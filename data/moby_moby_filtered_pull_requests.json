[
    {
        "merged": false,
        "additions": 27,
        "deletions": 127,
        "changed_files": 6,
        "created_at": "2023-10-18T00:05:35Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-17T21:41:32Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Add IP_NF_MANGLE to \"Generally Required\" kernel features, since it appears to be necessary for Docker Swarm to work.\r\n\r\nCloses #46636\r\n\r\n**- What I did**\r\nUsed the `check-config.sh` script for my custom Linux to be compatible with Docker.  And it mostly works, except connecting to local services in swarm mode! \r\n\r\nI tested on a single-node swarm cluster and started a simple web service:\r\n```\r\ndocker swarm init --default-addr-pool 10.22.0.0/16\r\ndocker service create --publish published=8088,target=80 --name=www nginx:1.25.2-alpine\r\ncurl 127.0.0.1:8088\r\n``` \r\nThe last command will fail to connect to the published port: `curl: (7) Failed to connect to 127.0.0.1 port 8088 after 0 ms: Error`\r\n\r\n\r\n**- How I did it**\r\nI isolated the cause for the connection refused to a single kernel module, using lots of `lsmod` and `diff` between a working system and my broken system, and moving various kernel modules out of the way and back again. It took some time.\r\n\r\n**- How to verify it**\r\nFirst establish a failing test case:\r\n1. Boot into a Linux that starts a Docker Engine but any swarm nodes.\r\n2. `sudo mv /lib/modules/6.1.51/kernel/net/ipv4/netfilter/iptable_mangle.ko{,.disabled}` (or equivalent) to move kernel modules out of the way.\r\n3. `docker swarm init --default-addr-pool 10.22.0.0/16`\r\n4. `docker service create --publish published=8088,target=80 --name=www nginx:1.25.2-alpine`\r\n6. `curl 127.0.0.1:8088`\r\nExpected: Connected, HTML is shown .\r\nActual: Connection failed.\r\nRun `lsmod | grep iptable_mangle` and confirm the module isn't loaded.\r\n\r\nCleanup:\r\n1. `docker service rm www`\r\n2. `docker swarm leave --force`\r\n\r\n\r\nNow confirm that the module is indeed required by swarm:\r\n1. `sudo mv /lib/modules/6.1.51/kernel/net/ipv4/netfilter/iptable_mangle.ko{.disabled,}` to reinstall kernel module\r\n2. `docker swarm init --default-addr-pool 10.22.0.0/16`\r\n3. `lsmod | grep iptable_mangle` and confirm the module is loaded but unused.\r\n4. `docker service create --publish published=8088,target=80 --name=www nginx:1.25.2-alpine`\r\n5. Run `lsmod | grep iptable_mangle` and confirm the module is in fact loaded and in use.\r\n6. `curl 127.0.0.1:8088`\r\nExpected/Actual: `iptable_mangle` is listed, HTML is shown.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\nAdd IP_NF_MANGLE to the list of \"Generally Required\" because it is required by Swarm.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n```\r\n                               __\r\n                              /\\_\\\r\n                             _\\/_/\r\n                            /\\_\\\r\n                            \\/_/_\r\n                              /\\_\\\r\n                              \\/_/\r\n                             /\\_\\               .\r\n                             \\/_/              ::\r\n                              .:::::::::::::..::::.\r\n                              :::::::::::::::::\r\n                              ;;;;;;.:::::::::\r\n                               ;;;;;;:::::::\r\n                                 ;;;:::::\r\n\r\n                        https://lightwhale.asklandd.dk\r\n\r\n```\r\n\r\nSigned-off-by: Stephan Henningsen <stephan+github@asklandd.dk>",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 94,
        "deletions": 87,
        "changed_files": 9,
        "created_at": "2023-10-17T20:33:31Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n- Related to #46237\r\n\r\nThe pattern of having low-level code that sets up iptables rules register reload callbacks for itself is not ideal. Callbacks can not be unregistered, so any values captured by the closures can never be GC'ed. And the callback registry is a singleton. While these issues could be overcome by iterating on the API, there are some other insurmountable issues which cannot be overcome without a complete overhaul of how the firewall reload logic is plumbed through. Imperative callback registration makes the control flow hard to reason about and the order of callbacks is implied by the order they were registered.\r\n\r\n**- What I did**\r\nMake the libnetwork Controller ultimately responsible for replaying firewall configuration when the firewall rulesets have been flushed externally. It fans out the reload signal to the drivers, which in turn fan out to the individual networks.\r\n\r\n**- How I did it**\r\nMade `(*Controller).handleFirewallReload` the only registered `iptables.OnReloaded` callback. It handles replaying firewall configuration for the controller, then calls into all the drivers which implement `FirewallReplayer` to handle replaying their own firewall configuration.\r\n\r\n**- How to verify it**\r\nTODO - UNVERIFIED\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\nN/A\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 19,
        "deletions": 18,
        "changed_files": 8,
        "created_at": "2023-10-17T14:36:20Z",
        "closed_at": "2023-10-18T08:23:23Z",
        "merged_at": "2023-10-18T08:23:23Z",
        "body": "### vendor: github.com/opencontainers/image-spec v1.1.0-rc5\r\n\r\nfull diff: https://github.com/opencontainers/image-spec/compare/v1.1.0-rc4...v1.1.0-rc5\r\n\r\n### replace some strings with OCI consts\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 21,
        "deletions": 1,
        "changed_files": 2,
        "created_at": "2023-10-17T10:05:41Z",
        "closed_at": null,
        "merged_at": null,
        "body": null,
        "comments": 1
    },
    {
        "merged": false,
        "additions": 7,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-17T08:38:19Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- follow up to: https://github.com/moby/moby/pull/46656\r\n\r\nMake sure we include the `no basic auth credentials` error in the\r\nmessage, so it looks like this:\r\n\r\n```\r\npull access denied for 127.0.0.1:5000/dockercli/busybox, repository does not exist or may require 'docker login': no basic auth credentials\r\n```\r\n\r\n**- How to verify it**\r\nCherry-pick: https://github.com/containerd/containerd/pull/9234\r\n```bash\r\nmake TEST_FILTER='TestLogoutWithExternalAuth'   TEST_IGNORE_CGROUP_CHECK=1   DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1    test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 10,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-17T02:24:22Z",
        "closed_at": null,
        "merged_at": null,
        "body": "This is a very simple first implementation; it relies on the way that `bkversion.Version` is overwritten in an initializer, and it doesn't expose the built-in Dockerfile frontend version/revision as that information is not currently available to BuildKit.\r\n\r\nThat being said, this is still a useful debug tool as-is given the increasing importance of the integrated BuildKit version for many users.\r\n\r\n```\r\nServer:\r\n Engine:\r\n  Version:          dev\r\n  API version:      1.44 (minimum version 1.12)\r\n  Go version:       go1.21.3\r\n  Git commit:       HEAD\r\n  Built:            Tue Oct 17 02:21:39 2023\r\n  OS/Arch:          linux/arm64\r\n  Experimental:     false\r\n containerd:\r\n  Version:          v1.7.6\r\n  GitCommit:        091922f03c2762540fd057fba91260237ff86acb\r\n runc:\r\n  Version:          1.1.9\r\n  GitCommit:        v1.1.9-0-gccaecfc\r\n docker-init:\r\n  Version:          0.19.0\r\n  GitCommit:        de40ad0\r\n BuildKit:\r\n  Version:          v0.12.2\r\n  GitCommit:        6560bb937e8c\r\n```",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 81,
        "deletions": 7,
        "changed_files": 5,
        "created_at": "2023-10-16T20:19:13Z",
        "closed_at": "2023-10-17T01:19:36Z",
        "merged_at": "2023-10-17T01:19:36Z",
        "body": "- backport of https://github.com/moby/moby/pull/46296\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 56,
        "deletions": 34,
        "changed_files": 6,
        "created_at": "2023-10-16T18:39:15Z",
        "closed_at": "2023-10-16T21:32:13Z",
        "merged_at": "2023-10-16T21:32:13Z",
        "body": "server: prohibit more than MaxConcurrentStreams handlers from running at once (CVE-2023-44487).\r\n\r\nIn addition to this change, applications should ensure they do not leave running tasks behind related to the RPC before returning from method handlers, or should enforce appropriate limits on any such work.\r\n\r\n- https://github.com/grpc/grpc-go/compare/v1.56.2...v1.56.3\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-16T16:06:56Z",
        "closed_at": "2023-10-16T17:12:48Z",
        "merged_at": "2023-10-16T17:12:48Z",
        "body": "\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\nFixes `ContainerCollectionTest.test_run_with_image_that_does_not_exist ` from docker-py\r\n\r\nPartially fixes TestImagePullNonExisting\r\n```diff\r\n$ make TEST_FILTER='TestImagePullNonExisting'   TEST_IGNORE_CGROUP_CHECK=1 DOCKER_BUILDKIT=0   DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1    test-integration\r\n(...)\r\n    --- FAIL: TestImagePullNonExisting/library/asdfasdf:foobar (0.02s)\r\n    --- FAIL: TestImagePullNonExisting/library/asdfasdf:latest (0.02s)\r\n    --- FAIL: TestImagePullNonExisting/asdfasdf:latest (0.02s)\r\n    --- FAIL: TestImagePullNonExisting/asdfasdf:foobar (0.03s)\r\n-    --- FAIL: TestImagePullNonExisting/library/asdfasdf (0.02s)\r\n-    --- FAIL: TestImagePullNonExisting/asdfasdf (0.02s)\r\n+    --- PASS: TestImagePullNonExisting/library/asdfasdf (1.00s)\r\n+    --- PASS: TestImagePullNonExisting/asdfasdf (1.01s)\r\nFAIL\r\n```\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 2,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-16T15:25:31Z",
        "closed_at": null,
        "merged_at": null,
        "body": "After a successful push, all pushed blobs should have a distribution.source label pointing to the new registry.\r\n\r\nBefore this commit, the label was only appended to the top-level blob (manifest or manifest list). Adjust this to also do that recursively to its children.\r\n\r\n\r\n**- How to verify it**\r\n```diff\r\n$ make TEST_FILTER='TestCrossRepositoryLayerPush'  TEST_IGNORE_CGROUP_CHECK=1   DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1   test-integration\r\n-=== FAIL: arm64.integration-cli TestDockerRegistrySuite/TestCrossRepositoryLayerPush (0.31s)\r\n-    docker_cli_push_test.go:193: assertion failed: expression is false: strings.Contains(out2, \"Mounted from dockercli/busybox\")\r\n-    check_test.go:476: [d0718e9a70ac8] daemon is not started\r\n-    --- FAIL: TestDockerRegistrySuite/TestCrossRepositoryLayerPush (0.31s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerRegistrySuite (0.31s)\r\n+=== RUN   TestDockerRegistrySuite/TestCrossRepositoryLayerPush\r\n+    check_test.go:476: [d5f85572549ed] daemon is not started\r\n+--- PASS: TestDockerRegistrySuite (0.79s)\r\n+    --- PASS: TestDockerRegistrySuite/TestCrossRepositoryLayerPush (0.79s)\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 36,
        "deletions": 12,
        "changed_files": 1,
        "created_at": "2023-10-16T11:46:50Z",
        "closed_at": null,
        "merged_at": null,
        "body": "The `Tags` slice of each history entry was filled with tags of parent image. Change it to correctly assign the current image tags.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n```diff\r\n$ make TEST_FILTER='TestAPIImagesHistory'  TEST_IGNORE_CGROUP_CHECK=1  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1   test-integration\r\n-=== Failed\r\n-=== FAIL: arm64.integration-cli TestDockerAPISuite/TestAPIImagesHistory (0.79s)\r\n-    docker_api_images_test.go:89: assertion failed: found is false\r\n-    --- FAIL: TestDockerAPISuite/TestAPIImagesHistory (0.79s)\r\n+=== RUN   TestDockerAPISuite/TestAPIImagesHistory\r\n+--- PASS: TestDockerAPISuite (0.84s)\r\n+    --- PASS: TestDockerAPISuite/TestAPIImagesHistory (0.79s)\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 57,
        "deletions": 22,
        "changed_files": 1,
        "created_at": "2023-10-16T11:19:13Z",
        "closed_at": "2023-10-17T11:56:58Z",
        "merged_at": "2023-10-17T11:56:58Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n~~Fix `TestImportWithCustomPlatform` (failing in https://github.com/moby/moby/actions/runs/6506688442/job/17672826153)~~\r\n\r\nSkip failing `TestImportWithCustomPlatform` test cases when using the containerd image store.\r\n\r\n**- How I did it**\r\n\r\n~~Reuse the same validation logic from [here](https://github.com/moby/moby/blob/5c3d0fbc5e665911133bb2f0de6b3fa5af41441a/image/image_os.go#L13-L18)~~\r\n\r\n~~that's already used in [here](https://github.com/moby/moby/blob/5c3d0fbc5e665911133bb2f0de6b3fa5af41441a/daemon/images/image_import.go#L34-L36)~~\r\n\r\nSplit out the \"reject\" cases from `TestImportWithCustomPlatform` into a new test `TestImportWithCustomPlatformReject`, which is skipped when using the containerd image store.\r\n\r\n**- How to verify it**\r\n\r\n` go test -run TestImportWithCustomPlatform ./integration/image/...`\r\n` go test -run TestImportWithCustomPlatformReject ./integration/image/...`\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![image](https://github.com/moby/moby/assets/70572044/7349aa65-8caf-413d-81c9-9c6ad63fabb9)\r\n",
        "comments": 13
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-16T10:10:13Z",
        "closed_at": "2023-10-16T17:33:08Z",
        "merged_at": "2023-10-16T17:33:08Z",
        "body": "- Fix https://github.com/moby/moby/issues/42461\r\n- Fix https://github.com/moby/moby/issues/46583\r\n- Closes https://github.com/moby/moby/pull/42454. Commit message has been improved and a couple comments have been added.\r\n\r\n**- What I did**\r\n\r\nWhen the default bridge is disabled by setting dockerd's `--bridge=none` option, the daemon still creates a sandbox for containers with no network attachment specified. In that case `NetworkDisabled` will be set to true.\r\n\r\nHowever, currently the `releaseNetwork` call will early return if NetworkDisabled is true. Thus, these sandboxes won't be deleted until the daemon is restarted. If a high number of such containers are created, the daemon would then take few minutes to start.\r\n\r\nAs a side note, `NetworkDisabled` semantics is weird/broken and should be revised:\r\n\r\n* On one hand a sandbox is created even if `NetworkDisbled` is set. Thus it allows these containers to be manually connected to other networks;\r\n* OTOH, when manually connecting such container to a network nothing happens and no error is returned (ie. no interface and no route provisioned, no embedded DNS, etc...);\r\n\r\n**- Description for the changelog**\r\n\r\n* Fix a bug that would prevent network sandboxes to be properly deleted when stopping containers with no network attachment are specified and dockerd's `--bridge=none` option is specified.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://hips.hearstapps.com/goodhousekeeping-uk/main/embedded/21976/giant_panda_bear-snow-good_housekeeping_uk.jpg?crop=1xw:0.75xh;center,top&resize=1200:*)",
        "comments": 4
    },
    {
        "merged": false,
        "additions": 42,
        "deletions": 6,
        "changed_files": 4,
        "created_at": "2023-10-15T14:59:13Z",
        "closed_at": null,
        "merged_at": null,
        "body": "\r\n\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nFix #46580\r\n\r\n**- How I did it**\r\n\r\nAdded the following fields:\r\n\r\n```diff\r\ndiff --git a/api/types/system/info.go b/api/types/system/info.go\r\nindex 09dbbd0926..89d4a0098e 100644\r\n--- a/api/types/system/info.go\r\n+++ b/api/types/system/info.go\r\n@@ -58,7 +58,7 @@ type Info struct {\r\n        Labels             []string\r\n        ExperimentalBuild  bool\r\n        ServerVersion      string\r\n-       Runtimes           map[string]Runtime\r\n+       Runtimes           map[string]RuntimeWithStatus\r\n        DefaultRuntime     string\r\n        Swarm              swarm.Info\r\n        // LiveRestoreEnabled determines whether containers should be kept\r\ndiff --git a/api/types/system/runtime.go b/api/types/system/runtime.go\r\nindex 83433acf92..037d3c237d 100644\r\n--- a/api/types/system/runtime.go\r\n+++ b/api/types/system/runtime.go\r\n@@ -12,3 +12,17 @@ type Runtime struct {\r\n        Type    string                 `json:\"runtimeType,omitempty\"`\r\n        Options map[string]interface{} `json:\"options,omitempty\"`\r\n }\r\n+\r\n+// RuntimeStatus descirbes an OCI runtime status.\r\n+type RuntimeStatus struct {\r\n+       // RRO is set to true when the runtime and the kernel support RRO mount.\r\n+       // RRO is set to false when the runtime or the kernel does not support RRO mount.\r\n+       // RRO is set to nil when the status is unknown.\r\n+       RRO *bool `json:\"rro,omitempty\"`\r\n+}\r\n+\r\n+// RuntimeWithStatus extends [Runtime] to hold [RuntimeStatus].\r\n+type RuntimeWithStatus struct {\r\n+       Runtime\r\n+       Status *RuntimeStatus `json:\"status,omitempty\"`\r\n+}\r\n```\r\n\r\n**- How to verify it**\r\n\r\n```console\r\n$ curl -s --unix-socket /var/run/docker.sock http://docker/v1.44/info | jq .Runtimes\r\n{\r\n  \"crun\": {\r\n    \"path\": \"/usr/local/bin/crun\",\r\n    \"status\": {\r\n      \"rro\": true\r\n    }\r\n  },\r\n  \"io.containerd.runc.v2\": {\r\n    \"path\": \"runc\",\r\n    \"status\": {\r\n      \"rro\": true\r\n    }\r\n  },\r\n  \"runc\": {\r\n    \"path\": \"runc\",\r\n    \"status\": {\r\n      \"rro\": true\r\n    }\r\n  },\r\n  \"runsc\": {\r\n    \"path\": \"/usr/local/bin/runsc\",\r\n    \"status\": {\r\n      \"rro\": false\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n(`docker info --format json` cannot be used until vendoring this PR into the CLI repo)\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\ndocker info: expose runtime features (\"rro\" mount mode, etc.)\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\ud83d\udc27 ",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 23,
        "deletions": 9,
        "changed_files": 2,
        "created_at": "2023-10-14T16:45:19Z",
        "closed_at": "2023-10-16T18:07:14Z",
        "merged_at": "2023-10-16T18:07:14Z",
        "body": "- follow-up to / relates to https://github.com/moby/moby/pull/40894\r\n\r\nThis is a follow-up to 2216d3ca8d65c5b0c85e297a3eb351a05db3a4d2 (https://github.com/moby/moby/pull/40894), which implemented the StartInterval for health-checks, but did not add validation for the minimum accepted interval;\r\n\r\n> The time to wait between checks in nanoseconds during the start period.\r\n> It should be 0 or at least 1000000 (1 ms). 0 means inherit.\r\n\r\nThis patch adds validation for the minimum accepted interval (1ms).\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 3021,
        "changed_files": 10,
        "created_at": "2023-10-14T12:36:34Z",
        "closed_at": "2023-10-16T18:10:15Z",
        "merged_at": "2023-10-16T18:10:15Z",
        "body": "While updating the docker/docker dependency in BuildKit, I noticed that the dependency tree showed _two_ separate versions of the semconv package; BuildKit and containerd were using the v1.17.0 version and docker/docker was using v1.7.0.\r\n\r\nThis patch updates the version we use to align with BuildKit and containerd.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 114,
        "deletions": 18,
        "changed_files": 18,
        "created_at": "2023-10-13T20:35:30Z",
        "closed_at": "2023-10-15T20:14:20Z",
        "merged_at": "2023-10-15T20:14:20Z",
        "body": "update buildkit to the latest code in the v0.12 branch:\r\n\r\nfull diff: https://github.com/moby/buildkit/compare/f94ed7cec313...6560bb937e8c5c86882d77ac83468ef2650d398f\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 6,
        "changed_files": 1,
        "created_at": "2023-10-13T17:41:46Z",
        "closed_at": "2023-10-13T18:36:49Z",
        "merged_at": "2023-10-13T18:36:49Z",
        "body": "This reverts commit 87775923971f93828610335b272129b33571541e (https://github.com/moby/moby/pull/46631), which turns out to break other test cases/the registry flow.\r\n\r\nThe correct place to handle missing credentials is instead https://github.com/containerd/containerd/blob/15bf23df09f974fe4813dd65eb550763f621fc0b/remotes/docker/authorizer.go#L200.",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 12,
        "deletions": 3,
        "changed_files": 2,
        "created_at": "2023-10-13T16:56:10Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Check if it's just some race condition between removing the container and actually decreasing the refcount.\r\n\r\nOpening a PR to have a CI run, because I can't reproduce this locally.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-10-13T11:21:48Z",
        "closed_at": "2023-10-13T16:12:24Z",
        "merged_at": "2023-10-13T16:12:24Z",
        "body": "Use a unique parent view snapshot key for each diff request.\r\n\r\nI considered using singleflight at first, but I realized it wouldn't really be correct.\r\nThe diff can take some time, so there's a window of time between the diff start and finish, where the file system can change. These changes not always will be reflected in the running diff.\r\n\r\nWith singleflight, the second diff request which happened before the previous diff was finished, would not include changes made to the container filesystem after the first diff request has started.\r\n\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker run --name asdf -d alpine touch /1\r\n$ docker diff asdf & docker diff asdf\r\n-[1] 5931\r\n-A /usr\r\n-A /usr/share\r\n-A /usr/share/misc\r\n-A /usr/share/udhcpc\r\n-A /usr/share/udhcpc/default.script\r\n-A /usr/share/apk\r\n-A /usr/share/apk/keys\r\n-A /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616db30d.rsa.pub\r\n-A /usr/share/apk/keys/aarch64\r\n-(...) # A LOT OF FILES THERE\r\n-A /lib/firmware\r\n-A /lib/libapk.so.2.14.0\r\n-A /lib/libssl.so.3\r\n-A /lib/libz.so.1.2.13\r\n-A /lib/modules-load.d\r\n-A /media\r\n-A /media/cdrom\r\n-A /media/floppy\r\n-A /media/usb\r\n-A /mnt\r\n-A /1\r\n-[1]+  Done                    docker diff asdf\r\n+[2] 5181\r\n+A /1\r\n+A /1\r\n+[1]   Done                    docker diff asdf\r\n+[2]+  Done                    docker diff asdf\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n```release-note\r\ncontainerd image store: Fix `docker diff` not working correctly when called multiple times concurrently for the same container\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-10-13T06:51:00Z",
        "closed_at": "2023-10-13T14:03:48Z",
        "merged_at": "2023-10-13T14:03:48Z",
        "body": "**- What I did**\r\n\r\nOn modern kernels this is an alias; however newer code has preferred ctstate while older code has preferred the deprecated 'state' name.\r\n\r\nPrefer the newer name for uniformity in the rules libnetwork creates, and because some implementations/distributions of the xtables userland tools may not support the legacy alias.\r\n\r\n**- Description for the changelog**\r\nN/A\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": false,
        "additions": 119,
        "deletions": 47,
        "changed_files": 5,
        "created_at": "2023-10-12T16:36:37Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nMakes the cache in classic builder work with the containerd image store\r\n\r\nIn order for the cache in the classic builder to work we need to:\r\n- use the came comparison function as the graph drivers implementation\r\n- save the container config when commiting the image\r\n- use all images to search a 'FROM \"scratch\"' image\r\n- load all images if `cacheFrom` is empty\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestBuildAddCurrentDirWithoutCache TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestBuildAddRemoteFileWithAndWithoutCache TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestBuildCopyDirButNotFile TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration \r\n```\r\n\r\nAnd surely others.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-12T13:50:09Z",
        "closed_at": "2023-10-12T16:40:24Z",
        "merged_at": "2023-10-12T16:40:24Z",
        "body": "**- What I did**\r\n\r\nSkipped the `TestPullAllTagsFromCentralRegistry` test when using containerd.\r\n\r\nThe image that this test pulls contains an error in the linux/amd64 manifest description, the reported size is 424 but the actual size is 524, making this test fail with containerd.\r\n\r\nI've opened a ticket to fix the image used in this test https://github.com/moby/moby/issues/46632\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-12T13:03:46Z",
        "closed_at": "2023-10-13T11:03:27Z",
        "merged_at": "2023-10-13T11:03:27Z",
        "body": "**- What I did**\r\n\r\nChanged the autorizer configuration to return `ErrNoBasicAuthCredentials` error when needed.\r\nIf the auth config contains an empty username/password we should return an error\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n`TestLogoutWithExternalAuth` should pass now\r\n\r\n```\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestLogoutWithExternalAuth TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 2,
        "deletions": 10,
        "changed_files": 2,
        "created_at": "2023-10-12T09:56:25Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\n- Resolve moby/moby#46615.\r\n- Revert commit ee9e52676409b2e428a816ac59f42f5ba61089dd from https://github.com/moby/moby/pull/42598\r\n- reopens https://github.com/moby/moby/issues/41525\r\n- reopens https://github.com/moby/moby/issues/33925\r\n\r\nRoute scope is used by the kernel to choose what source IP address should be used when establishing an outbound connection. As such, filtering routes based on their scope doesn't make sense. It happened to work for the original contributor only by chance.\r\n\r\nI didn't take much time to look into all the issues related to `CheckRouteOverlaps` but it'd be probably better to add an option to skip this check if the user wants it.\r\n\r\n**- How to verify it**\r\n\r\nSee the reproducer in https://github.com/moby/moby/issues/46615\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://i.natgeofe.com/n/70f8fe9c-d289-4965-9e07-3c430fefba08/02_animal_day_gallery_prairie_dog_2x3.jpg)\r\n",
        "comments": 6
    },
    {
        "merged": false,
        "additions": 49,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-10-12T07:27:44Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Fixes #46621 by returning a `context.Canceled` error to the caller.\r\n\r\n**- What I did**\r\n\r\nI added a check id `err` is a `context.Canceled` error. If so, we return the `err` directly to the caller through `errC`. In all other cases the error is generated from the API response just as before the change.\r\n\r\n**- How I did it**\r\n\r\nIt's as easy as checking the type of `err`. If it's a `context.Canceled` we skip creating an error from the (then empty) API response.\r\n\r\n**- How to verify it**\r\n\r\nCall `client.ContainerWait()` with a cancelable context and while waiting for the method to end, cancel the given context. before the change an error with an empty (`\"\"`) error message has been returned on `errC`. After the change a `context.Canceled` error will be returned on the `errC`.\r\n\r\n**- Description for the changelog**\r\n\r\n`client.ContainerWait()` now returns a `context.Canceled` error on the error channel when the operation is canceled via its context.\r\n\r\n\r\n",
        "comments": 8
    },
    {
        "merged": true,
        "additions": 25,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-10-12T01:03:23Z",
        "closed_at": "2023-10-12T06:52:48Z",
        "merged_at": "2023-10-12T06:52:48Z",
        "body": "Cherry-pick (non-clean):\r\n- #46564 ",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 25,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-10-11T22:30:10Z",
        "closed_at": "2023-10-12T06:50:47Z",
        "merged_at": "2023-10-12T06:50:47Z",
        "body": "Cherry-pick (non-clean):\r\n- https://github.com/moby/moby/pull/46564",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 5,
        "created_at": "2023-10-11T17:43:09Z",
        "closed_at": "2023-10-12T08:59:56Z",
        "merged_at": "2023-10-12T08:59:56Z",
        "body": "- relates to https://github.com/moby/moby/pull/46622\r\n\r\n\r\n### update to go1.20.9\r\n\r\ngo1.20.9 (released 2023-10-05) includes one security fixes to the cmd/go package,\r\nas well as bug fixes to the go command and the linker. See the Go 1.20.9\r\nmilestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.9+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.8...go1.20.9\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.2 and Go 1.20.9 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.2 and 1.20.9, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- cmd/go: line directives allows arbitrary execution during build\r\n\r\n  \"//line\" directives can be used to bypass the restrictions on \"//go:cgo_\"\r\n  directives, allowing blocked linker and compiler flags to be passed during\r\n  compliation. This can result in unexpected execution of arbitrary code when\r\n  running \"go build\". The line directive requires the absolute path of the file in\r\n  which the directive lives, which makes exploting this issue significantly more\r\n  complex.\r\n\r\n  This is CVE-2023-39323 and Go issue https://go.dev/issue/63211.\r\n\r\n-----\r\n\r\n### update to go1.20.10\r\n\r\ngo1.20.10 (released 2023-10-10) includes a security fix to the net/http package.\r\nSee the Go 1.20.10 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.10+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.9...go1.20.10\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.3 and Go 1.20.10 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.3 and 1.20.10, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- net/http: rapid stream resets can cause excessive work\r\n\r\n  A malicious HTTP/2 client which rapidly creates requests and\r\n  immediately resets them can cause excessive server resource consumption.\r\n  While the total number of requests is bounded to the\r\n  http2.Server.MaxConcurrentStreams setting, resetting an in-progress\r\n  request allows the attacker to create a new request while the existing\r\n  one is still executing.\r\n\r\n  HTTP/2 servers now bound the number of simultaneously executing\r\n  handler goroutines to the stream concurrency limit. New requests\r\n  arriving when at the limit (which can only happen after the client\r\n  has reset an existing, in-flight request) will be queued until a\r\n  handler exits. If the request queue grows too large, the server\r\n  will terminate the connection.\r\n\r\n  This issue is also fixed in golang.org/x/net/http2 v0.17.0,\r\n  for users manually configuring HTTP/2.\r\n\r\n  The default stream concurrency limit is 250 streams (requests)\r\n  per HTTP/2 connection. This value may be adjusted using the\r\n  golang.org/x/net/http2 package; see the Server.MaxConcurrentStreams\r\n  setting and the ConfigureServer function.\r\n\r\n  This is CVE-2023-39325 and Go issue https://go.dev/issue/63417.\r\n  This is also tracked by CVE-2023-44487.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 6,
        "changed_files": 6,
        "created_at": "2023-10-11T17:40:06Z",
        "closed_at": "2023-10-11T23:28:43Z",
        "merged_at": "2023-10-11T23:28:43Z",
        "body": "- relates to https://github.com/moby/moby/pull/46622\r\n\r\n\r\n### update to go1.20.9\r\n\r\ngo1.20.9 (released 2023-10-05) includes one security fixes to the cmd/go package,\r\nas well as bug fixes to the go command and the linker. See the Go 1.20.9\r\nmilestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.9+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.8...go1.20.9\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.2 and Go 1.20.9 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.2 and 1.20.9, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- cmd/go: line directives allows arbitrary execution during build\r\n\r\n  \"//line\" directives can be used to bypass the restrictions on \"//go:cgo_\"\r\n  directives, allowing blocked linker and compiler flags to be passed during\r\n  compliation. This can result in unexpected execution of arbitrary code when\r\n  running \"go build\". The line directive requires the absolute path of the file in\r\n  which the directive lives, which makes exploting this issue significantly more\r\n  complex.\r\n\r\n  This is CVE-2023-39323 and Go issue https://go.dev/issue/63211.\r\n\r\n-----\r\n\r\n### update to go1.20.10\r\n\r\ngo1.20.10 (released 2023-10-10) includes a security fix to the net/http package.\r\nSee the Go 1.20.10 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.10+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.9...go1.20.10\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.3 and Go 1.20.10 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.3 and 1.20.10, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- net/http: rapid stream resets can cause excessive work\r\n\r\n  A malicious HTTP/2 client which rapidly creates requests and\r\n  immediately resets them can cause excessive server resource consumption.\r\n  While the total number of requests is bounded to the\r\n  http2.Server.MaxConcurrentStreams setting, resetting an in-progress\r\n  request allows the attacker to create a new request while the existing\r\n  one is still executing.\r\n\r\n  HTTP/2 servers now bound the number of simultaneously executing\r\n  handler goroutines to the stream concurrency limit. New requests\r\n  arriving when at the limit (which can only happen after the client\r\n  has reset an existing, in-flight request) will be queued until a\r\n  handler exits. If the request queue grows too large, the server\r\n  will terminate the connection.\r\n\r\n  This issue is also fixed in golang.org/x/net/http2 v0.17.0,\r\n  for users manually configuring HTTP/2.\r\n\r\n  The default stream concurrency limit is 250 streams (requests)\r\n  per HTTP/2 connection. This value may be adjusted using the\r\n  golang.org/x/net/http2 package; see the Server.MaxConcurrentStreams\r\n  setting and the ConfigureServer function.\r\n\r\n  This is CVE-2023-39325 and Go issue https://go.dev/issue/63417.\r\n  This is also tracked by CVE-2023-44487.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1557,
        "deletions": 2471,
        "changed_files": 121,
        "created_at": "2023-10-11T17:02:31Z",
        "closed_at": "2023-10-12T09:15:23Z",
        "merged_at": "2023-10-12T09:15:22Z",
        "body": "- relates to https://github.com/moby/moby/pull/46622\r\n\r\n\r\n---\r\n\r\n\r\n### vendor: golang.org/x/sys v0.13.0\r\n\r\nfull diff: https://github.com/golang/sys/compare/v0.10.0...v0.13.0\r\n\r\n\r\n### vendor: golang.org/x/text v0.13.0\r\n\r\nfull diff: https://github.com/golang/text/compare/v0.11.0...v0.13.0\r\n\r\n### vendor: golang.org/x/crypto v0.14.0\r\n\r\nfull diff: https://github.com/golang/crypto/compare/v0.11.0...v0.14.0\r\n\r\n### vendor: golang.org/x/net v0.17.0\r\n\r\nfull diff: https://github.com/golang/net/compare/v0.13.0...v0.17.0\r\n\r\nThis fixes the same CVE as go1.21.3 and go1.20.10;\r\n\r\n- net/http: rapid stream resets can cause excessive work\r\n\r\n  A malicious HTTP/2 client which rapidly creates requests and\r\n  immediately resets them can cause excessive server resource consumption.\r\n  While the total number of requests is bounded to the\r\n  http2.Server.MaxConcurrentStreams setting, resetting an in-progress\r\n  request allows the attacker to create a new request while the existing\r\n  one is still executing.\r\n\r\n  HTTP/2 servers now bound the number of simultaneously executing\r\n  handler goroutines to the stream concurrency limit. New requests\r\n  arriving when at the limit (which can only happen after the client\r\n  has reset an existing, in-flight request) will be queued until a\r\n  handler exits. If the request queue grows too large, the server\r\n  will terminate the connection.\r\n\r\n  This issue is also fixed in golang.org/x/net/http2 v0.17.0,\r\n  for users manually configuring HTTP/2.\r\n\r\n  The default stream concurrency limit is 250 streams (requests)\r\n  per HTTP/2 connection. This value may be adjusted using the\r\n  golang.org/x/net/http2 package; see the Server.MaxConcurrentStreams\r\n  setting and the ConfigureServer function.\r\n\r\n  This is CVE-2023-39325 and Go issue https://go.dev/issue/63417.\r\n  This is also tracked by CVE-2023-44487.\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 7,
        "changed_files": 7,
        "created_at": "2023-10-11T16:49:43Z",
        "closed_at": "2023-10-11T22:20:22Z",
        "merged_at": "2023-10-11T22:20:22Z",
        "body": "### update to go1.21.2\r\n\r\ngo1.21.2 (released 2023-10-05) includes one security fixes to the cmd/go package,\r\nas well as bug fixes to the compiler, the go command, the linker, the runtime,\r\nand the runtime/metrics package. See the Go 1.21.2 milestone on our issue\r\ntracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.21.2+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.21.1...go1.21.2\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.2 and Go 1.20.9 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.2 and 1.20.9, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- cmd/go: line directives allows arbitrary execution during build\r\n\r\n  \"//line\" directives can be used to bypass the restrictions on \"//go:cgo_\"\r\n  directives, allowing blocked linker and compiler flags to be passed during\r\n  compliation. This can result in unexpected execution of arbitrary code when\r\n  running \"go build\". The line directive requires the absolute path of the file in\r\n  which the directive lives, which makes exploting this issue significantly more\r\n  complex.\r\n\r\n  This is CVE-2023-39323 and Go issue https://go.dev/issue/63211.\r\n\r\n-----\r\n\r\n### update to go1.21.3\r\n\r\ngo1.21.3 (released 2023-10-10) includes a security fix to the net/http package.\r\nSee the Go 1.21.3 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.21.3+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.21.2...go1.21.3\r\n\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.3 and Go 1.20.10 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.3 and 1.20.10, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- net/http: rapid stream resets can cause excessive work\r\n\r\n  A malicious HTTP/2 client which rapidly creates requests and\r\n  immediately resets them can cause excessive server resource consumption.\r\n  While the total number of requests is bounded to the\r\n  http2.Server.MaxConcurrentStreams setting, resetting an in-progress\r\n  request allows the attacker to create a new request while the existing\r\n  one is still executing.\r\n  \r\n  HTTP/2 servers now bound the number of simultaneously executing\r\n  handler goroutines to the stream concurrency limit. New requests\r\n  arriving when at the limit (which can only happen after the client\r\n  has reset an existing, in-flight request) will be queued until a\r\n  handler exits. If the request queue grows too large, the server\r\n  will terminate the connection.\r\n  \r\n  This issue is also fixed in golang.org/x/net/http2 v0.17.0,\r\n  for users manually configuring HTTP/2.\r\n  \r\n  The default stream concurrency limit is 250 streams (requests)\r\n  per HTTP/2 connection. This value may be adjusted using the\r\n  golang.org/x/net/http2 package; see the Server.MaxConcurrentStreams\r\n  setting and the ConfigureServer function.\r\n  \r\n  This is CVE-2023-39325 and Go issue https://go.dev/issue/63417.\r\n  This is also tracked by CVE-2023-44487.\r\n\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-11T13:47:53Z",
        "closed_at": "2023-10-11T16:35:56Z",
        "merged_at": "2023-10-11T16:35:56Z",
        "body": "`docker build --squash` is an experimental feature which is not implemented for containerd image store.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 107,
        "deletions": 132,
        "changed_files": 6,
        "created_at": "2023-10-11T12:31:22Z",
        "closed_at": "2023-10-12T00:49:49Z",
        "merged_at": "2023-10-12T00:49:49Z",
        "body": "- Backport of #46448 \r\n\r\n(cherry picked from commit f6fa56194f1c9cfd2e4ae41a17f75ab6b04f82df)\r\n\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 122,
        "deletions": 57,
        "changed_files": 5,
        "created_at": "2023-10-11T12:19:27Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- alternative to: https://github.com/moby/moby/pull/46516\r\n- closes https://github.com/moby/moby/pull/46516\r\n\r\n**distribution: Add Tags**\r\n\r\nAdd a function to return tags for the given repository reference. This\r\nis needed to implement the `pull -a` (pull all tags) for containerd\r\nwhich doesn't directly use distribution, but we need to somehow make an\r\nAPI call to the registry to obtain the available tags.\r\n\r\n**c8d/pull: Handle pull all tags**\r\n\r\nUse the distribution code to query the remote repository for tags and\r\npull them sequentially just like the non-c8d pull.\r\n\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull -a docker/doodle\r\n-Error response from daemon: failed to resolve reference \"docker.io/docker/doodle\": object required\r\n+birthday: Pulling from docker/doodle\r\n+ecaf003f35ec: Download complete\r\n+Digest: sha256:4a203cbea73f32a4885f8d9ee05233246445aa95dd4362887058ec663a7b8088\r\n+Status: Downloaded newer image for docker/doodle:birthday\r\n+birthday2019: Pulling from docker/doodle\r\n+Digest: sha256:4a203cbea73f32a4885f8d9ee05233246445aa95dd4362887058ec663a7b8088\r\n+Status: Downloaded newer image for docker/doodle:birthday2019\r\n(...)\r\n+summer: Pulling from docker/doodle\r\n+6fe738df11e6: Download complete\r\n+Digest: sha256:f7fdfd4a030d16a619f32f183307c9f60ddd9206dc92b1c3b1e1c2f1450567fc\r\n+Status: Downloaded newer image for docker/doodle:summer\r\n+summer2019: Pulling from docker/doodle\r\n+Digest: sha256:f7fdfd4a030d16a619f32f183307c9f60ddd9206dc92b1c3b1e1c2f1450567fc\r\n+Status: Downloaded newer image for docker/doodle:summer2019\r\n+docker.io/docker/doodle\r\n\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-note\r\n- containerd image store: Implement pulling all tags (`docker pull -a`)\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 109,
        "deletions": 132,
        "changed_files": 6,
        "created_at": "2023-10-11T08:20:55Z",
        "closed_at": "2023-10-11T20:07:51Z",
        "merged_at": "2023-10-11T20:07:51Z",
        "body": "- Backport of https://github.com/moby/moby/pull/46448 \r\n\r\n(cherry picked from commit f6fa56194f1c9cfd2e4ae41a17f75ab6b04f82df)\r\n\r\n\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 28,
        "deletions": 25,
        "changed_files": 1,
        "created_at": "2023-10-10T12:16:24Z",
        "closed_at": "2023-10-10T16:41:59Z",
        "merged_at": "2023-10-10T16:41:59Z",
        "body": "\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nExtract the distribution source label append into its own function and make it not fail on any error, we do still log the error.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 17364,
        "deletions": 1507,
        "changed_files": 31,
        "created_at": "2023-10-10T10:38:22Z",
        "closed_at": "2023-10-10T14:55:21Z",
        "merged_at": "2023-10-10T14:55:21Z",
        "body": "- relates to https://github.com/moby/moby/pull/46473\r\n\r\n---\r\n\r\n### vendor: golang.org/x/text v0.11.0\r\n\r\nfull diff: https://github.com/golang/text/compare/v0.9.0...v0.11.0\r\n\r\n\r\n### vendor: golang.org/x/net v0.13.0, golang.org/x/crypto v0.11.0\r\n\r\nfull diff: https://github.com/golang/net/compare/v0.10.0...v0.13.0\r\nfull diff: https://github.com/golang/crypto/compare/v0.9.0...v0.11.0\r\n\r\n### vendor: github.com/containerd/containerd v1.7.7\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.6...v1.7.7\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 52,
        "deletions": 560,
        "changed_files": 9,
        "created_at": "2023-10-10T08:19:16Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- Stacked on top of #46603\r\n- Related to CI failures seen on #46531\r\n\r\n**- What I did**\r\n\r\nFirst commit (excluding the one coming from #46603) adds a way to enable/disable upstream forwarding to the embedded resolver. When an endpoint joins/leaves a sandbox, this forwarding policy is modified based on whether there's an endpoint providing external connectivity.\r\n\r\nSecond commit ensures the resolver return a NXDOMAIN response when upstream forwarding is disabled and no matching container/alias can be found.\r\n\r\n**- Description for the changelog**\r\n\r\n* The embedded DNS resolver now returns a NXDOMAIN response when upstream forwarding is disabled (ie. on internal networks, or on Windows) and no container/alias match the queried name.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://ohlavache.org/wp-content/uploads/2021/11/TM-2-1024x683.jpg)",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-09T12:06:59Z",
        "closed_at": "2023-10-11T11:48:31Z",
        "merged_at": "2023-10-11T11:48:31Z",
        "body": "- Closes: https://github.com/moby/moby/issues/46600\r\n\r\nAllow to load images from compressed tars.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull alpine\r\nUsing default tag: latest\r\nlatest: Pulling from library/alpine\r\n579b34f0a95b: Download complete\r\nDigest: sha256:eece025e432126ce23f223450a0326fbebde39cdf496a85d8c016293fc851978\r\nStatus: Downloaded newer image for alpine:latest\r\ndocker.io/library/alpine:latest\r\n\r\n$ docker save alpine > alpine.tar\r\n$ gzip <alpine.tar >alpine.tar.gz\r\n\r\n$ docker rmi alpine\r\nUntagged: alpine:latest\r\nDeleted: sha256:eece025e432126ce23f223450a0326fbebde39cdf496a85d8c016293fc85197\r\n\r\n$ docker load -i alpine.tar\r\nLoaded image: alpine\r\n\r\n$ docker load -i alpine.tar.gz\r\n-archive/tar: invalid tar header\r\n+Loaded image: alpine\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-note\r\n- containerd image store: Fix `docker load` not being able to load images from compressed tar archives.\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-09T11:16:01Z",
        "closed_at": "2023-10-09T12:23:14Z",
        "merged_at": "2023-10-09T12:23:14Z",
        "body": null,
        "comments": 0
    },
    {
        "merged": true,
        "additions": 30,
        "deletions": 16,
        "changed_files": 5,
        "created_at": "2023-10-09T10:59:03Z",
        "closed_at": "2023-10-11T15:07:03Z",
        "merged_at": "2023-10-11T15:07:02Z",
        "body": "Related to:\r\n\r\n- CI failures seen on https://github.com/moby/moby/pull/46531\r\n\r\n**- What I did**\r\n\r\nSo far, internal networks were only isolated from the host by iptables DROP rules. As a consequence, outbound connections from containers would timeout instead of being \"rejected\" through an immediate ICMP dest/port unreachable, a TCP RST or a failing `connect` syscall.\r\n\r\nThis was visible when internal containers were trying to resolve a domain that don't match any container on the same network (be it a truly \"external\" domain, or a container that don't exist/is dead). In that case, the embedded resolver would try to forward DNS queries for the different values of resolv.conf `search` option, making DNS resolution slow to return an error, and the slowness being exacerbated by some libc implementations.\r\n\r\nThis change makes `connect` syscall to return ENETUNREACH, and thus solves the broader issue of failing fast when external connections are attempted.\r\n\r\n**- How to verify it**\r\n\r\nCI is green.\r\n\r\n**- Description for the changelog**\r\n\r\n* Make `connect` syscall fail fast when a container is only attached to an internal network.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://cdn.naturettl.com/wp-content/uploads/2014/10/08201805/john-speirs_i-guess-summers-over-800x504.jpg)",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 40,
        "deletions": 74,
        "changed_files": 2,
        "created_at": "2023-10-09T10:28:30Z",
        "closed_at": "2023-10-11T17:18:16Z",
        "merged_at": "2023-10-11T17:18:16Z",
        "body": "**- What I did**\r\n\r\nRewrote `TestPullNonExistingImage` to use parallel subtests instead of the custom goroutines solution.\r\nDeduplicated asserts and rewrote with `gotest.tools`.\r\n\r\n**- How to verify it**\r\nSee `TestImagePullNonExisting`\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 22,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-07T00:06:28Z",
        "closed_at": null,
        "merged_at": null,
        "body": "closes #46598\r\n\r\n**- What I did**\r\n\r\nI've created a function where we can set TLS verification flag without reading it from environment variables.\r\n\r\n**- How I did it**\r\n\r\nI've added a new function called `WithTLSClientConfigVerification` to [client/options.go](../blob/master/client/options.go) file.\r\n\r\n**- How to verify it**\r\n\r\n- I ran a Docker daemon with tls_verify=0\r\n- I created a random ca.pem\r\n- Then I called this new function, passing the random ca.pem, with both `tlsVerify` as true and `tlsVerify` as false\r\n- I noticed I was able to connect with `tlsVerify` as true, and received a certificate error when running with `tlsVerify` as false, as expected\r\n\r\n**- Description for the changelog**\r\nAdded `WithTLSClientConfigVerification` function to client options to enable setting TLS verification flag\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n![image](https://github.com/moby/moby/assets/496350/3282a427-0b45-47bf-9b87-94fefcfbc58a)\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 9,
        "deletions": 4,
        "changed_files": 2,
        "created_at": "2023-10-05T14:25:18Z",
        "closed_at": "2023-10-10T16:45:21Z",
        "merged_at": "2023-10-10T16:45:21Z",
        "body": "A dangling image isn't really a tag.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker rmi 63be88a405ec\r\n-Untagged: moby-dangling@sha256:63be88a405ec007463ceb1b9c5546cd88c9af839e55bb34add6a246962b078f8\r\nDeleted: sha256:63be88a405ec007463ceb1b9c5546cd88c9af839e55bb34add6a246962b078f8\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 2,
        "created_at": "2023-10-05T09:02:50Z",
        "closed_at": "2023-10-12T18:37:52Z",
        "merged_at": "2023-10-12T18:37:52Z",
        "body": "Close #36598\r\n\r\nNote that this is my first PR in the Moby project, or in any go-language project for that matter. Please forgive my mistakes, and give detailed instructions if changes are necessary.\r\n\r\n**- What I did**\r\n\r\nAllow users to run registry mirrors that are rooted at a subpath of a domain.\r\n\r\n**- How I did it**\r\n\r\nIn the registry configuration validation step, I removed the parts that check that there is no path in the mirror URIs.\r\n\r\n**- How to verify it**\r\n\r\nRun a registry with docker.io proxy config:\r\n\r\ndocker-compose.yml:\r\n\r\n```\r\nservices:\r\n\r\n  registry:\r\n    image: docker.io/registry:2\r\n    volumes:\r\n      - ./registry.yml:/etc/docker/registry/config.yml:ro\r\n      - ./data/registry:/var/lib/registry\r\n    restart: unless-stopped\r\n\r\n  proxy:\r\n    image: docker.io/caddy\r\n    ports:\r\n      - \"5001:5001\"\r\n    volumes:\r\n      - ./Caddyfile:/etc/caddy/Caddyfile:ro\r\n    restart: unless-stopped\r\n ```\r\n\r\nregistry.yml:\r\n\r\n```\r\nversion: 0.1\r\nlog:\r\n  fields:\r\n    service: registry\r\nstorage:\r\n  cache:\r\n    blobdescriptor: inmemory\r\n  filesystem:\r\n    rootdirectory: /var/lib/registry\r\nhttp:\r\n  addr: :5000\r\n  headers:\r\n    X-Content-Type-Options: [nosniff]\r\nhealth:\r\n  storagedriver:\r\n    enabled: true\r\n    interval: 10s\r\n    threshold: 3\r\nproxy:\r\n  remoteurl: https://registry-1.docker.io\r\n```\r\n\r\nCaddyfile:\r\n\r\n```\r\n:5001 {\r\n    handle_path /hub/* {\r\n        reverse_proxy http://registry:5000\r\n    }\r\n}\r\n```\r\n\r\nRun a Docker daemon with the following configuration in /etc/docker/daemon.json:\r\n\r\n```\r\n{\r\n    \"registry-mirrors\": [\r\n        \"http://localhost:5001/hub\"\r\n    ]\r\n}\r\n```\r\n\r\nThen pull an image: `docker pull ubuntu` and verify that the request goes through the self-hosted registry.\r\n\r\n**- Description for the changelog**\r\n\r\nMake it possible to run a registry mirror with an URI that includes a path.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![cute](https://github.com/moby/moby/assets/44319/df39b801-fdcd-4ae2-9ee0-8218020cff35)\r\n\r\n",
        "comments": 6
    },
    {
        "merged": true,
        "additions": 17,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-10-04T13:57:02Z",
        "closed_at": "2023-10-05T09:52:22Z",
        "merged_at": "2023-10-05T09:52:22Z",
        "body": "\r\n\r\n\r\n**- What I did**\r\nMade `TestDaemonNoSpaceLeftOnDeviceError` pass with containerd integration enabled.\r\n\r\n**- How I did it**\r\n- Pass empty containerd socket which forces the daemon to create a new supervised containerd. Otherwise a global containerd daemon will be used and the pulled image data will be stored in its data directory, instead of the the newly specified `data-root` that has a limited storage capacity.\r\n\r\n- Don't try to use `vfs` snapshotter, instead use `native` which is containerd's equivalent for `vfs`.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ make TEST_FILTER=TestDaemonNoSpaceLeftOnDeviceError TEST_IGNORE_CGROUP_CHECK=1 DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 \\\r\n    test-integration\r\n-=== FAIL: amd64.integration-cli TestDockerDaemonSuite/TestDaemonNoSpaceLeftOnDeviceError (4.11s)\r\n-    docker_cli_daemon_test.go:1641: assertion failed: expression is false: strings.Contains(pullOut, \"no space left on device\")\r\n-    check_test.go:589: [d39a69b3940cb] daemon is not started\r\n-    --- FAIL: TestDockerDaemonSuite/TestDaemonNoSpaceLeftOnDeviceError (4.11s)\r\n+=== RUN   TestDockerDaemonSuite/TestDaemonNoSpaceLeftOnDeviceError\r\n+    check_test.go:589: [d17531973e45d] daemon is not started\r\n+--- PASS: TestDockerDaemonSuite (7.14s)\r\n+    --- PASS: TestDockerDaemonSuite/TestDaemonNoSpaceLeftOnDeviceError (7.14s)\r\n```\r\n\r\n**- Description for the changelog**\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 18,
        "deletions": 6,
        "changed_files": 1,
        "created_at": "2023-10-04T12:33:15Z",
        "closed_at": "2023-10-13T07:00:55Z",
        "merged_at": "2023-10-13T07:00:55Z",
        "body": "The reported size is bigger with snapshotters (because it also includes the size of the filesystem metadata).\r\nAdjust the test to also handle other sizes correctly.\r\n\r\n**- What I did**\r\nMade `TestPsListContainersSize` green with c8d.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ make TEST_IGNORE_CGROUP_CHECK=1 DOCKERCLI_INTEGRATION_VERSION=v24.0.5  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 DOCKER_BUILDKIT=0  'TEST_FILTER=TestPsListContainersSize' test-integration\r\n\r\n-=== FAIL: amd64.integration-cli TestDockerCLIPsSuite/TestPsListContainersSize (0.38s)\r\n-    docker_cli_ps_test.go:164: assertion failed: error is not nil: strconv.Atoi: parsing \"4.1k\": invalid syntax\r\n-    --- FAIL: TestDockerCLIPsSuite/TestPsListContainersSize (0.38s)\r\n+--- PASS: TestDockerCLIPsSuite (1.03s)\r\n+    --- PASS: TestDockerCLIPsSuite/TestPsListContainersSize (1.03s)\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 17,
        "deletions": 11,
        "changed_files": 6,
        "created_at": "2023-10-04T11:19:51Z",
        "closed_at": "2023-10-11T14:55:16Z",
        "merged_at": "2023-10-11T14:55:16Z",
        "body": "Instead of passing a completely fresh context without any values, just discard the cancellation.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 15,
        "deletions": 29,
        "changed_files": 2,
        "created_at": "2023-10-04T10:32:48Z",
        "closed_at": "2023-10-12T10:52:24Z",
        "merged_at": "2023-10-12T10:52:24Z",
        "body": "- Needs: https://github.com/moby/moby/pull/46611\r\n- Needs: https://github.com/containerd/containerd/pull/9193\r\n\r\n**- What I did**\r\nImplemented Mounted/Exists statuses when pushing\r\n\r\n**- How I did it**\r\nUse push statuses from containerd.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull alpine\r\n$ printf 'FROM alpine\\nRUN env>/env' | docker buildx build -t pawelgronowski465/pushpushpush -\r\n(...)\r\n => => exporting manifest sha256:fbc9873dff2b770cb9a5fa1718d5c9191a8074b3eca4455d814efe3ddb3d4fd1                                                         0.0s\r\n => => exporting config sha256:f1ee5bc3732603844c32381d7e9f5e3a82558fb05de0fecdef0695b8a29e08f5                                                           0.0s\r\n => => exporting attestation manifest sha256:ac7fc162ed6f67cbb935b482bc33c510b840ea740e00d6a9613a8e16fba624ea                                             0.0s\r\n => => exporting manifest list sha256:63be88a405ec007463ceb1b9c5546cd88c9af839e55bb34add6a246962b078f8                                                    0.0s\r\n\r\n$ docker push pawelgronowski465/pushpushpush\r\nUsing default tag: latest\r\nThe push refers to repository [docker.io/pawelgronowski465/pushpushpush]\r\nf1ee5bc37326: Pushed\r\n-579b34f0a95b: Pushed\r\n+579b34f0a95b: Mounted from library/alpine\r\na882e643d830: Pushed\r\na8267b856818: Pushed\r\nfcb00a1b7bad: Pushed\r\nfbc9873dff2b: Pushed\r\nac7fc162ed6f: Pushed\r\n63be88a405ec: Pushed\r\nlatest: digest: sha256:63be88a405ec007463ceb1b9c5546cd88c9af839e55bb34add6a246962b078f8 size: 855\r\n\r\n$ docker push  pawelgronowski465/pushpushpush\r\nUsing default tag: latest\r\nThe push refers to repository [docker.io/pawelgronowski465/pushpushpush]\r\n-579b34f0a95b: Pushed\r\n-a882e643d830: Pushed\r\n+579b34f0a95b: Layer already exists\r\n+a882e643d830: Layer already exists\r\nfbc9873dff2b: Pushed\r\nac7fc162ed6f: Pushed\r\n63be88a405ec: Pushed\r\n-a8267b856818: Pushed\r\n-fcb00a1b7bad: Pushed\r\n-f1ee5bc37326: Pushed\r\n+a8267b856818: Already exists\r\n+fcb00a1b7bad: Already exists\r\n+f1ee5bc37326: Already exists\r\nlatest: digest: sha256:63be88a405ec007463ceb1b9c5546cd88c9af839e55bb34add6a246962b078f8 size: 855\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-note\r\ncontainerd image store: `docker push` now supports `Layer already exists` and `Mounted from` progress statuses\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 54,
        "deletions": 13,
        "changed_files": 2,
        "created_at": "2023-10-04T09:42:22Z",
        "closed_at": "2023-10-10T08:05:02Z",
        "merged_at": "2023-10-10T08:05:02Z",
        "body": "- Related to: https://github.com/moby/moby/pull/46579\r\n\r\n\r\n\r\n**- What I did**\r\nImplemented IDs in `docker history` for images built with the legacy builder\r\n\r\n**- How I did it**\r\nFind the parent images by image set by the legacy builder. In a similar way the graphdriver implementation does.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ printf  'FROM busybox\\nMAINTAINER foo\\nRUN echo 1 #layer0\\nRUN echo 2 #layer1\\nRUN echo 3 #layer2' | DOCKER_BUILDKIT=0 docker build -t asdf -\r\n\r\n$ docker history asdf\r\nIMAGE          CREATED          CREATED BY                                      SIZE      COMMENT\r\n8cd7634cb392   20 seconds ago   /bin/sh -c echo 3 #layer2                       0B\r\n-<missing>      20 seconds ago   /bin/sh -c echo 2 #layer1                       0B\r\n-<missing>      21 seconds ago   /bin/sh -c echo 1 #layer0                       0B\r\n-<missing>      21 seconds ago   /bin/sh -c #(nop)  MAINTAINER foo               0B\r\n+54e809c2d680   46 minutes ago   /bin/sh -c echo 2 #layer1                       0B\r\n+fa48cf09986b   46 minutes ago   /bin/sh -c echo 1 #layer0                       0B\r\n+4be0485735cf   46 minutes ago   /bin/sh -c #(nop)  MAINTAINER foo               0B\r\n<missing>      3 years ago      /bin/sh -c #(nop)  CMD [\"sh\"]                   0B\r\n<missing>      3 years ago      /bin/sh -c #(nop) ADD file:07d9466ed1a10916f\u2026   1.49MB\r\n```\r\n\r\n```diff\r\n$ make TEST_FILTER=TestRmiUntagHistoryLayer  TEST_IGNORE_CGROUP_CHECK=1 DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 DOCKER_BUILDKIT=0  \\\r\n    test-integration\r\n(...)\r\n-    docker_cli_rmi_test.go:279: assertion failed:\r\n-        Command:  /usr/local/cli-integration/docker tag <missing> tmp2\r\n-        ExitCode: 1\r\n-        Error:    exit status 1\r\n-        Stdout:\r\n-        Stderr:   Error parsing reference: \"<missing>\" is not a valid repository/tag: invalid reference format\r\n+    docker_cli_rmi_test.go:286: assertion failed: 2 (int) != 1 (int): out: Untagged: tmp2:latest\r\n+        Deleted: sha256:3518e150cf5f8a977721bdd34d5e00d5da1efe52c86dc7a44f8b5b54916d7c4a\r\n+        Untagged: moby-dangling@sha256:16d365089e5c10e1673ee82ab5bba38ade9b763296ad918bd24b42a1156c5456\r\n+        Deleted: sha256:16d365089e5c10e1673ee82ab5bba38ade9b763296ad918bd24b42a1156c5456\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 39,
        "deletions": 31,
        "changed_files": 1,
        "created_at": "2023-10-03T22:45:30Z",
        "closed_at": "2023-10-11T15:08:47Z",
        "merged_at": "2023-10-11T15:08:47Z",
        "body": "- fixes https://github.com/moby/moby/issues/46596\r\n\r\nThis reverts commit a9fa147a92e3672df3661797f87303ebd1009baa.\r\n\r\nThis is a broken commit as its creating a provider but never setting providerHandle which is what is used to write events.\r\n\r\nRelated: #46585",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 39,
        "deletions": 31,
        "changed_files": 1,
        "created_at": "2023-10-03T22:43:54Z",
        "closed_at": "2023-10-11T15:07:50Z",
        "merged_at": "2023-10-11T15:07:50Z",
        "body": "- fixes https://github.com/moby/moby/issues/46596\r\n\r\nThis reverts commit a9fa147a92e3672df3661797f87303ebd1009baa. The commit is unfortunately broken as it is still using `providerHandle` to write events but that handle is never actually set, so it is always invalid. All logging fails.\r\n\r\nNote: This is note a straight revert due to the change to containerd/log.\r\n\r\nThis also incidentally fixes a problem where the logged messages when an event write fails was always recording a nil error.",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 4,
        "changed_files": 4,
        "created_at": "2023-10-03T13:28:22Z",
        "closed_at": "2023-10-03T14:55:12Z",
        "merged_at": "2023-10-03T14:55:12Z",
        "body": "Fixes leases not being released when operation was cancelled.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-10-03T13:21:42Z",
        "closed_at": "2023-10-16T11:39:26Z",
        "merged_at": "2023-10-16T11:39:26Z",
        "body": "To match the graphdriver's push behavior which only shows the progress for layers.\r\nExclude indexes, manifests and image configs from the push progress. Don't explicitly check for `IsLayerType` to also handle other potentially big blobs (like buildkit attestations).\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```bash\r\n$ printf 'FROM ubuntu\\nRUN env >/env' | docker build -t pawelgronowski465/pushtest  -\r\n$ docker push  pawelgronowski465/testpush\r\nUsing default tag: latest\r\nThe push refers to repository [docker.io/pawelgronowski465/testpush]\r\nb384ff348c0f: Pushed\r\n3326f487ddb3: Pushed\r\nc391327a0f1d: Pushed\r\nlatest: digest: sha256:085ca3ebd85e2fc2a8189b2d0f22665053d9783d0d714c5bb97384282609e86a size: 855\r\n$\r\n\r\n\r\n# b384ff348c0f - buildkit attestation\r\n# 3326f487ddb3 - the extra layer (`RUN env>/env`)\r\n# c391327a0f1d - ubuntu rootfs\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-note\r\n- containerd image store: Hide push upload progress of manifests, configs and indexes (small json blobs) to match the original push behavior\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 1,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-02T23:39:17Z",
        "closed_at": "2023-10-03T14:54:28Z",
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nSkipped history layer test with containerd snapshotters\r\n\r\nWe don't keep the image ID of the intermediate images created during a build. This is also only a feature of the classic builder, buildkit doesn't create intermediate images either.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-10-02T23:26:49Z",
        "closed_at": "2023-10-11T20:41:42Z",
        "merged_at": "2023-10-11T20:41:42Z",
        "body": "\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nSkipped tests that check max concurrency.\r\n\r\nThese are not yet implemented with containerd snapshotters. We skip them now because implementing this is not trivial with containerd.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 62,
        "deletions": 1,
        "changed_files": 2,
        "created_at": "2023-10-02T21:33:08Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- Fixes https://github.com/moby/moby/issues/46576\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\nAdded the ability to filter the results of `docker image ls` or `docker images` through timestamps by adding the `until` filter.\r\n\r\n**- How I did it**\r\nModified the `acceptedImageFilterTags` map in `daemon/containerd/image_list.go` to include an `until` key. Then I modified `setupFilters` function in the same file to process the value assigned to the until key\r\n\r\n**- How to verify it**\r\nI added an integration test function `TestImagesFilterUntil`. I did not see any unit tests that test the `setupFilters` function directly, which is why I decided to add this new test instead. Let me know if there is a simpler or better way to test this. \r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n`docker image ls` now allows filtering by timestamp\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-10-02T18:33:30Z",
        "closed_at": "2023-10-03T14:51:12Z",
        "merged_at": "2023-10-03T14:51:12Z",
        "body": "- relates to https://github.com/moby/moby/pull/46542\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-09-30T23:00:06Z",
        "closed_at": "2023-10-01T04:50:29Z",
        "merged_at": "2023-10-01T04:50:29Z",
        "body": "This was mistakenly added to bklog.\r\nSince this is getting attached to the standard logger, and bklog is using the standard logger, we only need this added once.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 534,
        "deletions": 426,
        "changed_files": 6,
        "created_at": "2023-09-30T01:15:32Z",
        "closed_at": "2023-10-16T11:06:52Z",
        "merged_at": "2023-10-16T11:06:52Z",
        "body": "follow-up https://github.com/moby/moby/pull/46402#pullrequestreview-1651587668\r\n\r\n**- What I did**\r\n\r\nAlternative to #46402 using a matrix and set required env vars to test containerd backed image store.\r\n\r\n**- How I did it**\r\n\r\nSets a `storage` matrix conditionally based on `containerd-integration` GitHub label being set.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 10
    },
    {
        "merged": false,
        "additions": 29,
        "deletions": 45,
        "changed_files": 2,
        "created_at": "2023-09-29T23:11:35Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Check for accurate values that may contain content sizes unknown to the usage test in the calculation. Avoid asserting using deep equals when only the expected value range is known to the test.\r\n\r\nAlways use familiarized string in images output.",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 5,
        "deletions": 33,
        "changed_files": 2,
        "created_at": "2023-09-29T13:10:57Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- depends on: https://github.com/moby/moby/pull/46565\r\n\r\nThis is already handled by the RegistryHosts having a separate HTTP-only host for insecure registries.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 10,
        "changed_files": 5,
        "created_at": "2023-09-29T11:57:45Z",
        "closed_at": "2023-10-13T20:31:24Z",
        "merged_at": "2023-10-13T20:31:24Z",
        "body": "- related to: https://github.com/moby/moby/pull/45992\r\n\r\n`docker.io` is present in the `IndexConfigs` so the `Mirrors` property would get lost because a fresh `RegistryConfig` object was created.\r\n\r\nInstead of creating a new object, reuse the existing one and just mutate its fields.\r\n\r\n**- What I did**\r\nFixed mirrors not working with buildkit.\r\n\r\n**- How I did it**\r\nSee commit.\r\n\r\n**- How to verify it**\r\nTry to use registry mirror.\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 25,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-09-29T11:38:06Z",
        "closed_at": "2023-10-11T19:06:19Z",
        "merged_at": "2023-10-11T19:06:19Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nFix #46563  `Rootful-in-Rootless dind doesn't work since systemd v250 (due to oom score adj)`\r\n\r\n**- How I did it**\r\n\r\nBy limiting OOMScoreAdj\r\n\r\n**- How to verify it**\r\n\r\nRun `BINDDIR=. make shell` with Rootless Docker and systemd >= 250, and run `docker run --rm hello-world` inside there\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\nFix \"Rootful-in-Rootless\" dind on systemd >= 250\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\ud83d\udc27 \r\n",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-09-28T15:33:58Z",
        "closed_at": "2023-09-28T18:18:42Z",
        "merged_at": "2023-09-28T18:18:42Z",
        "body": "- Follow-up to/related to https://github.com/moby/moby/pull/46069\r\n- Related to https://github.com/moby/moby/pull/45966#discussion_r1334862901",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-09-28T15:14:27Z",
        "closed_at": "2023-09-28T16:46:50Z",
        "merged_at": "2023-09-28T16:46:50Z",
        "body": "See commits\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 10,
        "deletions": 7,
        "changed_files": 6,
        "created_at": "2023-09-28T12:24:11Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- backport of https://github.com/moby/moby/pull/46069\r\n- related / depends on https://github.com/moby/moby/pull/46559\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 32,
        "deletions": 36,
        "changed_files": 9,
        "created_at": "2023-09-28T12:23:29Z",
        "closed_at": "2023-09-28T18:45:25Z",
        "merged_at": "2023-09-28T18:45:24Z",
        "body": "- backport of https://github.com/moby/moby/pull/46339\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 1031,
        "deletions": 134,
        "changed_files": 67,
        "created_at": "2023-09-28T08:22:42Z",
        "closed_at": null,
        "merged_at": null,
        "body": "This is just a draft yet to kick in CI and see what I broke on Linux/Windows.\r\n\r\nNote that even after this is merged, things won't work because of dependencies:\r\n\r\n- https://github.com/moby/moby/pull/46094 (trivial 5-line change)\r\n- https://github.com/moby/buildkit/pull/4059 (less trivial, but nothing special)\r\n- https://github.com/containerd/containerd/pull/8789 This one is problematic. containerd doesn't have enough abstraction layer in mount.All and its developers declined PR that puts in implementation based on bindfs. Both containerd and buildkit call mount.All a lot. So it needs to work properly.",
        "comments": 3
    },
    {
        "merged": false,
        "additions": 6,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-27T15:26:24Z",
        "closed_at": "2023-09-27T15:38:36Z",
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\nadd some Chinese scientists names\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\nadd  Yang Chen-Ning and Zu Chongzhi\uff0c two  Chinese scientists names\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 23,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-09-27T12:06:18Z",
        "closed_at": "2023-09-27T15:06:02Z",
        "merged_at": "2023-09-27T15:06:02Z",
        "body": "- relates to https://github.com/moby/moby/pull/46542\r\n\r\n### integration-cli: fix getTestTokenService not sending header\r\n\r\nThis utility was setting the content-type header after WriteHeader was\r\ncalled, and the header was not sent because of that.\r\n\r\n### distribution: TestPullSchema2Config fix test response\r\n\r\nThe test was depending on the client constructing an error based on the\r\nhttp-status code, and the client not reading the response body if the\r\nresponse was not a JSON response.\r\n\r\nThis fix;\r\n\r\n- adds the correct content-type headers in the response\r\n- includes error-messages in the response\r\n- adds additional tests to cover both the plain (non-JSON) and JSON\r\n  error responses, as well as an empty response.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 22,
        "deletions": 28,
        "changed_files": 4,
        "created_at": "2023-09-27T10:09:45Z",
        "closed_at": "2023-09-27T14:06:47Z",
        "merged_at": "2023-09-27T14:06:47Z",
        "body": "Some changes I had in other branches; see individual commits for details.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 17,
        "deletions": 11,
        "changed_files": 1,
        "created_at": "2023-09-27T10:03:15Z",
        "closed_at": "2023-10-12T12:19:06Z",
        "merged_at": "2023-10-12T12:19:06Z",
        "body": "### libnetwork: Controller: getKeys, getPrimaryKeyTag: prevent panic\r\n\r\nPrevent potential panics if we don't have the expected number of keys\r\nfor the subsystem.\r\n\r\n### libnetwork: Controller: getKeys, getPrimaryKeyTag: slight refactor\r\n\r\n- use named return variables to make the function more self-describing\r\n- rename variable for readability\r\n- slightly optimize slice initialization, and keep linters happy\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 98,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-09-27T09:52:01Z",
        "closed_at": "2023-09-27T14:50:19Z",
        "merged_at": "2023-09-27T14:50:19Z",
        "body": "- extracted from: https://github.com/moby/moby/pull/46444\r\n\r\n\r\nCopy the implementation of `context.WithoutCancel` introduced in Go 1.21 to be able to use it when building with older versions. This will use the stdlib directly when building with Go 1.21+.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 137,
        "deletions": 75,
        "changed_files": 5,
        "created_at": "2023-09-27T09:29:56Z",
        "closed_at": "2023-10-11T15:03:30Z",
        "merged_at": "2023-10-11T15:03:30Z",
        "body": "**- What I did**\r\n\r\nThis change creates a few OTEL spans and plumb context through the DNS resolver and DNS backends (ie. Sandbox and Network). This should help better understand how much lock contention impacts performance, and help debug issues related to DNS queries (we basically have no visibility into what's happening here right now).\r\n\r\n**- Description for the changelog**\r\n\r\n* Plumb OTEL tracing into the embedded DNS resolver\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 9,
        "deletions": 9,
        "changed_files": 1,
        "created_at": "2023-09-26T17:47:32Z",
        "closed_at": "2023-09-27T08:12:24Z",
        "merged_at": "2023-09-27T08:12:24Z",
        "body": "\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 10,
        "changed_files": 2,
        "created_at": "2023-09-26T17:42:30Z",
        "closed_at": "2023-09-27T08:13:16Z",
        "merged_at": "2023-09-27T08:13:16Z",
        "body": "It was only used in a single place, and it was defined far away from where it was used.\r\n\r\nMove the code inline, so that it's clear at a glance what it's doing.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 6,
        "changed_files": 1,
        "created_at": "2023-09-26T17:35:12Z",
        "closed_at": "2023-09-27T08:23:33Z",
        "merged_at": "2023-09-27T08:23:33Z",
        "body": "The store field is only mutated by Controller.initStores(), which is only called inside the cosntructor (libnetwork.New), so there should be no need to protect the field with a mutex in non-exported functions.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 17,
        "deletions": 11,
        "changed_files": 3,
        "created_at": "2023-09-26T17:30:28Z",
        "closed_at": "2023-09-27T08:31:57Z",
        "merged_at": "2023-09-27T08:31:57Z",
        "body": "Log errors on the call-site to make it more transparent that errors may occur, but we're ignoring them.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-09-26T17:23:39Z",
        "closed_at": "2023-09-27T08:30:47Z",
        "merged_at": "2023-09-27T08:30:47Z",
        "body": "Controller.getNetworkFromStore() already returns a ErrNoSuchNetwork if no network was found, so we don't need to convert the existing error.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-09-26T16:57:49Z",
        "closed_at": "2023-09-26T19:07:03Z",
        "merged_at": "2023-09-26T19:07:03Z",
        "body": "Currently, all traces coming from the API have an empty operation string, which make them indistinguishable from each other without looking at the logs of the root span, and prevent proper filtering on Jaeger UI.\r\n\r\nWith this change, traces get the route pattern as the operation string.",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 19,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-09-26T09:21:45Z",
        "closed_at": "2023-09-29T11:58:58Z",
        "merged_at": "2023-09-29T11:58:58Z",
        "body": "**- What I did**\r\n\r\nhttps://github.com/moby/moby/pull/46495 changed the code to look for the platform when the image is a single-platform one but it looked at the wrong place, we now look at the image config  to get the platform when the image is not multi-platform\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nThis test should still work, also `docker --runtime io.containerd.wasmedge.v1 --platform wasi/wasm rumpl/bb` should run just fine too\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestCreateDifferentPlatform TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 427,
        "deletions": 1104,
        "changed_files": 30,
        "created_at": "2023-09-26T08:59:22Z",
        "closed_at": "2023-10-12T10:13:16Z",
        "merged_at": "2023-10-12T10:13:16Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46555\r\n\r\nopening as draft, as it's not tagged / released yet\r\n\r\n- relates to https://github.com/moby/moby/issues/46006\r\n- fixes https://github.com/moby/moby/issues/46006\r\n\r\n----\r\n\r\n- Fix storageDriver gcs not registered in binaries\r\n- reference: replace uses of deprecated function SplitHostname\r\n- Dont parse errors as JSON unless Content-Type is set to JSON\r\n- update to go1.20.8\r\n- Set Content-Type header in registry client ReadFrom\r\n- deprecate reference package, migrate to github.com/distribution/reference\r\n- digestset: deprecate package in favor of go-digest/digestset\r\n- Do not close HTTP request body in HTTP handler\r\n\r\nfull diff: https://github.com/distribution/distribution/compare/v2.8.2...v2.8.3\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 43,
        "deletions": 9,
        "changed_files": 2,
        "created_at": "2023-09-26T08:42:39Z",
        "closed_at": "2023-09-26T17:05:48Z",
        "merged_at": "2023-09-26T17:05:48Z",
        "body": "**- What I did**\r\n\r\nIntegration tests will now run through Delve when `DELVE_PORT` is set.",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 12,
        "deletions": 10,
        "changed_files": 8,
        "created_at": "2023-09-26T08:03:48Z",
        "closed_at": "2023-09-26T12:46:39Z",
        "merged_at": "2023-09-26T12:46:39Z",
        "body": "backporting a single commit from https://github.com/moby/moby/pull/43169, because this one was bothering me \ud83d\ude02  https://goreportcard.com/report/github.com/docker/docker\r\n\r\n<img width=\"1009\" alt=\"Screenshot 2023-09-26 at 10 02 37\" src=\"https://github.com/moby/moby/assets/1804568/c0256384-bbd7-4174-84a0-f52858f42195\">\r\n\r\n\r\n\r\n\r\nFormatting the code with https://github.com/mvdan/gofumpt\r\n\r\n(cherry picked from commit 2d12dc3a58ca18d10ff93c413e78ea1bc83d2dc8)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 165,
        "deletions": 20,
        "changed_files": 13,
        "created_at": "2023-09-24T17:38:28Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nBuilding upon ~~#46402~~ #46572 to bring the containerd image-store support on Windows up to something that is worth having tests enabled for.\r\n\r\n**- How I did it**\r\n\r\nFirstly, cherry-picked #46402 onto the mainline branch, once containerd 1.7.6 had been vendored by #45966. Update: Currently based directly on #46402 until it merges, unless something important lands in mainline first.\r\n\r\nSecondly, got the snapshotter tests functional on Windows matching the Linux version. (Two-liner, most of the work was done by @rumpl in #46402).\r\n\r\n~~Violently beat my head against~~ Iteratively worked through failures observed in the integration test suite setup, building the busybox image. As it happens, this step does most of the things we seem to care about, so it was a good test-case.\r\n\r\nRebased the results of the above after #46572 landed, which integrated the outcomes of the second paragraph already.\r\n\r\nRemaining TODOs to undraft this PR:\r\n\r\n- [x] Label this PR with `containerd-integration` (someone needs to do that for me) and drop the last (0d5edcdca184c8bd3c50b8b25d75544fa9e7d190) commit\r\n- [x] Rebase once ~~#46402~~ #46572 is merged, dropping the first couple of commits\r\n- [ ] Make and implement a decision about hack 1 (53777db68e5172cc50568a21959dff704565110d)\r\n- [ ] Make and implement a decision about hack 2 (https://github.com/moby/moby/pull/46539/commits/6e48f48df593fb689bb26894a36949632f61bd24 or [`b099f42`](https://github.com/moby/moby/pull/46539/files/53777db68e5172cc50568a21959dff704565110d..b099f42423c30eeaa26c77de32b0e169103c9e82))\r\n\r\n----\r\n\r\n*- Hack 1 (53777db68e5172cc50568a21959dff704565110d)*\r\n\r\nbuilder-next specifies the `host` network provider, but [that fails on Windows](https://github.com/moby/buildkit/blob/v0.12.2/util/network/netproviders/network_windows.go#L11-L13), blocking daemon startup even though we don't currently support builder-next.\r\n\r\nMy current hack is to use `auto`, since that means [`cni` if configured](https://github.com/moby/buildkit/blob/v0.12.2/util/network/netproviders/network.go#L36-L46) and if not, [on Windows it falls back to `null`](https://github.com/moby/buildkit/blob/v0.12.2/util/network/netproviders/network_windows.go#L15-L18), and [on Linux it falls back to `host`](https://github.com/moby/buildkit/blob/v0.12.2/util/network/netproviders/network_unix.go#L15-L18).\r\n\r\nI've currently only done this for Windows with a `runtime.GOOS` test, but I'm inclined to think we should use `auto` always, since: it does the right thing on Linux, and if we ever do need a more-complex network setup, CNI is the obvious path. If we ever do get builder-next working for Windows, it'll need to use CNI anyway, even for the equivalent of host networking.\r\n\r\n----\r\n\r\n*- Hack 2 (https://github.com/moby/moby/pull/46539/commits/6e48f48df593fb689bb26894a36949632f61bd24 or [`b099f42`](https://github.com/moby/moby/pull/46539/files/53777db68e5172cc50568a21959dff704565110d..b099f42423c30eeaa26c77de32b0e169103c9e82))*\r\n\r\nThe windowfilter graphdriver is a bit weird: When you \"mount\" an image from it, it actually [only does the volume setup (Prepare and Activate in HCS terms)](https://github.com/moby/moby/blob/51f0e7b0e49c709729d67559c9c07616c1da019b/daemon/graphdriver/windows/windows.go#L385-L407) and then [returns the `\\\\?\\Volume{GUID}\\` formatted volume name](https://github.com/moby/moby/blob/51f0e7b0e49c709729d67559c9c07616c1da019b/daemon/graphdriver/windows/windows.go#L414-L416), where other graphdrivers (and all the containerd snapshotters) actually [mount the image to a host directory](https://github.com/moby/moby/blob/51f0e7b0e49c709729d67559c9c07616c1da019b/daemon/graphdriver/overlay2/overlay.go#L596-L598) and [return that directory](https://github.com/moby/moby/blob/51f0e7b0e49c709729d67559c9c07616c1da019b/daemon/graphdriver/overlay2/overlay.go#L608).\r\n\r\nHowever, starting a container as we do now [requires us to pass that `\\\\?\\Volume{GUID}\\`-formatted volume name in the OCI spec as `Root.Path`](https://github.com/opencontainers/runtime-spec/blob/main/config.md#root).\r\n\r\nNormally, containerd doesn't expose that volume name to callers, but we can use the underlying Windows API to get the volume name from the mount point, which relies on [internal knowledge of the containerd/mount implementation](https://github.com/moby/moby/pull/46539/files#diff-6688f4342adf127b206582942bc147a0efab01c2e376b8a1a81e62c4bfee3ce1R296-R337) ([earlier implementation of the same idea that I'm less confident in](https://github.com/moby/moby/pull/46539/files/6e48f48df593fb689bb26894a36949632f61bd24#diff-6688f4342adf127b206582942bc147a0efab01c2e376b8a1a81e62c4bfee3ce1R296-R322)).\r\n\r\nThe BindFilter approach was pretty messy though, and I didn't like it very much. (There's probably a bunch of overlooked edge cases there too. I have no idea why I see four copies of the bind-mount there, which is another vote against the older BindFilter version.) The `GetLayerMountPath` isn't too bad, it's still poking at internal details, but they're details that containerd's mount package could trivially provide an API to expose, if we go this way.\r\n\r\nBeyond cleaning it up, an alternative approach would be to not populate `Windows.LayerFolders` nor `Root.Path` at all (removing the need for 1ad566e21dee685a0c10b01054bd40c5de7a0e5b as well) and instead use [containerd's `WithSnapshot` and `WithSnapshotter` config-functor-things](https://github.com/containerd/containerd/blob/v1.7.6/container_opts.go#L178-L207) when setting up the container.\r\n\r\nHowever, this would, at least on Windows, require us to unmount the directory before starting the container, as this flow makes hcsshim responsible for both [mounting of the root layer](https://github.com/microsoft/hcsshim/blob/v0.11.1/internal/hcsoci/resources_wcow.go#L60-L73) and [deriving `Windows.LayerFolders` from the snapshot](https://github.com/microsoft/hcsshim/blob/v0.11.1/cmd/containerd-shim-runhcs-v1/service_internal.go#L118-L158). Note that in the latter case, [there's a bug where hcsshim'll *append* to any `Windows.LayerFolders` passed in](https://github.com/opencontainers/runtime-spec/issues/1185#issuecomment-1474549056) ([0.12 onwards rejects this case explicitly instead](https://github.com/microsoft/hcsshim/blob/main/cmd/containerd-shim-runhcs-v1/rootfs.go#L15-L45)), so we *must not* populate it in this case. `nil` is fine, even though it's [out-of-spec](https://github.com/opencontainers/runtime-spec/issues/1185).\r\n\r\nThis should be _feasible_ as we already have the `conditionalMountOnStart` hook, but code flows after that is called need to be checked to ensure they are correctly handling the case of not mounting the container filesystem locally. For example, I noticed code on the Windows side that checks the same conditions as the current `conditionalMountOnStart` check, and if they match, does a temporary mount of the image; clearly there's some scope for refactoring that to not duplicate the condition around.\r\n\r\nIf it was just Windows, I'd have tried to go with this approach. However, I think it'd be cleaner if we use `WithSnapshot` for both Windows and Linux when executing containers. This would be a larger change, and probably has repercussions I'm unaware of at this time, since I haven't really worked to understand the overarching flow and its rationales. (Most other containerd-calling code [appears to use `WithNewSnapshot`](https://github.com/containerd/nerdctl/blob/v1.6.0/pkg/cmd/container/create.go#L316), but moby currently has a pile of stuff it wants to do to the image first, so I'm not considering that here.)\r\n\r\n----\r\n\r\n**- How to verify it**\r\n\r\nCI.\r\n\r\nThis PR has the `containerd-integration` label applied, so the new snapshotter test suite introduced in ~~#46402~~ #46572 will run for this PR (and any PR with that label), giving us both Windows and Linux coverage. As long as the failures in the snapshotter test suite are consistent across platforms (and I didn't break anything), we're probably fine.\r\n\r\nAll of the changes made here (except an interface change while the compiler will validate) are only in the \"use snapshotter\" code-path, so verification should be low-risk.\r\n\r\nIf someone wants to take the time and try this out with the WASM runtime, that'd be awesome. I have no particular plans to do so, even though that's what started me on this piece of work, months ago.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\nContainerd image store on Windows is slightly usable.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![image](https://github.com/moby/moby/assets/138397/149b0bcc-f13b-4b02-be07-a49dcfbee82b)\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 374,
        "deletions": 0,
        "changed_files": 3,
        "created_at": "2023-09-23T13:32:58Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\nMoved [the daemon fuzzer](https://github.com/google/oss-fuzz/blob/master/projects/moby/daemon_fuzzer.go) over from OSS-Fuzz.\r\n\r\nI also added a seed file and a dictionary. These are for OSS-Fuzz.\r\n\r\nThe fuzzer will invoke different daemon methods in an order determined by the fuzzer and with values determined by the fuzzer. It alread runs on OSS-Fuzz continuously and has been for around one year. \r\n\r\n@thaJeztah for info.\r\n\r\n**- How I did it**\r\n\r\nI refactored the fuzzer slightly for easier readability.\r\n\r\n**- How to verify it**\r\n\r\nOSS-Fuzz will build this fuzzer once it is merged. I have tested this via OSS-Fuzz only, and it runs fine on my end.",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 30,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-09-22T13:47:55Z",
        "closed_at": "2023-09-25T09:59:37Z",
        "merged_at": "2023-09-25T09:59:37Z",
        "body": "- extracted from: https://github.com/moby/moby/pull/46533\r\n\r\nThe reason it doesn't change with the graphdrivers is caused by an implementation detail and the fact that the image is loaded into the same daemon it was saved from.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 9,
        "changed_files": 1,
        "created_at": "2023-09-22T13:47:54Z",
        "closed_at": "2023-09-25T15:22:29Z",
        "merged_at": "2023-09-25T15:22:29Z",
        "body": "- extracted from: https://github.com/moby/moby/pull/46533\r\n\r\nRewrite TestSaveMultipleNames and TestSaveSingleTag  so that they don't use legacy `repositories` file (which isn't present in the OCI archives).\r\n`docker save` output is now OCI compatible, so we don't need to use the legacy file.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-22T13:36:44Z",
        "closed_at": "2023-09-22T14:49:23Z",
        "merged_at": "2023-09-22T14:49:23Z",
        "body": "- extracted from: https://github.com/moby/moby/pull/46533\r\n\r\n**integration-cli: Skip TestLoadZeroSizeLayer with c8d**\r\n\r\nThe input archive is in the old Docker format that's not OCI compatible\r\nand is not supported by the containerd archive import:\r\n```\r\n17d1436ef796af2fc2210cc37c4672e5aa1b62cb08ac4b95dd15372321105a66/\r\n17d1436ef796af2fc2210cc37c4672e5aa1b62cb08ac4b95dd15372321105a66/VERSION\r\n17d1436ef796af2fc2210cc37c4672e5aa1b62cb08ac4b95dd15372321105a66/json\r\n17d1436ef796af2fc2210cc37c4672e5aa1b62cb08ac4b95dd15372321105a66/layer.tar\r\n25445a0fc5025c3917a0cd6e307d92322540e0da691614312ddea22511b71513/\r\n25445a0fc5025c3917a0cd6e307d92322540e0da691614312ddea22511b71513/VERSION\r\n25445a0fc5025c3917a0cd6e307d92322540e0da691614312ddea22511b71513/json\r\n25445a0fc5025c3917a0cd6e307d92322540e0da691614312ddea22511b71513/layer.tar\r\n9c7cb910d84346a3fbf3cc2be046f44bf0af7f11eb8db2ef1f45e93c1202faac/\r\n9c7cb910d84346a3fbf3cc2be046f44bf0af7f11eb8db2ef1f45e93c1202faac/VERSION\r\n9c7cb910d84346a3fbf3cc2be046f44bf0af7f11eb8db2ef1f45e93c1202faac/json\r\n9c7cb910d84346a3fbf3cc2be046f44bf0af7f11eb8db2ef1f45e93c1202faac/layer.tar\r\nrepositories\r\n```\r\n\r\n**integration-cli: Skip Parent tests with c8d**\r\n\r\nParent property is not available in the OCI config.\r\n\r\n\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 132,
        "deletions": 23,
        "changed_files": 5,
        "created_at": "2023-09-22T11:58:19Z",
        "closed_at": "2023-10-13T12:41:33Z",
        "merged_at": "2023-10-13T12:41:33Z",
        "body": "- Fixes: https://github.com/moby/moby/issues/45461\r\n\r\nChanges:\r\n1. Implement a behavior from the graphdriver's export where `docker save something` (untagged reference) would export all images matching the specified repository.\r\n\r\n2. Don't save image name/reference if it was selected by a digest. This is a bit weird behavior, and we probably should have a flag to allow to opt-out/opt-in, but it seems to be an explicit behavior and there's a test that checks for it (`TestSaveLoadNoTag`).\r\n\r\n3. Fix `docker load` message not outputting image tag.\r\n\r\n\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make TEST_FILTER='(TestSave|TestLoad)' \\\r\n             TEST_IGNORE_CGROUP_CHECK=1 \\\r\n             DOCKER_GRAPHDRIVER=overlayfs \\\r\n             TEST_INTEGRATION_USE_SNAPSHOTTER=1 \\\r\n             test-integration\r\n```\r\n\r\n<details>\r\n<summary>Diff</summary>\r\n\r\n```diff\r\n-=== Failed\r\n-=== FAIL: arm64.integration.image TestSaveRepoWithMultipleImages (1.69s)\r\n-    save_test.go:126: assertion failed: error is not nil: Error response from daemon: No such image: foobar-save-multi-images-test:latest\r\n-\r\n=== FAIL: arm64.integration.image TestSaveCheckTimes (0.23s)\r\n    save_test.go:81: assertion failed: 2020-06-02T21:39:45Z (string) != 1970-01-01T00:00:00Z (string): expected: 2020-06-02 21:39:45.374289041 +0000 UTC, actual: 1970-01-01 00:00:00 +0000 UTC\r\nThere was a fire near the place I live and I feel as though I have been smoking smuggled russian ciggarettes every day for 50 years.\r\n-DONE 3 tests, 2 failures in 4.721s\r\n+DONE 3 tests, 1 failure in 4.723s\r\n...\r\n-=== Skipped\r\n-=== SKIP: arm64.integration-cli TestDockerSchema1RegistrySuite (0.01s)\r\n-    check_test.go:368: testEnv.UsingSnapshotter()\r\n-\r\n-=== Failed\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestLoadZeroSizeLayer (0.19s)\r\n-    docker_cli_save_load_test.go:199: assertion failed:\r\n-        Command:  /usr/local/cli-integration/docker load -i testdata/emptyLayer.tar\r\n-        ExitCode: 1\r\n-        Error:    exit status 1\r\n-        Stdout:\r\n-        Stderr:   unrecognized image format\r\n-\r\n-\r\n-        Failures:\r\n-        ExitCode was 1 expected 0\r\n-        Expected no error\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestLoadZeroSizeLayer (0.19s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveAndLoadRepoFlags (0.84s)\r\n-    docker_cli_save_load_test.go:160: assertion failed:\r\n-        --- before\r\n-        +++ after\r\n-        @@ -71,5 +71,5 @@\r\n-                 },\r\n-                 \"Metadata\": {\r\n-        -            \"LastTagTime\": \"2023-09-22T11:20:58.556805794Z\"\r\n-        +            \"LastTagTime\": \"2023-09-22T11:20:58.64523996Z\"\r\n-                 }\r\n-             }\r\n-        : inspect is not the same after a save / load\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveAndLoadRepoFlags (0.84s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveAndLoadWithProgressBar (4.66s)\r\n-    docker_cli_save_load_unix_test.go:87: assertion failed: expression is false: strings.Contains(out, expected)\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveAndLoadWithProgressBar (4.66s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveLoadNoTag (0.78s)\r\n-    docker_cli_save_load_test.go:254: assertion failed: strings.Contains(out, \"Loaded image: \") is true\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveLoadNoTag (0.78s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveLoadParents (1.68s)\r\n-    docker_cli_save_load_test.go:224: tmpdir /tmp/save-load-parents1920803891\r\n-    docker_cli_save_load_test.go:233: assertion failed:  (inspectOut string) != sha256:895384f1ece8c022db097c18c965b586b69a52cec7ea3d8ea5d4befe37c1c4a1 (idFoo string)\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveLoadParents (1.68s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveMultipleNames (0.20s)\r\n-    docker_cli_save_load_test.go:188: assertion failed: error is not nil: exit status 1: failed to save multiple repos: , exit status 1\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveMultipleNames (0.20s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveSingleTag (0.22s)\r\n-    docker_cli_save_load_test.go:100: assertion failed: error is not nil: exit status 1: failed to save repo with image ID and 'repositories' file: , exit status 1\r\n-    --- FAIL: TestDockerCLISaveLoadSuite/TestSaveSingleTag (0.22s)\r\n-\r\n-=== FAIL: arm64.integration-cli TestDockerCLISaveLoadSuite (11.84s)\r\n-\r\n-DONE 62 tests, 1 skipped, 8 failures in 12.239s\r\n+PASS\r\n+\r\n+=== Skipped\r\n+=== SKIP: arm64.integration-cli TestDockerCLISaveLoadSuite/TestLoadZeroSizeLayer (0.11s)\r\n+    docker_cli_save_load_test.go:230: testEnv.UsingSnapshotter(): input archive is not OCI compatible\r\n+    --- SKIP: TestDockerCLISaveLoadSuite/TestLoadZeroSizeLayer (0.11s)\r\n+\r\n+=== SKIP: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveAndLoadWithProgressBar (0.09s)\r\n+    docker_cli_save_load_unix_test.go:76: testEnv.UsingSnapshotter(): TODO: Not implemented yet\r\n+    --- SKIP: TestDockerCLISaveLoadSuite/TestSaveAndLoadWithProgressBar (0.09s)\r\n+\r\n+=== SKIP: arm64.integration-cli TestDockerCLISaveLoadSuite/TestSaveLoadParents (0.10s)\r\n+    docker_cli_save_load_test.go:241: testEnv.UsingSnapshotter(): Parent image property is not supported with containerd\r\n+    --- SKIP: TestDockerCLISaveLoadSuite/TestSaveLoadParents (0.10s)\r\n+\r\n+=== SKIP: arm64.integration-cli TestDockerSchema1RegistrySuite (0.01s)\r\n+    check_test.go:368: testEnv.UsingSnapshotter()\r\n+\r\n+DONE 62 tests, 4 skipped in 10.034s\r\n```\r\n\r\n</details>\r\n\r\n**- Description for the changelog**\r\n```release-note\r\n- containerd-integration: `docker save` is now able to export images from all tags of the repository\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 3571,
        "deletions": 1642,
        "changed_files": 111,
        "created_at": "2023-09-22T09:16:12Z",
        "closed_at": null,
        "merged_at": null,
        "body": "updating the dependency to tip of master, to get early warnings about breaking changes.\r\n\r\nsecond commit is to make it compile, but it's very much broken, as changes are needed to accommodate the changes from;\r\n\r\n- https://github.com/moby/buildkit/pull/4035\r\n- https://github.com/moby/buildkit/pull/4113\r\n\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 396,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-09-21T14:50:10Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- Slice of https://github.com/moby/moby/pull/45850, to make it easier to review\r\n\r\n**- What I did**\r\n\r\nThis PR introduces a new integration test suite aimed at testing networking features like inter-container communication, network isolation, port mapping, what happens when the userland proxy is enabled or disabled, etc... and how these features interact with daemon-level and network-level parameters.\r\n\r\nSo far, there's pretty much no tests making sure our networks are working as expected. For instance, there's a few tests for port mapping, but they don't cover all cases (eg. IPv6, disabling the userland proxy, etc...), and a few tests check if a specific iptables rule exists, but that doesn't prevent that specific rule from be wrong in the first place.\r\n\r\nAs we're planning to refactor how iptables rules are written and change some of them to fix known security issues, we need a way to test all parameter combinations (at least, the important ones). So far, this was done by hand which is painful and time consuming. As such, this new test suite is foundational to upcoming work.\r\n\r\nThis test suite should help:\r\n\r\n* Assert networking security boundaries are working properly, and prevent regressions on security patches;\r\n* Discover what's missing to make the userland proxy disabled by default;\r\n* Give a canonical test plan for new port mappers;\r\n\r\nFollowing tests are implemented in this PR:\r\n\r\n* Inter-container communication for internal and non-internal bridge networks, over IPv4 and * IPv6 (using ULAs or link-local addresses, SLAAC-assigned or dynamically allocated) ;\r\n* Inter-network communication for internal and non-internal bridge networks, over IPv4 and IPv6, is disallowed ;\r\n\r\n**- How to verify it**\r\n\r\nCI is green.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://france3-regions.francetvinfo.fr/image/wCtyn7iw2duXzdFg3eNf9utNvi4/600x400/regions/2022/09/29/6335a9a4351f0_maxstockfr019288.jpg)\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 45,
        "deletions": 48,
        "changed_files": 2,
        "created_at": "2023-09-21T14:28:21Z",
        "closed_at": "2023-09-26T17:19:32Z",
        "merged_at": "2023-09-26T17:19:32Z",
        "body": "This was part of a branch with other changes; let's get these out of the way first. See individual commits for details\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 41,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-21T12:07:56Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- relates to https://github.com/moby/moby/pull/46517\r\n\r\n\r\nThis is currently not to be merged, but while reviewing another PR, I was considering \"this test could be an integration test\", and then recalled why I didn't do this in the past.\r\n\r\nThe TL;DR is that client.ImagePull (as well as other functions that use a streaming endpoint) is very hard to consume. To use these functions, a great amount of boiler-plating code, as well as custom logic is needed, and the utilities to help with this (`pkg/jsonmessage` and/or `pkg/progress`, which both seem to be serving similar functionality), are poorly written;\r\n\r\nLooking at this (client.ImagePull) example:\r\n\r\n- The error returned is only for the initial request (which is \"reasonable\", and makes sense for some situations, but is definitely not intuitive).\r\n- A result of that is that _not_ handling the stream means \"cancelling\" the pull.\r\n- To get errors that occur during the pull, it's required to process the stream using the `jsonmessage` package. And the utilities in this package are tightly integrated with _presenting_ the stream (i.e., error-handling is part of \"presenting\" the stream).\r\n- Because of this coupling, it also expects things like \"do we have a terminal attached\"? (and if so: its file-descriptor), which is irrelevant for many scenarios where the pull is to be used for purposes other than a pull on the command-line.\r\n- _if_ we get an error, it's a `JSONError`, which _does_ have a status-code (although it appears to not be used) and cannot be handled by the `errdefs` package.\r\n\r\nWe should make this better. Some options to consider:\r\n\r\n- (lower hanging fruit): add an \"synchronous\" option, and move the stream- handling logic into the `ImagePull` function. This makes the function handle the pull from start to finish, printing the output (if `io.writers` are passed for this), and returns any error that occurs while pulling, which could be either the initial error (making the request), or errors during the pull.\r\n- It would also make sure to return errors with a correct `errdefs` type for further processing.\r\n- For the longer term, we must rewrite the `pkg/jsonmessage`, as well as the `pkg/progress` packages: remove the duplication, and make sure we have a canonical implementation where needed.\r\n- But also separate _handling_ the stream from _presenting_ the stream; presentation should be separate, and something the consumer should be able to have full control over.\r\n- This would be smilar to the `auxCallback` which was added at some point, but instead, any presentation function / callback should be optional (possibly some default with printing to a vanilla io.writer: TBD).\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 33,
        "deletions": 32,
        "changed_files": 3,
        "created_at": "2023-09-21T09:06:26Z",
        "closed_at": "2023-09-22T00:13:43Z",
        "merged_at": "2023-09-22T00:13:43Z",
        "body": "- extracted from https://github.com/moby/moby/pull/45966\r\n\r\nThe current executor is only tested on Linux, so let's be honest about that. Stubbing this correctly helps avoid incorrectly trying to call into Linux-only code in e.g. libnetwork.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 12,
        "changed_files": 4,
        "created_at": "2023-09-21T08:49:21Z",
        "closed_at": "2023-09-21T20:27:03Z",
        "merged_at": "2023-09-21T20:27:03Z",
        "body": "- extracted from https://github.com/moby/moby/pull/45966\r\n- relates to https://github.com/moby/moby/pull/45966#discussion_r1332018618\r\n- follow-up to https://github.com/moby/moby/pull/46489\r\n\r\nFor context: in https://github.com/moby/moby/pull/46489 I didn't want to change the type of `CommonConfig.LogFormat` (daemon/config/config.go). And in https://github.com/moby/moby/pull/45966#discussion_r1332018618 I suggested to move this to a separate PR; both for visibility and for discussion (whether we want our daemon's Config struct to have a direct dependency on containerd/log's types.\r\n\r\n\r\nThis type was introduced in\r\nhttps://github.com/containerd/containerd/commit/0a79e67e4f7bff1128c81ee14a8b2a74a8c55c51\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 1,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-09-21T08:11:57Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nWe were adding the manifest size to the total size of the image but the current sizes calculations only look at layers\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5831,
        "deletions": 2014,
        "changed_files": 166,
        "created_at": "2023-09-21T06:39:19Z",
        "closed_at": "2023-09-21T08:25:19Z",
        "merged_at": "2023-09-21T08:25:18Z",
        "body": "- relates to https://github.com/microsoft/hcsshim/pull/1899\r\n- relates to https://github.com/moby/moby/pull/45966\r\n- relates to https://github.com/containerd/containerd/pull/9127\r\n\r\n\r\nfull diff: https://github.com/Microsoft/hcsshim/compare/v0.9.10...v0.11.1\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-09-20T21:55:33Z",
        "closed_at": "2023-09-21T06:43:44Z",
        "merged_at": "2023-09-21T06:43:44Z",
        "body": "When graphdriver is not provided the graphdriver is looked up from docker info, but without quotes it may fail and set the graphdriver to an incorrect value.\r\n\r\nOn my local system without this change I was getting\r\n```\r\nDOCKER_GRAPHDRIVER=\"docker info\" accepts no arguments. See 'docker info --help'.  Usage:  docker info [OPTIONS]  Display system-wide information\r\n```",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 44,
        "deletions": 1187,
        "changed_files": 12,
        "created_at": "2023-09-20T16:08:29Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\n* [ ] integration/build\r\n* [X] integration/config\r\n* [ ] integration/container\r\n* [ ] integration/daemon\r\n* [ ] integration/image\r\n* [ ] integration/network\r\n* [ ] integration/plugin/*\r\n* [ ] integration/secret\r\n* [ ] integration/service\r\n* [ ] integration/session\r\n* [ ] integration/system\r\n* [ ] integration/volume\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-20T15:03:48Z",
        "closed_at": "2023-09-29T11:57:49Z",
        "merged_at": "2023-09-29T11:57:49Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nAlternative to #46518\r\ncloses #46518\r\n\r\n\r\nSkipped `TestBuildByDigest` when snapshotters are used.\r\n\r\n`Config.Image` not set when containerd is used as an image store and buildkit never sets it either, so let's skip this test if snapshotters are used\r\n\r\n\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 11,
        "deletions": 7,
        "changed_files": 6,
        "created_at": "2023-09-20T14:46:08Z",
        "closed_at": "2023-09-25T17:51:54Z",
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nIncluded the `Config.Image` information on build/commit/import\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nThis one shouldn't fail any more\r\n\r\n```console \r\n$ make TEST_FILTER=TestBuildByDigest TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 DOCKER_GRAPHDRIVER=overlayfs test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 7,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-09-20T14:42:02Z",
        "closed_at": null,
        "merged_at": null,
        "body": "\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nmoby and containerd have slightly different error messages when someone tries to pull an image that doesn't contain the current platform, instead of looking inside the error returned by containerd we match the errors in the test related to what image backend we are using\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 95,
        "deletions": 36,
        "changed_files": 9,
        "created_at": "2023-09-20T12:58:27Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**distribution: Export NewRepository**\r\n\r\nMake the function public\r\n\r\n**distribution: Extract PullEndpoints from Pull**\r\n\r\nExtract the function to iterate over available pull endpoints for the\r\ngiven image reference.\r\n\r\n**c8d/pull: Handle pull all tags**\r\n\r\nUse the distribution code to query the remote repository for tags and\r\npull them sequentially just like the non-c8d pull.\r\n\r\nNote: This uses the distribution code to query the remote registry for available tags. Theoretically these endpoints could be a little bit different than what the containerd pull would use as we don't pass these (and have no ability to do so) to the containerd pull.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull -a docker/doodle\r\n-Error response from daemon: failed to resolve reference \"docker.io/docker/doodle\": object required\r\n+birthday: Pulling from docker/doodle\r\n+ecaf003f35ec: Download complete\r\n+Digest: sha256:4a203cbea73f32a4885f8d9ee05233246445aa95dd4362887058ec663a7b8088\r\n+Status: Downloaded newer image for docker/doodle:birthday\r\n+birthday2019: Pulling from docker/doodle\r\n+Digest: sha256:4a203cbea73f32a4885f8d9ee05233246445aa95dd4362887058ec663a7b8088\r\n+Status: Downloaded newer image for docker/doodle:birthday2019\r\n(...)\r\n+summer: Pulling from docker/doodle\r\n+6fe738df11e6: Download complete\r\n+Digest: sha256:f7fdfd4a030d16a619f32f183307c9f60ddd9206dc92b1c3b1e1c2f1450567fc\r\n+Status: Downloaded newer image for docker/doodle:summer\r\n+summer2019: Pulling from docker/doodle\r\n+Digest: sha256:f7fdfd4a030d16a619f32f183307c9f60ddd9206dc92b1c3b1e1c2f1450567fc\r\n+Status: Downloaded newer image for docker/doodle:summer2019\r\n+docker.io/docker/doodle\r\n\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-note\r\n- containerd image store: Implement pulling all tags (`docker pull -a`)\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 21,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-09-20T12:03:36Z",
        "closed_at": "2023-09-20T14:38:39Z",
        "merged_at": "2023-09-20T14:38:39Z",
        "body": "Final progress messages were sent after the progress updater finished which made the \"Downloading\" progress not being updated into \"Download complete\".\r\n\r\nFix by sending the final messages after the progress has finished.\r\n\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull hello-world\r\nUsing default tag: latest\r\nlatest: Pulling from library/hello-world\r\n-70f5ac315c5a: Downloading [>                                                  ]       0B/3.19kB\r\n-Digest: sha256:4f53e2564790c8e7856ec08e384732aa38dc43c52f02952483e3f003afbf23db\r\n70f5ac315c5a: Download complete\r\n+Digest: sha256:4f53e2564790c8e7856ec08e384732aa38dc43c52f02952483e3f003afbf23db\r\nStatus: Downloaded newer image for hello-world:latest\r\ndocker.io/library/hello-world:latest\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-09-19T10:54:24Z",
        "closed_at": "2023-09-19T15:03:50Z",
        "merged_at": "2023-09-19T15:03:50Z",
        "body": "Makes it possible to pull `application/vnd.docker.distribution.manifest.v1+prettyjws` legacy manifests.\r\n\r\nThey are not stored in their original form but are converted to the OCI manifests.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ docker pull ubuntu:10.04\r\n-Error response from daemon: application/vnd.docker.distribution.manifest.v1+prettyjws not supported\r\n+86b54f4b6a4e: Download complete\r\n+Digest: sha256:fb69ce785f2a695210a62bc4531fc85a0a0f28664d24ee83fb8205bc3763a9df\r\n+Status: Downloaded newer image for ubuntu:10.04\r\n+docker.io/library/ubuntu:10.04\r\n\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- containerd-integration: Support pulling legacy schema1 images\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-09-19T09:38:48Z",
        "closed_at": "2023-09-19T10:56:23Z",
        "merged_at": "2023-09-19T10:56:23Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nMade some tests only run once\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 34,
        "deletions": 16,
        "changed_files": 1,
        "created_at": "2023-09-18T16:35:04Z",
        "closed_at": "2023-09-19T15:08:02Z",
        "merged_at": "2023-09-19T15:08:02Z",
        "body": "\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nReturn the number of containers that use an image if it was asked, during a `docker system df` call for example.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6350,
        "deletions": 2501,
        "changed_files": 198,
        "created_at": "2023-09-18T16:24:47Z",
        "closed_at": "2023-09-18T17:24:44Z",
        "merged_at": "2023-09-18T17:24:44Z",
        "body": "- relates to https://github.com/moby/moby/pull/45966\r\n\r\n### vendor: github.com/vishvananda/netns v0.0.4\r\n\r\nfull diff: https://github.com/vishvananda/netns/compare/v0.0.2...v0.0.4\r\n\r\n### vendor: github.com/vbatts/tar-split v0.11.3\r\n\r\nfull diff: https://github.com/vbatts/tar-split/compare/v0.11.2...v0.11.3\r\n\r\n\r\n### vendor: github.com/containerd/continuity v0.4.2\r\n\r\nfull diff: https://github.com/containerd/continuity/compare/v0.4.1...v0.4.2\r\n\r\n\r\n### vendor: github.com/tonistiigi/vt100 v0.0.0-20230623042737-f9a4f7ef6531\r\n\r\nfix possible panix on fast resizing\r\n\r\nfull diff: https://github.com/tonistiigi/vt100/compare/8066bb97264f...f9a4f7ef6531\r\n\r\n### vendor: github.com/klauspost/compress v1.16.5\r\n\r\nfull diff: https://github.com/klauspost/compress/compare/v1.16.3...v1.16.5\r\n\r\n### vendor: golang.org/x/sync v0.3.0\r\n\r\nfull diff: https://github.com/golang/sync/compare/v0.1.0...v0.3.0\r\n\r\n### vendor:\tgolang.org/x/sys v0.10.0\r\n\r\nfull diff: https://github.com/golang/sys/compare/v0.8.0...v0.10.0\r\n\r\n### vendor: golang.org/x/crypto v0.9.0\r\n\r\nfull diff: https://github.com/golang/crypto/compare/v0.3.0...v0.9.0\r\n\r\n### vendor: golang.org/x/oauth2 v0.7.0\r\n\r\nfull diff: https://github.com/golang/oauth2/compare/v0.6.0...v0.7.0\r\n\r\n### vendor: golang.org/x/tools v0.8.0\r\n\r\nfull diff: https://github.com/golang/tools/compare/v0.6.0...v0.8.0\r\n\r\n### vendor: google.golang.org/api v0.114.0\r\n\r\nfull diff: \r\n\r\n- https://github.com/googleapis/google-api-go-client/compare/v0.110.0...v0.114.0\r\n- https://github.com/googleapis/gax-go/compare/v2.7.0...v2.7.1\r\n\r\n### vendor: github.com/cenkalti/backoff/v4 v4.2.1\r\n\r\nno local changes\r\n\r\nfull diff: https://github.com/cenkalti/backoff/compare/v4.2.0...v4.2.1\r\n\r\n### vendor: google.golang.org/protobuf v1.31.0\r\n\r\nfull diff: https://github.com/protocolbuffers/protobuf-go/compare/v1.30.0...v1.31.0\r\n\r\n### vendor: google.golang.org/grpc v1.56.2\r\n\r\n### vendor: github.com/AdaLogics/go-fuzz-headers v0.0.0-20230811130428-ced1acdcaa24\r\n\r\nfull diff: https://github.com/AdaLogics/go-fuzz-headers/compare/43070de90fa1...ced1acdcaa24\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 6,
        "changed_files": 1,
        "created_at": "2023-09-18T14:36:33Z",
        "closed_at": "2023-09-18T19:26:58Z",
        "merged_at": "2023-09-18T19:26:58Z",
        "body": "Just return a regular error, because the API converts the error to the expected ErrorResponse. Before/After produce the same API response:\r\n\r\n    curl -v --unix-socket /var/run/docker.sock 'http://localhost/v1.43/images/search?term=hello'\r\n    *   Trying /var/run/docker.sock:0...\r\n    * Connected to localhost (/var/run/docker.sock) port 80 (#0)\r\n    > GET /v1.43/images/search?term=hello HTTP/1.1\r\n    > Host: localhost\r\n    > User-Agent: curl/7.74.0\r\n    > Accept: */*\r\n    >\r\n    * Mark bundle as not supporting multiuse\r\n    < HTTP/1.1 500 Internal Server Error\r\n    < Api-Version: 1.44\r\n    < Content-Type: application/json\r\n    < Docker-Experimental: false\r\n    < Ostype: linux\r\n    < Server: Docker/dev (linux)\r\n    < Traceparent: 00-c38c2da5cf30305fcb66836a28e227bf-d16f4f7d2c7002a1-01\r\n    < Date: Mon, 18 Sep 2023 14:30:18 GMT\r\n    < Content-Length: 41\r\n    <\r\n    {\"message\":\"Unexpected status code 409\"}\r\n    * Connection #0 to host localhost left intact\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 14,
        "changed_files": 3,
        "created_at": "2023-09-18T12:39:40Z",
        "closed_at": "2023-09-18T21:06:01Z",
        "merged_at": "2023-09-18T21:06:01Z",
        "body": "**- What I did**\r\n\r\n- Skipped `TestRemoveImageGarbageCollector`, it tests the layer store\r\n- Fixed `TestRemoveContainerAfterLiveRestore`, there is no need to pass the storage driver when starting the daemon\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\nThis test checks how the layer store works, so we don't need it when we\r\nuse containerd as image store\r\n\r\nSigned-off-by: Djordje Lukic <djordje.lukic@docker.com>",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-09-18T11:46:40Z",
        "closed_at": "2023-09-18T13:18:58Z",
        "merged_at": "2023-09-18T13:18:58Z",
        "body": "- relates to https://github.com/moby/moby/pull/18651\r\n- relates to https://github.com/moby/moby/pull/43637\r\n\r\n\r\nThis package was introduced in af597527121c0ad973e9d0ae4f9cf970da1513cc (https://github.com/moby/moby/pull/18651) as a utility package for devicemapper, which was removed in commit dc11d2a2d8e1df0a90ce289f5dd06cad38193073 (https://github.com/moby/moby/pull/43637)(v25.0.0).\r\n\r\nIt looks like there's no external consumers of this package, so we should consider removing it, but deprecating it first, just in case.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 21,
        "deletions": 21,
        "changed_files": 1,
        "created_at": "2023-09-18T10:29:42Z",
        "closed_at": "2023-09-19T19:52:22Z",
        "merged_at": "2023-09-19T19:52:22Z",
        "body": "- backport: https://github.com/moby/moby/pull/46476\r\n\r\n**- What I did**\r\nFixed new process not being killed and deleted when `newIOFromProcess` would fail.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 61,
        "deletions": 90,
        "changed_files": 9,
        "created_at": "2023-09-18T08:52:57Z",
        "closed_at": "2023-09-20T19:16:09Z",
        "merged_at": "2023-09-20T19:16:09Z",
        "body": "- fixes https://github.com/moby/moby/issues/46607\r\n\r\n**- What I did**\r\n\r\nDiffing a container yielded some extra changes that come from the files/directories that we mount inside the container (/etc/resolv.conf for example). To avoid that we create an intermediate snapshot that has these files, with this we can now diff the container fs with its parent and only get the differences that were made inside the container.\r\n\r\n**- How I did it**\r\n\r\nAdded a layer for the base snapshot of a container containing the files that are created by the runtime.\r\n\r\n**- How to verify it**\r\n\r\nRun `TestDiff`\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestDiff TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n- containerd integration: Fixed `docker diff` containing extra differences\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 20,
        "deletions": 42,
        "changed_files": 1,
        "created_at": "2023-09-17T12:32:07Z",
        "closed_at": "2023-09-18T13:04:41Z",
        "merged_at": "2023-09-18T13:04:41Z",
        "body": "- use local variables and remove some intermediate variables\r\n- handle the events inside the switch itself; this makes all the switch branches use the same logic, instead of \"some\" using a `continue`, and others falling through to have the event handled outside of the switch.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 13,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-09-16T11:24:58Z",
        "closed_at": "2023-09-20T14:39:38Z",
        "merged_at": "2023-09-20T14:39:38Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nWe weren't checking for the asked platform in the case the image was a manifest, only if it was a manifest list. Now we do\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nRun \r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestCreateDifferentPlatform TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-09-16T11:10:53Z",
        "closed_at": "2023-09-18T12:43:05Z",
        "merged_at": "2023-09-18T12:43:05Z",
        "body": "\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nWe were sending the \"Pulling from ...\" message too early, if the pull progress wasn't able to resolve the image we wouldn't sent the error back. Sending that first message would have flushed the output stream and image_routes.go would return a nil error.\r\n\r\nSo instead of sending the \"Pulling from ...\" message right away, we wait for the pull progress to at least start pulling a manifest, which is kinda what the graph driver implementation does.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n`TestDaemonProxy` should not fail any more\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestDaemonProxy TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_IGNORE_CGROUP_CHECK=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 113,
        "deletions": 114,
        "changed_files": 6,
        "created_at": "2023-09-16T05:05:23Z",
        "closed_at": "2023-10-16T17:08:07Z",
        "merged_at": "2023-10-16T17:08:07Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nThis PR contains a handful of commits (please do not squash) that modify the bridge driver to improve code readability and maintainability.\r\n\r\nThese commits are preparation for [my work-in-progress fix](https://github.com/rhansen/moby/commit/host_ipv6) for #46469.\r\n\r\nThe first commit was suggested in https://github.com/moby/moby/pull/46446#discussion_r1321377818\r\n\r\nNo behavior changes are expected, but I'm not 100% certain that the last commit (the one that renames `HostIP` to `HostIPv4`) preserves API and disk file format compatibility.  I'm OK with omitting that commit, but I think it improves readability, especially when combined with the fix for #46469.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n(not necessary)",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-15T22:17:36Z",
        "closed_at": "2023-09-17T13:58:58Z",
        "merged_at": "2023-09-17T13:58:58Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nChecked if the tag resembles a digest algorithm name before tagging and returning an error.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nRun \r\n\r\n```console\r\n$ make TEST_FILTER='TestTagUsingDigestAlgorithmAsName' TEST_IGNORE_CGROUP_CHECK=1 DOCKERCLI_INTEGRATION_VERSION=v24.0.5  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 96,
        "deletions": 92,
        "changed_files": 24,
        "created_at": "2023-09-15T11:56:29Z",
        "closed_at": "2023-09-15T19:55:01Z",
        "merged_at": "2023-09-15T19:55:01Z",
        "body": "- [x] follow-up to https://github.com/moby/moby/pull/46488\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 256,
        "deletions": 77,
        "changed_files": 25,
        "created_at": "2023-09-15T11:54:20Z",
        "closed_at": "2023-09-15T18:11:54Z",
        "merged_at": "2023-09-15T18:11:53Z",
        "body": "### vendor: github.com/Microsoft/hcsshim v0.9.10\r\n\r\nAdd support for platform compatibility check for windows + add windows builds\r\n\r\nfull diff: https://github.com/Microsoft/hcsshim/compare/v0.9.8...v0.9.10\r\n\r\n\r\n### vendor: github.com/containerd/containerd v1.6.24\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.6.22...v1.6.24\r\n\r\nv1.6.24 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.6.23...v1.6.24\r\n\r\nThe twenty-fourth patch release for containerd 1.6 contains various fixes\r\nand updates.\r\n\r\nNotable Updates\r\n\r\n- CRI: fix leaked shim caused by high IO pressure\r\n- Update to go1.20.8\r\n- Update runc to v1.1.9\r\n- Backport: add configurable mount options to overlay snapshotter\r\n- log: cleanups and improvements to decouple more from logrus\r\n\r\nv1.6.23 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.6.22...v1.6.23\r\n\r\nThe twenty-third patch release for containerd 1.6 contains various fixes\r\nand updates.\r\n\r\nNotable Updates\r\n\r\n- Add stable ABI support in windows platform matcher + update hcsshim tag\r\n- cri: Don't use rel path for image volumes\r\n- Upgrade GitHub actions packages in release workflow\r\n- update to go1.19.12\r\n- backport: ro option for userxattr mount check + cherry-pick: Fix ro mount option being passed\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-09-15T10:24:16Z",
        "closed_at": "2023-09-16T11:38:48Z",
        "merged_at": "2023-09-16T11:38:48Z",
        "body": "- backport of https://github.com/moby/moby/pull/46486\r\n\r\nUpdate the version used in testing;\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.3...v1.7.6\r\n\r\nv1.7.6 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.5...v1.7.6\r\n\r\nThe sixth patch release for containerd 1.7 contains various fixes and updates.\r\n\r\n- Fix log package for clients overwriting the global logger\r\n- Fix blockfile snapshotter copy on Darwin\r\n- Add support for Linux usernames on non-Linux platforms\r\n- Update Windows platform matcher to invoke stable ABI compability function\r\n- Update Golang to 1.20.8\r\n- Update push to inherit distribution sources from parent\r\n\r\nv1.7.5 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.4...v1.7.5\r\n\r\nThe fifth patch release for containerd 1.7 fixes a versioning issue from the previous release and includes some internal logging API changes.\r\n\r\nv1.7.4 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.3...v1.7.4\r\n\r\nThe fourth patch release for containerd 1.7 contains remote differ plugin support, a new block file based snapshotter, and various fixes and updates.\r\n\r\nNotable Updates\r\n\r\n- Add blockfile snapshotter\r\n- Add remote/proxy differ\r\n- Update runc binary to v1.1.9\r\n- Cri: Don't use rel path for image volumes\r\n- Allow attaching to any combination of stdin/out/err\r\n- Fix ro mount option being passed\r\n- Fix leaked shim caused by high IO pressure\r\n- Add configurable mount options to overlay snapshotter\r\n\r\n\r\n(cherry picked from commit 24102aa8ca838917c808ba0fa0dd270172805d1a)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-09-15T10:24:00Z",
        "closed_at": "2023-09-16T11:38:31Z",
        "merged_at": "2023-09-16T11:38:31Z",
        "body": "Update the version used in testing;\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.3...v1.7.6\r\n\r\nv1.7.6 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.5...v1.7.6\r\n\r\nThe sixth patch release for containerd 1.7 contains various fixes and updates.\r\n\r\n- Fix log package for clients overwriting the global logger\r\n- Fix blockfile snapshotter copy on Darwin\r\n- Add support for Linux usernames on non-Linux platforms\r\n- Update Windows platform matcher to invoke stable ABI compability function\r\n- Update Golang to 1.20.8\r\n- Update push to inherit distribution sources from parent\r\n\r\nv1.7.5 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.4...v1.7.5\r\n\r\nThe fifth patch release for containerd 1.7 fixes a versioning issue from the previous release and includes some internal logging API changes.\r\n\r\nv1.7.4 release notes:\r\n\r\nfull diff: https://github.com/containerd/containerd/compare/v1.7.3...v1.7.4\r\n\r\nThe fourth patch release for containerd 1.7 contains remote differ plugin support, a new block file based snapshotter, and various fixes and updates.\r\n\r\nNotable Updates\r\n\r\n- Add blockfile snapshotter\r\n- Add remote/proxy differ\r\n- Update runc binary to v1.1.9\r\n- Cri: Don't use rel path for image volumes\r\n- Allow attaching to any combination of stdin/out/err\r\n- Fix ro mount option being passed\r\n- Fix leaked shim caused by high IO pressure\r\n- Add configurable mount options to overlay snapshotter\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 40,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-09-15T08:58:33Z",
        "closed_at": "2023-09-15T15:38:06Z",
        "merged_at": "2023-09-15T15:38:05Z",
        "body": " **c8d/push: Support pushing all tags**\r\n\r\nImplement missing feature that pushes all tags from the provided local\r\nrepository.\r\n\r\n**c8d/push: Add missing message about repository**\r\n\r\n(a bit unrelated but I decided to include it here since it's only one line and I'm already making changes here)\r\n\r\nAdd \"The push referers to repository X\" message which is present in the\r\npush output when using the graphdrivers.\r\n\r\n\r\n**- How to verify it**\r\n[c8d integration tests CI](https://github.com/moby/moby/actions/runs/6187498841/job/16797538706?pr=45232)\r\n```diff\r\n-DONE 277 tests, 5 skipped, 54 failures in 447.508s\r\n+DONE 277 tests, 5 skipped, 47 failures in 501.680s\r\n```\r\n\r\n```bash\r\n$ make TEST_FILTER='TestPushMultipleTags'  TEST_IGNORE_CGROUP_CHECK=1 DOCKERCLI_INTEGRATION_VERSION=v24.0.5  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n...\r\n=== RUN   TestDockerRegistrySuite/TestPushMultipleTags\r\n--- PASS: TestDockerRegistrySuite (0.27s)\r\n    --- PASS: TestDockerRegistrySuite/TestPushMultipleTags (0.27s)\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 55,
        "deletions": 79,
        "changed_files": 1,
        "created_at": "2023-09-15T05:49:44Z",
        "closed_at": "2023-09-25T09:34:52Z",
        "merged_at": "2023-09-25T09:34:51Z",
        "body": "**- What I did**\r\nRefactored the containers list code which is responsible for `docker ps`\r\n\r\n**- How I did it**\r\nThere are 3 functions in this picture which are `Containers`, `reduceContainers` and `reducePsContainers`. `reducePsContainers` is only being called from `reduceContainers` and `reduceContainers` is only being called from `Containers`. This is the only line in `Containers` body. So, eliminated both `reduceContainers` and `reducePsContainers` and involved all the code inside `Containers` itself.\r\n\r\n**- How to verify it**\r\n`docker ps` command with any filters should work as it used to be,\r\n\r\n**- Description for the changelog**\r\nRemoved `reducePsContainers` and `reduceContainers` and inserted all this functionality in `Containers` itself.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n![image](https://github.com/moby/moby/assets/64607742/1ab26de0-3e18-4a1c-a9e3-048a63655e80)",
        "comments": 10
    },
    {
        "merged": true,
        "additions": 636,
        "deletions": 508,
        "changed_files": 112,
        "created_at": "2023-09-14T17:48:30Z",
        "closed_at": "2023-10-12T13:29:11Z",
        "merged_at": "2023-10-12T13:29:11Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-14T15:53:24Z",
        "closed_at": "2023-09-14T17:30:43Z",
        "merged_at": "2023-09-14T17:30:43Z",
        "body": "- Partially backport https://github.com/moby/moby/pull/45759\r\n- addresses https://github.com/docker/for-mac/issues/6870",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 14,
        "deletions": 7,
        "changed_files": 5,
        "created_at": "2023-09-14T14:39:49Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nFix the comment format to make linters able to catch the deprecation warning.\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 23,
        "deletions": 61,
        "changed_files": 3,
        "created_at": "2023-09-14T14:17:43Z",
        "closed_at": "2023-09-19T12:00:12Z",
        "merged_at": "2023-09-19T12:00:12Z",
        "body": "### libnetwork: Controller.processEndpointCreate, Delete: remove nmap arg\r\n\r\nIt was used to pass the controller's own field; let's just use the\r\nfield directly instead.\r\n\r\n### libnetwork: Network.updateSvcRecord: remove unused localEps arg\r\n\r\n### libnetwork: remove netWatch.remoteEps, as it's unused\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 60,
        "deletions": 58,
        "changed_files": 8,
        "created_at": "2023-09-14T12:34:03Z",
        "closed_at": "2023-09-19T15:17:32Z",
        "merged_at": "2023-09-19T15:17:32Z",
        "body": "**imageService/PullImage: Move reference parse to api**\r\n\r\nMake `PullImage` accept `reference.Named` directly instead of\r\nduplicating the parsing code for both graphdriver and containerd image\r\nservice implementations.\r\n\r\n**api/pull: Validate repo name**\r\n\r\nCopy the check for \"scratch\" image pull attempt from the distribution\r\nto the API.\r\n\r\n\r\n\r\n**- How to verify it**\r\n1. CI still passes\r\n2. `TestPullScratchNotAllowed` is now green with c8d integration\r\n\r\n```diff\r\n$ make TEST_FILTER='TestPullScratchNotAllowed'  TEST_IGNORE_CGROUP_CHECK=1 DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1   test-integration\r\n\r\n=== RUN   TestDockerHubPullSuite/TestPullScratchNotAllowed\r\n-    docker_cli_pull_test.go:203: assertion failed: expression is false: strings.Contains(out, \"'scratch' is a reserved -name\")\r\n---- FAIL: TestDockerHubPullSuite (2.21s)\r\n-    --- FAIL: TestDockerHubPullSuite/TestPullScratchNotAllowed (2.20s)\r\n-FAIL\r\n+--- PASS: TestDockerHubPullSuite (2.17s)\r\n+    --- PASS: TestDockerHubPullSuite/TestPullScratchNotAllowed (2.14s)\r\n+PASS\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 81,
        "deletions": 2,
        "changed_files": 5,
        "created_at": "2023-09-14T10:06:03Z",
        "closed_at": "2023-09-14T11:51:44Z",
        "merged_at": "2023-09-14T11:51:44Z",
        "body": "Backports:\r\n\r\n- https://github.com/moby/moby/pull/46406\r\n- fixes https://github.com/moby/moby/issues/46404\r\n- fixes docker/compose#10796\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 13,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-14T10:05:26Z",
        "closed_at": "2023-09-14T12:38:26Z",
        "merged_at": "2023-09-14T12:38:26Z",
        "body": "- closes https://github.com/moby/moby/issues/40857\r\n- closes https://github.com/moby/moby/issues/43421\r\n- closes https://github.com/moby/moby/issues/40857\r\n- related: https://github.com/moby/moby/pull/45229\r\n\r\n\r\nUsing @tianon's suggestion as starting point; https://github.com/moby/moby/issues/40857#issuecomment-629414797\r\n\r\nWe occassionally receive contributions to this script that are outside its intended scope. Let's add a comment to the script that outlines what it's meant for, and a link to a GitHub ticket with alternatives.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 21,
        "deletions": 21,
        "changed_files": 1,
        "created_at": "2023-09-14T09:17:15Z",
        "closed_at": "2023-09-18T13:06:57Z",
        "merged_at": "2023-09-18T13:06:57Z",
        "body": "\r\n\r\n**- What I did**\r\nFixed new process not being killed and deleted when `newIOFromProcess` would fail.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 36,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-09-13T23:35:55Z",
        "closed_at": "2023-09-14T15:18:08Z",
        "merged_at": "2023-09-14T15:18:08Z",
        "body": "When registry token is provided, the authorization header can be directly applied to the registry request. No other type of authorization will be attempted when the registry token is provided.\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 24,
        "deletions": 30,
        "changed_files": 7,
        "created_at": "2023-09-13T16:17:07Z",
        "closed_at": "2023-09-13T21:32:43Z",
        "merged_at": "2023-09-13T21:32:43Z",
        "body": "- follow-up to https://github.com/moby/moby/pull/46446#discussion_r1321384136\r\n\r\n### libnetwork/portmapper: New(): remove unused argument\r\n\r\nNone of the code using this function was setting the value, so let's\r\nsimplify and remove the argument.\r\n\r\n\r\n### libnetwork/portmapper: un-export PortMapper.Allocator\r\n\r\nIt was only accessed through methods on PortMapper, and in tests.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 336,
        "deletions": 340,
        "changed_files": 330,
        "created_at": "2023-09-13T15:45:47Z",
        "closed_at": "2023-10-12T08:35:02Z",
        "merged_at": "2023-10-12T08:35:02Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46488\r\n- [x] depends on https://github.com/moby/moby/pull/46489\r\n- [x] depends on https://github.com/moby/moby/pull/46611\r\n- relates to https://github.com/containerd/containerd/pull/9086\r\n- relates to https://github.com/containerd/containerd/pull/9093\r\n- relates to https://github.com/containerd/containerd/pull/9002\r\n\r\n\r\n\r\nThe github.com/containerd/containerd/log package was moved to a separate module, which will also be used by upcoming (patch) releases of containerd.\r\n\r\nThis patch moves our own uses of the package to use the new module.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-13T15:23:18Z",
        "closed_at": "2023-09-13T18:54:11Z",
        "merged_at": "2023-09-13T18:54:11Z",
        "body": "Adding Derek as curator, so that he's able to perform triage tasks in this repository :)\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-09-13T13:12:39Z",
        "closed_at": "2023-09-14T10:10:17Z",
        "merged_at": "2023-09-14T10:10:17Z",
        "body": "This is the band aid to address issue https://github.com/moby/moby/issues/42964.\r\n\r\nWhen the daemon process or the host running it is abruptly terminated, the layer metadata file can become inconsistent on the file system. Specifically, `link` and `lower` files may exist but be empty, leading to overlay mounting errors during layer extraction, such as: \"failed to register layer: error creating overlay mount to <path>: too many levels of symbolic links.\"\r\n\r\nThis commit introduces the use of `AtomicWriteFile` to ensure that the layer metadata files contain correct data when they exist on the file system.\r\n\r\nThe steps to reproduce the issue are described here https://github.com/moby/moby/issues/42964. ",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 15,
        "deletions": 8,
        "changed_files": 2,
        "created_at": "2023-09-12T20:48:06Z",
        "closed_at": null,
        "merged_at": null,
        "body": "This function is called for both IPv4 and IPv6, so this check broke `dockerd --iptables=false --ip6tables=true`.\r\n\r\n**- How to verify it**\r\n\r\n```\r\ndockerd --ipv6 --fixed-cidr-v6=fd00::/64 --iptables=false --experimental --ip6tables\r\n```\r\n\r\n**- Description for the changelog**\r\n\r\n`dockerd --iptables=false --ip6tables=true` now works.\r\n\r\nfixes #46467 ",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 244,
        "deletions": 135,
        "changed_files": 31,
        "created_at": "2023-09-12T17:12:31Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- relates to https://github.com/moby/moby/pull/46463 (https://github.com/moby/moby/pull/46463#issuecomment-1715866997)\r\n\r\n---\r\n\r\n- implement versions.FromContext\r\n- implement versions.WithVersion to return a context with the version attached.\r\n- deprecates the APIVersionKey type in favor of WithVersion.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 126,
        "deletions": 38,
        "changed_files": 31,
        "created_at": "2023-09-12T12:16:13Z",
        "closed_at": "2023-09-20T17:48:32Z",
        "merged_at": "2023-09-20T17:48:32Z",
        "body": "- relates to https://github.com/moby/moby/pull/46251#discussion_r1321482695\r\n\r\n\r\nWe try to perform API-version negotiation as lazy as possible (and only execute when we are about to make an API request). However, some code requires API-version dependent handling (to set options, or remove options based on the version of the API we're using).\r\n\r\nCurrently this code depended on the caller code to perform API negotiation (or to configure the API version) first, which may not happen, and because of that we may be missing options (or set options that are not supported on older API versions).\r\n\r\nThis patch:\r\n\r\n- splits the code that triggered API-version negotiation to a separate Client.checkVersion() function.\r\n- updates NewVersionError to accept a context\r\n- updates NewVersionError to perform API-version negotiation (if enabled)\r\n- updates various Client functions to manually trigger API-version negotiation\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 5,
        "created_at": "2023-09-12T09:25:37Z",
        "closed_at": "2023-09-12T12:39:11Z",
        "merged_at": "2023-09-12T12:39:11Z",
        "body": "- backport of https://github.com/moby/moby/pull/46453\r\n\r\ngo1.20.8 (released 2023-09-06) includes two security fixes to the html/template package, as well as bug fixes to the compiler, the go command, the runtime, and the crypto/tls, go/types, net/http, and path/filepath packages. See the Go 1.20.8 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.8+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.7...go1.20.8\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.1 and Go 1.20.8 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.1 and 1.20.8, minor point releases.\r\n\r\nThese minor releases include 4 security fixes following the security policy:\r\n\r\n- cmd/go: go.mod toolchain directive allows arbitrary execution The go.mod toolchain directive, introduced in Go 1.21, could be leveraged to execute scripts and binaries relative to the root of the module when the \"go\" command was executed within the module. This applies to modules downloaded using the \"go\" command from the module proxy, as well as modules downloaded directly using VCS software.\r\n\r\n  Thanks to Juho Nurminen of Mattermost for reporting this issue.\r\n\r\n  This is CVE-2023-39320 and Go issue https://go.dev/issue/62198.\r\n\r\n- html/template: improper handling of HTML-like comments within script contexts The html/template package did not properly handle HMTL-like \"<!--\" and \"-->\" comment tokens, nor hashbang \"#!\" comment tokens, in <script> contexts. This may cause the template parser to improperly interpret the contents of <script> contexts, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39318 and Go issue https://go.dev/issue/62196.\r\n\r\n- html/template: improper handling of special tags within script contexts The html/template package did not apply the proper rules for handling occurrences of \"<script\", \"<!--\", and \"</script\" within JS literals in <script> contexts. This may cause the template parser to improperly consider script contexts to be terminated early, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39319 and Go issue https://go.dev/issue/62197.\r\n\r\n- crypto/tls: panic when processing post-handshake message on QUIC connections Processing an incomplete post-handshake message for a QUIC connection caused a panic.\r\n\r\n  Thanks to Marten Seemann for reporting this issue.\r\n\r\n  This is CVE-2023-39321 and CVE-2023-39322 and Go issue https://go.dev/issue/62266.\r\n\r\n\r\n(cherry picked from commit c41121cc48537b3b18084e14831fa254be714446)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 6,
        "changed_files": 6,
        "created_at": "2023-09-12T09:25:33Z",
        "closed_at": "2023-09-12T12:38:06Z",
        "merged_at": "2023-09-12T12:38:05Z",
        "body": "- backport of https://github.com/moby/moby/pull/46453\r\n\r\n\r\ngo1.20.8 (released 2023-09-06) includes two security fixes to the html/template package, as well as bug fixes to the compiler, the go command, the runtime, and the crypto/tls, go/types, net/http, and path/filepath packages. See the Go 1.20.8 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.8+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.7...go1.20.8\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.1 and Go 1.20.8 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.1 and 1.20.8, minor point releases.\r\n\r\nThese minor releases include 4 security fixes following the security policy:\r\n\r\n- cmd/go: go.mod toolchain directive allows arbitrary execution The go.mod toolchain directive, introduced in Go 1.21, could be leveraged to execute scripts and binaries relative to the root of the module when the \"go\" command was executed within the module. This applies to modules downloaded using the \"go\" command from the module proxy, as well as modules downloaded directly using VCS software.\r\n\r\n  Thanks to Juho Nurminen of Mattermost for reporting this issue.\r\n\r\n  This is CVE-2023-39320 and Go issue https://go.dev/issue/62198.\r\n\r\n- html/template: improper handling of HTML-like comments within script contexts The html/template package did not properly handle HMTL-like \"<!--\" and \"-->\" comment tokens, nor hashbang \"#!\" comment tokens, in <script> contexts. This may cause the template parser to improperly interpret the contents of <script> contexts, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39318 and Go issue https://go.dev/issue/62196.\r\n\r\n- html/template: improper handling of special tags within script contexts The html/template package did not apply the proper rules for handling occurrences of \"<script\", \"<!--\", and \"</script\" within JS literals in <script> contexts. This may cause the template parser to improperly consider script contexts to be terminated early, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39319 and Go issue https://go.dev/issue/62197.\r\n\r\n- crypto/tls: panic when processing post-handshake message on QUIC connections Processing an incomplete post-handshake message for a QUIC connection caused a panic.\r\n\r\n  Thanks to Marten Seemann for reporting this issue.\r\n\r\n  This is CVE-2023-39321 and CVE-2023-39322 and Go issue https://go.dev/issue/62266.\r\n\r\n\r\n(cherry picked from commit c41121cc48537b3b18084e14831fa254be714446)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 119,
        "deletions": 24,
        "changed_files": 6,
        "created_at": "2023-09-12T07:28:08Z",
        "closed_at": "2023-09-12T12:40:05Z",
        "merged_at": "2023-09-12T12:40:05Z",
        "body": "- related to: https://github.com/janos/singleflight/pull/6\r\n- related to: https://github.com/moby/moby/pull/46444#discussion_r1321323146\r\n\r\nFixes the context aware singleflight not preserving context values.\r\n\r\nfull diff: https://github.com/janos/singleflight/compare/v0.3.0...v0.4.0\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 135,
        "deletions": 111,
        "changed_files": 8,
        "created_at": "2023-09-11T19:41:19Z",
        "closed_at": "2023-10-18T08:20:38Z",
        "merged_at": "2023-10-18T08:20:38Z",
        "body": "was preparing this one, and noticed some changes that were included in; https://github.com/moby/moby/pull/46386, so let me open this as draft (I'll update once the other one is merged);\r\n\r\n- [x] depends on https://github.com/moby/moby/pull/46386\r\n\r\n-----\r\n\r\n### vendor: github.com/go-logr/logr v1.2.4\r\n\r\nfull diff: https://github.com/go-logr/logr/compare/v1.2.3...v1.2.4\r\n\r\n### vendor: github.com/moby/swarmkit/v2 v2.0.0-20230911190601-f082dd7a0cee\r\n\r\nfull diff: https://github.com/moby/swarmkit/compare/12f0c246fed0...f082dd7a0ceeabf146a4705597b48b1c21aa3b8a\r\n\r\n\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 73,
        "deletions": 23,
        "changed_files": 9,
        "created_at": "2023-09-11T16:01:44Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- Follow-up to https://github.com/moby/moby/pull/45966",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 29,
        "deletions": 13,
        "changed_files": 3,
        "created_at": "2023-09-11T14:42:35Z",
        "closed_at": "2023-09-11T20:18:22Z",
        "merged_at": "2023-09-11T20:18:22Z",
        "body": "**- What I did**\r\n\r\nPR moby/moby#45759 added a validation step to `NetworkCreate` to ensure no IPv6 subnet could be set on a network if its `EnableIPv6` parameter is false.\r\n\r\nBefore that, the daemon was accepting such request but was doing nothing with the IPv6 subnet.\r\n\r\nThis validation step is now deleted, and we automatically set `EnableIPv6` if an IPv6 subnet was specified.\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-11T14:37:00Z",
        "closed_at": "2023-09-11T17:55:43Z",
        "merged_at": "2023-09-11T17:55:43Z",
        "body": "\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nDisabled schema1 registry integration tests\r\n\r\nschema1 was deprecated a while ago, containerd fails to push to a schema1 registry, let's just skip these tests for the containerd integration\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 7,
        "changed_files": 7,
        "created_at": "2023-09-11T13:48:05Z",
        "closed_at": "2023-09-12T08:43:25Z",
        "merged_at": "2023-09-12T08:43:25Z",
        "body": "go1.20.8 (released 2023-09-06) includes two security fixes to the html/template package, as well as bug fixes to the compiler, the go command, the runtime, and the crypto/tls, go/types, net/http, and path/filepath packages. See the Go 1.20.8 milestone on our issue tracker for details:\r\n\r\nhttps://github.com/golang/go/issues?q=milestone%3AGo1.20.8+label%3ACherryPickApproved\r\n\r\nfull diff: https://github.com/golang/go/compare/go1.20.7...go1.20.8\r\n\r\nFrom the security mailing:\r\n\r\n[security] Go 1.21.1 and Go 1.20.8 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.21.1 and 1.20.8, minor point releases.\r\n\r\nThese minor releases include 4 security fixes following the security policy:\r\n\r\n- cmd/go: go.mod toolchain directive allows arbitrary execution The go.mod toolchain directive, introduced in Go 1.21, could be leveraged to execute scripts and binaries relative to the root of the module when the \"go\" command was executed within the module. This applies to modules downloaded using the \"go\" command from the module proxy, as well as modules downloaded directly using VCS software.\r\n\r\n  Thanks to Juho Nurminen of Mattermost for reporting this issue.\r\n\r\n  This is CVE-2023-39320 and Go issue https://go.dev/issue/62198.\r\n\r\n- html/template: improper handling of HTML-like comments within script contexts The html/template package did not properly handle HMTL-like \"<!--\" and \"-->\" comment tokens, nor hashbang \"#!\" comment tokens, in <script> contexts. This may cause the template parser to improperly interpret the contents of <script> contexts, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39318 and Go issue https://go.dev/issue/62196.\r\n\r\n- html/template: improper handling of special tags within script contexts The html/template package did not apply the proper rules for handling occurrences of \"<script\", \"<!--\", and \"</script\" within JS literals in <script> contexts. This may cause the template parser to improperly consider script contexts to be terminated early, causing actions to be improperly escaped. This could be leveraged to perform an XSS attack.\r\n\r\n  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for reporting this issue.\r\n\r\n  This is CVE-2023-39319 and Go issue https://go.dev/issue/62197.\r\n\r\n- crypto/tls: panic when processing post-handshake message on QUIC connections Processing an incomplete post-handshake message for a QUIC connection caused a panic.\r\n\r\n  Thanks to Marten Seemann for reporting this issue.\r\n\r\n  This is CVE-2023-39321 and CVE-2023-39322 and Go issue https://go.dev/issue/62266.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 9602,
        "deletions": 8669,
        "changed_files": 1,
        "created_at": "2023-09-11T08:57:40Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- fixes https://github.com/moby/moby/issues/45418\r\n\r\nInitial conversion was done using the conversion-tool provided by swagger. I tried that conversion tool a few years back, and it wasn't great at the time, but it improved significantly. Nonetheless, quite some manual changes were needed after converting;\r\n\r\n- The conversion tool uses a fixed order of fields, which didn't match the existing file, so made comparing impossible.\r\n- The conversion tool optimizes YAML by leaving out quotes where possible, and using single-quotes in other cases. Ths again didn't match our existing file, and made comparing impossible.\r\n\r\nSome General description of changes from v2 -> v3:\r\n\r\n- `definitions` is now `components/schema`\r\n- `parameters` with `in: body` now get their own field: `requestBody` (which can be per-mediaType)\r\n- `parameters.type` is now `parameters.schema.type`\r\n- `produces` / `consumes` (mediaTypes) is now defined per request / response. For example, a `200` response that can return either `application/json` or `plain/text`, now has a `content` struct, with entries for each mediaType.\r\n- `x-nullable` is now supported by OpenAPI as `nullable`, but I kept both variants for now (to allow some tools to use the `x-` variant).\r\n\r\n(Error) responses in multiple content-types:\r\n\r\nOpenAPI v2 was limited in how to describe that an endpoint allowed for different content-types to be returned (produced). OpenAPI v3 addresses this limitation by allowing responses and requests to be defined per-media-type. Lacking more information, the conversion tool creates responses for every media-type, which includes variants for each error / status-code response (separate definitions for error-responses for archive/tar, application/json, text/plain, etc.). In some cases it would also create _requests_ for both, documenting a JSON request as `text/plain` (or other media-type).\r\n\r\nSome of these may have been the result or incorrect definitions in the v2 swagger (i.e., only including a `produces`, not a `consumes`), but that's to be looked at.\r\n\r\nThere's some parts to look into;\r\n\r\n- current version of the API should always return the JSON (ErrorResponse) type (API v1.23 and up, see [apiVersionSupportsJSONErrors][1]).\r\n- however, the Content-Type may not be set correctly in all cases. For example, the `GET /images/get` endpoint (`imageRouter.getImagesGet`), can return either \"no content type\", or `application/x-tar`, depending on where in [the code the error happens][2].\r\n- We could assume that any error (e.g. a `500`) _could_ return a plain-text error, but that's to be looked at.\r\n\r\nFor the time being, I limited most error returns to be JSON, and kept the `text/plain` variant for a follow-up.\r\n\r\nThere are some things remaining to be looked at;\r\n\r\n- Our swagger contains \"descriptions\" in some places where OpenAPI V3 doesn't allow them. These look to be in cases where we re-use a single definition for multiple purposes, and try to document each of them individually. These descriptions were kept as comments, with a TODO\r\n- Our go-swagger version does not support OpenAPI v3, which means that generating code from the swagger is currently broken. We need to update to a more recent version (something we had to do either way, as it was broken in many respects).\r\n\r\n[1]: https://github.com/moby/moby/blob/6ce5aa1cd5a46e02ffaa3fe0c794642b35601676/api/server/errorhandler.go#L31-L34\r\n[2]: https://github.com/moby/moby/blob/6ce5aa1cd5a46e02ffaa3fe0c794642b35601676/api/server/router/image/image_routes.go#L184-L207\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 107,
        "deletions": 132,
        "changed_files": 6,
        "created_at": "2023-09-11T06:22:00Z",
        "closed_at": "2023-10-05T15:10:30Z",
        "merged_at": "2023-10-05T15:10:30Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nKuberenets CRI interface `ListContainerStats` requires to collect every pod container's stats. Currently `daemon/stats/collector.go` runs in a serial way and sleep `1s` at the end of `for` loop. This causes `ListContainerStats` to suffer long delays if there are many pod containers on the node. \r\n\r\nThis PR is to address this issue.\r\n\r\n**- How I did it**\r\n\r\n- Make the stats collector parallel with the number of CPUs.\r\n- ~`Sleep` is not needed in a normal loop since a condition variable is used. Only sleep when an error happens at system level, then retry in next loop~. `time.Sleep(s.interval)` is needed for `one-short=0` or `stream=1`, otherwise the caller would receive successive stats without any interval.\r\n- Move `bufReader` out of `Collector`, since it cannot be shared by multiple goroutines.\r\n- Get container stats directly (i.e. without using publishers) for `one-shot` requests. \r\n\r\n**- How to verify it**\r\n\r\nRun the PR build with `cri-dockerd`, observe the time taken for `ListContainerStats`. Without this code change, it could take over 3 seconds when about 40 pod containers on the node. ~With this fix, it takes less than 1 second~. \r\n- Making stats collection parallel reduces the `ListContainerStats` time to 2 seconds on the 4-CPU node. \r\n- Getting container stats directly for `one-shot` requests reduces the `ListContainerStats` time to less than 200ms. (The requests sent by `cri-dockerd` are `one-shot` requests)  \r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\nImproves the performance of the stats collector\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 15
    },
    {
        "merged": false,
        "additions": 57,
        "deletions": 32,
        "changed_files": 11,
        "created_at": "2023-09-10T13:55:09Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Related to:\r\n\r\n- https://github.com/docker/cli/pull/4493#discussion_r1298609663\r\n- https://github.com/moby/moby/issues/19421\r\n\r\n**- What I did**\r\n\r\nConstants for both platform-specific and platform-independent networks are added to the api/network package.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://cdn.cdnparenting.com/articles/2019/06/01154838/Parrot-Facts-for-Kids-1115777186.webp)",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 54,
        "deletions": 4,
        "changed_files": 2,
        "created_at": "2023-09-10T08:02:27Z",
        "closed_at": "2023-09-13T16:08:03Z",
        "merged_at": "2023-09-13T16:08:03Z",
        "body": "Before this commit, setting the `com.docker.network.host_ipv4` bridge option when `enable_ipv6` is true and the experimental `ip6tables` option is enabled would cause Docker to fail to create the network:\r\n\r\n> failed to create network `test-network`: Error response from daemon: Failed to Setup IP tables: Unable to enable NAT rule: (iptables failed: `ip6tables --wait -t nat -I POSTROUTING -s fd01::/64 ! -o br-test -j SNAT --to-source 192.168.0.2`: ip6tables v1.8.7 (nf_tables): Bad IP address \"192.168.0.2\"\r\n>\r\n> Try `ip6tables -h` or `ip6tables --help` for more information.\r\n>  (exit status 2))\r\n\r\nFix this error by passing nil\u2014not the `host_ipv4` address\u2014when creating the IPv6 rules.\r\n\r\n**- How to verify it**\r\n\r\nUnit tests:\r\n\r\n`make TESTDIRS=github.com/docker/docker/libnetwork/drivers/bridge test-unit`\r\n\r\nTesting a fully built binary:\r\n\r\n```\r\ndockerd --ipv6 --fixed-cidr-v6=fd00::/64 --experimental --ip6tables\r\ndocker network create -d bridge --ipv6 --subnet fd01::/64 --opt com.docker.network.host_ipv4=192.168.0.2 test-network\r\n```\r\n\r\n**- Description for the changelog**\r\n\r\nFixed `com.docker.network.host_ipv4` option when IPv6 and `ip6tables` are enabled.\r\n\r\nFixes #46445 \r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 339,
        "deletions": 147,
        "changed_files": 28,
        "created_at": "2023-09-10T00:09:03Z",
        "closed_at": null,
        "merged_at": null,
        "body": "I was trying to find out why `docker info` was sometimes slow so plumbing a context through to propagate trace data through.\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-09-08T22:54:45Z",
        "closed_at": "2023-09-12T08:42:40Z",
        "merged_at": "2023-09-12T08:42:40Z",
        "body": "Looks like some dependencies ended up on in the wrong list.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 65,
        "changed_files": 14,
        "created_at": "2023-09-08T18:50:09Z",
        "closed_at": "2023-09-11T11:15:38Z",
        "merged_at": "2023-09-11T11:15:38Z",
        "body": "- relates to https://github.com/moby/moby/pull/46422 (https://github.com/moby/moby/pull/46422#discussion_r1319487337)\r\n\r\n\r\ncontainer.Run() should be a synchronous operation in normal circumstances; the container is created and started, so polling after that for the container to be in the \"running\" state should not be needed.\r\n\r\nThis should also prevent issues when a container (for whatever reason) exited immediately after starting; in that case we would continue polling for it to be running (which likely would never happen).\r\n\r\nLet's skip the polling; if the container is not in the expected state (i.e. exited), tests should fail as well.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 16,
        "changed_files": 5,
        "created_at": "2023-09-08T16:55:11Z",
        "closed_at": "2023-09-08T18:35:53Z",
        "merged_at": "2023-09-08T18:35:53Z",
        "body": "This brings in moby/buildkit#4215 which fixes a major issue with source policies in buildkit.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 45,
        "deletions": 14,
        "changed_files": 5,
        "created_at": "2023-09-08T15:47:10Z",
        "closed_at": "2023-09-12T08:43:03Z",
        "merged_at": "2023-09-12T08:43:02Z",
        "body": "Removes uses of the github.com/opencontainers/runc/libcontainer/devices package.\r\n\r\nfull diff: https://github.com/cncf-tags/container-device-interface/compare/v0.6.0...v0.6.1\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-09-08T15:25:22Z",
        "closed_at": "2023-09-08T21:09:34Z",
        "merged_at": "2023-09-08T21:09:34Z",
        "body": "**- What I did**\r\n\r\nWithout these compile flags, Delve is unable to report the value of some variables and it's not possible to jump into inlined code.\r\n\r\nAs the contributing docs already mention that `DOCKER_DEBUG` should disable \"build optimizations\", the env var is reused here instead of introducing a new one.\r\n\r\n**- How to verify it**\r\n\r\n```\r\n$ objdump --dwarf bundles/binary-daemon/dockerd | grep DW_AT_producer | grep -m 1 -- \"-N -l\"\r\n    <47>   DW_AT_producer    : Go cmd/compile go1.20.7; -N -l regabi\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://www.numerama.com/wp-content/uploads/2023/04/castor.jpg)\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 17,
        "deletions": 20,
        "changed_files": 1,
        "created_at": "2023-09-08T13:45:56Z",
        "closed_at": "2023-09-18T13:02:51Z",
        "merged_at": "2023-09-18T13:02:51Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 28,
        "deletions": 74,
        "changed_files": 4,
        "created_at": "2023-09-08T13:45:27Z",
        "closed_at": "2023-09-18T19:28:34Z",
        "merged_at": "2023-09-18T19:28:34Z",
        "body": "There's more to be fixed here (e.g. in most cases we're not even using the client that's constructed for the  `v1Endpoint`, so there's probably a lot more to be removed, but here's some bits I had lying around.\r\n\r\n\r\n### registry: remove use of v1 Version field and X-Docker-Registry-Version\r\n\r\n- The `Version` field was not used for any purpose, other than a debug log\r\n- The `X-Docker-Registry-Version` header was part of the registry v1 spec,\r\n  however, as we're not using the `Version` field, we don't need the\r\n  header for anything.\r\n- The `X-Docker-Registry-Config` header was only set by the mock registry;\r\n  there's no code consuming it, so we don't need to mock it (even if an\r\n  actual v1 registry / search API would return it).\r\n\r\nIt's also worth noting that we never call the `_ping` endpoint when using\r\nDocker Hub's search API, and Docker Hub does not even implement the `_ping`\r\nendpoint;\r\n\r\n    curl -fsSL https://index.docker.io/_ping | head -n 4\r\n    <!DOCTYPE html>\r\n    <html lang=\"en\">\r\n    <head>\r\n    <title>Docker</title>\r\n\r\n\r\n### registry: v1Endpoint.ping: add fast-path for X-Docker-Registry-Standalone\r\n\r\nThis function was making a request to the `_ping` endpoint, which (if\r\nimplemented) would return a JSON response, which we unmarshal (the only\r\nfield we use from the response is the `Standalone` field).\r\n\r\nHowever, if the response had a `X-Docker-Registry-Standalone`, that header\r\ntook precedence, and would overwrite the earlier `Standalone` value we\r\nobtained from the JSON response.\r\n\r\nThis patch adds a fast-path for situations where the header is present,\r\nin which case we can skip handling the JSON response altogether.\r\n\r\n### registry: v1Endpoint.ping: don't io.Readall the response\r\n\r\nWe have the response available, which is an io.Reader, so we don't have\r\nto read the entire response into memory before decoding.\r\n\r\n### registry: v1Endpoint.ping: include URL in debug log\r\n\r\nAlso remove log from `validateEndpoint`, because we don't actually\r\nping the default (Docker Hub).\r\n\r\n### registry: newV1Endpoint: make it clear we skip validation for Docker Hub\r\n\r\nvalidateEndpoint uses `v1Endpoint.ping` to verify if the search API can\r\nuse a secure connection, and to fall back to basic auth. For Docker Hub,\r\nwe don't allow insecure connections, and `v1Endpoint.ping` will not connect\r\nto Docker Hub (Docker Hub also does not implement the `_ping` endpoint,\r\nso doing so would always fail).\r\n\r\nLet's make it more clear that we don't do any validation, and return\r\nearly.\r\n\r\n### registry: remove intermediate vars in mock\r\n\r\n\r\n### registry: merge validateEndpoint into newV1Endpoint\r\n\r\nvalidateEndpoint was doing more than just validating; it was also implicitly\r\nmutating the endpoint that was passed to it (by reference).\r\n\r\nGiven that validation only happend when constructing a new v1Endpoint, let's\r\nmerge these functions.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-09-08T12:12:08Z",
        "closed_at": "2023-09-08T13:59:25Z",
        "merged_at": "2023-09-08T13:59:25Z",
        "body": "Fixes TestInspectByPrefix when running with c8d snapshotters enabled.\r\n\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make TEST_IGNORE_CGROUP_CHECK=1  \\\r\n             DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1  \\\r\n             TEST_FILTER='TestInspectByPrefix'  \\\r\n             test-integration\r\n```\r\n```diff\r\n=== RUN   TestDockerCLIInspectSuite\r\n=== RUN   TestDockerCLIInspectSuite/TestInspectByPrefix\r\n-    docker_cli_inspect_test.go:312: assertion failed: error is not nil: failed to inspect sha256:40350:\r\n-        Error: No such object: sha256:40350\r\n-\r\n---- FAIL: TestDockerCLIInspectSuite (0.13s)\r\n-    --- FAIL: TestDockerCLIInspectSuite/TestInspectByPrefix (0.13s)\r\n-\r\n+--- PASS: TestDockerCLIInspectSuite (0.11s)\r\n+    --- PASS: TestDockerCLIInspectSuite/TestInspectByPrefix (0.11s)\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 1,
        "changed_files": 2,
        "created_at": "2023-09-08T11:45:37Z",
        "closed_at": "2023-09-08T21:23:18Z",
        "merged_at": "2023-09-08T21:23:18Z",
        "body": "- Related to: https://github.com/moby/moby/pull/46085\r\n\r\nThis is a temporary alternative to the above PR that doesn't impact the CI, but still allows to run the integration-cli tests without removing the check.\r\n\r\nIt can be removed once we completely remove this check.\r\n\r\n**- What I did**\r\nAdd env variable that allows to run integration-cli tests with cgroup v2 enabled.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```bash\r\nmake TEST_IGNORE_CGROUP_CHECK=1   test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-09-08T10:23:05Z",
        "closed_at": "2023-09-08T13:17:53Z",
        "merged_at": "2023-09-08T13:17:53Z",
        "body": "\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\nRemove the last panic from the image service, I only removed it, didn't fid the download/upload limits...\r\n\r\nWe don't really want the daemon to panic for this so let's log a warning about max downloads and uploads\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-08T10:10:09Z",
        "closed_at": "2023-09-08T15:44:55Z",
        "merged_at": "2023-09-08T15:44:55Z",
        "body": "With containerd image store the images don't depend on each other even if they share the same content and it's totally fine to delete the \"parent\" image.\r\n\r\nThe skip is necessary because deleting the \"parent\" image does not produce an error with the c8d image store and deleting the `busybox` image breaks other tests.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-09-08T08:07:51Z",
        "closed_at": "2023-09-08T13:28:09Z",
        "merged_at": "2023-09-08T13:28:09Z",
        "body": "**- What I did**\r\n\r\nIn some cases, when the daemon launched by a test panics and quits, the cleanup code would end with an error when trying to kill it by its pid. In those cases the whole suite will end up waiting for the daemon that we start in .integration-daemon-start to finish and we end up waiting 2 hours for the CI to cancel after a timeout.\r\n\r\nUsing process substitution makes the integration tests quit.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nRun \r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestRunWithRuntimeFromConfigFile TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n```\r\n\r\nBefore this change this will never stop and hang after the `/go/src/github.com/docker/docker/hack/make/.integration-daemon-stop: line 11: kill: (1269) - No such process` error.\r\n\r\nAfter this change the script will stop after the kill error in the cleanup code.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 216,
        "deletions": 0,
        "changed_files": 27,
        "created_at": "2023-09-08T00:49:48Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Root resources are not available when building moby in a Linux package build environment. This change conditionally disables them when not run as root. See discussion at https://github.com/moby/moby/discussions/46387. Not being a Go programmer, I've done my best to try and match the local style; C&C welcome.\r\n\r\n**- What I did**\r\nI have added conditional skips in unit tests which require root privileges.\r\n\r\n**- How I did it**\r\nN/A\r\n\r\n**- How to verify it**\r\nThis is a port of a patch I made to get moby building in an RPM mock environment. We like to run as much of a projects testing as we can to build confidence that our build is correct and functional. If you run this in an RPM mock environment you'll see some of these tests skip (the mock builder is not run as root). They're run with a standard `go test` invocation. Some modules are skipped entirely, and are not modified here.\r\n\r\nI have verified that the preferred way of developing Moby is unaffected by running `make test-unit` and verifying that tests are not skipped erroneously. (DONE 3142 tests, 27 skipped in 37.667s and DONE 344 tests, 2 skipped in 243.128s).\r\n\r\n**- Description for the changelog**\r\n(not a user-facing change)\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![Image from iOS_cropped](https://github.com/moby/moby/assets/278804/dd2ee6b8-dedc-4c81-be87-fcccb0db1519)",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 9,
        "deletions": 9,
        "changed_files": 2,
        "created_at": "2023-09-07T22:23:49Z",
        "closed_at": "2023-09-08T06:22:21Z",
        "merged_at": "2023-09-08T06:22:21Z",
        "body": "This takes care of the TODO item now that the action is merged.\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 15,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-07T21:56:00Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Fixes #46427.\r\n\r\n**- What I did**\r\nAdded dependabot to keep GitHub Actions updated on a monthly basis. This takes advantage of dependabot's [grouped updates](https://github.blog/2023-08-24-a-faster-way-to-manage-version-updates-with-dependabot/), so that the project only receives a single PR each month updating all GitHub Actions at once. See [this PR on my fork](https://github.com/pnacht/moby/pull/1) updating three out-of-date Actions in moby workflows.\r\n\r\nI've selected a monthly update schedule so as to minimize the workload as much as possible. That being said, for what it's worth, the \"default\" schedule is \"weekly\". Let me know if you'd prefer I use the weekly schedule (or daily, if you're feeling wild!).\r\n\r\n**- How I did it**\r\nAdded `.github/dependabot.yml` with a single global group for all GitHub Actions.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n![20170513_160019 (1)](https://github.com/moby/moby/assets/15221358/dcf3f0b8-6702-4375-901f-5873660b015e)\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-09-07T17:15:53Z",
        "closed_at": "2023-09-18T14:08:12Z",
        "merged_at": "2023-09-18T14:08:12Z",
        "body": "Backport of https://github.com/moby/moby/pull/44395\r\nFixes https://github.com/moby/moby/issues/44396\r\ncherry picked from commit https://github.com/moby/moby/commit/2f0ba0a7e51756c9475d8b2379f32e4074e39afc",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 51,
        "deletions": 3,
        "changed_files": 5,
        "created_at": "2023-09-07T16:18:21Z",
        "closed_at": "2023-09-11T12:51:20Z",
        "merged_at": "2023-09-11T12:51:20Z",
        "body": "\r\n**- What I did**\r\nFixed `docker images` showing intermediate layers by default (they should be visible only with `--all`)\r\n\r\n**- How I did it**\r\nStore information about parent image as a containerd image object label and use that when listing.\r\n\r\n**- How to verify it**\r\n```diff\r\n$ DOCKER_BUILDKIT=0 docker build -t asdf .\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/4 : FROM busybox\r\n3fbc63216742: Download complete\r\n1fa89c01cd04: Download complete\r\nfc9db2894f4e: Download complete\r\n8a0af25e8c2e: Download complete\r\n ---> 3fbc63216742\r\nStep 2/4 : LABEL asdf=1\r\n ---> Running in 8815b66a12a4\r\n ---> Removed intermediate container 8815b66a12a4\r\n ---> a2b5f145d9d2\r\nStep 3/4 : RUN env>/env\r\n ---> Running in 2f71fc879fda\r\n ---> Removed intermediate container 2f71fc879fda\r\n ---> 53ef1dea7427\r\nStep 4/4 : CMD [\"echo\", \"hi\"]\r\n ---> Running in 26fb9dab31b2\r\n ---> Removed intermediate container 26fb9dab31b2\r\n ---> 59da756a8eb8\r\nSuccessfully built 59da756a8eb8\r\nSuccessfully tagged asdf:latest\r\n$ docker images --all\r\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\r\nasdf         latest    59da756a8eb8   4 seconds ago   6.11MB\r\n<none>       <none>    53ef1dea7427   4 seconds ago   6.11MB\r\nbusybox      latest    3fbc63216742   5 seconds ago   6.09MB\r\n<none>       <none>    a2b5f145d9d2   5 seconds ago   6.09MB\r\n$ docker images\r\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\r\n-asdf         latest    59da756a8eb8   4 seconds ago   6.11MB\r\n-<none>       <none>    53ef1dea7427   4 seconds ago   6.11MB\r\n-busybox      latest    3fbc63216742   5 seconds ago   6.09MB\r\n-<none>       <none>    a2b5f145d9d2   5 seconds ago   6.09MB\r\n+asdf         latest    59da756a8eb8   1 second ago    6.11MB\r\n+busybox      latest    3fbc63216742   2 seconds ago   6.09MB\r\n```\r\n\r\n\r\nAlso `TestBuildMultiStageArg` and `TestBuildMultiStageGlobalArg`.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 31,
        "deletions": 36,
        "changed_files": 1,
        "created_at": "2023-09-07T13:54:32Z",
        "closed_at": "2023-09-08T16:14:19Z",
        "merged_at": "2023-09-08T16:14:19Z",
        "body": "### integration/container: fix flaky TestResizeWhenContainerNotStarted\r\n\r\nThis test was failing frequently on Windows, where the test was waiting\r\nfor the container to exit before continuing;\r\n\r\n    === FAIL: github.com/docker/docker/integration/container TestResizeWhenContainerNotStarted (18.69s)\r\n    resize_test.go:58: timeout hit after 10s: waiting for container to be one of (exited), currently running\r\n\r\nIt looks like this test is merely validating that a container in any non-\r\nrunning state should produce an error, so there's no need to run a container\r\n(waiting for it to stop), and just \"creating\" a container (which would be\r\nin `created` state) should work for this purpose.\r\n\r\n\r\n\r\n### integration/container: TestResize, TestResizeWithInvalidSize: rm poll.WaitOn\r\n\r\ncontainer.Run should be an synchronous operation; the container should\r\nbe running after the request was made (or produce an error). Simplify\r\nthese tests, and remove the redundant polling.\r\n\r\nThese were added as part of 8f800c941570ffcd087c920c37d3a368a5a19e6d,\r\nbut no such polls were in place before the refactor, and there's no\r\nmention of these during review of the PR, so I assume these were just\r\nadded either as a \"precaution\", or a result of \"copy/paste\" from another\r\ntest.\r\n\r\n### integration/container: combine TestResize tests into subtests\r\n\r\nReduce some of the boiler-plating, and by combining the tests, we skip\r\nthe testenv.Clean() in between each of the tests. Performance gain isn't\r\nreally measurable, but every bit should help :)\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 37,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-07T12:37:45Z",
        "closed_at": "2023-09-07T19:09:42Z",
        "merged_at": null,
        "body": "## Overview\r\n\r\nThis pull request introduces a fuzz driver that addresses issue #44361. The purpose of this fuzz driver is to rigorously test the MergeDaemonConfigurations API by injecting mutated data into its arguments. By doing so, we aim to enhance our continuous testing efforts and ensure the robustness of this API.\r\n\r\n## Details\r\n\r\nThe fuzz driver has been designed to thoroughly exercise the MergeDaemonConfigurations API.\r\nIt accomplishes this by systematically injecting various forms of mutated data into the API's arguments.\r\nThrough this approach, we can identify potential vulnerabilities and edge cases that might otherwise go unnoticed.\r\n## Additional Information\r\n\r\nWe want to highlight that we have already developed numerous fuzz drivers, each serving as a valuable addition to our testing suite. If this PR is well-received, we are eager to contribute more fuzz drivers to further bolster our testing capabilities.\r\n\r\nThus, we are eager for your feedback and guidance on the process of adding fuzz drivers. Specifically, we would appreciate insights on the following:\r\n\r\n- Deployment: How should we handle the deployment of these fuzz drivers within the project's testing infrastructure?\r\n- Testing Metrics: Are there specific testing metrics or criteria that you consider essential for evaluating the effectiveness of these fuzz drivers?\r\n- Any Other Concerns: Please let us know if you have any other concerns or preferences related to the inclusion of fuzz drivers in the project.\r\n\r\nThank you for considering this contribution, and we look forward to your feedback.",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 37,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-09-07T10:37:41Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nThe daemon already expect in many places that endpoints in `container.NetworkSettings.Networks` are keyed by network's full name, once the endpoint has been effectively created.\r\n\r\nAlso, it already handles full ID -> full name conversion but it doesn't properly handle the case where user-specified settings where stored with a partial network ID key.\r\n\r\nBecause of this missing case, if a container is created with a reference to a partial network ID, two entries for the same network are inserted in `container.NetworkSettings.Networks`.\r\n\r\nBeside bad UX (ie. duplicated entry when inspecting the container), there's another concrete issue: when such container is disconnected from a network and then restarted, the container will be unintendedly reconnected to that network.\r\n\r\n**- How to verify it**\r\n\r\nNew integration test is green, or by hand:\r\n\r\n```\r\n$ docker network create --subnet 192.168.100.0/24 testnet1\r\n9b8a3a46b182e42523fcc625629e83ee00435a5b16016f8b4823f810e7f2a3e6\r\n\r\n$ docker run --rm --name test --network 9b8a3a46b1 --ip 192.168.100.24 -d nicolaka/netshoot /bin/sleep 1m\r\n\r\n# Prior to this fix:\r\n$ docker inspect test | jq '.[] | .NetworkSettings.Networks | keys'\r\n[\r\n  \"9b8a3a46b1\",\r\n  \"testnet1\"\r\n]\r\n# And after:\r\n$ docker inspect test | jq '.[] | .NetworkSettings.Networks | keys'\r\n[\r\n  \"testnet1\"\r\n]\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n<img src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Sea_Otter_%28Enhydra_lutris%29_%2825169790524%29_crop.jpg/800px-Sea_Otter_%28Enhydra_lutris%29_%2825169790524%29_crop.jpg\" width=75% height=75% />\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 21,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-07T08:41:42Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- related to: https://github.com/moby/moby/pull/46418\r\n\r\nCalling Close twice on these causes the same buffer to be put to the buffer pool again. This effectively \"poisons\" the pool and can cause errors for other consumers of the pool.\r\n\r\nMultiple Close are a no-op and produce a warning with an optional stack trace (if debug mode is enabled).\r\n\r\n**- What I did**\r\nTurned multiple calls of `Close` on Read/WriteCloserWrappers a no-op.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-09-07T08:41:26Z",
        "closed_at": "2023-09-07T14:30:02Z",
        "merged_at": "2023-09-07T14:30:02Z",
        "body": "The compressor is already closed a few lines below and there's no error\r\nreturns between so the defer is not needed.\r\n\r\nCalling Close twice on a writerCloserWrapper is unsafe as it causes it\r\nto put the same buffer to the pool multiple times.\r\n\r\n**- What I did**\r\nFixed random stack overflow daemon panics after import is performed.\r\n\r\n**- How I did it**\r\nRemoved double `Close`.\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make DOCKER_GRAPHDRIVER=overlayfs  TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_FILTER='TestImport'    test-integration\r\n```\r\nCheck the daemon doesn't panic with stack overflow.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-09-06T15:33:30Z",
        "closed_at": "2023-09-06T21:08:43Z",
        "merged_at": "2023-09-06T21:08:43Z",
        "body": "- relates to https://github.com/moby/moby/issues/46388\r\n- relates to https://github.com/moby/moby/pull/44210\r\n- relates to https://github.com/moby/moby/issues/45719\r\n\r\nWhen running a `docker cp` to copy files to/from a container, the lookup of the `getent` executable happens within the container's filesystem, so we cannot re-use the results.\r\n\r\nUnfortunately, that also means we can't preserve the results for any other uses of these functions, but probably the lookup should not be \"too\" costly.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 88,
        "deletions": 75,
        "changed_files": 18,
        "created_at": "2023-09-06T11:40:14Z",
        "closed_at": "2023-09-07T22:25:36Z",
        "merged_at": "2023-09-07T22:25:36Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46415\r\n\r\nWe should still look for all places where this is used, as there may be quite some that are either not needed, or (with multi-arch image support) potentially unwanted, but let's at least slightly improve things;\r\n\r\n\r\n- pkg/system: move ErrNotSupportedOperatingSystem to where it's used\r\n- pkg/system: move IsOSSupported to \"image\" package\r\n    This function is used in combination with images, so move it there to prevent having to import pkg/system (which contains many unrelated functions)\r\n- image: make ErrNotSupportedOperatingSystem an errdefs.ErrInvalidParameter\r\n- image: implement CheckOS\r\n    Implement a function that returns an error to replace existing uses of the IsOSSupported utility, where callers had to produce the error after checking.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 25,
        "deletions": 12,
        "changed_files": 1,
        "created_at": "2023-09-06T11:36:29Z",
        "closed_at": "2023-09-07T11:59:27Z",
        "merged_at": "2023-09-07T11:59:27Z",
        "body": "Break up the complicated \"if\" condition into multiple checks.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-09-06T11:31:16Z",
        "closed_at": "2023-09-06T13:32:01Z",
        "merged_at": "2023-09-06T13:32:01Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-09-06T10:18:27Z",
        "closed_at": "2023-09-12T08:08:46Z",
        "merged_at": "2023-09-12T08:08:46Z",
        "body": "strong-type the fields with the expected type, to make it more explicit what we're expecting here.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 57,
        "deletions": 8,
        "changed_files": 3,
        "created_at": "2023-09-06T10:14:54Z",
        "closed_at": "2023-09-08T21:10:23Z",
        "merged_at": "2023-09-08T21:10:23Z",
        "body": "**- What I did**\r\n\r\nBrought pull progress in line with what graph drivers do:\r\n\r\n- show the digest of the pulled manifest(list)\r\n- tell the user if the image is newer or already exists\r\n- skip downloading images we already have locally\r\n\r\nBefore:\r\n\r\n```console\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\naabed3296a3d: Download complete \r\nb492494d8e01: Download complete \r\nc6b84b685f35: Download complete \r\n445a6a12be2b: Download complete \r\ndocker.io/library/ubuntu:latest\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\naabed3296a3d: Already exists \r\nb492494d8e01: Already exists \r\nc6b84b685f35: Already exists \r\ndocker.io/library/ubuntu:latest\r\n```\r\n\r\nAfter:\r\n\r\n```console\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\nlatest: Pulling from library/ubuntu\r\n445a6a12be2b: Download complete \r\nDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054\r\nStatus: Downloaded newer image for ubuntu:latest\r\ndocker.io/library/ubuntu:latest\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\nlatest: Pulling from library/ubuntu\r\nDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054\r\nStatus: Image is up to date for ubuntu:latest\r\ndocker.io/library/ubuntu:latest\r\n```\r\n\r\nCompare to the output with graph drivers:\r\n\r\n```console\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\nlatest: Pulling from library/ubuntu\r\n445a6a12be2b: Pull complete \r\nDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054\r\nStatus: Downloaded newer image for ubuntu:latest\r\ndocker.io/library/ubuntu:latest\r\n$ docker pull ubuntu\r\nUsing default tag: latest\r\nlatest: Pulling from library/ubuntu\r\nDigest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054\r\nStatus: Image is up to date for ubuntu:latest\r\ndocker.io/library/ubuntu:latest\r\n```\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nAt least one test will pass now:\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestPullFromCentralRegistryImplicitRefParts TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n```\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 11,
        "deletions": 16,
        "changed_files": 2,
        "created_at": "2023-09-06T10:11:29Z",
        "closed_at": "2023-09-12T07:36:38Z",
        "merged_at": "2023-09-12T07:36:38Z",
        "body": "Windows doesn't support \"FROM scratch\", and the platform was only used for validation on other platforms if a platform was provided, so no need to set defaults.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-09-05T19:22:08Z",
        "closed_at": "2023-09-06T06:38:37Z",
        "merged_at": "2023-09-06T06:38:37Z",
        "body": "- Backport of #44395\r\n- fixes https://github.com/moby/moby/issues/44396\r\n\r\ncherry picked from commit 2f0ba0a7e51756c9475d8b2379f32e4074e39afc",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-09-05T19:17:30Z",
        "closed_at": "2023-09-06T06:34:35Z",
        "merged_at": "2023-09-06T06:34:35Z",
        "body": "- Backport of #44395\r\n- fixes https://github.com/moby/moby/issues/44396\r\n\r\ncherry picked from commit 2f0ba0a7e51756c9475d8b2379f32e4074e39afc",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 81,
        "deletions": 1,
        "changed_files": 5,
        "created_at": "2023-09-05T15:57:24Z",
        "closed_at": "2023-09-13T21:35:07Z",
        "merged_at": "2023-09-13T21:35:07Z",
        "body": "**- What I did**\r\n\r\n- Fix https://github.com/moby/moby/issues/46404\r\n- Fix docker/compose#10796\r\n\r\nThe daemon would pass an EndpointCreateOption to set the interface MAC address if the network name and the provided network mode were matching. Obviously, if the network mode is a network ID, it won't work. To make things worse, the network mode is never normalized if it's a partial ID.\r\n\r\nTo fix that: 1. the condition under what the container's mac-address is applied is updated to also match the full ID; 2. the network mode is normalized to a full ID when it's only a partial one.\r\n\r\n**- How to verify it**\r\n\r\n```\r\n$ docker run --rm --name test --network 6cabee8406 --mac-address \"02:42:ac:11:00:02\" nicolaka/netshoot ip -brief link show dev eth0\r\neth0@if92        UP             02:42:ac:11:00:02 <BROADCAST,MULTICAST,UP,LOWER_UP> \r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://upload.wikimedia.org/wikipedia/commons/d/d4/Sea_otter_pair2.jpg)\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 0,
        "changed_files": 3,
        "created_at": "2023-09-05T15:23:32Z",
        "closed_at": "2023-09-06T10:31:35Z",
        "merged_at": "2023-09-06T10:31:35Z",
        "body": "**- What I did**\r\n\r\nAdded image events for \r\n\r\n- push\r\n- pull\r\n- save\r\n\r\n**- How I did it**\r\n\r\nWith my hands\r\n\r\n**- How to verify it**\r\n\r\nChange line 84 in `hack/make/.integration-test-helpers` to say\r\n```\r\nflags+=\" -test.run ${TEST_FILTER}/\"\r\n```\r\n\r\nand run:\r\n\r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=DockerCLIEventSuite TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n```\r\n\r\nAll the tests should pass.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\nSigned-off-by: Djordje Lukic <djordje.lukic@docker.com>",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 398,
        "deletions": 265,
        "changed_files": 10,
        "created_at": "2023-09-05T08:23:36Z",
        "closed_at": "2023-10-16T08:36:40Z",
        "merged_at": null,
        "body": "- replaces / closes https://github.com/moby/moby/pull/45232\r\n\r\n**- What I did**\r\n\r\nAdded CI for the containerd integration\r\n\r\nAny PR that has the label `containerd-integration` will also run tests with the snapshotters\r\n\r\nExample PR without the needed label, note the skipped jobs https://github.com/rumpl/moby/pull/138\r\n\r\n**- How I did it**\r\n\r\nMoved everything from `test.yml` into a reusable workflow in `.test.yml` and used that to run tests with graph drivers and containerd snapshotters. Also added a workflow to test snapshotters in windows.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 17
    },
    {
        "merged": true,
        "additions": 18,
        "deletions": 8,
        "changed_files": 1,
        "created_at": "2023-09-04T14:35:39Z",
        "closed_at": "2023-09-05T10:22:35Z",
        "merged_at": "2023-09-05T10:22:34Z",
        "body": "**- What I did**\r\nFixed `TestBuildMultiStageArg` and `TestBuildMultiStageGlobalArg` to have a saner error message when `docker images` returns more than one image.\r\n\r\n\r\n\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make DOCKER_GRAPHDRIVER=overlayfs \\\r\n             DOCKER_BUILDKIT=0 \\\r\n             TEST_INTEGRATION_USE_SNAPSHOTTER=1  \\\r\n             TEST_FILTER='(TestBuildMultiStageArg|TestBuildMultiStageGlobalArg)'  \\\r\n              test-integration\r\n```\r\n\r\n\r\n<details>\r\n\r\n<summary>Before</summary>\r\n\r\n\r\n```\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite/TestBuildMultiStageArg (1.74s)\r\n    docker_cli_build_test.go:4628: assertion failed:\r\n        Command:  /usr/local/cli-integration/docker run --rm 24133bd11b7a\r\n        e43aad44e67b cat /out\r\n        ExitCode: 125\r\n        Error:    exit status 125\r\n        Stdout:\r\n        Stderr:   docker: invalid reference format.\r\n        See 'docker run --help'.\r\n\r\n\r\n        Failures:\r\n        ExitCode was 125 expected 0\r\n        Expected no error\r\n    --- FAIL: TestDockerCLIBuildSuite/TestBuildMultiStageArg (1.74s)\r\n\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite/TestBuildMultiStageGlobalArg (1.21s)\r\n    docker_cli_build_test.go:4653: assertion failed:\r\n        Command:  /usr/local/cli-integration/docker run --rm c94132f5d3b5\r\n        d81ffc1589dc cat /out\r\n        ExitCode: 125\r\n        Error:    exit status 125\r\n        Stdout:\r\n        Stderr:   docker: invalid reference format.\r\n        See 'docker run --help'.\r\n\r\n\r\n        Failures:\r\n        ExitCode was 125 expected 0\r\n        Expected no error\r\n    --- FAIL: TestDockerCLIBuildSuite/TestBuildMultiStageGlobalArg (1.21s)\r\n\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite (2.95s)\r\n\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n\r\n<summary>After</summary>\r\n\r\n```\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite/TestBuildMultiStageArg (4.06s)\r\n    docker_cli_build_test.go:4629: assertion failed: expected [3c977a3fb50e b732767e946c] (length 2) to have length 1: only one image with \"multifromtest\" label is expected\r\n    --- FAIL: TestDockerCLIBuildSuite/TestBuildMultiStageArg (4.06s)\r\n\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite/TestBuildMultiStageGlobalArg (5.44s)\r\n    docker_cli_build_test.go:4659: assertion failed: expected [801c8500dd4a da5eea1f7933] (length 2) to have length 1: only one image with \"multifromtest\" label is expected\r\n    --- FAIL: TestDockerCLIBuildSuite/TestBuildMultiStageGlobalArg (5.44s)\r\n\r\n=== FAIL: arm64.integration-cli TestDockerCLIBuildSuite (9.51s)\r\n\r\n```\r\n\r\n</details>\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 44,
        "deletions": 55,
        "changed_files": 2,
        "created_at": "2023-09-04T11:41:29Z",
        "closed_at": "2023-09-12T08:38:43Z",
        "merged_at": "2023-09-12T08:38:43Z",
        "body": "- relates to / addresses https://github.com/moby/moby/issues/46241\r\n\r\n### libnetwork/osl: Namespace.DeleteNeighbor: don't warn on non-existing neighbor\r\n\r\nThe code ignores these errors, but will unconditionally print a warning;\r\n\r\n> If the kernel deletion fails for the neighbor entry still remote it\r\n> from the namespace cache. Otherwise if the neighbor moves back to the\r\n> same host again, kernel update can fail.\r\n\r\nLet's reduce noise if the neighbor wasn't found, to prevent logs like:\r\n\r\n    Aug 16 13:26:35 master1.local dockerd[4019880]: time=\"2023-08-16T13:26:35.186662370+02:00\" level=warning msg=\"error while deleting neighbor entry\" error=\"no such file or directory\"\r\n    Aug 16 13:26:35 master1.local dockerd[4019880]: time=\"2023-08-16T13:26:35.366585939+02:00\" level=warning msg=\"error while deleting neighbor entry\" error=\"no such file or directory\"\r\n    Aug 16 13:26:42 master1.local dockerd[4019880]: time=\"2023-08-16T13:26:42.366658513+02:00\" level=warning msg=\"error while deleting neighbor entry\" error=\"no such file or directory\"\r\n\r\n### libnetwork/osl: Namespace.DeleteNeighbor: remove osDelete argument\r\n\r\nThis argument was originally added in libnetwork:\r\nhttps://github.com/moby/libnetwork/commit/03f440667f79f33ef3cb1faeb13c0bca1a0f8737\r\n\r\nAt the time, this argument was conditional, but currently it's always set\r\nto \"true\", so let's remove it.\r\n\r\n### libnetwork/osl: Namespace.DeleteNeighbor: remove intermediate vars\r\n\r\n- store linkIndex in a local variable so that it can be reused\r\n- remove / rename some intermediate vars that shadowed existing declaration\r\n\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 18,
        "changed_files": 1,
        "created_at": "2023-09-04T08:39:20Z",
        "closed_at": "2023-09-04T13:06:58Z",
        "merged_at": "2023-09-04T13:06:58Z",
        "body": "The test-file had a duplicate definition for ErrNotImplemented, which caused an error in this package, and was not used otherwise, so we can remove this file.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 74,
        "deletions": 40,
        "changed_files": 1,
        "created_at": "2023-09-04T08:13:44Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- fixes https://github.com/moby/moby/issues/40156\r\n\r\n\r\n### integration/system: update TestInfoAPI to not use string-matching\r\n\r\nThis test was rewritten from an integration-cli test in commit\r\n68d9beedbe0994af5c91022874daa271b657be8c, and originally implemented in\r\nf4942ed864f00a31591ef0257a971ef41ddd4c70, which rewrote it from a unit-\r\ntest to an integration test.\r\n\r\nOriginally, it would check for the raw JSON response from the daemon, and\r\ncheck for individual fields to be present in the output, but after commit\r\n0fd5a654280ef509a6512f84981f28d559869b90 (https://github.com/moby/moby/pull/33534), `client.Info()` was used, and\r\nnow the response is unmarshalled into a `system.Info`.\r\n\r\nThe remainder of the test remained the same in that rewrite, and as a\r\nresult were were now effectively testing if a `system.Info` struct,\r\nwhen marshalled as JSON would show all the fields (surprise: it does).\r\n\r\nTL;DR; the test would even pass with an empty `system.Info{}` struct,\r\nwhich didn't provide much coverage, as it passed without a daemon:\r\n\r\n    func TestInfoAPI(t *testing.T) {\r\n        // always shown fields\r\n        stringsToCheck := []string{\r\n            \"ID\",\r\n            \"Containers\",\r\n            \"ContainersRunning\",\r\n            \"ContainersPaused\",\r\n            \"ContainersStopped\",\r\n            \"Images\",\r\n            \"LoggingDriver\",\r\n            \"OperatingSystem\",\r\n            \"NCPU\",\r\n            \"OSType\",\r\n            \"Architecture\",\r\n            \"MemTotal\",\r\n            \"KernelVersion\",\r\n            \"Driver\",\r\n            \"ServerVersion\",\r\n            \"SecurityOptions\",\r\n        }\r\n    \r\n        out := fmt.Sprintf(\"%+v\", system.Info{})\r\n        for _, linePrefix := range stringsToCheck {\r\n            assert.Check(t, is.Contains(out, linePrefix))\r\n        }\r\n    }\r\n\r\nThis patch makes the test _slightly_ better by checking if the fields\r\nare non-empty. More work is needed on this test though; currently it\r\nuses the (already running) daemon, so it's hard to check for specific\r\nfields to be correct (withouth knowing state of the daemon), but it's\r\nnot unlikely that other tests (partially) cover some of that. A TODO\r\ncomment was added to look into that (we should probably combine some\r\ntests to prevent overlap, and make it easier to spot \"gaps\" as well).\r\n\r\nWhile working on this, also moving the `SystemTime` into this test,\r\nbecause that field is (no longer) dependent on \"debug\" state\r\n\r\n(It is was actually this change that led me down this rabbit-hole)\r\n\r\n                         ()_()\r\n                         (-.-)\r\n                        '(\")(\")'\r\n\r\n\r\n### integration/system: TestInfoAPIWarnings: improve test, and t.Parallel\r\n\r\nThis test takes at least 15 seconds to run, because loadListeners imposes\r\na 15-second delay for insecure listeners. Rewrite the test to run with\r\nt.Parallel, use a test-table, and add additional test-cases to verify both\r\ncases where the warning should be returned, and should _not_ be returned.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": false,
        "additions": 19,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-09-02T00:31:32Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Under some scenarios, exit events could be sent both from the containerd daemon and the shim. Only the first event should be handled and second event ignored.\r\n\r\n- Attempt to address #46212\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1298,
        "deletions": 408,
        "changed_files": 12,
        "created_at": "2023-08-31T16:56:09Z",
        "closed_at": "2023-09-26T07:45:16Z",
        "merged_at": "2023-09-26T07:45:16Z",
        "body": "**- What I did**\r\n\r\nAdded support in Swarm for custom Seccomp profiles, some small amount of AppArmor configuration, and `no-new-privileges`.\r\n\r\n**- How I did it**\r\n\r\nSwarmkit has the necessary plumbing for these fields added, and now it's wired up in the engine.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\nAdded Swarm support for seccomp, AppArmor, and no-new-privileges.\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 13,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-08-31T12:33:59Z",
        "closed_at": "2023-09-04T14:47:02Z",
        "merged_at": "2023-09-04T14:47:02Z",
        "body": "**- What I did**\r\n\r\nAfter a push is completed we must return the tag, digest and size back to the caller.\r\n\r\nBefore:\r\n\r\n```console\r\n$ docker push rumpl/myimage:latest\r\n82945907b899: Pushed \r\n3f4d90098f5b: Pushed \r\n79b66b6c912a: Pushed \r\n5bdb2a6b4b9a: Pushed \r\n```\r\n\r\nAfter:\r\n\r\n```console\r\n$ docker push rumpl/myimage:latest\r\n82945907b899: Pushed \r\n3f4d90098f5b: Pushed \r\n79b66b6c912a: Pushed \r\n5bdb2a6b4b9a: Pushed \r\nlatest: digest: sha256:5bdb2a6b4b9a0608d6ed3321a4b87998e044ef28f551a1bfb19d4dc7c9d680ba size: 750\r\n```\r\n\r\nNote: a bunch of integration-cli tests fail at the `setupImage` stage because we didn't return this information, it's used to get the pushed digest and then continue the test with that image. This will help us get past that first step and see the real failure (if any) in the integration-cli tests.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 122,
        "deletions": 87,
        "changed_files": 3,
        "created_at": "2023-08-31T10:59:02Z",
        "closed_at": "2023-09-11T18:41:59Z",
        "merged_at": "2023-09-11T18:41:59Z",
        "body": "- Requires: https://github.com/moby/moby/pull/46313\r\n\r\n- Closes: https://github.com/moby/moby/issues/46194\r\n\r\n**- What I did**\r\n- Fixed `failed to prepare snapshot: parent snapshot <digest> does not exist: not found` error\r\n- Removed unused mount of the rolayer snapshot\r\n- Fixed `mismatched image rootfs and manifest layers` when producing a new image with an empty diff (empty layer was added to the manifest when it was intentionally not being added in the config)\r\n- Replaced 1 hour leases with actual leases that are deleted when `Release` is called on ro/rw layer\r\n\r\n**- How I did it**\r\n- See commits\r\n\r\n**- How to verify it**\r\nIntegrations tests with c8d enabled\r\n\r\n```diff\r\n === FAIL: amd64.integration-cli TestDockerCLIBuildSuite (308.65s)\r\n\r\n- DONE 250 tests, 13 skipped, 41 failures in 314.721s\r\n+ DONE 250 tests, 13 skipped, 20 failures in 310.432s\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- containerd-integration: Fix legacy builder build errors when multiple COPY/ADD instructions are used\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 18,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-08-31T09:07:59Z",
        "closed_at": "2023-08-31T10:23:33Z",
        "merged_at": "2023-08-31T10:23:33Z",
        "body": "- Related to: https://github.com/moby/moby/pull/46374\r\n- Related to: https://github.com/moby/moby/pull/40894\r\n\r\n**- What I did**\r\nDocument the `StartInterval` added in 2216d3ca8d65c5b0c85e297a3eb351a05db3a4d2. and bump the image spec version to v1.3.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 33,
        "changed_files": 2,
        "created_at": "2023-08-31T08:42:26Z",
        "closed_at": "2023-08-31T09:57:09Z",
        "merged_at": "2023-08-31T09:57:09Z",
        "body": "**- What I did**\r\n\r\nRemoved platform related timeout values.\r\n\r\nThese were dependent on the DOCKER_ENGINE_GOARCH environment variable but this var was no longer set. There was also some weird check to see if the architecture is \"windows\" which doesn't make sense. Seeing how nothing failed ever since the TIMEOUT was no longer platform-dependent we can safely remove this check.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-31T08:38:47Z",
        "closed_at": "2023-08-31T10:22:03Z",
        "merged_at": "2023-08-31T10:22:03Z",
        "body": "- Follow up to: https://github.com/moby/moby/pull/46374/\r\n\r\n**- What I did**\r\nFixed a small typo.\r\n\r\n**- How I did it**\r\n`s/supserseeded/superseded/`\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-30T19:44:25Z",
        "closed_at": "2023-08-31T09:02:20Z",
        "merged_at": "2023-08-31T09:02:20Z",
        "body": "- relates to https://github.com/moby/moby/pull/46376\r\n\r\nThe test considered `Foo/bar` to be an invalid name, with the assumption that it was `[docker.io]/Foo/bar`. However, this was incorrect, and the test passed because the reference parsing had a bug; if the first element (`Foo`) is not lowercase (so not a valid namespace /  \"path element\"), then it *should* be considered a domain (as uppercase domain names are valid).\r\n\r\nThe reference parser did not account for this, and running the test with a version of the parser with a fix caused the test to fail:\r\n\r\n    === Failed\r\n    === FAIL: client TestImageTagInvalidSourceImageName/invalidRepo/FOO/bar (0.00s)\r\n        image_tag_test.go:54: assertion failed: expected error to contain \"not a valid repository/tag\", got \"Error response from daemon: client should not have made an API call\"\r\n            Error response from daemon: client should not have made an API call\r\n\r\n    === FAIL: client TestImageTagInvalidSourceImageName (0.00s)\r\n\r\nThis patch removes the faulty test-case.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 79,
        "changed_files": 1,
        "created_at": "2023-08-30T17:19:55Z",
        "closed_at": "2023-08-31T09:01:45Z",
        "merged_at": "2023-08-31T09:01:45Z",
        "body": "- relates to https://github.com/moby/moby/pull/46376\r\n\r\nembed the interface, so that we don't have to implement stubs.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1605,
        "deletions": 84,
        "changed_files": 104,
        "created_at": "2023-08-30T16:34:09Z",
        "closed_at": "2023-09-05T13:04:51Z",
        "merged_at": "2023-09-05T13:04:51Z",
        "body": "- related https://github.com/distribution/distribution/pull/4031\r\n- supersedes and closes https://github.com/moby/moby/pull/43278\r\n- closes https://github.com/moby/moby/issues/18731\r\n\r\nThe \"reference\" package was moved to a separate module, which was extracted from https://github.com/distribution/distribution/commit/b9b19409cf458dcb9e1253ff44ba75bd0620faa6\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 123,
        "deletions": 5,
        "changed_files": 7,
        "created_at": "2023-08-30T14:29:31Z",
        "closed_at": "2023-09-11T17:04:36Z",
        "merged_at": "2023-09-11T17:04:36Z",
        "body": "**- What I did**\r\n\r\nRemapped the GID/UID when a snapshot is created if the daemon is started with `--userns-remap`. This implementation differs from the graph driver one slightly. With graph drivers the files/directories are chown'ed when the image is downloaded and the contents extracted. Basically, with graph drivers we remap on pull and with containerd we remap on run.\r\n\r\nNote: with this change builds still fail, my guess is because buildkit still mounts the roots in normal mode, I'll continue looking but I think we can merge this one, I am pretty sure some changes in buildkit are needed:\r\n\r\n```console\r\n$ docker build -t userns . \r\n[+] Building 1.7s (6/6) FINISHED                                                                                                                               docker:local\r\n => [internal] load build definition from dd                                                                                                                           0.0s\r\n => => transferring dockerfile: 71B                                                                                                                                    0.0s\r\n => [internal] load .dockerignore                                                                                                                                      0.0s\r\n => => transferring context: 2B                                                                                                                                        0.0s\r\n => [internal] load metadata for docker.io/library/debian:bullseye-slim                                                                                                1.3s\r\n => [auth] library/debian:pull token for registry-1.docker.io                                                                                                          0.0s\r\n => CACHED [1/2] FROM docker.io/library/debian:bullseye-slim@sha256:61386e11b5256efa33823cbfafd668dd651dbce810b24a8fb7b2e32fa7f65a85                                   0.0s\r\n => => resolve docker.io/library/debian:bullseye-slim@sha256:61386e11b5256efa33823cbfafd668dd651dbce810b24a8fb7b2e32fa7f65a85                                          0.0s\r\n => ERROR [2/2] RUN touch testa                                                                                                                                        0.3s\r\n------\r\n > [2/2] RUN touch testa:\r\n0.287 runc run failed: unable to start container process: error during container init: error mounting \"/tmp/root/165536.165536/buildkit/executor/hosts.iv21cdui6qvdwqel9cdo93spo\" to rootfs at \"/etc/hosts\": open /tmp/root/165536.165536/buildkit/executor/7yecjv2i25qdu44khgx41b450/rootfs/etc/hosts: permission denied\r\n------\r\ndd:2\r\n--------------------\r\n   1 |     FROM debian:bullseye-slim\r\n   2 | >>> RUN touch testa\r\n   3 |     \r\n--------------------\r\nERROR: failed to solve: process \"/bin/sh -c touch testa\" did not complete successfully: exit code: 1\r\n```\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n`TestDaemonUserNamespaceRootSetting` should not fail any more\r\n \r\n```console\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_FILTER=TestDaemonUserNamespaceRootSetting TEST_INTEGRATION_USE_SNAPSHOTTER=1 test-integration\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 766,
        "deletions": 1907,
        "changed_files": 5,
        "created_at": "2023-08-30T14:20:46Z",
        "closed_at": "2023-08-30T15:56:46Z",
        "merged_at": "2023-08-30T15:56:46Z",
        "body": "- follow-up to https://github.com/moby/moby/pull/46371\r\n- relates to https://github.com/moby/moby/pull/46363\r\n\r\n\r\nThanks to some nice StackOverflow post for an approach;\r\n\r\n- https://stackoverflow.com/questions/46611465/git-combining-two-files-into-one-with-history-preserved\r\n- https://devblogs.microsoft.com/oldnewthing/20190514-00/?p=102493\r\n\r\nThis combines the 3 separate files, and preserving history (well, with\r\nthe help of `git log --follow image/spec/spec.md`).\r\n\r\n```bash\r\ngit checkout master\r\ngit checkout -b image_spec_combined\r\ngit mv image/spec/v1.md image/spec/spec.md\r\n# git commit .....\r\n\r\ngit checkout master\r\ngit checkout -b image_spec_1.1\r\ngit mv image/spec/v1.1.md image/spec/spec.md\r\n# git commit .....\r\n\r\ngit checkout master\r\ngit checkout -b image_spec_1.2\r\ngit mv image/spec/v1.2.md image/spec/spec.md\r\n# git commit .....\r\n\r\n\r\n# merge the branches (after resolving conflicts)\r\ngit checkout image_spec_combined\r\ngit merge -S --signoff image_spec_1.1\r\ngit merge -S --signoff image_spec_1.2\r\n```\r\n\r\n\r\nTo view the combined history:\r\n\r\n```bash\r\ngit log --follow image/spec/spec.md\r\n\r\ncommit 939675dd24b4c765fce1c4f9286a3ab41880b5a2 (image_spec_1.2)\r\nAuthor: Sebastiaan van Stijn <github@gone.nl>\r\nDate:   Wed Aug 30 15:06:25 2023 +0200\r\n\r\n    image/spec: rename v1.2.md to spec.md\r\n\r\n    In preparation of merging the versioned-specs into a single file,\r\n    with history.\r\n...\r\n...\r\ncommit 79910625f0a7aa76590e4362817dda22f28343aa\r\nAuthor: Josh Hawn <josh.hawn@docker.com>\r\nDate:   Sun Dec 7 23:25:31 2014 -0800\r\n\r\n    Adds Docker Image v1 Spec Documention\r\n...\r\n```\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 65,
        "deletions": 0,
        "changed_files": 3,
        "created_at": "2023-08-30T11:35:12Z",
        "closed_at": "2023-08-30T13:54:44Z",
        "merged_at": "2023-08-30T13:54:44Z",
        "body": "relates to:\r\n\r\n- https://github.com/moby/moby/pull/46363\r\n- ONBUILD was added in https://github.com/moby/moby/pull/3254 (which was before the image spec v1.0.0 was added in https://github.com/moby/moby/pull/9560)\r\n- ArgsEscaped was added in https://github.com/moby/moby/pull/17851 (v1.12.0-rc1, image-spec v1.2.0)\r\n- https://github.com/opencontainers/image-spec/pull/892\r\n- SHELL was added in https://github.com/moby/moby/commit/b18ae8c9ccc2eb6cf8aa947f25eb6f1d20089776 / https://github.com/moby/moby/pull/22489 (v1.12.0-rc1, image-spec v1.2.0)\r\n\r\n\r\n\r\n### image/spec: add missing \"OnBuild\" field\r\n\r\nThis field was added in commit 9f994c96468e2495a2dc118355b6565e7dac0f44,\r\nwhich was merged before the image-spec v1.0.0 was released (which happened\r\nin commit 79910625f0a7aa76590e4362817dda22f28343aa).\r\n\r\nThis patch back-fills the specifications to describe the property.\r\n\r\n### image/spec: add missing \"ArgsEscaped\" field (v1.1, v1.2)\r\n\r\nThis field was added in 9db5db1b94bc1000d151315851096dcc6cd3512d, which\r\nwas part of v1.10.0-rc1 and later, which used image spec v1.1.0.\r\n\r\nIt's worth noting that documentation for the v1.1.0 image spec was not\r\nyet available until commit 4fa0eccd10c5c120fe1f641285db920cf643dbe8,\r\nwhich was included in v1.12.0-rc1 and up. The `ArgsEscaped` field was\r\nalso adopted by the OCI image spec since [v1.1.0-rc3][1], but considered\r\ndeprecated, and not recommended to be used.\r\n\r\nThis patch amends the v1.1 and v1.2 specifications to describe the field.\r\n\r\n[1]: https://github.com/opencontainers/image-spec/commit/59780aa56914ae9cf4ca68c10989d3f89337d1e0\r\n\r\n### image/spec: add missing \"Shell\" field (v1.2)\r\n\r\nThis field was added in b18ae8c9ccc2eb6cf8aa947f25eb6f1d20089776, which\r\nwas part of v1.12.0-rc1 and later, which used image spec v1.2.0.\r\n\r\nThis patch amends the v1.2 spec to include the missing field.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 25,
        "deletions": 25,
        "changed_files": 3,
        "created_at": "2023-08-30T09:20:15Z",
        "closed_at": "2023-08-30T10:46:39Z",
        "merged_at": "2023-08-30T10:46:39Z",
        "body": "- remove some trailing commas, which made the JSON invalid (some of these were fixed in the 1.2 spec, but not in older versions).\r\n- synchronise some formatting / phrasing between versions, to make them easier to compare.\r\n- remove non-breaking spaces (`NBSP`) in example outputs, and replace them with regular spaces.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 13,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-08-29T21:15:49Z",
        "closed_at": "2023-08-30T16:22:24Z",
        "merged_at": "2023-08-30T16:22:24Z",
        "body": "- extracting from https://github.com/moby/moby/pull/46225, which still needs some work\r\n\r\n### daemon: Daemon.killWithSignal(): don't discard handleContainerExit error\r\n\r\nDaemon.handleContainerExit() returns an error if snapshotting the container's\r\nstate to disk fails. There's not much we can do with the error if it occurs,\r\nbut let's log the error if that happens, instead of discarding it.\r\n\r\n### daemon: Daemon.killWithSignal(): don't discard snapshotting errors\r\n\r\nWhile there's not much we can do if we failed to store a snapshot of the\r\ncontainer's state, let's log the error in case it happens in stad of discarding.\r\n\r\nDaemon.handleContainerExit() returns an error if snapshotting the container's\r\nstate to disk fails. There's not much we can do with the error if it occurs,\r\nbut let's log the error if that happens, instead of discarding it.\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 3,
        "deletions": 14,
        "changed_files": 1,
        "created_at": "2023-08-29T21:03:49Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- follow-up to https://github.com/moby/moby/pull/43998\r\n\r\n----\r\n\r\n### testing: update docker-py to latest (main branch)\r\n\r\nusing current head main;\r\n\r\nhttps://github.com/docker/docker-py/compare/6.1.3...c38656dc7894363f32317affecc3e4279e1163f8\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 92,
        "deletions": 9,
        "changed_files": 4,
        "created_at": "2023-08-29T18:02:34Z",
        "closed_at": "2023-08-29T22:36:47Z",
        "merged_at": "2023-08-29T22:36:47Z",
        "body": "- backport of https://github.com/moby/moby/pull/46253\r\n- fixes https://github.com/moby/moby/issues/46148\r\n- fixes https://github.com/docker/for-linux/issues/1470\r\n\r\n----\r\n\r\n\r\n\r\nOn startup all local volumes were unmounted as a cleanup mechanism for the non-clean exit of the last engine process.\r\n\r\nThis caused live-restored volumes that used special volume opt mount flags to be broken. While the refcount was restored, the _data directory was just unmounted, so all new containers mounting this volume would just have the access to the empty _data directory instead of the real volume.\r\n\r\nWith this patch, the mountpoint isn't unmounted. Instead, if the volume is already mounted, just mark it as mounted, so the next time Mount is called only the ref count is incremented, but no second attempt to mount it is performed.\r\n\r\n**- What I did**\r\nFixed the case where live-restore of volumes that specified custom volume opts wouldn't work properly.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\nCI\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- Fixed a bug which caused named volumes that set custom `device` or `type` volume option to be unmounted when restarting the daemon and not live-restoring it properly.\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 92,
        "deletions": 9,
        "changed_files": 4,
        "created_at": "2023-08-29T18:02:30Z",
        "closed_at": "2023-08-29T19:14:17Z",
        "merged_at": "2023-08-29T19:14:17Z",
        "body": "- backport of https://github.com/moby/moby/pull/46253\r\n- addresses https://github.com/moby/moby/issues/46148\r\n- fixes https://github.com/docker/for-linux/issues/1470\r\n\r\n----\r\n\r\n\r\n\r\nOn startup all local volumes were unmounted as a cleanup mechanism for the non-clean exit of the last engine process.\r\n\r\nThis caused live-restored volumes that used special volume opt mount flags to be broken. While the refcount was restored, the _data directory was just unmounted, so all new containers mounting this volume would just have the access to the empty _data directory instead of the real volume.\r\n\r\nWith this patch, the mountpoint isn't unmounted. Instead, if the volume is already mounted, just mark it as mounted, so the next time Mount is called only the ref count is incremented, but no second attempt to mount it is performed.\r\n\r\n**- What I did**\r\nFixed the case where live-restore of volumes that specified custom volume opts wouldn't work properly.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\nCI\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- Fixed a bug which caused named volumes that set custom `device` or `type` volume option to be unmounted when restarting the daemon and not live-restoring it properly.\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 11,
        "changed_files": 1,
        "created_at": "2023-08-29T17:56:01Z",
        "closed_at": "2023-09-20T20:01:28Z",
        "merged_at": "2023-09-20T20:01:28Z",
        "body": "Some breadcrumbs / left-overs from other work;\r\n\r\n### libnetwork: Endpoint.InterfaceName: remove redundant nil check\r\n\r\n### libnetwork: Endpoint.AddStaticRoute don't create StaticRoute if unused\r\n\r\nThis function either had to create a new StaticRoute, or add the destination\r\nto the list of routes. Skip creating a StaticRoute struct if we're not\r\ngonna use it.\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 6,
        "changed_files": 2,
        "created_at": "2023-08-29T14:50:25Z",
        "closed_at": "2023-08-29T15:49:15Z",
        "merged_at": "2023-08-29T15:49:15Z",
        "body": "There is no meaningful distinction between `driverapi.Registerer` and `drvregistry.DriverNotifyFunc`. They are both used to register a network driver with an interested party. They have the same function signature. The only difference is that the latter could be satisfied by an anonymous closure. However, in practice the only implementation of `drvregistry.DriverNotifyFunc` is the `(*libnetwork.Controller).RegisterDriver` method. This same method also makes the `libnetwork.Controller` type satisfy the `Registerer` interface, therefore the `DriverNotifyFunc` type is redundant. Change `drvregistry.Networks` to notify a `Registerer` and drop the `DriverNotifyFunc` type.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 63,
        "deletions": 20,
        "changed_files": 3,
        "created_at": "2023-08-29T13:48:19Z",
        "closed_at": "2023-08-31T14:22:46Z",
        "merged_at": "2023-08-31T14:22:46Z",
        "body": "- Related to: https://github.com/moby/moby/pull/46313\r\n\r\nThis is an initial effort to add a canonical implementation of the Docker Image spec (`application/vnd.docker.container.image.v1+json`).\r\n\r\nThe intent was to share as much of the implementation with the [OCI image spec](https://github.com/opencontainers/image-spec) and allow for easy conversion between OCI image and Docker OCI image.\r\n\r\n\r\n**- What I did**\r\nAdd Go structs describing the image spec which extend the OCI types.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 8,
        "changed_files": 6,
        "created_at": "2023-08-29T11:59:49Z",
        "closed_at": "2023-08-29T12:50:49Z",
        "merged_at": "2023-08-29T12:50:49Z",
        "body": "### errdefs: remove gotest.tools dependency\r\n\r\nIt was only used in a single test, and was not using any of the gotest.tools features, so let's remove it as dependency.\r\n\r\nWith this, the package has no external dependencies (only stdlib).\r\n\r\n### errdefs: remove redundant import comments\r\n\r\nA package only needs one \"import\" comment to enforce, so keeping one in the go.doc.\r\n\r\nIt should be noted that even with that; in most cases, go will ignore these comments (if go modules are used, even in \"vendor\" mode).\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 8,
        "changed_files": 3,
        "created_at": "2023-08-29T11:35:15Z",
        "closed_at": "2023-08-29T12:45:52Z",
        "merged_at": "2023-08-29T12:45:52Z",
        "body": "- splitting up the work on https://github.com/moby/moby/pull/44032\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 394,
        "deletions": 393,
        "changed_files": 11,
        "created_at": "2023-08-29T11:34:12Z",
        "closed_at": "2023-09-01T16:31:16Z",
        "merged_at": "2023-09-01T16:31:16Z",
        "body": "- splitting up the work on https://github.com/moby/moby/pull/44032\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 11,
        "changed_files": 6,
        "created_at": "2023-08-29T10:48:36Z",
        "closed_at": "2023-08-29T12:01:31Z",
        "merged_at": "2023-08-29T12:01:31Z",
        "body": "This field was used when the code supported both \"v1\" and \"v2\" registries. We no longer support v1 registries, and the only v1 endpoint that's still used is for the legacy \"search\" endpoint, which does not use the APIEndpoint type.\r\n\r\nAs no code is using this field, and the value will always be set to \"v2\", we can deprecated the Version field.\r\n\r\nI'm keeping this field for 1 release, to give notice to any potential external consumer, after which we can delete it.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-29T08:59:18Z",
        "closed_at": "2023-08-29T10:29:07Z",
        "merged_at": "2023-08-29T10:29:07Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 54,
        "deletions": 49,
        "changed_files": 2,
        "created_at": "2023-08-29T08:57:23Z",
        "closed_at": "2023-08-29T10:47:55Z",
        "merged_at": "2023-08-29T10:47:55Z",
        "body": "### registry: combine TestEndpointParse and TestEndpointParseInvalid\r\n\r\nCombine the two tests into a TestV1EndpointParse function, and rewrite\r\nthem to use gotest.tools for asserting.\r\n\r\nAlso changing the test-cases to use \"https://\", as the scheme doesn't\r\nmatter for this test, but using \"http://\" may trip-up some linters,\r\nso let's avoid that.\r\n\r\n### registry: simplify `trimV1Address`\r\n\r\nFirst, remove the loop over `apiVersions`. The `apiVersions` map has two\r\nentries (`APIVersion1 => \"v1\"`, and `APIVersion2 => \"v2\"`), and `APIVersion1`\r\nis skipped, which means that the loop effectively translates to;\r\n\r\n    if apiVersionStr == \"v2\" {\r\n        return \"\", invalidParamf(\"unsupported V1 version path %s\", apiVersionStr)\r\n    }\r\n\r\nWhich leaves us with \"anything else\" being returned as-is.\r\n\r\nThis patch removes the loop, and replaces the remaining handling to check\r\nfor the \"v2\" suffix to produce an error, or to strip the \"v1\" suffix.\r\n\r\n### registry: improve error for invalid search endpoints\r\n\r\nExplain that search is not supported on v2 endpoints, and include the\r\noffending endpoint in the error-message.\r\n\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-28T20:07:55Z",
        "closed_at": "2023-08-28T22:05:41Z",
        "merged_at": "2023-08-28T22:05:41Z",
        "body": "- relates to https://github.com/moby/moby/pull/46350\r\n\r\n\r\ncommit 70ad5b818fa94891d0778daba2f830e5ca6382a7 changed event.Type to be a strong type, no longer an alias for string. for some reason, this test passed on the PR, but failed later on;\r\n\r\n    === Failed\r\n    === FAIL: daemon/events TestLoadBufferedEventsOnlyFromPast (0.00s)\r\n        events_test.go:203: assertion failed: network (messages[0].Type events.Type) != network (string)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 52,
        "deletions": 50,
        "changed_files": 13,
        "created_at": "2023-08-28T15:01:25Z",
        "closed_at": "2023-10-12T10:51:19Z",
        "merged_at": null,
        "body": "**- What I did**\r\nReplaced `errors.Wrap` with `fmt.Errorf`\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 15,
        "deletions": 11,
        "changed_files": 3,
        "created_at": "2023-08-28T10:55:40Z",
        "closed_at": "2023-08-28T13:14:11Z",
        "merged_at": "2023-08-28T13:14:11Z",
        "body": "- follow-up to https://github.com/moby/moby/pull/44704\r\n\r\nMake the error message slightly clearer on \"what\" part is not valid, and provide suggestions on what are acceptable values.\r\n\r\nBefore this change:\r\n\r\n    docker create --restart=always:3 busybox\r\n    Error response from daemon: invalid restart policy: maximum retry count cannot be used with restart policy 'always'\r\n\r\n    docker create --restart=always:-1 busybox\r\n    Error response from daemon: invalid restart policy: maximum retry count cannot be used with restart policy 'always'\r\n\r\n    docker create --restart=unknown busybox\r\n    Error response from daemon: invalid restart policy 'unknown'\r\n\r\nAfter this change:\r\n\r\n    docker create --restart=always:3 busybox\r\n    Error response from daemon: invalid restart policy: maximum retry count can only be used with 'on-failure'\r\n\r\n    docker create --restart=always:-1 busybox\r\n    Error response from daemon: invalid restart policy: maximum retry count can only be used with 'on-failure' and cannot be negative\r\n\r\n    docker create --restart=unknown busybox\r\n    Error response from daemon: invalid restart policy: unknown policy 'unknown'; use one of 'no', 'always', 'on-failure', or 'unless-stopped'\r\n\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 299,
        "deletions": 186,
        "changed_files": 70,
        "created_at": "2023-08-27T19:56:08Z",
        "closed_at": "2023-09-05T09:11:42Z",
        "merged_at": "2023-09-05T09:11:42Z",
        "body": "follow-up to / depends on:\r\n\r\n- [x] https://github.com/moby/moby/pull/46336\r\n- [x] https://github.com/moby/moby/pull/46338\r\n- [x] https://github.com/moby/moby/pull/46350\r\n- [x] https://github.com/moby/moby/pull/46354\r\n\r\n\r\n### api/types/events: define \"Action\" type and consts\r\n\r\nDefine consts for the Actions we use for events, instead of \"ad-hoc\" strings.\r\nHaving these consts makes it easier to find where specific events are triggered,\r\nmakes the events less error-prone, and allows documenting each Action (if needed).\r\n\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 8,
        "changed_files": 6,
        "created_at": "2023-08-27T19:50:38Z",
        "closed_at": "2023-08-28T14:44:26Z",
        "merged_at": "2023-08-28T14:44:26Z",
        "body": "- [x] follow-up to / depends on https://github.com/moby/moby/pull/46338\r\n- relates to / follow-up to https://github.com/moby/moby/pull/42770\r\n\r\n### api/types/events: make events.Type an actual type\r\n\r\nThis type was added in 247f4796d21d98909974410ff27b61233776ae3a (https://github.com/moby/moby/pull/42770), and\r\nat the time was added as an alias for string;\r\n\r\n> api/types/events: add \"Type\" type for event-type enum\r\n>\r\n> Currently just an alias for string, but we can change it to be an\r\n> actual type.\r\n\r\nNow that all code uses the defined types, we should be able to make\r\nthis an actual type.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-27T19:42:38Z",
        "closed_at": "2023-08-28T09:36:53Z",
        "merged_at": "2023-08-28T09:36:53Z",
        "body": "- relates to https://github.com/moby/moby/commit/5045a2de24e62095278bd10b7abce4153d713b2a / https://github.com/moby/moby/pull/45278\r\n\r\n\r\nUpdating the version of crun that we use in our tests to a version that supports the \"features\" command (crun v1.8.6 and up). This should prevent some warnings in our logs:\r\n\r\n    WARN[2023-08-26T17:05:35.042978552Z] Failed to run [/usr/local/bin/crun features]: \"unknown command features\\n\"  error=\"exit status 1\"\r\n\r\nfull diff: https://github.com/containers/crun/compare/1.4.5...1.8.7\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 58,
        "deletions": 84,
        "changed_files": 1,
        "created_at": "2023-08-27T19:15:49Z",
        "closed_at": "2023-09-21T12:31:31Z",
        "merged_at": "2023-09-21T12:31:31Z",
        "body": "### libnetwork: Controller.agentSetup: remove redundant condition\r\n\r\nThe function returns at the start if there agent is non-nil.\r\n\r\n### libnetwork: Controller.agentSetup: use structured logs\r\n\r\n### libnetwork: Endpoint: return early if no agent was found\r\n\r\nThis removes redundant nil-checks in Endpoint.deleteServiceInfoFromCluster\r\nand Endpoint.addServiceInfoToCluster.\r\n\r\nThese functions return early if the network is not [\"cluster eligible\"][1],\r\nand the function used for that (`Network.isClusterEligible`) requires the\r\n[agent to not be `nil`][2].\r\n\r\nThis check moved around a few times ([3][3], [4][4]), but was originally\r\nadded in [libnetwork 1570][5] which, among others, tried to avoid a nil-pointer\r\nexception reported in [moby 28712][6], which accessed the `Controller.agent`\r\n[without locking][7]. That issue was addressed by adding locks, adding a\r\n`Controller.getAgent` accessor, and updating deleteServiceInfoFromCluster\r\nto use a local var. It also sprinkled this `nil` check to be on the safe\r\nside, but as `Network.isClusterEligible` already checks for the agent\r\nto not be `nil`, this should not be redundant.\r\n\r\n[1]: https://github.com/moby/moby/blob/5b53ddfcdd1c0721f875d3e237078ab7de891a57/libnetwork/agent.go#L529-L534\r\n[2]: https://github.com/moby/moby/blob/5b53ddfcdd1c0721f875d3e237078ab7de891a57/libnetwork/agent.go#L688-L696\r\n[3]: https://github.com/moby/libnetwork/commit/f2307265c77fd6db5d92310857c3ffad1184ad24\r\n[4]: https://github.com/moby/libnetwork/commit/6426d1e66f33c0b0c8bb135b7ee547447f54d043\r\n[5]: https://github.com/moby/libnetwork/commit/8dcf9960aa81767376e580f20d9ecea3e68f62ad\r\n[6]: https://github.com/moby/moby/issues/28712\r\n[7]: https://github.com/moby/moby/blob/75fd88ba8938f120ce1f2a21b19cf13c12071b16/vendor/github.com/docker/libnetwork/agent.go#L452\r\n\r\n\r\n### libnetwork: rewrite Network.isClusterEligible to return agent\r\n\r\nThis function was used to check if the network is a multi-host, swarm-scoped\r\nnetwork. Part of this check involved a check whether the cluster-agent was\r\npresent.\r\n\r\nIn all places where this function was used, the next step after checking if\r\nthe network was \"cluster eligible\", was to get the agent, and (again) check\r\nif it was not nil.\r\n\r\nThis patch rewrites the isClusterEligible utility into a clusterAgent utility,\r\nwhich both checks if the network is cluster-eligible, and returns the agent\r\n(if set). For convenience, an \"ok\" bool is added, which callers can use to\r\nreturn early (although just checking for nilness would likely have been\r\nsufficient).\r\n\r\n\r\nlibnetwork: Controller.handleDriverTableEvent: reduce some duplication\r\n\r\nI guess the attempt here was to not duplicate code, but in doing so,\r\nthere was actually more code-duplication than necessary.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 28,
        "deletions": 31,
        "changed_files": 1,
        "created_at": "2023-08-27T18:49:51Z",
        "closed_at": "2023-09-13T10:36:35Z",
        "merged_at": "2023-09-13T10:36:35Z",
        "body": "### libnetwork: Network.Services: return early and don't lock in a loop\r\n\r\n- return early when failing to fetch the driver\r\n- store network-ID and controller in a variable to prevent repeatedly\r\n  locking/unlocking. We don't expect the network's ID to change\r\n  during this operation.\r\n\r\n### libnetwork: Network.Services: remove some intermediate vars\r\n\r\n### libnetwork: Network: return early where possible\r\n\r\nAdd a fast-patch to some functions, to prevent locking/unlocking,\r\nor other operations that would not be needed;\r\n\r\n- Network.addDriverInfoToCluster\r\n- Network.deleteDriverInfoFromCluster\r\n- Network.addServiceInfoToCluster\r\n- Network.deleteServiceInfoFromCluster\r\n- Network.addDriverWatches\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 180,
        "deletions": 202,
        "changed_files": 8,
        "created_at": "2023-08-27T18:37:47Z",
        "closed_at": null,
        "merged_at": null,
        "body": "### libnetwork: handleDriverTableEvent: reduce some duplication\r\n\r\nI guess the attempt here was to not duplicate code, but in doing so,\r\nthere was actually more code-duplication than necessary.\r\n\r\n\r\n### libnetwork: Controller.handleNodeTableEvent, handleEpTableEvent move vars\r\n\r\nmove variables closer to where they're used, and rename them where appropriate.\r\n\r\n### libnetwork: Controller.handleNodeTableEvent: skip networkdb.UpdateEvent\r\n\r\nController.handleNodeTableEvent was logging an error if it would handle\r\na `networkdb.UpdateEvent`, however, the function would still continue\r\nprocessing the event, and attempt to unmarshal an empty `[]byte` to a\r\n`networkdb.NodeAddr` (resulting in an `unexpected end of JSON input` error).\r\n\r\nIf it _would_ proceed (i.e., if the unmarshal would not error), it would;\r\n\r\n- call `Controller.processNodeDiscovery` (with an empty list of IPs)\r\n- which would iterate over all registered drivers, calling `Controller.pushNodeDiscovery`\r\n  for drivers that implement `discoverapi.Discover`.\r\n- ultimately ending up in `Controller.pushNodeDiscovery` returning early\r\n  because no IPs were provided.\r\n\r\nBased on the above, it looks like returning early here is the right thing\r\nto do.\r\n\r\n### libnetwork: Controller.pushNodeDiscovery: return early\r\n\r\nSkip fetching the agent and parsing its IP-address if we don't use it.\r\n\r\n### libnetwork: Controller.handleNodeTableEvent: log event-type in errors\r\n\r\nAllow discovering what kind of event was received if an error occurs.\r\n\r\n### libnetwork: Controller.pushNodeDiscovery: take single IP, ignore nil\r\n\r\nThe signature to take multiple addresses originates in [libnetwork/188][1]\r\n(\"Libnetwork Host Discovery using Swarm Discovery pkg), which initially\r\nhad a `diff` function as part of the `hostdiscovery` package, which would\r\nproduce a list of changes in IP-addresses (added, removed).\r\n\r\nDiscovery with external k/v stores was removed, and the `hostdiscovery`\r\npackage was removed in 00f9b23c3ae1614b648e9da1c6423c381f58153e (https://github.com/moby/moby/pull/42247), and\r\ncurrent code always pass a single IP-address (if any).\r\n\r\nThe Controller.pushNodeDiscovery method contained a check whether the\r\npassed list of node-addresses was nil, however, this was never the\r\ncase because `Controller.handleNodeTableEvent` would unconditionally\r\n[initialize a slice][2] (even if the event had a `nil` IP-address).\r\n\r\nIn case of a `nil` IP-address, this address would be;\r\n\r\n- compared with the agent's advertiseAddr to determine if this is `self`\r\n- encoded as a string, and sent as `NodeDiscoveryData.Address`. This string\r\n  would be a literal `\"<nil>\"`.\r\n\r\nWhile I don't know if there's other implementations that treat this information\r\ndifferent, looking at the [overlay implementation of `driver.DiscoverNew`][3],\r\nit would check the field to be an empty string, and otherwise produce an\r\nerror (which wouldn't apply if it contained `\"<nil>\"`), and set the\r\ndriver's advertiseAddress to this value, effectively un-setting it\r\n(`net.ParseIP()` silently ignores invalid values), or producing an error\r\n(`netip.ParseAddr()` will error).\r\n\r\nFor completeness: `driver.DiscoverDelete` has no implementation in the\r\noverlay driver, but both `driver.DiscoverNew` and `driver.DiscoverDelete`\r\nare both implemented by the `remote` driver, which sends them to the\r\nremote \"as-is\", so it will depend on the receiving end to handle.\r\n\r\nSo based on the overlay implementation, my assumption is that an empty\r\nnode-address should be considered _invalid_ (both for `DiscoverDelete`\r\nand `DiscoverNew`), so let's return early if we encounter one, but log\r\na warning to discover cases where this happened.\r\n\r\n[1]: https://github.com/moby/libnetwork/commit/ac4d7b61367e34ac341c2171d70d8b6a0a0fbecf\r\n[2]: https://github.com/moby/moby/blob/5b53ddfcdd1c0721f875d3e237078ab7de891a57/libnetwork/agent.go#L905\r\n[3]: https://github.com/moby/moby/blob/5b53ddfcdd1c0721f875d3e237078ab7de891a57/libnetwork/drivers/overlay/overlay.go#L92-L97\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 18,
        "changed_files": 2,
        "created_at": "2023-08-27T18:25:29Z",
        "closed_at": "2023-08-29T09:33:11Z",
        "merged_at": "2023-08-29T09:33:11Z",
        "body": "### libnetwork: Endpoint.Iface, Endpoint.Interface remove redundant \"if\"\r\n\r\n### libnetwork: remove Endpoint.Interface\r\n\r\nThis method is not part of any interface, and identical to Endpoint.Iface,\r\nbut one returns an Interface-type (driverapi.InterfaceInfo) and the other\r\nreturns a concrete type (EndpointInterface).\r\n\r\nInterface-matching should generally happen on the receiver side, and this\r\nfunction was only used in a single location, and passed as argument to\r\nDriver.CreateEndpoint, which already matches the interface by accepting\r\na driverapi.InterfaceInfo.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 7,
        "changed_files": 2,
        "created_at": "2023-08-27T18:20:30Z",
        "closed_at": "2023-08-29T09:34:00Z",
        "merged_at": "2023-08-29T09:34:00Z",
        "body": "### libnetwork/drivers/remote: remove unused testEndpoint.Interface\r\n\r\n### libnetwork/drivers/remote: driver.DeleteNetwork: remove var that collided\r\n\r\n`delete` is a builtin\r\n\r\n### libnetwork/drivers/remote: rollbackEndpoint.Interface: return concrete type\r\n\r\nInterface-matching should generally happen on the receiver side, and this\r\nfunction was only used in a single location, and passed as argument to\r\nDriver.CreateEndpoint, which already matches the interface by accepting\r\na driverapi.InterfaceInfo.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 22,
        "deletions": 26,
        "changed_files": 3,
        "created_at": "2023-08-27T18:16:06Z",
        "closed_at": "2023-08-29T09:33:33Z",
        "merged_at": "2023-08-29T09:33:33Z",
        "body": "### libnetwork/drivers/bridge: getIPv4Data: remove unused argument\r\n\r\n### libnetwork/drivers/bridge: testEndpoint.Interface: return concrete type\r\n\r\nInterface-matching should generally happen on the receiver side, and this\r\nfunction was only used in a single location, and passed as argument to\r\nDriver.CreateEndpoint, which already matches the interface by accepting\r\na driverapi.InterfaceInfo.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 19,
        "deletions": 12,
        "changed_files": 1,
        "created_at": "2023-08-27T18:10:19Z",
        "closed_at": "2023-09-20T08:27:06Z",
        "merged_at": "2023-09-20T08:27:06Z",
        "body": "### libnetwork: resolveAddr: add GoDoc\r\n\r\nDescribe the behavior of this function, as it was not documented.\r\n\r\n### libnetwork: nwAgent.bindAddr: change to net.IP\r\n\r\nStore the IP-address as a net.IP instead of a string.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-08-26T17:50:59Z",
        "closed_at": "2023-08-26T22:01:06Z",
        "merged_at": "2023-08-26T22:01:06Z",
        "body": "- rebase of https://github.com/moby/moby/pull/46292, which pulled in some foreign commits\r\n- supersedes / closes https://github.com/moby/moby/pull/46292\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 32,
        "deletions": 36,
        "changed_files": 9,
        "created_at": "2023-08-26T17:45:59Z",
        "closed_at": "2023-08-28T11:08:28Z",
        "merged_at": "2023-08-28T11:08:28Z",
        "body": "- relates to https://github.com/moby/moby/pull/46069\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 47,
        "deletions": 68,
        "changed_files": 4,
        "created_at": "2023-08-26T15:48:18Z",
        "closed_at": "2023-08-28T11:12:10Z",
        "merged_at": "2023-08-28T11:12:10Z",
        "body": "### daemon: inline some vars when producing events\r\n\r\nAlso moves the clusterEventAction closer to where it's used.\r\n\r\n### daemon: daemon.logClusterEvent: use events.Type for event-types\r\n\r\nAlso swapping the order of arguments; putting the \"attributes\" arguments\r\nlast, so that variables can be more cleanly inlined.\r\n\r\n### daemon: logNetworkEvent, logSecretEvent, logConfigEvent rm unused args\r\n\r\n### daemon: remove LogPluginEventWithAttributes as it's not used\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 107,
        "deletions": 163,
        "changed_files": 6,
        "created_at": "2023-08-26T13:42:59Z",
        "closed_at": "2023-08-28T14:35:06Z",
        "merged_at": "2023-08-28T14:35:06Z",
        "body": "- relates to https://github.com/moby/moby/pull/18888\r\n\r\n\r\nThese fields were deprecated in Docker 1.10 through 72f1881df102fce9ad31e98045b91c204dd44513 (https://github.com/moby/moby/pull/18888), but were still used in various places and in tests.\r\n\r\n### daemon/events: rewrite test-assertions with gotest.tools\r\n\r\n- clean up \"//import\" comment, as test-files cannot be imported, and only\r\n  one \"//import\" comment is needed per package.\r\n- remove some intermediate variables\r\n- rewrite assertions to use gotest.tools\r\n- use assert.Check()) (non-fatal) where possible\r\n\r\n### daemon/events: verify non-deprecated fields\r\n\r\nSome tests were testing the deprecated fields, instead of their non-deprecated\r\nalternatives.\r\n\r\nThis patch adds a utility to verify that they match, and rewrites the tests\r\nto check the non-deprecated fields instead.\r\n\r\n### client: TestEvents: don't depend on deprecated fields\r\n\r\n### integration/container: TestPause: don't depend on deprecated fields\r\n\r\n### daemon: TestHealthStates: don't depend on deprecated fields\r\n\r\n### integration-cli: TestEventsFormat: rewrite test to not use deprecated fields\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 119,
        "deletions": 102,
        "changed_files": 16,
        "created_at": "2023-08-26T10:56:23Z",
        "closed_at": "2023-08-28T17:02:19Z",
        "merged_at": "2023-08-28T17:02:19Z",
        "body": "- api/types: move checkpoint-types to api/types/checkpoint\r\n- integration/container: TestCheckpoint: remove intermediate vars\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-26T10:52:27Z",
        "closed_at": "2023-08-28T12:40:53Z",
        "merged_at": "2023-08-28T12:40:53Z",
        "body": "The content of this file was removed in c0bc14e8dd5a31f5edc804e9a1347bb3eb44483e (https://github.com/moby/moby/pull/37156), and all it container since was the package name.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 18,
        "changed_files": 4,
        "created_at": "2023-08-25T14:48:31Z",
        "closed_at": "2023-08-26T14:42:58Z",
        "merged_at": "2023-08-26T14:42:58Z",
        "body": "- relates to https://github.com/moby/moby/pull/35518\r\n- relates to https://github.com/moby/moby/pull/43637\r\n- relates to https://github.com/docker/docker-ce-packaging/issues/898\r\n\r\n\r\nThis check was added in 98fe4bd8f1e35f8e498e268f6### hack: remove devicemapper leftovers and build-tags\r\n\r\nThis check was added in 98fe4bd8f1e35f8e498e268f653a43cbfa31e751, to check\r\nwhether dm_task_deferred_remove could be removed, and to conditionally set\r\nthe corresponding build-tags. Now that the devicemapper graphdriver has been\r\nremoved in dc11d2a2d8e1df0a90ce289f5dd06cad38193073, we no longer need this.\r\n\r\nThis patch:\r\n\r\n- removes uses of the (no longer used) `libdm`, `dlsym_deferred_remove`,\r\n  and `libdm_no_deferred_remove` build-tags.\r\n- removes the `add_buildtag` utility, which is now unused.\r\n\r\n\r\n### Dockerfile: remove libdevmapper-dev\r\n\r\nThe devicemapper graphdriver has been removed in commit dc11d2a2d8e1df0a90ce289f5dd06cad38193073, and we should no longer need this.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 8,
        "changed_files": 3,
        "created_at": "2023-08-25T14:27:33Z",
        "closed_at": "2023-08-30T22:23:29Z",
        "merged_at": "2023-08-30T22:23:29Z",
        "body": "- backport of https://github.com/moby/moby/pull/46321\r\n- relates to https://github.com/moby/moby/pull/46069\r\n\r\n\r\n(cherry picked from commit cd49f9affdad81360620019b6e8741ae73fd5590)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 15,
        "deletions": 12,
        "changed_files": 4,
        "created_at": "2023-08-25T14:27:26Z",
        "closed_at": "2023-08-25T15:28:00Z",
        "merged_at": "2023-08-25T15:28:00Z",
        "body": "- backport of https://github.com/moby/moby/pull/46321\r\n- relates to https://github.com/moby/moby/pull/46069\r\n\r\n\r\n(cherry picked from commit cd49f9affdad81360620019b6e8741ae73fd5590)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 28,
        "deletions": 28,
        "changed_files": 14,
        "created_at": "2023-08-25T14:23:50Z",
        "closed_at": "2023-08-25T15:44:23Z",
        "merged_at": "2023-08-25T15:44:23Z",
        "body": "- backport of https://github.com/moby/moby/pull/46323\r\n\r\n### docs/api: update links to Go documentation\r\n\r\nGo documentation moved to the `go.dev` domain;\r\n\r\n    curl -sI https://golang.org/doc/install/source#environment | grep 'location'\r\n    location: https://go.dev/doc/install/source\r\n\r\n\r\n### api: swagger: update link to Go documentation\r\n\r\nGo documentation moved to the `go.dev` domain;\r\n\r\n    curl -sI https://golang.org/doc/install/source#environment | grep 'location'\r\n    location: https://go.dev/doc/install/source\r\n\r\n### CONTRIBUTING.md: update links to golang docs and blog\r\n\r\n- docs moved to https://go.dev/doc/\r\n- blog moved to https://go.dev/blog/\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 4,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-08-25T11:45:27Z",
        "closed_at": null,
        "merged_at": null,
        "body": "systemd service notification is not generic to all linux systems, only useful on those really running systemd (Lennartix platforms), but it introduces dependencies that aren't desired on class Linux targets.\r\n\r\nFor freebsd target we already have dummy functions that we can use on classic Linux. Restructuring in a way that these are used on freebsd and on linux when 'nosystemd' tag is set.\r\n\r\nOpting out via 'nosystemd' tag, so downstreams dont change suddenly, w/o setting any additional tags.\r\n\r\nchanges v3: rebased and added go:build flags\r\nchanges v2: renamed tag 'nosystemd' to 'no_systemd'\r\n            switch to new style build tags\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-08-25T11:36:20Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- backport of https://github.com/moby/moby/pull/46324\r\n- relates to https://github.com/moby/moby/pull/46069\r\n\r\n---\r\n\r\n### hack: update link to GOPATH documentation\r\n\r\nThis documentation moved to a different page, and the Go documentation\r\nmoved to the https://go.dev/ domain.\r\n\r\n### Dockerfile: Windows: update Golang download domains to cut down redirects\r\n\r\nThe `golang.org` domain moved to `go.dev`, and the download-URLs we were\r\nusing resulted in 2 redirects;\r\n\r\n    curl -sI https://golang.org/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://go.dev/dl/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://go.dev/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    HTTP/2 200\r\n    # ...\r\n\r\nThis patch cuts it down to one redirects. I decided not to use the \"final\"\r\n(`dl.google.com`) URL, because that URL is not documented in the Golang docs,\r\nand visiting the domain itself (https://dl.google.com/) redirects to a marketing\r\npage for \"Google Chrome\".\r\n\r\nTrying the `/go/` path (https://dl.google.com/go/) also does not show a landing\r\npage that lists downloads, so I'm considering those URLs to be \"unstable\".\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-08-25T11:36:16Z",
        "closed_at": "2023-08-25T12:49:01Z",
        "merged_at": "2023-08-25T12:49:01Z",
        "body": "- backport of https://github.com/moby/moby/pull/46324\r\n- relates to https://github.com/moby/moby/pull/46069\r\n\r\n---\r\n\r\n### hack: update link to GOPATH documentation\r\n\r\nThis documentation moved to a different page, and the Go documentation\r\nmoved to the https://go.dev/ domain.\r\n\r\n### Dockerfile: Windows: update Golang download domains to cut down redirects\r\n\r\nThe `golang.org` domain moved to `go.dev`, and the download-URLs we were\r\nusing resulted in 2 redirects;\r\n\r\n    curl -sI https://golang.org/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://go.dev/dl/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://go.dev/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    HTTP/2 200\r\n    # ...\r\n\r\nThis patch cuts it down to one redirects. I decided not to use the \"final\"\r\n(`dl.google.com`) URL, because that URL is not documented in the Golang docs,\r\nand visiting the domain itself (https://dl.google.com/) redirects to a marketing\r\npage for \"Google Chrome\".\r\n\r\nTrying the `/go/` path (https://dl.google.com/go/) also does not show a landing\r\npage that lists downloads, so I'm considering those URLs to be \"unstable\".\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-08-25T11:36:11Z",
        "closed_at": "2023-08-25T12:48:41Z",
        "merged_at": "2023-08-25T12:48:41Z",
        "body": "- backport of https://github.com/moby/moby/pull/46324\r\n- relates to https://github.com/moby/moby/pull/46069\r\n\r\n---\r\n\r\n### hack: update link to GOPATH documentation\r\n\r\nThis documentation moved to a different page, and the Go documentation\r\nmoved to the https://go.dev/ domain.\r\n\r\n### Dockerfile: Windows: update Golang download domains to cut down redirects\r\n\r\nThe `golang.org` domain moved to `go.dev`, and the download-URLs we were\r\nusing resulted in 2 redirects;\r\n\r\n    curl -sI https://golang.org/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://go.dev/dl/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://go.dev/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    HTTP/2 200\r\n    # ...\r\n\r\nThis patch cuts it down to one redirects. I decided not to use the \"final\"\r\n(`dl.google.com`) URL, because that URL is not documented in the Golang docs,\r\nand visiting the domain itself (https://dl.google.com/) redirects to a marketing\r\npage for \"Google Chrome\".\r\n\r\nTrying the `/go/` path (https://dl.google.com/go/) also does not show a landing\r\npage that lists downloads, so I'm considering those URLs to be \"unstable\".\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 3,
        "created_at": "2023-08-25T10:55:26Z",
        "closed_at": "2023-08-25T11:49:33Z",
        "merged_at": "2023-08-25T11:49:33Z",
        "body": "- relates to https://github.com/moby/moby/pull/46069\r\n\r\n### hack: update link to GOPATH documentation\r\n\r\nThis documentation moved to a different page, and the Go documentation\r\nmoved to the https://go.dev/ domain.\r\n\r\n### Dockerfile: Windows: update Golang download domains to cut down redirects\r\n\r\nThe `golang.org` domain moved to `go.dev`, and the download-URLs we were\r\nusing resulted in 2 redirects;\r\n\r\n    curl -sI https://golang.org/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://go.dev/dl/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://go.dev/dl/go1.20.windows-amd64.zip | grep 'location'\r\n    location: https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    \r\n    curl -sI https://dl.google.com/go/go1.20.windows-amd64.zip\r\n    HTTP/2 200\r\n    # ...\r\n\r\nThis patch cuts it down to one redirects. I decided not to use the \"final\"\r\n(`dl.google.com`) URL, because that URL is not documented in the Golang docs,\r\nand visiting the domain itself (https://dl.google.com/) redirects to a marketing\r\npage for \"Google Chrome\".\r\n\r\nTrying the `/go/` path (https://dl.google.com/go/) also does not show a landing\r\npage that lists downloads, so I'm considering those URLs to be \"unstable\".\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 28,
        "deletions": 28,
        "changed_files": 14,
        "created_at": "2023-08-25T10:46:32Z",
        "closed_at": "2023-08-25T12:14:39Z",
        "merged_at": "2023-08-25T12:14:39Z",
        "body": "### docs/api: update links to Go documentation\r\n\r\nGo documentation moved to the `go.dev` domain;\r\n\r\n    curl -sI https://golang.org/doc/install/source#environment | grep 'location'\r\n    location: https://go.dev/doc/install/source\r\n\r\n\r\n### api: swagger: update link to Go documentation\r\n\r\nGo documentation moved to the `go.dev` domain;\r\n\r\n    curl -sI https://golang.org/doc/install/source#environment | grep 'location'\r\n    location: https://go.dev/doc/install/source\r\n\r\n### CONTRIBUTING.md: update links to golang docs and blog\r\n\r\n- docs moved to https://go.dev/doc/\r\n- blog moved to https://go.dev/blog/\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 15,
        "deletions": 12,
        "changed_files": 4,
        "created_at": "2023-08-25T00:21:47Z",
        "closed_at": "2023-08-25T10:43:08Z",
        "merged_at": "2023-08-25T10:43:08Z",
        "body": "- relates to https://github.com/moby/moby/pull/46069\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 33,
        "deletions": 22,
        "changed_files": 4,
        "created_at": "2023-08-24T23:04:49Z",
        "closed_at": "2023-08-29T20:04:39Z",
        "merged_at": "2023-08-29T20:04:39Z",
        "body": "### daemon/containerd: log errors when releasing leases\r\n\r\nLog a warning if we encounter an error when releasing leases. While it\r\nmay not have direct consequences, failing to release the lease should be\r\nunexpected, so let's make them visible.\r\n\r\n### daemon/containerd: newROLayerForImage: remove unused args\r\n\r\nAlso rename variables that collided with imports.\r\n\r\n\r\n### daemon/containerd: rename some vars that collided with imports\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 49,
        "deletions": 54,
        "changed_files": 26,
        "created_at": "2023-08-24T16:01:39Z",
        "closed_at": "2023-08-24T23:06:06Z",
        "merged_at": "2023-08-24T23:06:05Z",
        "body": "- follow-up to https://github.com/moby/moby/pull/43169\r\n\r\nLet's do another format\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 36,
        "changed_files": 36,
        "created_at": "2023-08-24T15:48:53Z",
        "closed_at": "2023-08-24T23:06:39Z",
        "merged_at": "2023-08-24T23:06:39Z",
        "body": "- relates to / follow-up to https://github.com/moby/moby/pull/45475\r\n\r\ncommit ab35df454d0666ef1214168938f952cc74c1d659 (https://github.com/moby/moby/pull/45475) removed most of the pre-go1.17 build-tags, but for some reason, \"go fix\" doesn't remove these, so removing the remaining ones manually\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 204,
        "deletions": 226,
        "changed_files": 5,
        "created_at": "2023-08-24T14:45:26Z",
        "closed_at": "2023-09-20T14:13:15Z",
        "merged_at": "2023-09-20T14:13:15Z",
        "body": "### libnetwork/osl: implement Namespace.RemoveInterface\r\n\r\nInterface.Remove() was directly accessing Namespace \"internals\", such\r\nas locking/unlocking. Move the code from Interface.Remove() into the\r\nNamespace instead.\r\n\r\n### libnetwork/osl: Namespace: make mutex private\r\n\r\nMake the mutex internal to the Namespace; locking/unlocking should not\r\nbe done externally, and this makes it easier to see where it's used.\r\n\r\n### libnetwork/osl: Namespace: programRoute, removeRoute rm path arg\r\n\r\nRemove the argument, because it was not used.\r\n\r\n### libnetwork/osl: Namespace: make error-handling more idiomatic\r\n\r\nCheck for non-nil errors (and return early) instead of the reverse.\r\n\r\n### libnetwork/osl: Namespace: inline setGateway and setGatewayIPv6\r\n\r\nThey were not consistently used, and the locations where they were\r\nused were already \"setters\", so we may as well inline the code.\r\n\r\nAlso updating Namespace.Restore to keep the lock slightly longer,\r\ninstead of locking/unlocking for each property individually, although\r\nwe should consider to keep the long for the duration of the whole\r\nfunction to make it more atomic.\r\n\r\n\r\n### libnetwork/osl: Namespace.Restore: rename vars for readability\r\n\r\n### libnetwork/osl: Namespace.Restore: flatten nested conditions\r\n\r\nFlatten some nested \"if\"-statements, and improve error.\r\n\r\nErrors returned by this function are not handled, and only logged, so\r\nmake them more informative if debugging is needed.\r\n\r\n### libnetwork/osl: Namespace.Restore: conditionally fetch IPs\r\n\r\nWe're only using the results if the interface doesn't have an address\r\nyet, so skip this step if we don't use it.\r\n\r\n### libnetwork/osl: make constructing Interfaces more atomic\r\n\r\nIt's still not \"great\", but implement a `newInterface()` constructor\r\nto create a new Interface instance, instead of creating a partial\r\ninstance and applying \"options\" after the fact.\r\n\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 22,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-24T14:38:51Z",
        "closed_at": "2023-08-24T15:33:12Z",
        "merged_at": "2023-08-24T15:33:12Z",
        "body": "Copying relevant documentation from the EndpointInfo interface. We should remove this interface, and the related Info() function, but it's currently acting as a \"gate\" to prevent accessing the Endpoint's accessors without making sure it's fully hydrated.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 187,
        "deletions": 141,
        "changed_files": 7,
        "created_at": "2023-08-24T14:05:45Z",
        "closed_at": "2023-08-31T17:51:47Z",
        "merged_at": "2023-08-31T17:51:47Z",
        "body": "- Depends on: https://github.com/moby/moby/pull/46363\r\n\r\nThis fixes `ONBUILD`, `MAINTAINER` and Healthcheck in containerd integration.\r\n\r\n**- What I did**\r\nFixed `ONBUILD`, `MAINTAINER` and healthchecks in containerd integration.\r\n\r\n**- How I did it**\r\nUse wrappers for OCI Image and ImageConfig which preserve Docker specific config fields when serializing/deserializing images. \r\n\r\n**- How to verify it**\r\n```diff\r\n$ make DOCKER_GRAPHDRIVER=overlayfs  \\\r\n   DOCKER_BUILDKIT=0 \\\r\n   TEST_INTEGRATION_USE_SNAPSHOTTER=1  \\\r\n   TEST_FILTER='(Health|OnBuild|TestBuildMaintainer|TestBuildFrom)'    test-integration\r\n(...)\r\n- DONE 74 tests, 1 skipped, 17 failures in 85.404s\r\n+ DONE 74 tests, 1 skipped in 58.001s\r\n```\r\n\r\nAlso, test case (for healthcheck) reported by user:\r\n```diff\r\n$ docker run -d syncthing/syncthing\r\n40280b7b22645ef2967bdae63fdfee3522e9e7003c3de7d5eae689f6a1713a53\r\n\r\n$ docker ps\r\n- CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS        PORTS                                       NAMES\r\n- 3e797ed5e0ee   syncthing/syncthing   \"/bin/entrypoint.sh \u2026\"   2 seconds ago   Up 1 second   8384/tcp, 21027/udp, 22000/tcp, 22000/udp   kind_cray\r\n+ CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS                           PORTS                                       NAMES\r\n+ 40280b7b2264   syncthing/syncthing   \"/bin/entrypoint.sh \u2026\"   2 seconds ago   Up 1 second (health: starting)   8384/tcp, 21027/udp, 22000/tcp, 22000/udp   charming_shamir\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- containerd integration: Fixed `ONBUILD` and `MAINTAINER` Dockerfile instruction\r\n- containerd integration: Fixed healthchecks\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 9,
        "changed_files": 1,
        "created_at": "2023-08-24T12:53:48Z",
        "closed_at": "2023-08-24T14:11:12Z",
        "merged_at": "2023-08-24T14:11:12Z",
        "body": "- closes https://github.com/moby/moby/pull/42889\r\n- relates to #46307\r\n\r\n**- What I did**\r\n\r\nSwitched to downloading `distribution/distribution` instead of cloning+building it.\r\n\r\nWe used to have to clone and build the registry v2 but now that we have updated the version we can directtly copy the binary from the official distribution/distribution image.\r\n\r\nrelates to #42889, #46307\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 2,
        "changed_files": 3,
        "created_at": "2023-08-24T11:51:10Z",
        "closed_at": "2023-08-29T16:34:20Z",
        "merged_at": "2023-08-29T16:34:20Z",
        "body": "### libnetwork: fix some missing imports on macOS and FreeBSD\r\n\r\nThis was introduced in 1980deffaeed881e04abe48aba6295fd67d84f4a (https://github.com/moby/moby/pull/45881), which\r\nchanged the implementation, but forgot to update imports in these.\r\n\r\n### libnetwork: Controller.addServiceBinding: fix duplicate word in comment\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 4,
        "changed_files": 2,
        "created_at": "2023-08-24T10:49:16Z",
        "closed_at": "2023-08-24T13:03:28Z",
        "merged_at": "2023-08-24T13:03:28Z",
        "body": "- backport: https://github.com/moby/moby/pull/46301\r\n\r\n**- What I did**\r\nFixed `CreateImage` losing the parent layers when creating a child image.\r\n\r\nThis fixes `failed to export image: mismatched image rootfs and manifest layers` errors in integration-cli build tests with c8d enabled (https://github.com/moby/moby/pull/45232). Although this doesn't make all these tests green, as they now fail due to: https://github.com/moby/moby/issues/46194.\r\n\r\n\r\n\r\n**- How I did it**\r\nClone the passed `Image` and replace its ID instead of recreating it from scratch (and not setting all needed fields).\r\n\r\n**- How to verify it**\r\nBefore\r\n\r\n```bash\r\n$ make  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1  TEST_FILTER='TestBuildAddBadLinks'  test-integration\r\n...\r\n=== RUN   TestDockerCLIBuildSuite/TestBuildAddBadLinks\r\n    docker_cli_build_test.go:998: assertion failed: \r\n        Command:  /usr/local/cli-integration/docker build -t test-link-absolute .\r\n        ExitCode: 1\r\n        Error:    exit status 1\r\n        Stdout:   Sending build context to Docker daemon   5.12kB\r\n\r\n\r\n        Step 1/3 : FROM scratch\r\n         ---> \r\n        Step 2/3 : ADD links.tar /\r\n         ---> 7f60960c7521\r\n        Step 3/3 : ADD foo.txt /symlink/\r\n        \r\n        Stderr:   failed to export image: mismatched image rootfs and manifest layers\r\n        \r\n        \r\n        Failures:\r\n        ExitCode was 1 expected 0\r\n        Expected no error\r\n...\r\n```\r\n\r\nAfter\r\n```bash\r\n$ make  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1  TEST_FILTER='TestBuildAddBadLinks'  test-integration\r\n...\r\n--- PASS: TestDockerCLIBuildSuite (3.24s)\r\n    --- PASS: TestDockerCLIBuildSuite/TestBuildAddBadLinks (2.32s)\r\n    --- PASS: TestDockerCLIBuildSuite/TestBuildAddBadLinksVolume (0.92s)\r\n...\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-08-24T10:25:37Z",
        "closed_at": "2023-08-24T13:04:45Z",
        "merged_at": "2023-08-24T13:04:45Z",
        "body": "Some non-executable files had executable mode flag.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-24T09:25:55Z",
        "closed_at": "2023-08-24T11:34:10Z",
        "merged_at": "2023-08-24T11:34:10Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nUpdated the registry version used in the integration tests, the one used was 6 years old\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 89,
        "deletions": 191,
        "changed_files": 17,
        "created_at": "2023-08-23T18:23:59Z",
        "closed_at": "2023-08-24T14:23:32Z",
        "merged_at": "2023-08-24T14:23:32Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46149\r\n\r\n\r\n### libnetwork/osl: remove Sandbox and Info interfaces\r\n\r\nIt only has a single implementation.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 20,
        "deletions": 12,
        "changed_files": 2,
        "created_at": "2023-08-23T18:01:36Z",
        "closed_at": "2023-08-24T15:06:40Z",
        "merged_at": "2023-08-24T15:06:40Z",
        "body": "- relates to https://github.com/moby/moby/pull/46190#discussion_r1291052416\r\n\r\nCheck if firewalld is running before running the function, so that consumers of the function don't have to check for the status.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-23T17:18:57Z",
        "closed_at": "2023-08-23T19:07:03Z",
        "merged_at": "2023-08-23T19:07:03Z",
        "body": "- relates to https://github.com/moby/moby/pull/45232\r\n\r\nThis test is currently failing with containerd-integration, which should be looked into, but let's start with preventing it from panicking, to make the test-failures less noisy;\r\n\r\n        --- FAIL: TestDiskUsage/after_container.Run (0.26s)\r\n    panic: runtime error: index out of range [0] with length 0 [recovered]\r\n        panic: runtime error: index out of range [0] with length 0\r\n\r\n    goroutine 280 [running]:\r\n    testing.tRunner.func1.2({0xb07a00, 0x40002006a8})\r\n        /usr/local/go/src/testing/testing.go:1526 +0x1c8\r\n    testing.tRunner.func1()\r\n        /usr/local/go/src/testing/testing.go:1529 +0x364\r\n    panic({0xb07a00, 0x40002006a8})\r\n        /usr/local/go/src/runtime/panic.go:884 +0x1f4\r\n    github.com/docker/docker/integration/system.TestDiskUsage.func3(0x0?, {0x0, {0x14ea4a8, 0x0, 0x0}, {0x14ea4a8, 0x0, 0x0}, {0x14ea4a8, 0x0, ...}, ...})\r\n        /go/src/github.com/docker/docker/integration/system/disk_usage_test.go:82 +0x7e4\r\n    github.com/docker/docker/integration/system.TestDiskUsage.func4(0x4000235c80?)\r\n        /go/src/github.com/docker/docker/integration/system/disk_usage_test.go:118 +0x8c\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 111,
        "deletions": 61,
        "changed_files": 4,
        "created_at": "2023-08-23T17:01:11Z",
        "closed_at": "2023-08-23T18:58:42Z",
        "merged_at": "2023-08-23T18:58:42Z",
        "body": "- backport of https://github.com/moby/moby/pull/46284\r\n- Fixes: https://github.com/moby/moby/issues/46248\r\n- addresses https://github.com/docker/for-mac/issues/6853#issuecomment-1680977603\r\n\r\n\r\n**- What I did**\r\nFix running containers with empty `Image`.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\nc8d integration tests (https://github.com/moby/moby/pull/45232) from `TestDockerCLIBuildSuite`:\r\n```diff\r\n- DONE 250 tests, 13 skipped, 58 failures in 352.552s\r\n+ DONE 250 tests, 13 skipped, 42 failures in 406.027s\r\n```\r\n\r\n**Before**\r\n```bash\r\n$ printf 'FROM scratch\\nLABEL asdf=1' | DOCKER_BUILDKIT=0 docker build -t asdf -\r\nDEPRECATED: The legacy builder is deprecated and will be removed in a future release.\r\n            BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0\r\n            environment-variable.\r\n\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/2 : FROM scratch\r\n --->\r\nStep 2/2 : LABEL asdf=1\r\ninvalid reference format\r\n```\r\n\r\n**After**\r\n```bash\r\n$ printf 'FROM scratch\\nLABEL asdf=1' | DOCKER_BUILDKIT=0 docker build -t asdf -\r\nDEPRECATED: The legacy builder is deprecated and will be removed in a future release.\r\n            BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0\r\n            environment-variable.\r\n\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/2 : FROM scratch\r\n --->\r\nStep 2/2 : LABEL asdf=1\r\n ---> Running in 08bc1d65adb1\r\n ---> Removed intermediate container 08bc1d65adb1\r\n ---> 7072ecaf239f\r\nSuccessfully built 7072ecaf239f\r\nSuccessfully tagged asdf:latest\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\ncontainerd integration: Fix building Dockerfiles with `FROM scratch` instruction when using the legacy builder (non buildkit).\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 4,
        "changed_files": 2,
        "created_at": "2023-08-23T14:19:59Z",
        "closed_at": "2023-08-24T10:45:06Z",
        "merged_at": "2023-08-24T10:45:06Z",
        "body": "- requires: https://github.com/moby/moby/pull/46284\r\n\r\n**- What I did**\r\nFixed `CreateImage` losing the parent layers when creating a child image.\r\n\r\nThis fixes `failed to export image: mismatched image rootfs and manifest layers` errors in integration-cli build tests with c8d enabled (https://github.com/moby/moby/pull/45232). Although this doesn't make all these tests green, as they now fail due to: https://github.com/moby/moby/issues/46194.\r\n\r\n\r\n\r\n**- How I did it**\r\nClone the passed `Image` and replace its ID instead of recreating it from scratch (and not setting all needed fields).\r\n\r\n**- How to verify it**\r\nBefore\r\n\r\n```bash\r\n$ make  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1  TEST_FILTER='TestBuildAddBadLinks'  test-integration\r\n...\r\n=== RUN   TestDockerCLIBuildSuite/TestBuildAddBadLinks\r\n    docker_cli_build_test.go:998: assertion failed: \r\n        Command:  /usr/local/cli-integration/docker build -t test-link-absolute .\r\n        ExitCode: 1\r\n        Error:    exit status 1\r\n        Stdout:   Sending build context to Docker daemon   5.12kB\r\n\r\n\r\n        Step 1/3 : FROM scratch\r\n         ---> \r\n        Step 2/3 : ADD links.tar /\r\n         ---> 7f60960c7521\r\n        Step 3/3 : ADD foo.txt /symlink/\r\n        \r\n        Stderr:   failed to export image: mismatched image rootfs and manifest layers\r\n        \r\n        \r\n        Failures:\r\n        ExitCode was 1 expected 0\r\n        Expected no error\r\n...\r\n```\r\n\r\nAfter\r\n```bash\r\n$ make  DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1  TEST_FILTER='TestBuildAddBadLinks'  test-integration\r\n...\r\n--- PASS: TestDockerCLIBuildSuite (3.24s)\r\n    --- PASS: TestDockerCLIBuildSuite/TestBuildAddBadLinks (2.32s)\r\n    --- PASS: TestDockerCLIBuildSuite/TestBuildAddBadLinksVolume (0.92s)\r\n...\r\n```\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-23T13:57:29Z",
        "closed_at": "2023-08-23T15:41:15Z",
        "merged_at": "2023-08-23T15:41:15Z",
        "body": "- backport of https://github.com/moby/moby/pull/46293\r\n- relates to https://github.com/moby/moby/pull/43939\r\n\r\nIf the image for the wanted platform doesn't exist then the lease doesn't exist either. Returning this error hides the real error, so let's not return it.\r\n\r\n\r\n(cherry picked from commit b8ff8ea58ee37d672f42e94da4d73442d8a81fc9)\r\n\r\n---\r\n\r\n**- What I did**\r\n\r\n#43939 changed the signature of `manifestMatchesPlatform` and started returning the lease error, the issue is that, if the image for the wanted platform doesn't exist, then the lease doesn't exist either. We shouldn't return an error if the lease is not found\r\n\r\n**- How I did it**\r\n\r\nBy checking the error returned when we list lease resources.\r\n\r\n**- How to verify it**\r\n\r\nWith this compose file\r\n\r\n```yaml\r\nservices:\r\n  test:\r\n    build:\r\n      context: .\r\n      dockerfile: Dockerfile\r\n```\r\n\r\nAnd this Dockerfile:\r\n\r\n```dockerfile\r\nFROM alpine\r\n```\r\n\r\nRun the compose project once:\r\n\r\n```console\r\n$ docker compose up\r\n```\r\nThen run it but with a preferred platform specified:\r\n\r\nBefore:\r\n\r\n```console\r\n$ DOCKER_DEFAULT_PLATFORM=linux/arm64 docker-compose up\r\n[+] Running 0/0\r\n \u280b Container compose-platform-test-1  Recreate                                                                                                                         0.0s \r\nError response from daemon: lease \"moby-image-sha256:e22aab0781e952e8ae9c49b2162eda23ef9a62d26a7b1e6a2d66b77f6751c45e\": not found\r\n```\r\nAfter:\r\n\r\n```console\r\n$ DOCKER_DEFAULT_PLATFORM=linux/arm64 docker-compose up\r\n[+] Running 0/0\r\n \u280b Container compose-platform-test-1  Recreate                                                                                                                         0.0s \r\nError response from daemon: image with reference compose-platform-test was found but does not match the specified platform: wanted linux/arm64, actual: linux/amd64\r\n```\r\n\r\nThis was reported in multiple places:\r\n\r\n* https://github.com/laravel/sail/issues/597\r\n* https://github.com/docker/compose/issues/10856#issuecomment-1682601800\r\n* https://stackoverflow.com/questions/76413014/error-response-from-daemon-lease-moby-image-sha256c274-not-found\r\n\r\n**- Description for the changelog**\r\nFixed the reported error when the local image's platform mismatches the wanted one\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-23T07:50:12Z",
        "closed_at": "2023-08-23T12:00:58Z",
        "merged_at": "2023-08-23T12:00:58Z",
        "body": "**- What I did**\r\n\r\nSkip graphdriver tests if we are using containerd snapshotters\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 22,
        "deletions": 11,
        "changed_files": 2,
        "created_at": "2023-08-23T06:59:12Z",
        "closed_at": null,
        "merged_at": null,
        "body": "closes #44921\r\n\r\n**- What I did**\r\nRestrict `0` value for:\r\n- config.MaxConcurrentDownloads\r\n- config.MaxConcurrentUploads\r\n- config.MaxDownloadAttempts\r\n- config.MTU (minimal value is set 68)\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\nThe daemon should refuse to start.\r\n\r\n$ docker run --rm -it --privileged docker:20.10.23-dind dockerd --max-download-attempts=0\r\ninvalid max download attempts: 0\r\n$ docker run --rm -it --privileged docker:20.10.23-dind sh -c 'mkdir /etc/docker && echo '\"'\"'{\"max-download-attempts\": 0}'\"'\"' > /etc/docker/daemon.json && dockerd'\r\nunable to configure the Docker daemon with file /etc/docker/daemon.json: configuration validation from file failed: invalid max download attempts: 0\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 81,
        "deletions": 7,
        "changed_files": 5,
        "created_at": "2023-08-22T22:54:43Z",
        "closed_at": "2023-08-23T08:55:15Z",
        "merged_at": "2023-08-23T08:55:14Z",
        "body": "### vendor: github.com/moby/patternmatcher v0.6.0\r\n\r\n- integrate frontend/dockerfile/dockerignore from buildkit\r\n\r\nfull diff: https://github.com/moby/patternmatcher/compare/v0.5.0...v0.6.0\r\n\r\n\r\n### replace dockerfile/dockerignore with patternmatcher/ignorefile\r\n\r\nThe BuildKit dockerignore package was integrated in the patternmatcher\r\nrepository / module. This patch updates our uses of the BuildKit package\r\nwith its new location.\r\n\r\nA small local change was made to keep the format of the existing error message,\r\nbecause the \"ignorefile\" package is slightly more agnostic in that respect\r\nand doesn't include \".dockerignore\" in the error message.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-22T10:09:10Z",
        "closed_at": "2023-08-23T13:55:04Z",
        "merged_at": "2023-08-23T13:55:04Z",
        "body": "**- What I did**\r\n\r\n#43939 changed the signature of `manifestMatchesPlatform` and started returning the lease error, the issue is that, if the image for the wanted platform doesn't exist, then the lease doesn't exist either. We shouldn't return an error if the lease is not found\r\n\r\n**- How I did it**\r\n\r\nBy checking the error returned when we list lease resources.\r\n\r\n**- How to verify it**\r\n\r\nWith this compose file\r\n\r\n```yaml\r\nservices:\r\n  test:\r\n    build:\r\n      context: .\r\n      dockerfile: Dockerfile\r\n```\r\n\r\nAnd this Dockerfile:\r\n\r\n```dockerfile\r\nFROM alpine\r\n```\r\n\r\nRun the compose project once:\r\n\r\n```console\r\n$ docker compose up\r\n```\r\nThen run it but with a preferred platform specified:\r\n\r\nBefore:\r\n\r\n```console\r\n$ DOCKER_DEFAULT_PLATFORM=linux/arm64 docker-compose up\r\n[+] Running 0/0\r\n \u280b Container compose-platform-test-1  Recreate                                                                                                                         0.0s \r\nError response from daemon: lease \"moby-image-sha256:e22aab0781e952e8ae9c49b2162eda23ef9a62d26a7b1e6a2d66b77f6751c45e\": not found\r\n```\r\nAfter:\r\n\r\n```console\r\n$ DOCKER_DEFAULT_PLATFORM=linux/arm64 docker-compose up\r\n[+] Running 0/0\r\n \u280b Container compose-platform-test-1  Recreate                                                                                                                         0.0s \r\nError response from daemon: image with reference compose-platform-test was found but does not match the specified platform: wanted linux/arm64, actual: linux/amd64\r\n```\r\n\r\nThis was reported in multiple places:\r\n\r\n* https://github.com/laravel/sail/issues/597\r\n* https://github.com/docker/compose/issues/10856#issuecomment-1682601800\r\n* https://stackoverflow.com/questions/76413014/error-response-from-daemon-lease-moby-image-sha256c274-not-found\r\n\r\n**- Description for the changelog**\r\nFixed the reported error when the local image's platform mismatches the wanted one\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 12,
        "deletions": 24,
        "changed_files": 5,
        "created_at": "2023-08-22T06:01:40Z",
        "closed_at": "2023-08-26T22:01:07Z",
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n  Updated readme to close cli object\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": false,
        "additions": 16,
        "deletions": 180,
        "changed_files": 14,
        "created_at": "2023-08-21T20:02:59Z",
        "closed_at": "2023-08-23T12:24:23Z",
        "merged_at": null,
        "body": "backport of:\r\n\r\n- https://github.com/moby/moby/pull/44526\r\n- https://github.com/moby/moby/pull/46271\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 8,
        "changed_files": 1,
        "created_at": "2023-08-21T19:08:48Z",
        "closed_at": "2023-08-21T20:12:39Z",
        "merged_at": "2023-08-21T20:12:39Z",
        "body": "- backport of https://github.com/moby/moby/pull/46137\r\n\r\n----\r\n\r\n- [x] relates to / depends on https://github.com/docker/docs/pull/17858\r\n- relates to https://github.com/moby/moby/pull/39736\r\n- relates to https://github.com/moby/moby/issues/39701\r\n- relates to https://github.com/distribution/distribution/issues/2976\r\n- relates to https://github.com/moby/moby/issues/44521\r\n- relates to https://github.com/moby/moby/pull/42300\r\n- relates to https://github.com/docker/roadmap/issues/173\r\n\r\n\r\n### distribution: update warning for deprecated image formats\r\n\r\n- Use the same warning for both \"v1 in manifest-index\" and bare \"v1\" images.\r\n- Update URL to use a \"/go/\" redirect, which allows the docs team to more\r\n  easily redirect the URL to relevant docs (if things move).\r\n\r\n\r\n### distribution: show image schema deprecation on all registries\r\n\r\nWhen we added this deprecation warning, some registries had not yet\r\nmoved away from the deprecated specification, so we made the warning\r\nconditional for pulling from Docker Hub.\r\n\r\nThat condition was added in 647dfe99a50badd27f0508c67eddc4b4923fcef7,\r\nwhich is over 4 Years ago, which should be time enough for images\r\nand registries to have moved to current specifications.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 21,
        "deletions": 185,
        "changed_files": 14,
        "created_at": "2023-08-21T18:53:14Z",
        "closed_at": "2023-08-23T12:23:46Z",
        "merged_at": "2023-08-23T12:23:46Z",
        "body": "- backport of https://github.com/moby/moby/pull/46273\r\n- backport of https://github.com/moby/moby/pull/44526\r\n- backport of https://github.com/moby/moby/pull/46271\r\n- fixes https://github.com/moby/moby/issues/46272\r\n\r\n--\r\n\r\nBundle of cherry-picks related to bin-image; also drops Dockerfile.e2e to make recent Makefile changes apply cleanly.\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 1894,
        "deletions": 675,
        "changed_files": 133,
        "created_at": "2023-08-21T18:46:35Z",
        "closed_at": "2023-08-29T19:51:03Z",
        "merged_at": "2023-08-29T19:51:03Z",
        "body": "- vendor github.com/containerd/ttrpc v1.1.2 https://github.com/containerd/ttrpc/compare/v1.1.1...v1.1.2\r\n- https://github.com/moby/moby/pull/46118\r\n\r\nalso backports:\r\n\r\n- https://github.com/moby/moby/commit/9752e4364437d6dc4609d7b647fb44781a60def5 vendor: golang.org/x/sys v0.6.0 (https://github.com/golang/sys/compare/v0.5.0...v0.6.0)\r\n- https://github.com/moby/moby/commit/3886faced81b86a0ff303f93df04fd5aa0b252b1 vendor: golang.org/x/text v0.8.0 (https://github.com/golang/text/compare/v0.7.0...v0.8.0)\r\n- https://github.com/moby/moby/commit/f531e3cf6995159064f9b54b18318367c39d72c5 vendor: golang.org/x/net v0.8.0 (https://github.com/golang/net/compare/v0.7.0...v0.8.0)\r\n- https://github.com/moby/moby/commit/c1a9e82d3e546999429ea535aa82e72c57eb00c7 vendor: google.golang.org/grpc v1.50.1 (https://github.com/grpc/grpc-go/compare/v1.48.0...v1.50.1)\r\n\r\n----\r\n\r\n----\r\n\r\n### vendor: containerd binary to v1.6.22\r\n\r\n- full diff: https://github.com/containerd/containerd/compare/v1.6.21...v1.6.22\r\n- release notes: https://github.com/containerd/containerd/releases/tag/v1.6.22\r\n\r\n---\r\n\r\nNotable Updates\r\n\r\n- RunC: Update runc binary to v1.1.8\r\n- CRI: Fix `additionalGids`: it should fallback to `imageConfig.User`\r\n  when `securityContext.RunAsUser`, `RunAsUsername` are empty\r\n- CRI: Write generated CNI config atomically\r\n- Fix concurrent writes for `UpdateContainerStats`\r\n- Make `checkContainerTimestamps` less strict on Windows\r\n- Port-Forward: Correctly handle known errors\r\n- Resolve `docker.NewResolver` race condition\r\n- SecComp: Always allow `name_to_handle_at`\r\n- Adding support to run hcsshim from local clone\r\n- Pinned image support\r\n- Runtime/V2/RunC: Handle early exits w/o big locks\r\n- CRITool: Move up to CRI-TOOLS v1.27.0\r\n- Fix cpu architecture detection issue on emulated ARM platform\r\n- Task: Don't `close()` io before `cancel()`\r\n- Fix panic when remote differ returns empty result\r\n- Plugins: Notify readiness when registered plugins are ready\r\n- Unwrap io errors in server connection receive error handling\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-21T18:23:11Z",
        "closed_at": "2023-08-21T22:03:11Z",
        "merged_at": "2023-08-21T22:03:11Z",
        "body": "- backport of https://github.com/moby/moby/pull/46285\r\n\r\n\r\nI had a CI run fail to \"Upload reports\":\r\n\r\n    Exponential backoff for retry #1. Waiting for 4565 milliseconds before continuing the upload at offset 0\r\n    Finished backoff for retry #1, continuing with upload\r\n    Total file count: 211 ---- Processed file #160 (75.8%)\r\n    ...\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    ##### Begin Diagnostic HTTP information #####\r\n    Status Code: 503\r\n    Status Message: Service Unavailable\r\n    Header Information: {\r\n      \"content-length\": \"592\",\r\n      \"content-type\": \"application/json; charset=utf-8\",\r\n      \"date\": \"Mon, 21 Aug 2023 14:08:10 GMT\",\r\n      \"server\": \"Kestrel\",\r\n      \"cache-control\": \"no-store,no-cache\",\r\n      \"pragma\": \"no-cache\",\r\n      \"strict-transport-security\": \"max-age=2592000\",\r\n      \"x-tfs-processid\": \"b2fc902c-011a-48be-858d-c62e9c397cb6\",\r\n      \"activityid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-tfs-session\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-e2eid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-senderdeploymentid\": \"63be6134-28d1-8c82-e969-91f4e88fcdec\",\r\n      \"x-frame-options\": \"SAMEORIGIN\"\r\n    }\r\n    ###### End Diagnostic HTTP information ######\r\n    Retry limit has been reached for chunk at offset 0 to https://pipelinesghubeus5.actions.githubusercontent.com/Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-22.04-systemd%2Fbundles%2Ftest-integration%2FTestInfoRegistryMirrors%2Fd20ac12e48cea%2Fdocker.log\r\n    Warning: Aborting upload for /tmp/reports/ubuntu-22.04-systemd/bundles/test-integration/TestInfoRegistryMirrors/d20ac12e48cea/docker.log due to failure\r\n    Error: aborting artifact upload\r\n    Total file count: 211 ---- Processed file #165 (78.1%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    Exponential backoff for retry #1. Waiting for 5799 milliseconds before continuing the upload at offset 0\r\n\r\nAs a result, the \"Download reports\" continued retrying:\r\n\r\n    ...\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    An error occurred while attempting to download a file\r\n    Error: Request timeout: /Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-20.04%2Fbundles%2Ftest-integration%2FTestCreateWithDuplicateNetworkNames%2Fd47798cc212d1%2Fdocker.log\r\n        at ClientRequest.<anonymous> (/home/runner/work/_actions/actions/download-artifact/v3/dist/index.js:3681:26)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at ClientRequest.emit (node:events:513:28)\r\n        at TLSSocket.emitRequestTimeout (node:_http_client:839:9)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at TLSSocket.emit (node:events:525:35)\r\n        at TLSSocket.Socket._onTimeout (node:net:550:8)\r\n        at listOnTimeout (node:internal/timers:559:17)\r\n        at processTimers (node:internal/timers:502:7)\r\n    Exponential backoff for retry #1. Waiting for 5305 milliseconds before continuing the download\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n\r\nAnd, it looks like GitHub doesn't allow cancelling the job, possibly because it is defined with `if: always()`?\r\n\r\n\r\n(cherry picked from commit d6f340e784ee2b4e208be9834f75f042a0fb6691)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-21T18:22:33Z",
        "closed_at": "2023-08-21T22:02:56Z",
        "merged_at": "2023-08-21T22:02:56Z",
        "body": "- backport of https://github.com/moby/moby/pull/46285\r\n\r\nI had a CI run fail to \"Upload reports\":\r\n\r\n    Exponential backoff for retry #1. Waiting for 4565 milliseconds before continuing the upload at offset 0\r\n    Finished backoff for retry #1, continuing with upload\r\n    Total file count: 211 ---- Processed file #160 (75.8%)\r\n    ...\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    ##### Begin Diagnostic HTTP information #####\r\n    Status Code: 503\r\n    Status Message: Service Unavailable\r\n    Header Information: {\r\n      \"content-length\": \"592\",\r\n      \"content-type\": \"application/json; charset=utf-8\",\r\n      \"date\": \"Mon, 21 Aug 2023 14:08:10 GMT\",\r\n      \"server\": \"Kestrel\",\r\n      \"cache-control\": \"no-store,no-cache\",\r\n      \"pragma\": \"no-cache\",\r\n      \"strict-transport-security\": \"max-age=2592000\",\r\n      \"x-tfs-processid\": \"b2fc902c-011a-48be-858d-c62e9c397cb6\",\r\n      \"activityid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-tfs-session\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-e2eid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-senderdeploymentid\": \"63be6134-28d1-8c82-e969-91f4e88fcdec\",\r\n      \"x-frame-options\": \"SAMEORIGIN\"\r\n    }\r\n    ###### End Diagnostic HTTP information ######\r\n    Retry limit has been reached for chunk at offset 0 to https://pipelinesghubeus5.actions.githubusercontent.com/Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-22.04-systemd%2Fbundles%2Ftest-integration%2FTestInfoRegistryMirrors%2Fd20ac12e48cea%2Fdocker.log\r\n    Warning: Aborting upload for /tmp/reports/ubuntu-22.04-systemd/bundles/test-integration/TestInfoRegistryMirrors/d20ac12e48cea/docker.log due to failure\r\n    Error: aborting artifact upload\r\n    Total file count: 211 ---- Processed file #165 (78.1%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    Exponential backoff for retry #1. Waiting for 5799 milliseconds before continuing the upload at offset 0\r\n\r\nAs a result, the \"Download reports\" continued retrying:\r\n\r\n    ...\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    An error occurred while attempting to download a file\r\n    Error: Request timeout: /Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-20.04%2Fbundles%2Ftest-integration%2FTestCreateWithDuplicateNetworkNames%2Fd47798cc212d1%2Fdocker.log\r\n        at ClientRequest.<anonymous> (/home/runner/work/_actions/actions/download-artifact/v3/dist/index.js:3681:26)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at ClientRequest.emit (node:events:513:28)\r\n        at TLSSocket.emitRequestTimeout (node:_http_client:839:9)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at TLSSocket.emit (node:events:525:35)\r\n        at TLSSocket.Socket._onTimeout (node:net:550:8)\r\n        at listOnTimeout (node:internal/timers:559:17)\r\n        at processTimers (node:internal/timers:502:7)\r\n    Exponential backoff for retry #1. Waiting for 5305 milliseconds before continuing the download\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n\r\nAnd, it looks like GitHub doesn't allow cancelling the job, possibly because it is defined with `if: always()`?\r\n\r\n\r\n(cherry picked from commit d6f340e784ee2b4e208be9834f75f042a0fb6691)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-21T16:53:13Z",
        "closed_at": "2023-08-21T18:19:40Z",
        "merged_at": "2023-08-21T18:19:40Z",
        "body": "I had a CI run fail to \"Upload reports\" in https://github.com/moby/moby/pull/46206:\r\n\r\n    Exponential backoff for retry #1. Waiting for 4565 milliseconds before continuing the upload at offset 0\r\n    Finished backoff for retry #1, continuing with upload\r\n    Total file count: 211 ---- Processed file #160 (75.8%)\r\n    ...\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    Total file count: 211 ---- Processed file #164 (77.7%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    ##### Begin Diagnostic HTTP information #####\r\n    Status Code: 503\r\n    Status Message: Service Unavailable\r\n    Header Information: {\r\n      \"content-length\": \"592\",\r\n      \"content-type\": \"application/json; charset=utf-8\",\r\n      \"date\": \"Mon, 21 Aug 2023 14:08:10 GMT\",\r\n      \"server\": \"Kestrel\",\r\n      \"cache-control\": \"no-store,no-cache\",\r\n      \"pragma\": \"no-cache\",\r\n      \"strict-transport-security\": \"max-age=2592000\",\r\n      \"x-tfs-processid\": \"b2fc902c-011a-48be-858d-c62e9c397cb6\",\r\n      \"activityid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-tfs-session\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-e2eid\": \"49a48b53-0411-4ff3-86a7-4528e3f71ba2\",\r\n      \"x-vss-senderdeploymentid\": \"63be6134-28d1-8c82-e969-91f4e88fcdec\",\r\n      \"x-frame-options\": \"SAMEORIGIN\"\r\n    }\r\n    ###### End Diagnostic HTTP information ######\r\n    Retry limit has been reached for chunk at offset 0 to https://pipelinesghubeus5.actions.githubusercontent.com/Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-22.04-systemd%2Fbundles%2Ftest-integration%2FTestInfoRegistryMirrors%2Fd20ac12e48cea%2Fdocker.log\r\n    Warning: Aborting upload for /tmp/reports/ubuntu-22.04-systemd/bundles/test-integration/TestInfoRegistryMirrors/d20ac12e48cea/docker.log due to failure\r\n    Error: aborting artifact upload\r\n    Total file count: 211 ---- Processed file #165 (78.1%)\r\n    A 503 status code has been received, will attempt to retry the upload\r\n    Exponential backoff for retry #1. Waiting for 5799 milliseconds before continuing the upload at offset 0\r\n\r\nAs a result, the \"Download reports\" continued retrying:\r\n\r\n    ...\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n    An error occurred while attempting to download a file\r\n    Error: Request timeout: /Y2huPMnV2RyiTvKoReSyXTCrcRyxUdSDRZYoZr0ONBvpl5e9Nu/_apis/resources/Containers/8331549?itemPath=integration-reports%2Fubuntu-20.04%2Fbundles%2Ftest-integration%2FTestCreateWithDuplicateNetworkNames%2Fd47798cc212d1%2Fdocker.log\r\n        at ClientRequest.<anonymous> (/home/runner/work/_actions/actions/download-artifact/v3/dist/index.js:3681:26)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at ClientRequest.emit (node:events:513:28)\r\n        at TLSSocket.emitRequestTimeout (node:_http_client:839:9)\r\n        at Object.onceWrapper (node:events:627:28)\r\n        at TLSSocket.emit (node:events:525:35)\r\n        at TLSSocket.Socket._onTimeout (node:net:550:8)\r\n        at listOnTimeout (node:internal/timers:559:17)\r\n        at processTimers (node:internal/timers:502:7)\r\n    Exponential backoff for retry #1. Waiting for 5305 milliseconds before continuing the download\r\n    Total file count: 1004 ---- Processed file #436 (43.4%)\r\n\r\nAnd, it looks like GitHub doesn't allow cancelling the job, possibly because it is defined with `if: always()`?\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 111,
        "deletions": 61,
        "changed_files": 4,
        "created_at": "2023-08-21T16:02:01Z",
        "closed_at": "2023-08-23T16:57:54Z",
        "merged_at": "2023-08-23T16:57:54Z",
        "body": "- Fixes: https://github.com/moby/moby/issues/46248\r\n- addresses https://github.com/docker/for-mac/issues/6853#issuecomment-1680977603\r\n\r\n**- What I did**\r\nFix running containers with empty `Image`.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\nc8d integration tests (https://github.com/moby/moby/pull/45232) from `TestDockerCLIBuildSuite`:\r\n```diff\r\n- DONE 250 tests, 13 skipped, 58 failures in 352.552s\r\n+ DONE 250 tests, 13 skipped, 42 failures in 406.027s\r\n```\r\n\r\n**Before**\r\n```bash\r\n$ printf 'FROM scratch\\nLABEL asdf=1' | DOCKER_BUILDKIT=0 docker build -t asdf -\r\nDEPRECATED: The legacy builder is deprecated and will be removed in a future release.\r\n            BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0\r\n            environment-variable.\r\n\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/2 : FROM scratch\r\n --->\r\nStep 2/2 : LABEL asdf=1\r\ninvalid reference format\r\n```\r\n\r\n**After**\r\n```bash\r\n$ printf 'FROM scratch\\nLABEL asdf=1' | DOCKER_BUILDKIT=0 docker build -t asdf -\r\nDEPRECATED: The legacy builder is deprecated and will be removed in a future release.\r\n            BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0\r\n            environment-variable.\r\n\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/2 : FROM scratch\r\n --->\r\nStep 2/2 : LABEL asdf=1\r\n ---> Running in 08bc1d65adb1\r\n ---> Removed intermediate container 08bc1d65adb1\r\n ---> 7072ecaf239f\r\nSuccessfully built 7072ecaf239f\r\nSuccessfully tagged asdf:latest\r\n```\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\ncontainerd integration: Fix building Dockerfiles with `FROM scratch` instruction when using the legacy builder (non buildkit).\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 19,
        "changed_files": 6,
        "created_at": "2023-08-20T17:31:42Z",
        "closed_at": "2023-08-23T12:13:26Z",
        "merged_at": "2023-08-23T12:13:26Z",
        "body": "\"Pay no attention to the implementation behind the curtain!\"\r\n\r\nThere's only one implementation of the Sandbox interface, and only one implementation of the Info interface, and they both happens to be implemented by the same type: networkNamespace. Let's merge these interfaces.\r\n\r\nAnd now that we know that there's one, and only one Info, we can drop the charade, and relieve the Sandbox from its dual personality.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 29,
        "deletions": 39,
        "changed_files": 4,
        "created_at": "2023-08-20T17:09:16Z",
        "closed_at": "2023-08-23T12:16:23Z",
        "merged_at": "2023-08-23T12:16:23Z",
        "body": "Use the only implementation (EndpointInterface) instead.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 4,
        "deletions": 5,
        "changed_files": 2,
        "created_at": "2023-08-19T11:20:08Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Related to:\r\n\r\n- https://github.com/moby/moby/pull/46188\r\n\r\n**- What I did**\r\n\r\nIf a single error is passed to `multierror.Join`, `joinError.Error()` returns the error as is. However, due to the multiline formatting applied otherwise, it's better to add a line break between the preamble and the multierror string when wrapping it, eg.:\r\n\r\n```golang\r\nfmt.Errorf(\"invalid network config:\\n%w\", multierror.Join(errs...))\r\n```\r\n\r\nThis commit removes this special case to make the format consistent no matter how many errors are joined:\r\n\r\n```\r\n# Before\r\ninvalid network config:\r\nsome error\r\n\r\n# After\r\ninvalid network config:\r\n* some error\r\n```",
        "comments": 5
    },
    {
        "merged": false,
        "additions": 159,
        "deletions": 138,
        "changed_files": 6,
        "created_at": "2023-08-19T11:20:01Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- follow-up to https://github.com/moby/moby/pull/44697\r\n- relates to https://github.com/moby/moby/pull/13835\r\n- relates to https://github.com/moby/moby/pull/35441\r\n- addresses / fixes https://github.com/moby/moby/issues/40176\r\n\r\n\r\nWhile working on some changes, I noticed that a file I was editing was a generated file; https://github.com/moby/moby/blob/cf15460a3b9d23334fcc063ff1396844b16fa11d/volume/drivers/proxy.go#L1\r\n\r\nHowever, the header didn't have the [correct format for generated files](https://pkg.go.dev/cmd/go@go1.21.0#hdr-Generate_Go_files_by_processing_source) so didn't warn me about this, so I thought: \"let me update the template to have the right comment\". To verify my changes, I ran `make generated-files`, which didn't complain, but did not update the generated file. When I tried to manually `go generate` the file, the file _did_ change, but also generated _very_ different code.\r\n\r\nSo, looking at the file's history (perhaps I used the wrong command for generating the file?), I found various manual changes were made to this file in the past, but CI never complained about this :thinking:\r\n\r\nIn short: this PR is the result of one of those \"down the rabbit-hole\" cases:\r\n\r\n- Update the template to actually generate the expected code.\r\n- Update the template to have a correctly formatted \"this is a generated file\" comment.\r\n- Fix the `make generated-files` target to also include this file (fun fact: it **was** generating the file, but not copying it out, and because of that, was not validating it for changes).\r\n- And finally: update the template with some of the changes I was about to make manually, and to make the code slightly more iodiomatic.\r\n\r\n. Looking at the history of the file, I then noticed that the file was manually updated a few times in the past.\r\n\r\n### pkg/plugins: pluginrpc-gen: fix go generate for volume driver\r\n\r\nThe volume driver plugin generated code was manually updated in\r\nb15f8d2d4f054a87052a7065c50441f7e8479fa9, so generating the code\r\nwould no longer produce the same output.\r\n\r\nThis patch updates the generator code to allow regenerating the volume\r\ndriver plugin.\r\n\r\n- update buildImports to allow additional imports to be passed\r\n- add a conditional block to the template for volumeDriver\r\n- add a conditional block to set the right timeout, depending on what\r\n  method we're generating code for.\r\n- slightly adjust the template to make the output format match the\r\n  existing code.\r\n\r\nSome of this is a bit quirky, so we should look for a more generic option,\r\nbut I tried to preserve the ability to generate this code, so that it\r\ncan evolve if things change.\r\n\r\nTo verify the generated code:\r\n\r\n    GO111MODULE=off go install ./pkg/plugins/pluginrpc-gen\r\n    GO111MODULE=off go generate ./volume/drivers\r\n\r\n### hack: generate-files.Dockerfile: validate volume/drivers\r\n\r\nMaybe this was left out on purpose in 7daaa001205c259be30b479aeea28a11ec775ef5,\r\nbecause the `pluginrpc-gen` generator was broken for this code, but now\r\nthat the generator works correctly, we can enable generating this package,\r\nand validate it in CI.\r\n\r\nThe Dockerfile was actually building `pluginrpc-gen` and generating the\r\nplugin (`volume/drivers`), but was not copying the result, and as a result\r\nalso not validating the results.\r\n\r\n### hack: generate-files.Dockerfile: simplify pluginrpc-gen install\r\n\r\npluginrpc-gen is also \"go install\"-able (if there's a go.mod), so let's\r\nuse it :)\r\n\r\n### pkg/plugins: pluginrpc-gen: fix \"generated code\" header to be detected\r\n\r\nUpdate the comment to match the format defined by [Golang][1], otherwise\r\nit won't be detected by IDEs and linters.\r\n\r\n[1]: https://pkg.go.dev/cmd/go@go1.21.0#hdr-Generate_Go_files_by_processing_source\r\n\r\n\r\nWith this change, my IDE properly picks up that the file is generated:\r\n\r\n<img width=\"699\" alt=\"Screenshot 2023-08-19 at 12 01 36\" src=\"https://github.com/moby/moby/assets/1804568/04e0f07b-8745-4b00-804a-45fe7c0d0b3e\">\r\n\r\n\r\n### pkg/plugins: pluginrpc-gen: use struct-literals in generated code\r\n\r\nMakes the generated code slightly nicer :)\r\n\r\n\r\n### pkg/plugins: pluginrpc-gen: use early return on error\r\n\r\nDon't assign output variables if an error occurred.\r\n\r\n### pkg/plugins: pluginrpc-gen: assert interface\r\n\r\nMake sure the generated code matches the interface, and produce a\r\ncompile-time error otherwise.\r\n\r\n### pkg/plugins: pluginrpc-gen: fix generating logger plugin\r\n\r\nMake the generator work for generating daemon/logger/logPluginProxy.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![down-the-rabbit-hole](https://github.com/moby/moby/assets/1804568/b40e7f46-dcd4-4255-bc34-f3d15cbb8c3f)\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-08-19T06:36:18Z",
        "closed_at": "2023-08-19T09:19:13Z",
        "merged_at": "2023-08-19T09:19:13Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\nfixes https://github.com/moby/moby/issues/46272\r\n\r\n**- What I did**\r\n\r\n`bin-image` workflow will push the moby-bin image on git push events but it is not intended to be done from forks.\r\n\r\n**- How I did it**\r\n\r\nCheck repo origin on git push events.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\ncc @TBBle",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 11,
        "deletions": 24,
        "changed_files": 4,
        "created_at": "2023-08-18T20:37:41Z",
        "closed_at": "2023-08-21T19:43:04Z",
        "merged_at": "2023-08-21T19:43:04Z",
        "body": "- Replacement for https://github.com/moby/moby/pull/46267, which was opened from the wrong branch\r\n\r\n**- What I did**\r\n\r\nMove GHA-related arguments out of the bakefile and into the GHA workflows, and clean up the metadata applied to `moby-bin` builds.\r\n\r\nI'm not entirely thrilled with the end state, but this is less invasive than the more aggressive refactors I have in mind; in general these variables are a nightmare to manage, and we should really have something better. Today is not that day, however.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-18T19:30:42Z",
        "closed_at": "2023-08-21T10:30:55Z",
        "merged_at": "2023-08-21T10:30:55Z",
        "body": "This is something that stood out to me: removing the intermediate container is part of a build step, but unlike the other output from the build, wasn't indented (and prefixed with `--->`) to be shown as part of the build.\r\n\r\nThis patch adds the `--->` prefix, to make it clearer what step the removal was part of.\r\n\r\nWhile at it, I also updated the message itself: this output is printed _after_ the intermediate container has been removed, so we may as well make it match reality, so I changed \"removing\" to \"removed\".\r\n\r\nBefore:\r\n\r\n\r\n```bash\r\necho -e 'FROM busybox\\nRUN echo hello > /dev/null\\nRUN echo world > /dev/null\\n' | DOCKER_BUILDKIT=0 docker build --no-cache -\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/3 : FROM busybox\r\n ---> a416a98b71e2\r\nStep 2/3 : RUN echo hello > /dev/null\r\n ---> Running in a1a65b9365ac\r\nRemoving intermediate container a1a65b9365ac\r\n ---> 8c6b57ebebdd\r\nStep 3/3 : RUN echo world > /dev/null\r\n ---> Running in 9fa977b763a5\r\nRemoving intermediate container 9fa977b763a5\r\n ---> 795c1f2fc7b9\r\nSuccessfully built 795c1f2fc7b9\r\n```\r\n\r\nAfter:\r\n\r\n```bash\r\necho -e 'FROM busybox\\nRUN echo hello > /dev/null\\nRUN echo world > /dev/null\\n' | DOCKER_BUILDKIT=0 docker build --no-cache -\r\nSending build context to Docker daemon  2.048kB\r\nStep 1/3 : FROM busybox\r\n ---> fc9db2894f4e\r\nStep 2/3 : RUN echo hello > /dev/null\r\n ---> Running in 38d7c34c2178\r\n ---> Removed intermediate container 38d7c34c2178\r\n ---> 7c0dbc45111d\r\nStep 3/3 : RUN echo world > /dev/null\r\n ---> Running in 629620285d4c\r\n ---> Removed intermediate container 629620285d4c\r\n ---> b92f70f2e57d\r\nSuccessfully built b92f70f2e57d\r\n```\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 40,
        "deletions": 23,
        "changed_files": 3,
        "created_at": "2023-08-18T14:24:35Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Move the initialization logic to the attachContext itself, so that\r\nthe container doesn't have to be aware about mutexes and other logic.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 13,
        "deletions": 24,
        "changed_files": 6,
        "created_at": "2023-08-18T14:11:07Z",
        "closed_at": "2023-08-18T20:09:33Z",
        "merged_at": null,
        "body": "**- What I did**\r\n\r\nRemove GHA-specific variables from the bakefile, and moderately clean up the metadata we build `moby-bin` images with, making it more clear these are nightly builds.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 121,
        "deletions": 10,
        "changed_files": 3,
        "created_at": "2023-08-18T13:33:45Z",
        "closed_at": "2023-08-21T10:50:22Z",
        "merged_at": "2023-08-21T10:50:22Z",
        "body": "- backport: https://github.com/moby/moby/pull/46189\r\n\r\n\r\n\r\n\r\n**- What I did**\r\nUse refcounted mounter introduced in #45698 when doing diff and export. This is to reuse already mounted rootfs of a container and avoid breaking overlay by mounting an workdir layer as a lowerdir of other mounts.\r\n\r\nAlso added an integration test to verify.\r\n\r\n\r\n**- How I did it**\r\nSee individual commits.\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_FILTER='TestOverlayfs' test-integration\r\n```\r\n\r\n<details>\r\n<summary>Test with #45698 reverted</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n    overlayfs_test.go:80: diff caused overlayfs kernel warning: <4>[520803.140901] overlayfs: lowerdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/export\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520803.156318] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520803.156462] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_to_container\r\n    overlayfs_test.go:80: cp to container caused overlayfs kernel warning: <4>[520803.177945] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: cp to container caused overlayfs kernel warning: <4>[520803.178382] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_from_container\r\n    overlayfs_test.go:80: cp from container caused overlayfs kernel warning: <4>[520803.193088] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: cp from container caused overlayfs kernel warning: <4>[520803.193471] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n--- FAIL: TestOverlayfs (1.07s)\r\n    --- FAIL: TestOverlayfs/diff (0.02s)\r\n    --- FAIL: TestOverlayfs/export (0.02s)\r\n    --- FAIL: TestOverlayfs/cp_to_container (0.02s)\r\n    --- FAIL: TestOverlayfs/cp_from_container (0.02s)\r\nFAIL\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Before this PR</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n    overlayfs_test.go:80: diff caused overlayfs kernel warning: <4>[520341.301322] overlayfs: lowerdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/export\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520341.314918] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520341.315250] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_to_container\r\n=== RUN   TestOverlayfs/cp_from_container\r\n--- FAIL: TestOverlayfs (1.02s)\r\n    --- FAIL: TestOverlayfs/diff (0.02s)\r\n    --- FAIL: TestOverlayfs/export (0.02s)\r\n    --- PASS: TestOverlayfs/cp_to_container (0.01s)\r\n    --- PASS: TestOverlayfs/cp_from_container (0.01s)\r\nFAIL\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>After this PR</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n=== RUN   TestOverlayfs/export\r\n=== RUN   TestOverlayfs/cp_to_container\r\n=== RUN   TestOverlayfs/cp_from_container\r\n--- PASS: TestOverlayfs (1.07s)\r\n    --- PASS: TestOverlayfs/diff (0.04s)\r\n    --- PASS: TestOverlayfs/export (0.02s)\r\n    --- PASS: TestOverlayfs/cp_to_container (0.01s)\r\n    --- PASS: TestOverlayfs/cp_from_container (0.01s)\r\nPASS\r\n\r\nDONE 5 tests in 3.427s\r\n```\r\n\r\n</details>\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-18T13:14:32Z",
        "closed_at": "2023-09-01T13:04:27Z",
        "merged_at": "2023-09-01T13:04:27Z",
        "body": "\n<!--\nPlease make sure you've read and understood our contributing guidelines;\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\n\n** Make sure all your commits include a signature generated with `git commit -s` **\n\nFor additional information on our contributing process, read our contributing\nguide https://docs.docker.com/opensource/code/\n\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\n\"closes #xxxx\"\n\nPlease provide the following information:\n-->\n\n**- What I did**\n\nUpdated the description in the API docs to clarify that this is the endpoint to use if you want to pull an image. This is not immediately clear from the endpoint name.\n\n**- How I did it**\n\n**- How to verify it**\n\n**- Description for the changelog**\n<!--\nWrite a short (one line) summary that describes the changes in this\npull request for inclusion in the changelog:\n-->\n\n\n**- A picture of a cute animal (not mandatory but encouraged)**\n\n\udb84\uddeb\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 173,
        "deletions": 167,
        "changed_files": 2,
        "created_at": "2023-08-18T11:13:18Z",
        "closed_at": "2023-08-23T12:13:53Z",
        "merged_at": "2023-08-23T12:13:53Z",
        "body": "Just a minor reorganisation; move options together into a dedicated file.\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-18T11:13:04Z",
        "closed_at": "2023-08-18T12:58:18Z",
        "merged_at": "2023-08-18T12:58:18Z",
        "body": "- backport: https://github.com/moby/moby/pull/46261\r\n\r\nActive count is incremented, but message claimed the opposite.\r\n\r\nSigned-off-by: Pawe\u0142 Gronowski <pawel.gronowski@docker.com>\r\n(cherry picked from commit 7f965d55c719b8777221c4dbf9a1eb93cfada8ab)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 41,
        "deletions": 46,
        "changed_files": 1,
        "created_at": "2023-08-18T11:09:43Z",
        "closed_at": "2023-08-23T12:22:33Z",
        "merged_at": "2023-08-23T12:22:33Z",
        "body": "extracting some commits from another branch I was working on\r\n\r\n### libnetwork: resolver: remove setCommonFlags, use createRespMsg\r\n\r\nThis function was added in 36fd9d02be9014b8016adb5d255cdacd6dc9e64d (libnetwork: https://github.com/moby/libnetwork/commit/ce6c6e8c350aed8e3de1910c571b93c2f4d69a8b),\r\nbecause there were multiple places where a DNS response was created,\r\nwhich had to use the same options. However, new \"common\" options were\r\nadded since, and having it in a function separate from the other (also\r\ncommon) options was just hiding logic, so let's remove it.\r\n\r\nWhat the above probably _should_ have done was to create a common utility\r\nto create a DNS response (as all other options are shared as well). This\r\nwas actually done in 0c22e1bd07d75f7a719fe72e466a8ff6dadfd167 (libnetwork: https://github.com/moby/libnetwork/commit/be3531759b8025fcfeec765101c0d018a86981fc),\r\nwhich added a `createRespMsg` utility, but missed that it could be used\r\nfor both cases.\r\n\r\nThis patch:\r\n\r\n- removes the setCommonFlags function\r\n- uses createRespMsg instead to share common options\r\n\r\n### libnetwork: resolver: remove some intermediate variables\r\n\r\nUse struct-literals where possible for slightly more readable code.\r\n\r\n### libnetwork: resolver: Resolver.dialExtDNS use joinHostPort and cleanup\r\n\r\nSlightly refactor Resolver.dialExtDNS:\r\n\r\n- use net.JoinHostPort to properly format IPv6 addresses\r\n- define a const for the default port, and avoid int ->  string\r\n  conversion if no custom port is defined\r\n- slightly simplify logic if the HostLoopback is used (at the cost of\r\n  duplicating one line); in that case we don't need to define the closure\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-18T09:39:54Z",
        "closed_at": "2023-08-18T10:50:38Z",
        "merged_at": "2023-08-18T10:50:38Z",
        "body": "Active count is incremented, but message claimed the opposite.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-18T07:49:06Z",
        "closed_at": "2023-08-18T10:52:11Z",
        "merged_at": "2023-08-18T10:52:11Z",
        "body": "- backport: https://github.com/moby/moby/pull/46130\r\n- backport: https://github.com/moby/moby/pull/46257\r\n- backport: https://github.com/moby/moby/pull/46259\r\n\r\nI forgot to backport the first PR and a second fix on master was made.\r\nBackport all fixes to the 24.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-08-17T19:18:39Z",
        "closed_at": "2023-08-17T20:50:57Z",
        "merged_at": "2023-08-17T20:50:57Z",
        "body": "- Follow-up to https://github.com/moby/moby/pull/46257, which was mildly incorrect for reasons of YAML indentation (but should have been caught due to reordering of the block \ud83d\ude05)",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-17T17:43:20Z",
        "closed_at": "2023-08-17T19:12:23Z",
        "merged_at": "2023-08-17T19:12:23Z",
        "body": "**- What I did**\r\n\r\nEnsure that `GitCommit` is populated in `GET /version` by setting `DOCKER_GITCOMMIT` in moby-bin builds.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n`docker version`\r\n\r\n**- Description for the changelog**\r\nN/A\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 14,
        "changed_files": 3,
        "created_at": "2023-08-17T17:25:05Z",
        "closed_at": "2023-08-18T12:15:00Z",
        "merged_at": "2023-08-18T12:15:00Z",
        "body": "fixes #46255\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nSwitch to known base image for windows dev container so we can avoid relying on local tag `microsoft/windowsservercore` and therefore avoid checking and pulling the upstream image unnecessarily. That would save ~4m.\r\n\r\n**- How I did it**\r\n\r\nRemoves `microsoft/windowsservercore` refs and set defaults as build arguments.\r\n\r\n**- How to verify it**\r\n\r\nCI\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 92,
        "deletions": 9,
        "changed_files": 4,
        "created_at": "2023-08-17T14:57:09Z",
        "closed_at": "2023-08-29T17:57:41Z",
        "merged_at": "2023-08-29T17:57:41Z",
        "body": "- Replaces: https://github.com/moby/moby/pull/46152\r\n- addresses https://github.com/moby/moby/issues/46148\r\n- addresses https://github.com/docker/for-linux/issues/1470\r\n\r\nOn startup all local volumes were unmounted as a cleanup mechanism for the non-clean exit of the last engine process.\r\n\r\nThis caused live-restored volumes that used special volume opt mount flags to be broken. While the refcount was restored, the _data directory was just unmounted, so all new containers mounting this volume would just have the access to the empty _data directory instead of the real volume.\r\n\r\nWith this patch, the mountpoint isn't unmounted. Instead, if the volume is already mounted, just mark it as mounted, so the next time Mount is called only the ref count is incremented, but no second attempt to mount it is performed.\r\n\r\n**- What I did**\r\nFixed the case where live-restore of volumes that specified custom volume opts wouldn't work properly.\r\n\r\n**- How I did it**\r\nSee commits.\r\n\r\n**- How to verify it**\r\nCI\r\n\r\n**- Description for the changelog**\r\n```release-notes\r\n- Fixed a bug which caused named volumes that set custom `device` or `type` volume option to be unmounted when restarting the daemon and not live-restoring it properly.\r\n```\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 6
    },
    {
        "merged": false,
        "additions": 93,
        "deletions": 42,
        "changed_files": 3,
        "created_at": "2023-08-17T13:19:01Z",
        "closed_at": null,
        "merged_at": null,
        "body": "When resolving names in swarm mode, services with exposed ports are connected to user overlay network, ingress network, and local (docker_gwbridge) networks. Name resolution should prioritize returning the VIP/IPs on user overlay network over ingress and local networks.\r\n\r\nSandbox.ResolveName implemented this by taking the list of endpoints, splitting the list into 3 separate lists based on the type of network that the endpoint was attached to (dynamic, ingress, local), and then creating a new list, applying the networks in that order.\r\n\r\nThis patch refactors that logic to use a custom sorter (sort.Interface), which makes the code more transparent, and prevents iterating over the list of endpoints multiple times.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 58,
        "deletions": 258,
        "changed_files": 19,
        "created_at": "2023-08-17T12:40:26Z",
        "closed_at": "2023-09-12T14:53:15Z",
        "merged_at": "2023-09-12T14:53:15Z",
        "body": "**- What I did**\r\n\r\nFixes #18864, #20648, #33561, #40901 (and probably more).\r\n\r\n[This GH comment][1] makes clear network name uniqueness has never been enforced due to the eventually consistent nature of Classic Swarm datastores:\r\n\r\n> there is no guaranteed way to check for duplicates across a cluster of docker hosts.\r\n\r\nAnd this is further confirmed by other comments made by @mrjana in that same issue, eg. [this one][2]:\r\n\r\n> we want to adopt a schema which can pave the way in the future for a completely decentralized cluster of docker hosts (if scalability is needed).\r\n\r\nThis decentralized model is what Classic Swarm was trying to be. It's been superseded since then by Docker Swarm, which has a centralized control plane.\r\n\r\nTo circumvent this drawback, the `NetworkCreate` endpoint accepts a `CheckDuplicate` flag. However it's not perfectly reliable as it won't catch concurrent requests.\r\n\r\nDue to this design decision, API clients like Compose have to implement workarounds to make sure names are really unique (eg. docker/compose#9585). And the daemon itself has seen a string of issues due to that decision, including some that aren't fixed to this day (for instance moby/moby#40901):\r\n\r\n> The problem is, that if you specify a network for a container using the ID, it will add that network to the container but it will then change it to reference the network by using the name.\r\n\r\nTo summarize, this \"feature\" is broken, has no practical use and is a source of pain for Docker users and API consumers. So let's just remove it for _all_ API versions.\r\n\r\n[1]: https://github.com/moby/moby/issues/18864#issuecomment-167201414\r\n[2]: https://github.com/moby/moby/issues/18864#issuecomment-167202589\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n<img src=\"https://i.natgeofe.com/k/80385d2b-cf77-43eb-9589-a2c9229401bd/quokka-selfie-smile.jpg\" width=50% height=50% />",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 49,
        "deletions": 47,
        "changed_files": 1,
        "created_at": "2023-08-16T15:42:12Z",
        "closed_at": "2023-08-23T12:17:39Z",
        "merged_at": "2023-08-23T12:17:39Z",
        "body": "- un-export ZoneSettings, because it's only used internally\r\n- make conversion to a \"interface\" slice a method on the struct\r\n- remove the getDockerZoneSettings() function, and move the type-definition close to where it's used, as it was only used in a single location\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 19,
        "deletions": 6,
        "changed_files": 1,
        "created_at": "2023-08-16T15:28:53Z",
        "closed_at": "2023-08-23T17:38:09Z",
        "merged_at": "2023-08-23T17:38:09Z",
        "body": "This test didn't make a lot of sense, because `checkRunning()` depends on the `connection` package-var being set, which is done by `firewalldInit()`, so would never be true on its own.\r\n\r\nAdd a small utility that opens its own D-Bus connection to verify if firewalld is running, and otherwise skips the tests (preserving any error in the process).\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-16T15:25:59Z",
        "closed_at": "2023-08-23T17:58:19Z",
        "merged_at": "2023-08-23T17:58:19Z",
        "body": "DelInterfaceFirewalld returns an error if the interface to delete was not found. Let's ignore cases where we were successfully able to get the list of interfaces in the zone, but the interface was not part of the zone.\r\n\r\nThis patch changes the error for these cases to an errdefs.ErrNotFound, and updates IPTable.ProgramChain to ignore those errors.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 18,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-08-16T13:29:44Z",
        "closed_at": "2023-08-18T13:36:26Z",
        "merged_at": "2023-08-18T13:36:26Z",
        "body": "- backport: https://github.com/moby/moby/pull/46238\r\n\r\n(cherry picked from commit a64adda4e77890f8b126cf7a723f27735a07e5d2)\r\n\r\n**- What I did**\r\nFixed failure to inspect image if any of its present manifest references an image config which isn't present locally.\r\n\r\n**- How I did it**\r\nIgnore c8d `NotFound` error when \r\n\r\n**- How to verify it**\r\n```bash\r\n$ docker pull busybox:1.36.1\r\n$ docker pull --platform linux/amd64 busybox:1.36.1\r\n$ ctr content rm sha256:a416a98b71e224a31ee99cff8e16063554498227d2b696152a9c3e0aa65e5824 # Delete amd64 config\r\n```\r\n\r\n**Before**\r\n```\r\n$ docker image inspect busybox:1.36.1\r\n[]\r\nError response from daemon: failed to read config content: content digest sha256:a416a98b71e224a31ee99cff8e16063554498227d2b696152a9c3e0aa65e5824: not found\r\n```\r\n\r\n**After**\r\n```json\r\n$ docker image inspect busybox:1.36.1\r\n[\r\n    {\r\n        \"Id\": \"sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79\",\r\n        \"RepoTags\": [\r\n            \"busybox:latest\"\r\n        ],\r\n        \"RepoDigests\": [\r\n            \"busybox@sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79\"\r\n        ],\r\n        (...)\r\n        \"Architecture\": \"arm64\",\r\n        \"Variant\": \"v8\",\r\n        \"Os\": \"linux\",\r\n        \"Size\": 1920927,\r\n        \"VirtualSize\": 1920927,\r\n        (...)\r\n    }\r\n]\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 16,
        "changed_files": 1,
        "created_at": "2023-08-16T12:57:09Z",
        "closed_at": "2023-08-17T21:49:56Z",
        "merged_at": "2023-08-17T21:49:56Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46242\r\n- relates to https://github.com/moby/moby/pull/46108\r\n\r\n\r\n### libnetwork: remove deprecated scope consts\r\n\r\nRemoves the deprecated consts, which moved to a separate \"scope\" package\r\nin commit 6ec03d6745dc986d5175ac8270bb9052e04c1c2c, and are no longer used;\r\n\r\n- datastore.LocalScope\r\n- datastore.GlobalScope\r\n- datastore.SwarmScope\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 9,
        "deletions": 18,
        "changed_files": 5,
        "created_at": "2023-08-16T12:54:54Z",
        "closed_at": "2023-08-17T19:35:45Z",
        "merged_at": "2023-08-17T19:35:45Z",
        "body": "Remove uses of deprecated datastore.LocalScope const\r\n\r\nfull diff: https://github.com/moby/swarmkit/compare/60421a63a7f1...3f2e40b3ed5167a50b3205973a73b0b2ea049810\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 66,
        "deletions": 43,
        "changed_files": 1,
        "created_at": "2023-08-16T11:30:43Z",
        "closed_at": "2023-08-23T12:19:27Z",
        "merged_at": "2023-08-23T12:19:27Z",
        "body": "### libnetwork: Controller.NewNetwork: use named error-return\r\n\r\nIt's used in various defers, but was using `err` as name, which can be\r\nconfusing, and increases the risk of accidentally shadowing the error.\r\n\r\nThis patch:\r\n\r\n- introduces a `retErr` output variable, to be used in defer statements.\r\n- explicitly changes some `err` uses to locally-scoped variables.\r\n- moves some variable definitions closer to where they're used (where possible).\r\n\r\nWhile working on this change, there was one point in the code where\r\nerror handling was ambiguous. I added a note for that, in case this\r\nwas not a bug:\r\n\r\n> This code was previously assigning the error to the global \"err\"\r\n> variable (before it was renamed to \"retErr\"), but in case of a\r\n> \"MaskableError\" did not *return* the error:\r\n> https://github.com/moby/moby/blob/b325dcbff60a04cedbe40eb627465fc7379d05bf/libnetwork/controller.go#L566-L573\r\n>\r\n> Depending on code paths further down, that meant that this error\r\n> was either overwritten by other errors (and thus not handled in\r\n> defer statements) or handled (if no other code was overwriting it.\r\n>\r\n> I suspect this was a bug (but possible without effect), but it could\r\n> have been intentional. This logic is confusing at least, and even\r\n> more so combined with the handling in defer statements that check for\r\n> both the \"err\" return AND \"skipCfgEpCount\":\r\n> https://github.com/moby/moby/blob/b325dcbff60a04cedbe40eb627465fc7379d05bf/libnetwork/controller.go#L586-L602\r\n>\r\n> To save future visitors some time to dig up history:\r\n>\r\n> - config-only networks were added in 25082206df465d1c11dd1276a65b4a1dc701bd43 (https://github.com/moby/libnetwork/pull/1742)\r\n> - the special error-handling and \"skipCfgEpcoung\" was added in ddd22a819867faa0cd7d12b0c3fad1099ac3eb26 (https://github.com/moby/libnetwork/pull/2415)\r\n> - and updated in 87b082f3659f9ec245ab15d781e6bfffced0af83 to don't use string-matching (https://github.com/moby/libnetwork/pull/2459)\r\n\r\n\r\n### libnetwork: Controller.NewSandbox: use named error-return\r\n\r\nIt's used in various defers, but was using `err` as name, which can be\r\nconfusing, and increases the risk of accidentally shadowing the error.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 14,
        "changed_files": 3,
        "created_at": "2023-08-16T09:39:04Z",
        "closed_at": "2023-08-22T08:50:36Z",
        "merged_at": "2023-08-22T08:50:36Z",
        "body": "\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 18,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-08-16T09:35:28Z",
        "closed_at": "2023-08-18T13:35:44Z",
        "merged_at": "2023-08-18T13:35:44Z",
        "body": "\r\n**- What I did**\r\nFixed failure to inspect image if any of its present manifest references an image config which isn't present locally.\r\n\r\n**- How I did it**\r\nIgnore c8d `NotFound` error when reading config in `walkImageManifests`.\r\n\r\n**- How to verify it**\r\n```bash\r\n$ docker pull busybox:1.36.1\r\n$ docker pull --platform linux/amd64 busybox:1.36.1\r\n$ ctr content rm sha256:a416a98b71e224a31ee99cff8e16063554498227d2b696152a9c3e0aa65e5824 # Delete amd64 config\r\n```\r\n\r\n**Before**\r\n```\r\n$ docker image inspect busybox:1.36.1\r\n[]\r\nError response from daemon: failed to read config content: content digest sha256:a416a98b71e224a31ee99cff8e16063554498227d2b696152a9c3e0aa65e5824: not found\r\n```\r\n\r\n**After**\r\n```json\r\n$ docker image inspect busybox:1.36.1\r\n[\r\n    {\r\n        \"Id\": \"sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79\",\r\n        \"RepoTags\": [\r\n            \"busybox:latest\"\r\n        ],\r\n        \"RepoDigests\": [\r\n            \"busybox@sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79\"\r\n        ],\r\n        (...)\r\n        \"Architecture\": \"arm64\",\r\n        \"Variant\": \"v8\",\r\n        \"Os\": \"linux\",\r\n        \"Size\": 1920927,\r\n        \"VirtualSize\": 1920927,\r\n        (...)\r\n    }\r\n]\r\n```\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 242,
        "deletions": 123,
        "changed_files": 4,
        "created_at": "2023-08-15T23:59:41Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- relates to https://github.com/moby/moby/pull/46190 https://github.com/moby/moby/pull/46190#discussion_r1291052416\r\n- [x] depends on https://github.com/moby/moby/pull/46245\r\n- [x] depends on https://github.com/moby/moby/pull/46246\r\n- [x] depends on https://github.com/moby/moby/pull/46247\r\n- [x] depends on https://github.com/moby/moby/pull/46304\r\n\r\n### libnetwork/iptables: un-export Conn\r\n\r\nUn-export Conn, as it's only used internally. Rename it to firewalldConnection,\r\nto make clearer what it's used for, and rename the sysconn field.\r\n\r\nlibnetwork/iptables: firewalldInit: move error message to newConnection\r\n\r\nMove generating the error-message to where we know what the cause is,\r\ninstead of assuming we're unable to make a D-Bus connection.\r\n\r\n### libnetwork/iptables: firewalldInit: move error message to newConnection\r\n\r\nMove generating the error-message to where we know what the cause is,\r\ninstead of assuming we're unable to make a D-Bus connection.\r\n\r\n### libnetwork/iptables: make newConnection() slightly more idiomatic\r\n\r\nDon't consider a connection successful if firewalld is not running. If\r\nit's not running, return a suitable error message. We only use the D-Bus\r\nconnection to communicate with firewalld, so no need to return a connection\r\nif it's not running.\r\n\r\n### libnetwork/iptables: make signalHandler a method\r\n\r\nMake it a method on the firewalldConnection, which felt more natural\r\nthan being implemented as a standalone function that depended on the\r\npackage-level variable.\r\n\r\n### libnetwork/iptables: move setting up signals into handleSignals\r\n\r\nnewConnection was setting up these listeners, but in the event we\r\nfailed to check if firewalld was running, we would error-out, and\r\nclose the connection.\r\n\r\nLooking at b052827e025267336f0d426df44ec536745821f8, all of this code\r\nis directly related to handling signals, so let's combine this into the\r\nhandleSignals method.\r\n\r\n\r\n\r\n### libnetwork/iptables: make setupDockerZone a method\r\n\r\nMake it a method on the firewalldConnection, which felt more natural\r\nthan being implemented as a standalone function that depended on the\r\npackage-level variable.\r\n\r\nAlso improve some error-messages to include context about the failure.\r\n\r\n\r\n### libnetwork/iptables: make firewalldInit more atomic \r\n\r\nfirewalldInit was returning an error if we failed to set up the docker\r\nzone, but did not close the D-Bus connection. Given that we consider\r\nfirewalld to \"not be usable\" in case of an error, let's also close\r\nthe connection;\r\n\r\n    unable to initialize firewalld; using raw iptables instead\r\n\r\nAnd return the connection on success, instead of implicitly setting the\r\npackage-level `firewalld` variable.\r\n\r\n\r\n### libnetwork/iptables: remove firewalldRunning package-var\r\n\r\nMake the firewalld status a property of firewalldConnection, so that all\r\nstatus is captured in the `firewalld` instance.\r\n\r\nfirewalldInit() already checks if firewalld is running when initializing,\r\nin which case the `firewalld` variable would be nil.\r\n\r\nWhile refactoring, also use an `atomic.Bool`; the running-status can be\r\nupdated as part of `startSignalHandler()`, which means that there's a\r\npotential concurrency-issue with other code accessing the firewalld\r\nstatus.\r\n\r\n### libnetwork/iptables: implement addInterface/delInterface methods\r\n\r\nMove the implementation from AddInterfaceFirewalld and DelInterfaceFirewalld\r\nto a method on firewalldConnection, but keeping the exported utility-functions.\r\n\r\n### libnetwork/iptables: register callbacks on firewalldConnection\r\n\r\nRegister callbacks on the firewalldConnection instance instead of a global\r\nvariable. These callbacks should only be needed if firewalld is initialized\r\nand running, so associate them with the firewalldConnection that we created.\r\n\r\n\r\n### libnetwork/iptables: Passthrough: re-use IPVersion type\r\n\r\nUse the existing IPVersion type to switch between ipv4 and ipv6. The IPV\r\ntype was only used for this function, and currently required callers to\r\nmap a IPVersion to IPV.\r\n\r\n### libnetwork/iptables: implement passthrough as method\r\n\r\nMove the Passthrough implementation to a method on firewalldConnection,\r\nand add a check if firewalld is initialized and running.\r\n\r\n### libnetwork/iptables: move firewalld helpers together\r\n\r\nMove the exported helpers to a separate file.\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-08-15T22:27:18Z",
        "closed_at": "2023-08-16T09:24:45Z",
        "merged_at": "2023-08-16T09:24:44Z",
        "body": "This function has _four_ output variables of the same type, and several defer statements that checked the error returned (but using the `err` variable).\r\n\r\nThis patch names the return variables to make it clearer what's being returned, and renames the error-return to `retErr` to make it clearer where we're dealing with the returned error (and not any local err), to prevent accidentally shadowing.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 10,
        "deletions": 0,
        "changed_files": 3,
        "created_at": "2023-08-14T17:35:11Z",
        "closed_at": null,
        "merged_at": null,
        "body": "**- What I did**\r\n\r\n- Moved integration/internal/termtest/stripansi.go to integration/internal/termtest/stripansi_windows.go in order to pull \"github.com/Azure/go-ansiterm\"  on Windows system only.\r\n\r\n- written a dummy stripansi_default.go for other platforms.\r\n\r\n**- How I did it**\r\n\r\nwith mv and kwrite.\r\n\r\n**- How to verify it**\r\n\r\nRun tests on various platforms, for which I don't have access to. But the change is trivial.\r\n\r\n\r\n**- Description for the changelog**\r\n\r\n-  Make integration/internal/termtest Windows-only\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\nThis is a [Lykoi cat](https://en.m.wikipedia.org/wiki/Lykoi):\r\n\r\n![301189136_1257635511671283_4619588125750006623_n](https://github.com/moby/moby/assets/30413512/7b75259b-8e18-4dc0-8eaa-df56b58622f1)\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 407,
        "changed_files": 4,
        "created_at": "2023-08-14T16:55:03Z",
        "closed_at": "2023-08-16T15:53:16Z",
        "merged_at": "2023-08-16T15:53:16Z",
        "body": "backport of:\r\n\r\n- https://github.com/moby/moby/pull/44741\r\n- https://github.com/moby/moby/pull/46224\r\n\r\nMinor conflict, because this one's not in the branch:\r\n\r\n- https://github.com/moby/moby/pull/44308\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 402,
        "changed_files": 1,
        "created_at": "2023-08-14T16:53:30Z",
        "closed_at": "2023-08-15T18:29:23Z",
        "merged_at": "2023-08-15T18:29:23Z",
        "body": "- backport of https://github.com/moby/moby/pull/46224\r\n\r\n(cherry picked from commit 59aa3dce8a3abc9d6eb29df7c76b4484e8758234)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-14T15:39:33Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- partial backport of https://github.com/moby/moby/pull/46192\r\n\r\nhttps://github.com/opencontainers/runc/releases/tag/v1.1.9\r\n\r\n(cherry picked from commit b039bbc678892661e2e42fd69d7aa417887b8ecf)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-14T15:39:28Z",
        "closed_at": "2023-08-16T00:07:13Z",
        "merged_at": "2023-08-16T00:07:13Z",
        "body": "- partial backport of https://github.com/moby/moby/pull/46192\r\n\r\nhttps://github.com/opencontainers/runc/releases/tag/v1.1.9\r\n\r\n(cherry picked from commit b039bbc678892661e2e42fd69d7aa417887b8ecf)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 2,
        "created_at": "2023-08-14T15:39:24Z",
        "closed_at": "2023-08-15T22:05:07Z",
        "merged_at": "2023-08-15T22:05:06Z",
        "body": "- partial backport of https://github.com/moby/moby/pull/46192\r\n\r\nhttps://github.com/opencontainers/runc/releases/tag/v1.1.9\r\n\r\n(cherry picked from commit b039bbc678892661e2e42fd69d7aa417887b8ecf)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 5,
        "deletions": 6,
        "changed_files": 3,
        "created_at": "2023-08-14T15:08:39Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 11,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-08-14T15:00:55Z",
        "closed_at": "2023-08-23T12:19:54Z",
        "merged_at": "2023-08-23T12:19:54Z",
        "body": "### libnetwork/iptables: reduce DeleteConntrackEntriesXX debug logs\r\n\r\nBoth functions were generating debug logs if there was nothing to log.\r\nThe function already produces logs if things failed while deleting entries,\r\nso these logs would only be printed if there was nothing to delete, so can\r\nsafely be discarded.\r\n\r\nBefore this change:\r\n\r\n    DEBU[2023-08-14T12:33:23.082052638Z] Revoking external connectivity on endpoint sweet_swirles (1519f9376a3abe7a1c981600c25e8df6bbd0a3bc3a074f1c2b3bcbad0438443b)\r\n    DEBU[2023-08-14T12:33:23.085782847Z] DeleteConntrackEntries purged ipv4:0, ipv6:0\r\n    DEBU[2023-08-14T12:33:23.085793847Z] DeleteConntrackEntriesByPort for udp ports purged ipv4:0, ipv6:0\r\n\r\n\r\n### libnetwork/iptables: DeleteConntrackEntries: remove \"totals\" returns\r\n\r\nThere's nothing handling these results, and they're logged as debug-logs,\r\nso we may as well remove the returned variables.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 10,
        "deletions": 16,
        "changed_files": 2,
        "created_at": "2023-08-14T14:30:27Z",
        "closed_at": null,
        "merged_at": null,
        "body": "### daemon: Daemon.killPossiblyDeadProcess(): fix error return\r\n\r\nThis function is meant to suppress \"no such process\" errors, but was\r\nstill returning them.\r\n\r\n### daemon: Daemon.killProcessDirectly() don't return error that will be ignored\r\n\r\nDaemon.Kill is the only consumer of this function, and will ignore \"no such\r\nprocess\" errors, so simplify the code for consumers of this function to\r\nnot have to selectively ignore errors.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 402,
        "changed_files": 1,
        "created_at": "2023-08-14T12:33:55Z",
        "closed_at": "2023-08-14T16:45:36Z",
        "merged_at": "2023-08-14T16:45:36Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\ncloses #42496\r\ncloses #42495\r\ncloses #42494\r\ncloses #42468\r\ncloses #23626 \r\n\r\n**- What I did**\r\n\r\nRemoved s390x and ppc64le Jenkins pipelines.  These pipeline have been failing for an extended period of time.\r\n\r\n**- How I did it**\r\n\r\nChange is applied in Jenkinsfile.  The Jenkins agents will be disabled and removed after this PR is merged.\r\n\r\n**- How to verify it**\r\n\r\nhttps://ci-next.docker.com/public/job/moby/\r\n\r\n**- Description for the changelog**\r\n\r\nRemoved s390x and ppc64le Jenkins pipelines\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![image](https://github.com/moby/moby/assets/108835138/b0b988c1-ef74-4547-90ac-8b9a520909bf)\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-08-14T11:06:30Z",
        "closed_at": "2023-08-16T10:17:09Z",
        "merged_at": "2023-08-16T10:17:09Z",
        "body": "- relates to https://github.com/moby/moby/pull/41227\r\n\r\nThis goroutine was added in c458bca6dc25c25d3345b093592167f2bd5e4af9 (https://github.com/moby/moby/pull/41227), and looks for errors from the wait channel. If no error is returned, it attempts to start the container, and *updates* the error if a failure happened while doing so, so that the code below it can update the container's status, and perform auto-remove (if set for the container).\r\n\r\nHowever, due to the formatting of the code, it was easy to overlook that the \"err\" variable was not local to the \"if\" statement.\r\n\r\nThis patch breaks up the if-statement in an attempt to make it clearer that this is not a local \"err\" variable, and adds a code-comment explaining the logic.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 382,
        "deletions": 78,
        "changed_files": 16,
        "created_at": "2023-08-13T20:50:27Z",
        "closed_at": "2023-08-29T21:23:26Z",
        "merged_at": "2023-08-29T21:23:26Z",
        "body": "- backport of https://github.com/moby/moby/pull/45704\r\n- backport of https://github.com/moby/moby/pull/45511\r\n- Fixes #45491\r\n\r\n**- What I did**\r\n\r\n### daemon: stop setting container resources to zero\r\n\r\nMany of the fields in LinuxResources struct are pointers to scalars for some reason, presumably to differentiate between set-to-zero and unset when unmarshaling from JSON, despite zero being outside the acceptable range for the corresponding kernel tunables. When creating the OCI spec for a container, the daemon sets the container's OCI spec CPUShares and BlkioWeight parameters to zero when the corresponding Docker container configuration values are zero, signifying unset, despite the minimum acceptable value for CPUShares being two, and BlkioWeight ten. This has gone unnoticed as runC does not distingiush set-to-zero from unset as it also uses zero internally to represent unset for those fields. However, kata-containers v3.2.0-alpha.3 tries to apply the explicit-zero resource parameters to the container, exactly as instructed, and fails loudly. The OCI runtime-spec is silent on how the runtime should handle the case when those parameters are explicitly set to out-of-range values and kata's behaviour is not unreasonable, so the daemon must therefore be in the wrong.\r\n\r\nTranslate unset values in the Docker container's resources HostConfig to omit the corresponding fields in the container's OCI spec when starting and updating a container in order to maximize compatibility with runtimes.\r\n\r\n\r\n\r\n### Do not drop effective&permitted set\r\n\r\nCurrently moby drops ep sets before the entrypoint is executed. This does mean that with combination of no-new-privileges the file capabilities stops working with non-root containers. This is undesired as the usability of such containers is harmed comparing to running root containers.\r\n\r\nThis commit therefore sets the effective/permitted set in order to allow use of file capabilities or libcap(3)/prctl(2) respectively with combination of no-new-privileges and without respectively.\r\n\r\nFor no-new-privileges the container will be able to obtain capabilities that are requested.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nUse the below as Dockerfile\r\n```\r\nFROM alpine\r\nRUN apk add --update libcap\r\n\r\nRUN ls -la /usr/sbin/capsh\r\nRUN setcap 'cap_sys_admin=ep' /usr/sbin/capsh\r\n```\r\n\r\n`docker run --security-opt=no-new-privileges --user=100 --cap-add sys_admin <tag of the build Dockerfile> capsh --print`\r\n\r\nYou should see `Current: = cap_sys_admin+ep` rather than `Current:`\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 163,
        "deletions": 13,
        "changed_files": 4,
        "created_at": "2023-08-13T20:48:23Z",
        "closed_at": "2023-08-15T22:05:39Z",
        "merged_at": "2023-08-15T22:05:39Z",
        "body": "- backport of https://github.com/moby/moby/pull/45511\r\n- Fixes #45491\r\n\r\n**- What I did**\r\n\r\nCurrently moby drops ep sets before the entrypoint is executed. This does mean that with combination of no-new-privileges the file capabilities stops working with non-root containers. This is undesired as the usability of such containers is harmed comparing to running root containers.\r\n\r\nThis commit therefore sets the effective/permitted set in order to allow use of file capabilities or libcap(3)/prctl(2) respectively with combination of no-new-privileges and without respectively.\r\n\r\nFor no-new-privileges the container will be able to obtain capabilities that are requested.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\nUse the below as Dockerfile\r\n```\r\nFROM alpine\r\nRUN apk add --update libcap\r\n\r\nRUN ls -la /usr/sbin/capsh\r\nRUN setcap 'cap_sys_admin=ep' /usr/sbin/capsh\r\n```\r\n\r\n`docker run --security-opt=no-new-privileges --user=100 --cap-add sys_admin <tag of the build Dockerfile> capsh --print`\r\n\r\nYou should see `Current: = cap_sys_admin+ep` rather than `Current:`\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 5,
        "created_at": "2023-08-13T20:23:36Z",
        "closed_at": "2023-08-15T22:06:25Z",
        "merged_at": "2023-08-15T22:06:25Z",
        "body": "- backport of https://github.com/moby/moby/pull/45929\r\n- included https://github.com/moby/moby/pull/45304/commits/7665feeb528d02021b943aed3655eff5eca96598 for a clean cherry-pick\r\n\r\n---\r\n\r\n**- What I did**\r\nDon't use Git to find the repository root as it won't work inside the build environment.\r\nThis allows us to use `with-go-mod.sh` during build and will make updating the `go 1.xx` line easier to manage.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n![](https://media.discordapp.net/attachments/704333319697072231/1128319736598495252/20230711_153934.jpg?width=1072&height=804)\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 497,
        "deletions": 143,
        "changed_files": 19,
        "created_at": "2023-08-13T20:15:34Z",
        "closed_at": "2023-08-15T22:06:38Z",
        "merged_at": "2023-08-15T22:06:38Z",
        "body": "- backport of https://github.com/moby/moby/pull/46118\r\n\r\n---\r\n\r\n### vendor github.com/containerd/ttrpc v1.1.2\r\n\r\nfull diff: https://github.com/containerd/ttrpc/compare/v1.1.1...v1.1.2\r\n\r\n\r\n### vendor: containerd binary to v1.6.22\r\n\r\n- full diff: https://github.com/containerd/containerd/compare/v1.6.21...v1.6.22\r\n- release notes: https://github.com/containerd/containerd/releases/tag/v1.6.22\r\n\r\n---\r\n\r\nNotable Updates\r\n\r\n- RunC: Update runc binary to v1.1.8\r\n- CRI: Fix `additionalGids`: it should fallback to `imageConfig.User`\r\n  when `securityContext.RunAsUser`, `RunAsUsername` are empty\r\n- CRI: Write generated CNI config atomically\r\n- Fix concurrent writes for `UpdateContainerStats`\r\n- Make `checkContainerTimestamps` less strict on Windows\r\n- Port-Forward: Correctly handle known errors\r\n- Resolve `docker.NewResolver` race condition\r\n- SecComp: Always allow `name_to_handle_at`\r\n- Adding support to run hcsshim from local clone\r\n- Pinned image support\r\n- Runtime/V2/RunC: Handle early exits w/o big locks\r\n- CRITool: Move up to CRI-TOOLS v1.27.0\r\n- Fix cpu architecture detection issue on emulated ARM platform\r\n- Task: Don't `close()` io before `cancel()`\r\n- Fix panic when remote differ returns empty result\r\n- Plugins: Notify readiness when registered plugins are ready\r\n- Unwrap io errors in server connection receive error handling\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-08-13T20:03:05Z",
        "closed_at": "2023-08-30T21:43:40Z",
        "merged_at": "2023-08-30T21:43:40Z",
        "body": "- backport of https://github.com/moby/moby/pull/46091\r\n- (hopefully) fixes / addresses https://github.com/docker/for-win/issues/13600\r\n\r\n\r\nGo 1.15.7 contained a security fix for CVE-2021-3115, which allowed arbitrary code to be executed at build time when using cgo on Windows.\r\n\r\nThis issue was not limited to the go command itself, and could also affect binaries that use `os.Command`, `os.LookPath`, etc.\r\n\r\nFrom the related blogpost (https://blog.golang.org/path-security):\r\n\r\n> Are your own programs affected?\r\n>\r\n> If you use exec.LookPath or exec.Command in your own programs, you only need to\r\n> be concerned if you (or your users) run your program in a directory with untrusted\r\n> contents. If so, then a subprocess could be started using an executable from dot\r\n> instead of from a system directory. (Again, using an executable from dot happens\r\n> always on Windows and only with uncommon PATH settings on Unix.)\r\n>\r\n> If you are concerned, then we\u2019ve published the more restricted variant of os/exec\r\n> as golang.org/x/sys/execabs. You can use it in your program by simply replacing\r\n\r\nAt time of the go1.15 release, the Go team considered changing the behavior of `os.LookPath()` and `exec.LookPath()` to be a breaking change, and made the behavior \"opt-in\" by providing the `golang.org/x/sys/execabs` package as a replacement.\r\n\r\nHowever, for the go1.19 release, this changed, and the default behavior of `os.LookPath()` and `exec.LookPath()` was changed. From the release notes: https://go.dev/doc/go1.19#os-exec-path\r\n\r\n> Command and LookPath no longer allow results from a PATH search to be found\r\n> relative to the current directory. This removes a common source of security\r\n> problems but may also break existing programs that depend on using, say,\r\n> exec.Command(\"prog\") to run a binary named prog (or, on Windows, prog.exe)\r\n> in the current directory. See the os/exec package documentation for information\r\n> about how best to update such programs.\r\n>\r\n> On Windows, Command and LookPath now respect the NoDefaultCurrentDirectoryInExePath\r\n> environment variable, making it possible to disable the default implicit search\r\n> of \u201c.\u201d in PATH lookups on Windows systems.\r\n\r\nA result of this change was that registering the daemon as a Windows service no longer worked when done from within the directory of the binary itself:\r\n\r\n    C:\\> cd \"Program Files\\Docker\\Docker\\resources\"\r\n    C:\\Program Files\\Docker\\Docker\\resources> dockerd --register-service\r\n    exec: \"dockerd\": cannot run executable found relative to current directory\r\n\r\nNote that using an absolute path would work around the issue:\r\n\r\n    C:\\Program Files\\Docker\\Docker>resources\\dockerd.exe --register-service\r\n\r\nThis patch changes `registerService()` to use `os.Executable()`, instead of depending on `os.Args[0]` and `exec.LookPath()` for resolving the absolute path of the binary.\r\n\r\n\r\n(cherry picked from commit 3e8fda0a709bb7e706547d7b656e380eba965995)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-08-13T20:02:45Z",
        "closed_at": "2023-08-30T21:43:34Z",
        "merged_at": "2023-08-30T21:43:34Z",
        "body": "- backport of https://github.com/moby/moby/pull/46091\r\n- (hopefully) fixes / addresses https://github.com/docker/for-win/issues/13600\r\n\r\nGo 1.15.7 contained a security fix for CVE-2021-3115, which allowed arbitrary code to be executed at build time when using cgo on Windows.\r\n\r\nThis issue was not limited to the go command itself, and could also affect binaries that use `os.Command`, `os.LookPath`, etc.\r\n\r\nFrom the related blogpost (https://blog.golang.org/path-security):\r\n\r\n> Are your own programs affected?\r\n>\r\n> If you use exec.LookPath or exec.Command in your own programs, you only need to\r\n> be concerned if you (or your users) run your program in a directory with untrusted\r\n> contents. If so, then a subprocess could be started using an executable from dot\r\n> instead of from a system directory. (Again, using an executable from dot happens\r\n> always on Windows and only with uncommon PATH settings on Unix.)\r\n>\r\n> If you are concerned, then we\u2019ve published the more restricted variant of os/exec\r\n> as golang.org/x/sys/execabs. You can use it in your program by simply replacing\r\n\r\nAt time of the go1.15 release, the Go team considered changing the behavior of `os.LookPath()` and `exec.LookPath()` to be a breaking change, and made the behavior \"opt-in\" by providing the `golang.org/x/sys/execabs` package as a replacement.\r\n\r\nHowever, for the go1.19 release, this changed, and the default behavior of `os.LookPath()` and `exec.LookPath()` was changed. From the release notes: https://go.dev/doc/go1.19#os-exec-path\r\n\r\n> Command and LookPath no longer allow results from a PATH search to be found\r\n> relative to the current directory. This removes a common source of security\r\n> problems but may also break existing programs that depend on using, say,\r\n> exec.Command(\"prog\") to run a binary named prog (or, on Windows, prog.exe)\r\n> in the current directory. See the os/exec package documentation for information\r\n> about how best to update such programs.\r\n>\r\n> On Windows, Command and LookPath now respect the NoDefaultCurrentDirectoryInExePath\r\n> environment variable, making it possible to disable the default implicit search\r\n> of \u201c.\u201d in PATH lookups on Windows systems.\r\n\r\nA result of this change was that registering the daemon as a Windows service no longer worked when done from within the directory of the binary itself:\r\n\r\n    C:\\> cd \"Program Files\\Docker\\Docker\\resources\"\r\n    C:\\Program Files\\Docker\\Docker\\resources> dockerd --register-service\r\n    exec: \"dockerd\": cannot run executable found relative to current directory\r\n\r\nNote that using an absolute path would work around the issue:\r\n\r\n    C:\\Program Files\\Docker\\Docker>resources\\dockerd.exe --register-service\r\n\r\nThis patch changes `registerService()` to use `os.Executable()`, instead of depending on `os.Args[0]` and `exec.LookPath()` for resolving the absolute path of the binary.\r\n\r\n\r\n(cherry picked from commit 3e8fda0a709bb7e706547d7b656e380eba965995)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-08-13T20:02:20Z",
        "closed_at": "2023-08-15T22:06:58Z",
        "merged_at": "2023-08-15T22:06:58Z",
        "body": "- backport of https://github.com/moby/moby/pull/46091\r\n- (hopefully) fixes / addresses https://github.com/docker/for-win/issues/13600\r\n\r\nGo 1.15.7 contained a security fix for CVE-2021-3115, which allowed arbitrary code to be executed at build time when using cgo on Windows.\r\n\r\nThis issue was not limited to the go command itself, and could also affect binaries that use `os.Command`, `os.LookPath`, etc.\r\n\r\nFrom the related blogpost (https://blog.golang.org/path-security):\r\n\r\n> Are your own programs affected?\r\n>\r\n> If you use exec.LookPath or exec.Command in your own programs, you only need to\r\n> be concerned if you (or your users) run your program in a directory with untrusted\r\n> contents. If so, then a subprocess could be started using an executable from dot\r\n> instead of from a system directory. (Again, using an executable from dot happens\r\n> always on Windows and only with uncommon PATH settings on Unix.)\r\n>\r\n> If you are concerned, then we\u2019ve published the more restricted variant of os/exec\r\n> as golang.org/x/sys/execabs. You can use it in your program by simply replacing\r\n\r\nAt time of the go1.15 release, the Go team considered changing the behavior of `os.LookPath()` and `exec.LookPath()` to be a breaking change, and made the behavior \"opt-in\" by providing the `golang.org/x/sys/execabs` package as a replacement.\r\n\r\nHowever, for the go1.19 release, this changed, and the default behavior of `os.LookPath()` and `exec.LookPath()` was changed. From the release notes: https://go.dev/doc/go1.19#os-exec-path\r\n\r\n> Command and LookPath no longer allow results from a PATH search to be found\r\n> relative to the current directory. This removes a common source of security\r\n> problems but may also break existing programs that depend on using, say,\r\n> exec.Command(\"prog\") to run a binary named prog (or, on Windows, prog.exe)\r\n> in the current directory. See the os/exec package documentation for information\r\n> about how best to update such programs.\r\n>\r\n> On Windows, Command and LookPath now respect the NoDefaultCurrentDirectoryInExePath\r\n> environment variable, making it possible to disable the default implicit search\r\n> of \u201c.\u201d in PATH lookups on Windows systems.\r\n\r\nA result of this change was that registering the daemon as a Windows service no longer worked when done from within the directory of the binary itself:\r\n\r\n    C:\\> cd \"Program Files\\Docker\\Docker\\resources\"\r\n    C:\\Program Files\\Docker\\Docker\\resources> dockerd --register-service\r\n    exec: \"dockerd\": cannot run executable found relative to current directory\r\n\r\nNote that using an absolute path would work around the issue:\r\n\r\n    C:\\Program Files\\Docker\\Docker>resources\\dockerd.exe --register-service\r\n\r\nThis patch changes `registerService()` to use `os.Executable()`, instead of depending on `os.Args[0]` and `exec.LookPath()` for resolving the absolute path of the binary.\r\n\r\n\r\n(cherry picked from commit 3e8fda0a709bb7e706547d7b656e380eba965995)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 15,
        "deletions": 8,
        "changed_files": 1,
        "created_at": "2023-08-13T19:55:26Z",
        "closed_at": "2023-08-15T22:07:36Z",
        "merged_at": "2023-08-15T22:07:36Z",
        "body": "- backport of https://github.com/moby/moby/pull/45649\r\n- fixes https://github.com/moby/moby/issues/45460\r\n\r\n\r\nIPv6 ipt rules are exactly the same as IPv4 rules, although both protocol don't use the same networking model. This has bad consequences, for instance: 1. the current v6 rules disallow Neighbor Solication/Advertisement ; 2. multicast addresses can't be used ; 3. link-local addresses are blocked too.\r\n\r\nTo solve this, this commit changes the following rules:\r\n\r\n```\r\n-A DOCKER-ISOLATION-STAGE-1 ! -s fdf1:a844:380c:b247::/64 -o br-21502e5b2c6c -j DROP\r\n-A DOCKER-ISOLATION-STAGE-1 ! -d fdf1:a844:380c:b247::/64 -i br-21502e5b2c6c -j DROP\r\n```\r\n\r\ninto:\r\n\r\n```\r\n-A DOCKER-ISOLATION-STAGE-1 ! -s fdf1:a844:380c:b247::/64 ! -i br-21502e5b2c6c   -o br-21502e5b2c6c -j DROP\r\n-A DOCKER-ISOLATION-STAGE-1 ! -d fdf1:a844:380c:b247::/64   -i br-21502e5b2c6c ! -o br-21502e5b2c6c -j DROP\r\n```\r\n\r\nThese rules only limit the traffic ingressing/egressing the bridge, but not traffic between veth on the same bridge.\r\n\r\nNote that, the Kernel takes care of dropping invalid IPv6 packets, eg. loopback spoofing, thus these rules don't need to be more specific.\r\n\r\nSolve #45460.\r\n\r\n\r\n(cherry picked from commit da9e44a620db39307f5548a1451be9c434c5b34d)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 58,
        "deletions": 45,
        "changed_files": 7,
        "created_at": "2023-08-13T19:49:08Z",
        "closed_at": "2023-08-24T11:34:44Z",
        "merged_at": "2023-08-24T11:34:44Z",
        "body": "- addresses https://github.com/moby/moby/pull/46213\r\n\r\n### daemon: cleanupContainer: don't fail if container is already stopped\r\n\r\nSaw this failure in a flaky test, and I wondered why we consider this an\r\nerror condition;\r\n\r\n    === RUN   TestKillWithStopSignalAndRestartPolicies\r\n        main_test.go:32: assertion failed: error is not nil: Error response from daemon: Could not kill running container 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7, cannot remove - Container 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7 is not running: failed to remove 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7\r\n    --- FAIL: TestKillWithStopSignalAndRestartPolicies (0.84s)\r\n    === RUN   TestKillWithStopSignalAndRestartPolicies/same-signal-disables-restart-policy\r\n        --- PASS: TestKillWithStopSignalAndRestartPolicies/same-signal-disables-restart-policy (0.42s)\r\n    === RUN   TestKillWithStopSignalAndRestartPolicies/different-signal-keep-restart-policy\r\n        --- PASS: TestKillWithStopSignalAndRestartPolicies/different-signal-keep-restart-policy (0.23s)\r\n\r\nIn the above;\r\n\r\n1. `Error response from daemon: Could not kill running container 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7`\r\n2. `cannot remove - Container 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7 is not running`\r\n3. `failed to remove 668f62511f4aa62357269cd405cff1fbe295b7f6d5011e7cfed434e3072330b7`\r\n\r\nSo it looks like the removal fails because we couldn't kill the container\r\nbecause it was already stopped, which may be a race condition where the first\r\ncheck shows the container to be running (but may already be in process to be\r\nremoved or killed. In either case, we probably shouldn't fail the removal if\r\nthe container is already stopped.\r\n\r\nThis patch adds a `isNotRunning()` utility, so that we can ignore this case,\r\nand proceed with the removal.\r\n\r\n### daemon: cleanupContainer: slightly cleanup error messages\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 138,
        "deletions": 92,
        "changed_files": 4,
        "created_at": "2023-08-12T19:40:44Z",
        "closed_at": "2023-08-24T17:23:18Z",
        "merged_at": "2023-08-24T17:23:18Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46209\r\n- related: https://github.com/moby/moby/issues/46210\r\n\r\n----\r\n\r\n### daemon: remove Daemon.checkContainer and related utils\r\n\r\nThis was added in 12485d62eeba27119260dc5eb54ac4fa83c3130b to save some\r\nduplication, but was really over-engineered to save a few lines of code,\r\nat the cost of hiding away what it does and also potentially returning\r\ninconsistent errors (not addressed in this patch). Let's start with\r\ninlining these.\r\n\r\nThis removes;\r\n\r\n- Daemon.checkContainer\r\n- daemon.containerIsRunning\r\n- daemon.containerIsNotRestarting\r\n\r\n### daemon: WithNamespaces(): inline variables\r\n\r\n### daemon: WithNamespaces(): use OCI-spec consts for namespaces\r\n\r\n### daemon: WithNamespaces(): use switch instead of if/else if/else\r\n\r\nWe were using a mixture of approaches for these; aligning them a bit\r\nto all use switch statements.\r\n\r\n### daemon: WithNamespaces(): remove redundant \"if\"\r\n\r\nThis check was originally used to only validate the mode if it was set to\r\na non-empty value (see commit 072400fc4b8d6a38a2007d41072b765666a4c288), but\r\nvalidation was made unconditional in c3d7a0c6033a2764dd85c3863809ac498ef129f2.\r\n\r\nGiven that a `CgroupnsMode` can't be both [`CgroupnsMode.IsEmpty()`][1]\r\nand [`CgroupnsMode.IsPrivate`][2], we can remove the extra check.\r\n\r\n[1]: https://github.com/moby/moby/blob/e0da5cb9291982a4c7b3c6b0642eeced4ba9f8ac/api/types/container/hostconfig.go#L33-L36\r\n[2]: https://github.com/moby/moby/blob/e0da5cb9291982a4c7b3c6b0642eeced4ba9f8ac/api/types/container/hostconfig.go#L23-L26\r\n\r\n\r\n### daemon: WithNamespaces(): fix incorrect error for PID namespace\r\n\r\n`Daemon.getPidContainer()` was wrapping the error-message with a message\r\n(\"cannot join PID of a non running container\") that did not reflect the\r\nactual reason for the error; `Daemon.GetContainer()` could either return\r\nan invalid parameter (invalid / empty identifier), or a \"not found\" error\r\nif the specified container-ID could not be found.\r\n\r\nIn the latter case, we don't want to return a \"not found\" error through\r\nthe API, as this would indicate that the container we're _starting_ was\r\nnot found (which is not the case), so we need to convert the error into\r\nan `errdefs.ErrInvalidParameter` (the container-ID specified for the PID\r\nnamespace is invalid if the container doesn't exist).\r\n\r\nThis logic is similar to what we do for IPC namespaces. which received\r\na similar fix in c3d7a0c6033a2764dd85c3863809ac498ef129f2.\r\n\r\nIt's worth noting that, while `WithNamespaces()` may return an \"invalid\r\nparameter\" error, the `start` endpoint itself may _not_ be. as outlined\r\nin commit bf1fb97575ae0c929075f8340d7deb4ae9f41fae, starting a container\r\nthat has an invalid configuration should be considered an internal server\r\nerror, and is not an invalid _request_. However, for uses other than\r\ncontainer \"start\", `WithNamespaces()` should return the correct error\r\nto allow code to handle it accordingly.\r\n\r\n\r\n### daemon: Daemon.getPidContainer: change to accept \"id\" argument\r\n\r\nThis function didn't need the whole container, only its ID, so let's\r\nuse that as argument. This also makes it consistent with getIpcContainer.\r\n\r\n\r\n### daemon: Daemon.getIpcContainer: make errors less repetitive\r\n\r\n- Most error-message returned would already include \"container\" and the\r\n  container ID in the error-message (e.g. \"container %s is not running\"),\r\n  so there's no need to add a custom prefix for that.\r\n- os.Stat returns a PathError, which already includes the operation (\"stat\"),\r\n  the path, and the underlying error that occurred.\r\n\r\nAnd while updating, let's also fix the name to be proper camelCase :)\r\n\r\n### daemon: WithNamespaces(): add notes about user-namespaces\r\n\r\nWhile working on this code, I noticed that there's currently an issue\r\nwith userns enabled. When userns is enabled, joining another container's\r\nnamespace must also join its user-namespace.\r\n\r\nHowever, a container can only be in a single user namespace, so if a\r\ncontainer joins namespaces from multiple containers, latter user-namespaces\r\noverwrite former ones.\r\n\r\nWe must add validation for this, but in the meantime, add notes / todo's.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 35,
        "deletions": 30,
        "changed_files": 2,
        "created_at": "2023-08-12T17:09:59Z",
        "closed_at": "2023-08-14T11:55:30Z",
        "merged_at": "2023-08-14T11:55:30Z",
        "body": "### integration/internal/container: remove import aliases\r\n\r\nSome files used aliases, others didn't, and they didn't appear to be\r\nrequired.\r\n\r\n### integration/internal/container: add WithPIDMode option\r\n\r\nSome files used aliases, others didn't, and they didn't appear to be\r\nrequired.\r\n\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-08-12T17:07:02Z",
        "closed_at": "2023-08-14T08:41:42Z",
        "merged_at": "2023-08-14T08:41:42Z",
        "body": "\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 8,
        "deletions": 11,
        "changed_files": 1,
        "created_at": "2023-08-12T17:04:53Z",
        "closed_at": "2023-08-23T17:56:02Z",
        "merged_at": "2023-08-23T17:56:02Z",
        "body": "### daemon: withLibnetwork(): use OCI-spec consts for namespaces\r\n\r\n### daemon: withLibnetwork(): return early if networking is disabled\r\n\r\nThe function was checking in a loop if networking for the container was\r\ndisabled. Change the function to return early, and to only set hooks\r\nif one needs to be set.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 87,
        "deletions": 92,
        "changed_files": 6,
        "created_at": "2023-08-12T16:03:31Z",
        "closed_at": "2023-08-21T19:21:16Z",
        "merged_at": "2023-08-21T19:21:16Z",
        "body": "## libnetwork: implement Controller.GetSandbox, remove Controller.WalkSandboxes and related code\r\n\r\n### libnetwork: remove unused SandboxKeyWalker\r\n\r\n### libnetwork: remove redundant sandboxTable type\r\n\r\nIt was not exported so let's remove the abstraction to not make it look\r\nlike something more than it is.\r\n\r\n### libnetwork: parallelTester: move vars closer to where they're used\r\n\r\n### libnetwork: implement Controller.GetSandbox(containerID)\r\n\r\nVarious parts of the code were using \"walkers\" to iterate over the\r\ncontroller's sandboxes, and the only condition for all of them was\r\nto find the sandbox for a given container-ID. Iterating over all\r\nsandboxes was also sub-optimal, because on Windows, the ContainerID\r\nis used as Sandbox-ID, which can be used to lookup the sandbox from\r\nthe \"sandboxes\" map on the controller.\r\n\r\nThis patch implements a GetSandbox method on the controller that\r\nlooks up the sandbox for a given container-ID, using the most optimal\r\napproach (depending on the platform).\r\n\r\nThe new method can return errors for invalid (empty) container-IDs, and\r\na \"not found\" error to allow consumers to detect non-existing sandboxes,\r\nor potentially invalid IDs.\r\n\r\nThis new method replaces the (non-exported) Daemon.getNetworkSandbox(),\r\nwhich was only used internally, in favor of directly accessing the\r\ncontroller's method.\r\n\r\n### libnetwork: remove Controller.WalkSandboxes and related code\r\n\r\nThis functionality has been replaced with Controller.GetSandbox, and is\r\nno longer used anywhere.\r\n\r\nThis patch removes:\r\n\r\n- the Controller.WalkSandboxes method\r\n- the SandboxContainerWalker SandboxWalker\r\n- the SandboxWalker type\r\n\r\n### libnetwork: remove Controller.Sandboxes as it's no longer used\r\n\r\nThe Controller.Sandboxes method was used by some SandboxWalkers. Now\r\nthat those have been removed, there are no longer any consumers of this\r\nmethod, so let's remove it for now.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 51,
        "deletions": 29,
        "changed_files": 10,
        "created_at": "2023-08-12T15:58:45Z",
        "closed_at": "2023-08-23T12:21:30Z",
        "merged_at": "2023-08-23T12:21:30Z",
        "body": "- relates to https://github.com/moby/moby/pull/46149\r\n\r\n### libnetwork/osl: use filepath.Join() only when changing basedir\r\n\r\nUse filepath.Join() only when the base-path is updated, instead of every\r\ntime it is accessed.\r\n\r\n### libnetwork/options: OptionExecRoot: skip osl.SetBasePath on non-Linux\r\n\r\nThe basepath is only used on Linux, so no need to call it on other\r\nplatforms. SetBasePath was already stubbed out on other platforms,\r\nbut \"osl\" was still imported in various places where it was not actually\r\nused, so trying to reduce imports to get a better picture of what parts\r\nare used (and not used).\r\n\r\n### libnetwork: un-export SetExternalKey\r\n\r\nIt's only called as part of the \"libnetwork-setkey\" re-exec, so un-exporting\r\nit to make clear it's not for external use.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 4,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-12T15:56:12Z",
        "closed_at": null,
        "merged_at": null,
        "body": "relates to:\r\n\r\n- https://github.com/moby/libnetwork/pull/515\r\n- https://github.com/moby/moby/pull/20662\r\n- https://github.com/moby/libnetwork/issues/829\r\n- https://github.com/moby/libnetwork/pull/921\r\n\r\n\r\nSupport for \"libnetwork-setkey\" re-exec was added in libnetwork in commit [6175353964906b1279cd3477437b15cca9b1a2e0][1] (https://github.com/moby/libnetwork/pull/515) which included a test for both Sandbox.SetKey, and setting the key through the \"libnetwork-setkey\" re-exec.\r\n\r\nDuring the integration with [containerd 1.0][2], it was found that the re-exec hook used the wrong type (https://github.com/moby/libnetwork/issues/829):\r\n\r\n> In https://github.com/docker/libnetwork/blob/df3f8a10796e2173732aeafa41af45f970ced9f6/sandbox_externalkey_unix.go#L48\r\n> the code is expecting libcontainer.State as input but data provided by\r\n> libcontainer actually has the type libcontainer/configs.HookState.\r\n>\r\n> That means that this data doesn't contain netns path and the SetKey should not work.\r\n\r\nThis issue was fixed in [e84aad941e0577ee501de9b5ba9667e2f5daf38f][3] (https://github.com/moby/libnetwork/pull/921), but lacking a test-environment, the `TestExternalKeyWithReexec` test was removed.\r\n\r\n[1]: https://github.com/moby/libnetwork/commit/6175353964906b1279cd3477437b15cca9b1a2e0\r\n[2]: https://github.com/moby/moby/pull/20662\r\n[3]: https://github.com/moby/libnetwork/commit/e84aad941e0577ee501de9b5ba9667e2f5daf38f\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 30,
        "deletions": 40,
        "changed_files": 2,
        "created_at": "2023-08-12T13:25:32Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Slight refactor to somewhat future-proof these functions and prevent accidental shadowing of the error that's handled in defer statements (Daemon.ContainerRename is still messy and could still use some improvements)\r\n\r\n### daemon: Daemon.connectToNetwork: rename named return to prevent shadowing\r\n\r\nThe output var was used in a `defer`, but named `err` and shadowed in various\r\nplaces. Rename the var to a more explicit name to make clear where it's used\r\nand to prevent it being accidentally shadowed.\r\n\r\n### daemon: Daemon.ContainerRename: use named return to prevent shadowing\r\n\r\nThe output var was used in a `defer`. Rename the var to a more explicit\r\nname to make clear where it's used and to prevent it being accidentally\r\nshadowed.\r\n\r\n### daemon: Daemon.ContainerRename: move vars closer to where they're used\r\n\r\nAlso break-up some \"if\" statements that were hiding that they were updating\r\nexisting variables.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 12,
        "deletions": 13,
        "changed_files": 4,
        "created_at": "2023-08-12T13:18:06Z",
        "closed_at": "2023-08-23T17:56:59Z",
        "merged_at": "2023-08-23T17:56:58Z",
        "body": "### libnetwork: Controller.NewSandbox: don't generate ID if not used\r\n\r\nWindows uses the container-iD as ID for sandboxes, so it's not needed to\r\ngenerate an ID  when running on Windows.\r\n\r\n### daemon: updateSandboxNetworkSettings: remove unused error-return\r\n\r\nThis function never returns an error, so let's remove the error-return,\r\nand give it a slightly more to-the-point name.\r\n\r\n### daemon/network: Settings: move sandbox fields together\r\n\r\nJust a minor nit; let's move these fields together.\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 1241,
        "deletions": 1262,
        "changed_files": 5,
        "created_at": "2023-08-11T23:30:24Z",
        "closed_at": "2023-08-15T22:11:22Z",
        "merged_at": "2023-08-15T22:11:22Z",
        "body": "- chipping away bits from https://github.com/moby/moby/pull/46149\r\n\r\n### libnetwork: rename unix-only testfiles\r\n\r\nSome tests were implicitly skipped through the `getTestEnv()` utility,\r\nwhich made it hard to discover they were not ran on Windows.\r\n\r\n### libnetwork: merge linux-only test-files\r\n\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 20,
        "deletions": 42,
        "changed_files": 17,
        "created_at": "2023-08-11T23:26:56Z",
        "closed_at": "2023-08-15T22:11:38Z",
        "merged_at": "2023-08-15T22:11:38Z",
        "body": "- chipping away bits from https://github.com/moby/moby/pull/46149\r\n\r\n### libnetwork/drivers/bridge: minor formatting fixes\r\n\r\nMy IDE kept on re-formatting, so let's do so.\r\n\r\n\r\n### libnetwork/drivers/bridge: rename some linux-only files\r\n\r\nThis makes it easier to spot if code is only used on Linux. Note that \"all of\"\r\nthe bridge driver is Linux-only.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 31,
        "deletions": 34,
        "changed_files": 3,
        "created_at": "2023-08-11T19:29:33Z",
        "closed_at": "2023-08-16T10:18:40Z",
        "merged_at": "2023-08-16T10:18:40Z",
        "body": "### daemon: Daemon.ContainerStart(): make validateState a regular function\r\n\r\nThere's no need for this to be a closure; let's just make it a regular\r\nfunction. While moving it out, also make some minor code-changes and\r\nadd some code-comments to describe the flow / intent, which may not\r\nbe trivial for people that are not familiar with these details.\r\n\r\n### daemon: remove containerNotModifiedError\r\n\r\nRemoving this type, because:\r\n\r\n- containerNotModifiedError is not an actual error, and abstracting it away\r\n  was hiding some of these details. It also wasn't used as a sentinel error\r\n  anywhere, so doesn't have to be its own type.\r\n- Defining a type just to toggle the error-message between \"not running\"\r\n  and \"not stopped\" felt a bit over-the-top, as each variant was only used once.\r\n- So  \"it only had one job\", and it didn't even do that right; it produced\r\n  capitalized error messages, which makes linters unhappy.\r\n\r\nSo, let's just inline what it does in the two places it was used.\r\n\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-11T12:48:04Z",
        "closed_at": "2023-08-11T14:18:49Z",
        "merged_at": "2023-08-11T14:18:49Z",
        "body": "Any error that occurs while creating the spec, even if it's the result of an invalid container config, must be considered a System error (internal server error), as it's not an error with the request to start the container.\r\n\r\nInvalid configuration in the config itself must be validated when creating the container (creating its config), but some errors are dependent on the current state, for example when starting a container that shares a namespace with another container, and that container is not running (or missing).\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 7,
        "changed_files": 6,
        "created_at": "2023-08-11T12:30:38Z",
        "closed_at": "2023-08-14T15:33:19Z",
        "merged_at": "2023-08-14T15:33:19Z",
        "body": "https://github.com/opencontainers/runc/releases/tag/v1.1.9",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 501,
        "deletions": 493,
        "changed_files": 39,
        "created_at": "2023-08-11T12:06:55Z",
        "closed_at": "2023-08-11T15:49:43Z",
        "merged_at": "2023-08-11T15:49:43Z",
        "body": "These changes come from a branch I was working on, and for which I needed some changes in the test-utilities.\r\n\r\nI also kept running in \"change one-variable-at-a-time\" for the `client` vars, so thought \"let's do a one-time pass to change this in these packages\".\r\n\r\n### integration/container: use consistent name for api-client\r\n\r\nThe `client` variable was colliding with the `client` import. In some cases\r\nthe confusing `cli` name (it's not the \"cli\") was used. Given that such names\r\ncan easily start spreading (through copy/paste, or \"code by example\"), let's\r\nmake a one-time pass through all of them in this package to use the same name.\r\n\r\n### integration/internal/container: use consistent name for api-client\r\n\r\nThe `client` variable was colliding with the `client` import. In some cases\r\nthe confusing `cli` name (it's not the \"cli\") was used. Given that such names\r\ncan easily start spreading (through copy/paste, or \"code by example\"), let's\r\nmake a one-time pass through all of them in this package to use the same name.\r\n\r\n### integration/internal/container: add NewTestConfig utility\r\n\r\nIntroduce a NewTestConfig utility, to allow using the available utilities\r\nfor constructing a config, and use them with the regular API client.\r\n\r\n### integration/internal/container: refactor CreateExpectingErr\r\n\r\nThis utility was only used for a single test, and it was very limited\r\nin functionality as it only allowed for a certain error-string to be\r\nmatched.\r\n\r\nLet's change it into a more generic function; a helper that allows a\r\ncontainer to be created from a `TestContainerConfig` (which can be\r\nconstructed using `NewTestConfig`) and that returns the response from\r\nclient.ContainerCreate(), so that any result from that can be tested,\r\nleaving it up to the test to check the results.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 20,
        "deletions": 17,
        "changed_files": 4,
        "created_at": "2023-08-11T00:06:30Z",
        "closed_at": null,
        "merged_at": null,
        "body": "- Fixes when docker should add the interface to the firewalld docker zone\r\n- FollowUP of Issue #45126 / PR #45127\r\n\r\nI had to open this new PR because the old one was autoclosed when I synched my fork with main repo.\r\n\r\nAfter 2 failed attempts to fix the issue, and thanks to all the feedback, I decided to create a new test environment with an Ubuntu-22.04LTS VM and a Fedora38 VM for further testing/investigation. This helped clear my mind about what icc and internal really means to docker (hopefully).\r\n\r\nAfter extensive testing, my conclusion was simple: any bridge interface with icc enabled should be added to the docker firewalld zone. The internal option is being handled correctly.\r\n\r\nAfter re-analysing the code, came up with a new possible solution.\r\n\r\n~~Here's some rationale about how I see docker bridges should behave:~~\r\n\r\n~~Internal is meant to define wether the container should communicate with other hosts, and icc is meant to allow communication between containers. Those concepts were a bit mixed in my mind before.~~\r\n\r\n~~Anyway, the current interaction of docker with firewalld does not result in the desired state, at least in an default install on Ubuntu/Fedora.~~\r\n\r\n~~I have created a test script and a compose to automate the tests, and the network section of the compose file is this:~~\r\n\r\n```yaml\r\nnetworks:\r\n\r\n  # Should communicate with containers and external hosts \r\n  default_bridge_settings:\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: docker_default\r\n\r\n  # Group1: setting enable_icc to true\r\n  \r\n  # Should communicate with containers and external hosts\r\n  icc_enabled:\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: icc\r\n      com.docker.network.bridge.enable_icc: \"true\"\r\n      \r\n  # Should communicate with containers and external hosts \r\n  icc_enabled_nointernal:\r\n    internal: false\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: icc_nointernal\r\n      com.docker.network.bridge.enable_icc: \"true\"\r\n\r\n  # Should communicate with containers ONLY\r\n  icc_enabled_internal:\r\n    internal: true\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: icc_internal\r\n      com.docker.network.bridge.enable_icc: \"true\"\r\n\r\n  # Group2: setting enable_icc to false\r\n  \r\n  # Should communicate with external hosts ONLY\r\n  icc_disabled:\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: noicc\r\n      com.docker.network.bridge.enable_icc: \"false\"\r\n\r\n  # Should communicate with external hosts ONLY\r\n  icc_disabled_nointernal:\r\n    internal: false\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: noicc_noint\r\n      com.docker.network.bridge.enable_icc: \"false\"\r\n\r\n  # Should NOT communicate with any containers or external hosts \r\n  icc_disabled_internal:\r\n    internal: true\r\n    driver: bridge\r\n    driver_opts:\r\n      com.docker.network.bridge.name: noicc_internal\r\n      com.docker.network.bridge.enable_icc: \"false\"\r\n```\r\n\r\nconsidering that the default value for internal is false AND com.docker.network.bridge.enable_icc is true, the **default_bridge_settings, icc_enabled and icc_enabled_internal** are the same, and **icc_disabled is equal to icc_disabled_nointernal**.\r\n\r\nThe only useful declarations are for icc_enabled_internal, where the network only works between the attached containers and icc_disabled/icc_disabled_nointernal where the container should communicate with external hosts only, not with other containers connected to the same bridge.\r\n\r\nicc_enabled_internal configuration is meant to create a private network to be used between a backend and frontend container, where the frontend container should be connected to another network with the icc_disabled config type to the outide world or another private network such as an nginx proxy, which is then part of another network of config icc_disabled.\r\n\r\nAND, from my observation, I believe those features only works when iptables is enabled in docker config.\r\n\r\nHere's my test results:\r\n\r\n![image](https://github.com/moby/moby/assets/834010/1d7580c7-058b-4763-8827-569fea8967b2)\r\n\r\n![image](https://github.com/moby/moby/assets/834010/2a7a04e3-edc4-4e8d-a5f5-7a6bd7d4b93f)\r\n\r\nA few notes about the above results:\r\n- I had to add ens192 to the public firewalld zone on Ubuntu, to behave exactly like Fedora when using firewalld. And the \"ens192 not in public zone\" shows the behavior of firewalld without ens192 in public zone. Fedora defaults to add the iface to the public zone.\r\n-  After re-reading the source and trying to track what exactly the code was doing with AddInterfaceFirewalld and DelInterfaceFirewalld, I hope I got it right this time.\r\n\r\nThanks for all the feedback / orientation",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 121,
        "deletions": 10,
        "changed_files": 3,
        "created_at": "2023-08-10T17:15:20Z",
        "closed_at": "2023-08-18T13:29:14Z",
        "merged_at": "2023-08-18T13:29:14Z",
        "body": "- Related to: https://github.com/moby/moby/pull/45698\r\n\r\n\r\n\r\n\r\n**- What I did**\r\nUse refcounted mounter introduced in #45698 when doing diff and export. This is to reuse already mounted rootfs of a container and avoid breaking overlay by mounting an workdir layer as a lowerdir of other mounts.\r\n\r\nAlso added an integration test to verify.\r\n\r\n\r\n**- How I did it**\r\nSee individual commits.\r\n\r\n**- How to verify it**\r\n```bash\r\n$ make DOCKER_GRAPHDRIVER=overlayfs TEST_INTEGRATION_USE_SNAPSHOTTER=1 TEST_FILTER='TestOverlayfs' test-integration\r\n```\r\n\r\n<details>\r\n<summary>Test with #45698 reverted</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n    overlayfs_test.go:80: diff caused overlayfs kernel warning: <4>[520803.140901] overlayfs: lowerdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/export\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520803.156318] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520803.156462] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_to_container\r\n    overlayfs_test.go:80: cp to container caused overlayfs kernel warning: <4>[520803.177945] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: cp to container caused overlayfs kernel warning: <4>[520803.178382] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_from_container\r\n    overlayfs_test.go:80: cp from container caused overlayfs kernel warning: <4>[520803.193088] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: cp from container caused overlayfs kernel warning: <4>[520803.193471] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n--- FAIL: TestOverlayfs (1.07s)\r\n    --- FAIL: TestOverlayfs/diff (0.02s)\r\n    --- FAIL: TestOverlayfs/export (0.02s)\r\n    --- FAIL: TestOverlayfs/cp_to_container (0.02s)\r\n    --- FAIL: TestOverlayfs/cp_from_container (0.02s)\r\nFAIL\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Before this PR</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n    overlayfs_test.go:80: diff caused overlayfs kernel warning: <4>[520341.301322] overlayfs: lowerdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/export\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520341.314918] overlayfs: upperdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n    overlayfs_test.go:80: export caused overlayfs kernel warning: <4>[520341.315250] overlayfs: workdir is in-use as upperdir/workdir of another mount, accessing files from both mounts will result in undefined behavior.\r\n=== RUN   TestOverlayfs/cp_to_container\r\n=== RUN   TestOverlayfs/cp_from_container\r\n--- FAIL: TestOverlayfs (1.02s)\r\n    --- FAIL: TestOverlayfs/diff (0.02s)\r\n    --- FAIL: TestOverlayfs/export (0.02s)\r\n    --- PASS: TestOverlayfs/cp_to_container (0.01s)\r\n    --- PASS: TestOverlayfs/cp_from_container (0.01s)\r\nFAIL\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>After this PR</summary>\r\n\r\n```\r\nINFO: Testing against a local daemon\r\n=== RUN   TestOverlayfs\r\n=== RUN   TestOverlayfs/diff\r\n=== RUN   TestOverlayfs/export\r\n=== RUN   TestOverlayfs/cp_to_container\r\n=== RUN   TestOverlayfs/cp_from_container\r\n--- PASS: TestOverlayfs (1.07s)\r\n    --- PASS: TestOverlayfs/diff (0.04s)\r\n    --- PASS: TestOverlayfs/export (0.02s)\r\n    --- PASS: TestOverlayfs/cp_to_container (0.01s)\r\n    --- PASS: TestOverlayfs/cp_from_container (0.01s)\r\nPASS\r\n\r\nDONE 5 tests in 3.427s\r\n```\r\n\r\n</details>\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 6
    },
    {
        "merged": true,
        "additions": 71,
        "deletions": 0,
        "changed_files": 2,
        "created_at": "2023-08-10T15:58:30Z",
        "closed_at": "2023-08-16T15:16:09Z",
        "merged_at": "2023-08-16T15:16:09Z",
        "body": "**- What I did**\r\n\r\nAs we have a hard time figuring out what moby/moby#46099 should look like, this drop-in replacement will solve the initial formatting problem we have. It's made internal such that we can remove it whenever we want and unlike moby/moby#46099 doesn't require thoughtful API changes.\r\n\r\n**- How I did it**\r\n\r\nThis new `joinError` has the exact same semantic has the one from stdlib. Only difference is how its `Error()` method format its message.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://www.dispatch.com/gcdn/presto/2021/11/01/NCOD/1bab0f3b-e3ff-4457-bd20-2b668627be20-A_red_squirrel_de-husks_a_walnut_in_the_writers_backyard._Jim_McCormac.jpg?width=660&height=630&fit=crop&format=pjpg&auto=webp)",
        "comments": 5
    },
    {
        "merged": true,
        "additions": 306,
        "deletions": 320,
        "changed_files": 11,
        "created_at": "2023-08-10T15:34:16Z",
        "closed_at": "2023-08-11T22:31:49Z",
        "merged_at": "2023-08-11T22:31:49Z",
        "body": "- extracting some commits from https://github.com/moby/moby/pull/46149\r\n\r\n\r\n### libnetwork: move TestDNSOptions to a non-windows file\r\n\r\nIt was only testing stub implementations on Windows that are not\r\nused in production code.\r\n\r\n### libnetwork: Resolved.SetupFunc() minor cleanup\r\n\r\nRemove intermediate variables in favor of struct-literals.\r\n\r\n### libnetwork: move resolverIPSandbox closer to where it's used\r\n\r\nIt's only used on non-Windows platforms, so let's move it there.\r\n\r\n### internal/testutils/netnsutils: move utils that were not used on Windows\r\n\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 8,
        "deletions": 0,
        "changed_files": 1,
        "created_at": "2023-08-10T14:07:02Z",
        "closed_at": null,
        "merged_at": null,
        "body": "Last week some people reported issues with ownership issues (https://github.com/docker/cli/issues/4481, https://github.com/moby/moby/issues/46161) which were reproducible only on the 20.10.25 packaged by Ubuntu (`docker.io` package). This turned out to be an issue with a `unix` build flag not being set by the used Go compiler (more specifically - unix build flag which was introduced in Go 1.19).\r\n\r\nThis PR introduces an intentional build error when building with Go older than 1.19.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 49978,
        "deletions": 334,
        "changed_files": 389,
        "created_at": "2023-08-10T11:58:55Z",
        "closed_at": "2023-08-15T22:11:59Z",
        "merged_at": "2023-08-15T22:11:59Z",
        "body": "### vendor: golang.org/x/crypto v0.3.0\r\n\r\nfull diff: https://github.com/golang/crypto/compare/v0.2.0...v0.3.0\r\n\r\n\r\n### vendor: github.com/moby/swarmkit/v2 v2.0.0-20230808164555-1983e41a9fff\r\n\r\nnotable changes:\r\n\r\n- Free unused volumes in more cases (https://github.com/moby/swarmkit/pull/3144)\r\n    - addresses https://github.com/moby/moby/issues/45547\r\n- Convert BasicKeyRequest to KeyRequest to use cloudflare/cfssl 1.x.x\r\n- reduce direct imports of logrus\r\n\r\ndiffs:\r\n\r\n- github.com/cloudflare/cfssl v1.6.4; full diff: https://github.com/cloudflare/cfssl/compare/5d63dbd981b5...v1.6.4\r\n- github.com/moby/swarmkit/v2; full diff: https://github.com/moby/swarmkit/compare/bc71908479e5...60421a63a7f148ba1ec7d35c55e4cf9ac03d6b78\r\n\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 7
    },
    {
        "merged": true,
        "additions": 427,
        "deletions": 137,
        "changed_files": 12,
        "created_at": "2023-08-10T10:27:40Z",
        "closed_at": "2023-09-18T20:09:29Z",
        "merged_at": "2023-09-18T20:09:29Z",
        "body": "- fixes https://github.com/moby/moby/issues/19418\r\n\r\nDepends on:\r\n\r\n- https://github.com/moby/moby/pull/46182\r\n- https://github.com/moby/moby/pull/46188\r\n- https://github.com/moby/moby/pull/46251\r\n\r\n**- What I did**\r\n\r\nSo far, only a subset of `NetworkingConfig` was validated when calling `ContainerCreate`. Other parameters would be validated when the container was started. And the same goes for `EndpointSettings` on `NetworkConnect`.\r\n\r\nAlso, the validation code was early exiting as soon as it caught an error. It now tries to validate as much as it can, and returns all the errors.\r\n\r\n**- How to verify it**\r\n\r\nTesting with the CLI won't work because it has its own client-side layer of validation (although incomplete). Some Go code has to be written to test all validation cases.\r\n\r\n**- Description for the changelog**\r\n\r\n* `NetworkConnect` and `ContainerCreate` have improved data validation, and now return all validation errors at once.\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 11,
        "changed_files": 3,
        "created_at": "2023-08-10T10:16:25Z",
        "closed_at": "2023-08-10T11:26:52Z",
        "merged_at": "2023-08-10T11:26:52Z",
        "body": "**- What I did**\r\n\r\nReplaced `github.com/pkg/errors` with std `errors`. It'll make it possible to use `errors.Join()` in that file. And also, fixed some errors capitalization while at it.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 5,
        "changed_files": 5,
        "created_at": "2023-08-10T09:24:39Z",
        "closed_at": "2023-08-10T11:12:29Z",
        "merged_at": "2023-08-10T11:12:29Z",
        "body": "In these cases, continuing after a non nil error will result in a nil dereference in panic.\r\nChange the `assert.Check` to `assert.NilError` to avoid that.\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-08-09T12:30:01Z",
        "closed_at": "2023-08-09T16:12:08Z",
        "merged_at": "2023-08-09T16:12:08Z",
        "body": "- backport: https://github.com/moby/moby/pull/45399\r\n\r\n**- What I did**\r\nUnskip:\r\n- TestKillWithStopSignalAndRestartPolicies\r\n- TestKillStoppedContainer\r\n\r\nintegration tests on Windows.\r\n\r\n\r\n**- How I did it**\r\n`dd` in vim\r\n\r\n**- How to verify it**\r\nCI\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-09T12:25:04Z",
        "closed_at": "2023-08-09T13:39:10Z",
        "merged_at": "2023-08-09T13:39:10Z",
        "body": "- backport: https://github.com/moby/moby/pull/46168\r\n\r\nIf TEST_INTEGRATION_FAIL_FAST is not set, run the integration-cli tests even if integration tests failed.\r\n\r\n(cherry picked from commit 6841a53d1764bd65d08fe655a147ae3c24c977c1)\r\n\r\n**- What I did**\r\nDon't fail-fast after `integration` tests failed but before `integration-cli` tests are started.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-09T12:23:36Z",
        "closed_at": "2023-08-09T15:39:29Z",
        "merged_at": "2023-08-09T15:39:29Z",
        "body": "- backport: https://github.com/moby/moby/pull/46168\r\n\r\nIf TEST_INTEGRATION_FAIL_FAST is not set, run the integration-cli tests even if integration tests failed.\r\n\r\n(cherry picked from commit 6841a53d1764bd65d08fe655a147ae3c24c977c1)\r\n\r\n**- What I did**\r\nDon't fail-fast after `integration` tests failed but before `integration-cli` tests are started.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 64,
        "deletions": 53,
        "changed_files": 2,
        "created_at": "2023-08-09T10:39:38Z",
        "closed_at": "2023-08-10T10:13:18Z",
        "merged_at": "2023-08-10T10:13:18Z",
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 20,
        "deletions": 38,
        "changed_files": 1,
        "created_at": "2023-08-09T08:44:55Z",
        "closed_at": "2023-08-09T11:44:06Z",
        "merged_at": "2023-08-09T11:44:06Z",
        "body": "\r\n\r\n**- What I did**\r\nRewritten asserts in `pkg/plugins/plugin_test.go` to use `gotest.tools` style asserts.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 134,
        "deletions": 154,
        "changed_files": 4,
        "created_at": "2023-08-08T21:14:20Z",
        "closed_at": "2023-08-09T10:17:55Z",
        "merged_at": "2023-08-09T10:17:55Z",
        "body": "- first part of https://github.com/moby/moby/pull/46149, which still needs some work\r\n\r\n### libnetwork/osl: let's not do this, etc.\r\n\r\nNo context in the commit that added it, but PR discussion shows that\r\nthe API was mostly exploratory, and it was 8 Years go, so let's not\r\nhead in that direction :) https://github.com/moby/libnetwork/commit/b6467848599a1b9ad504ba8f10fdce07afb4ea76\r\n\r\n### libnetwork/osl: nwIface: unexport sync.Mutex\r\n\r\nDon't make the mutex public. This also gives a better clue\r\nif the mutex is used externally.\r\n\r\n### libnetwork/osl: nwIface: remove mutex altogether\r\n\r\nThe mutex is only used on reads, but there's nothing protecting writes,\r\nand it looks like nothing is mutating fields after creation, so let's\r\nremove this altogether.\r\n\r\n### libnetwork/osl: make newKey and newInfo a t.Helper()\r\n\r\nBoth were passed testing.T, but it was not used, so let's make use of it.\r\n\r\n### libnetwork/osl: clean up newInfo() a bit\r\n\r\nUse struct-literals in some places to make it slightly more visible\r\nwhat we're creating where.\r\n\r\n### libnetwork/osl: some minor nits\r\n\r\n### libnetwork/osl: move all networkNamespace methods together\r\n\r\nThese methods were sprinkled throughout the code; let's move\r\nthem together.\r\n\r\n### libnetwork/osl: nwIface: add godoc\r\n\r\nCopy the godoc from the interface to the implementation.\r\n\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 0,
        "deletions": 5,
        "changed_files": 1,
        "created_at": "2023-08-08T18:02:04Z",
        "closed_at": "2023-08-08T19:56:08Z",
        "merged_at": "2023-08-08T19:56:08Z",
        "body": "**- What I did**\r\n\r\nThese errors aren't used in our repo and seem unused by the OSS community (this was checked with Sourcegraph).\r\n\r\n- ErrIpamInternalError has never been used\r\n- ErrInvalidRequest is unused since moby/libnetwork@c85356efa\r\n- ErrPoolNotFound has never been used\r\n- ErrOverlapPool has never been used\r\n- ErrNoAvailablePool has never been used\r\n\r\nFor the record, here's [a link](https://sourcegraph.com/search?q=context:global+file:%5C.go%24+-repo:moby/moby+-repo:docker/docker-ce+-repo:moby/libnetwork+-file:vendor/+content:%22github.com/docker/docker%22+content:ErrNoAvailablePool&patternType=regexp&sm=1&groupBy=repo) to one of my Sourcegraph query. As can be seen, the only result is an old repo which is vendoring `github.com/docker/docker` in a weird way (and has seen no activity in the past 5 years).\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 20,
        "deletions": 23,
        "changed_files": 3,
        "created_at": "2023-08-08T13:09:07Z",
        "closed_at": "2023-08-10T19:00:14Z",
        "merged_at": "2023-08-10T19:00:14Z",
        "body": "### client: Client.checkResponseErr: change errorMessage to an error\r\n\r\n### client: Client.Ping: re-use request when falling back to GET\r\n\r\nRe-use the request, and change the method to GET instead of building\r\na new request \"from scratch\".\r\n\r\n### client: Client.buildRequest: use http.NewRequestWithContext\r\n\r\nAttach the context to the request while we're creating it, instead of\r\ncreating the context first, and adding the context later.\r\n\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 10,
        "changed_files": 1,
        "created_at": "2023-08-08T12:28:37Z",
        "closed_at": "2023-08-08T16:37:32Z",
        "merged_at": "2023-08-08T16:37:32Z",
        "body": "**- What I did**\r\n\r\nPR moby/moby#45759 is going to use the new `errors.Join` function  to return a list of validation errors.\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 7,
        "changed_files": 1,
        "created_at": "2023-08-08T12:02:13Z",
        "closed_at": "2023-08-09T11:29:47Z",
        "merged_at": "2023-08-09T11:29:47Z",
        "body": "**- What I did**\r\nFixed `make test-integration` with `TEST_FILTER` not working correctly when passing a regular expression that matches multiple tests in both `integration` and `integration-cli` suites.\r\n\r\n**- How I did it**\r\nSee individual commits\r\n\r\n**- How to verify it**\r\n\r\n# Before\r\n\r\n\r\n<details>\r\n\r\n<summary>TEST_FILTER='(TestPushBusyboxImage|TestDiff)'</summary>\r\n\r\n\r\n```bash\r\n$ make TEST_FILTER='(TestPushBusyboxImage|TestDiff)' test-integration\r\n(...)\r\n---> Making bundle: test-integration (in bundles/test-integration)\r\nSkipping integration-cli tests since the supplied filter \"(TestPushBusyboxImage|TestDiff)\" omits all integration-cli tests\r\nSCRIPTDIR=/go/src/github.com/docker/docker/hack\r\nHOSTNAME=385d291ba1a7\r\nVALIDATE_ORIGIN_BRANCH=\r\nDEST=bundles/test-integration\r\nPWD=/go/src/github.com/docker/docker\r\nCONTAINERD_ADDRESS=/run/docker/containerd/containerd.sock\r\nDOCKER_GITCOMMIT=8dcad20eae\r\ncontainer=docker\r\nHOME=/root\r\nCONTAINERD_NAMESPACE=moby\r\nGOLANG_VERSION=1.20.6\r\nVALIDATE_REPO=\r\nVALIDATE_BRANCH=\r\nTERM=xterm\r\nDOCKER_PKG=github.com/docker/docker\r\nTEST_CLIENT_BINARY=/usr/local/cli-integration/docker\r\nSHLVL=1\r\nDOCKER_GRAPHDRIVER=overlay2\r\nGO111MODULE=off\r\nPATH=/usr/local/cli:/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nMAKEDIR=/go/src/github.com/docker/docker/hack/make\r\nTEST_FILTER=(TestPushBusyboxImage|TestDiff)\r\nGOPATH=/go\r\nPKG_CONFIG=pkg-config\r\n_=/usr/bin/env\r\nBuilding test suite binary ./integration/container/test.main\r\n---> Making bundle: .integration-daemon-start (in bundles/test-integration)\r\nUsing test binary /usr/local/cli-integration/docker\r\nINFO: Waiting for daemon to start...\r\nStarting dockerd\r\n.\r\n---> Making bundle: .build-empty-images (in bundles/test-integration)\r\nLoaded image: emptyfs:latest\r\nLoaded image ID: sha256:0df1207206e5288f4a989a2f13d1f5b3c4e70467702c1d5d21dfc9f002b7bd43\r\nRunning integration-test (iteration 1)\r\nRunning /go/src/github.com/docker/docker/integration/container (arm64.integration.container) flags=-test.v -test.timeout=5m  -test.run (TestPushBusyboxImage|TestDiff)\r\nLoaded image: busybox:latest\r\nLoaded image: busybox:glibc\r\nLoaded image: debian:bullseye-slim\r\nLoaded image: hello-world:latest\r\nLoaded image: arm32v7/hello-world:latest\r\nINFO: Testing against a local daemon\r\n=== RUN   TestDiff\r\n--- PASS: TestDiff (0.48s)\r\nPASS\r\n\r\nDONE 1 tests in 1.900s\r\n---> Making bundle: .integration-daemon-stop (in bundles/test-integration)\r\nRemoving test suite binaries\r\nexiting test-integration\r\n++ exit 0\r\n\r\n```\r\n</details>\r\n\r\n\r\n# After\r\n\r\n<details>\r\n\r\n<summary>TEST_FILTER='(TestPushBusyboxImage|TestDiff)'</summary>\r\n\r\n\r\n```bash\r\n$ make TEST_FILTER='(TestPushBusyboxImage|TestDiff)' test-integration\r\n(..)\r\n---> Making bundle: test-integration (in bundles/test-integration)\r\nSCRIPTDIR=/go/src/github.com/docker/docker/hack\r\nHOSTNAME=162ed7cc7b58\r\nVALIDATE_ORIGIN_BRANCH=\r\nDEST=bundles/test-integration\r\nPWD=/go/src/github.com/docker/docker\r\nCONTAINERD_ADDRESS=/run/docker/containerd/containerd.sock\r\nDOCKER_GITCOMMIT=ca9db07ddb\r\ncontainer=docker\r\nHOME=/root\r\nCONTAINERD_NAMESPACE=moby\r\nGOLANG_VERSION=1.20.7\r\nVALIDATE_REPO=\r\nVALIDATE_BRANCH=\r\nTERM=xterm\r\nDOCKER_PKG=github.com/docker/docker\r\nTEST_CLIENT_BINARY=/usr/local/cli-integration/docker\r\nSHLVL=1\r\nDOCKER_GRAPHDRIVER=overlay2\r\nGO111MODULE=off\r\nPATH=/usr/local/cli:/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nMAKEDIR=/go/src/github.com/docker/docker/hack/make\r\nTEST_FILTER=(TestPushBusyboxImage|TestDiff)\r\nGOPATH=/go\r\nPKG_CONFIG=pkg-config\r\n_=/usr/bin/env\r\nBuilding test suite binary ./integration-cli/test.main\r\nBuilding test suite binary ./integration/container/test.main\r\n---> Making bundle: .integration-daemon-start (in bundles/test-integration)\r\nUsing test binary /usr/local/cli-integration/docker\r\nINFO: Waiting for daemon to start...\r\nStarting dockerd\r\n.\r\n---> Making bundle: .build-empty-images (in bundles/test-integration)\r\nLoaded image: emptyfs:latest\r\nLoaded image ID: sha256:0df1207206e5288f4a989a2f13d1f5b3c4e70467702c1d5d21dfc9f002b7bd43\r\nRunning integration-test (iteration 1)\r\nRunning /go/src/github.com/docker/docker/integration/container (arm64.integration.container) flags=-test.v -test.timeout=5m    -test.run (TestPushBusyboxImage|TestDiff)\r\nLoaded image: busybox:latest\r\nLoaded image: busybox:glibc\r\nLoaded image: debian:bullseye-slim\r\nLoaded image: hello-world:latest\r\nLoaded image: arm32v7/hello-world:latest\r\nINFO: Testing against a local daemon\r\n=== RUN   TestDiff\r\n--- PASS: TestDiff (0.37s)\r\nPASS\r\n\r\nDONE 1 tests in 1.804s\r\nRunning /go/src/github.com/docker/docker/integration-cli (arm64.integration-cli) flags=-test.v -test.timeout=360m    -test.run /(TestPushBusyboxImage|TestDiff)\r\nINFO: Testing against a local daemon\r\nINFO: Testing with docker cli version:\r\nClient:\r\n Version:      unknown-version\r\n API version:  1.30\r\n Go version:   go1.20.7\r\n Git commit:   unknown-commit\r\n Built:        unknown-buildtime\r\n OS/Arch:      linux/arm64\r\n\r\nServer:\r\n Version:      dev\r\n API version:  1.44 (minimum version 1.12)\r\n Go version:   go1.20.7\r\n Git commit:   ca9db07ddb\r\n Built:        Tue Aug  8 11:34:23 2023\r\n OS/Arch:      linux/arm64\r\n Experimental: false\r\n\r\n=== RUN   TestDockerAPISuite\r\n--- PASS: TestDockerAPISuite (0.01s)\r\n=== RUN   TestDockerBenchmarkSuite\r\n--- PASS: TestDockerBenchmarkSuite (0.00s)\r\n=== RUN   TestDockerCLIAttachSuite\r\n--- PASS: TestDockerCLIAttachSuite (0.00s)\r\n=== RUN   TestDockerCLIBuildSuite\r\n--- PASS: TestDockerCLIBuildSuite (0.00s)\r\n=== RUN   TestDockerCLICommitSuite\r\n--- PASS: TestDockerCLICommitSuite (0.00s)\r\n=== RUN   TestDockerCLICpSuite\r\n--- PASS: TestDockerCLICpSuite (0.00s)\r\n=== RUN   TestDockerCLICreateSuite\r\n--- PASS: TestDockerCLICreateSuite (0.00s)\r\n=== RUN   TestDockerCLIEventSuite\r\n--- PASS: TestDockerCLIEventSuite (0.00s)\r\n=== RUN   TestDockerCLIExecSuite\r\n--- PASS: TestDockerCLIExecSuite (0.00s)\r\n=== RUN   TestDockerCLIHealthSuite\r\n--- PASS: TestDockerCLIHealthSuite (0.00s)\r\n=== RUN   TestDockerCLIHistorySuite\r\n--- PASS: TestDockerCLIHistorySuite (0.00s)\r\n=== RUN   TestDockerCLIImagesSuite\r\n--- PASS: TestDockerCLIImagesSuite (0.00s)\r\n=== RUN   TestDockerCLIImportSuite\r\n--- PASS: TestDockerCLIImportSuite (0.00s)\r\n=== RUN   TestDockerCLIInfoSuite\r\n--- PASS: TestDockerCLIInfoSuite (0.00s)\r\n=== RUN   TestDockerCLIInspectSuite\r\n--- PASS: TestDockerCLIInspectSuite (0.00s)\r\n=== RUN   TestDockerCLILinksSuite\r\n--- PASS: TestDockerCLILinksSuite (0.00s)\r\n=== RUN   TestDockerCLILoginSuite\r\n--- PASS: TestDockerCLILoginSuite (0.00s)\r\n=== RUN   TestDockerCLILogsSuite\r\n--- PASS: TestDockerCLILogsSuite (0.00s)\r\n=== RUN   TestDockerCLINetmodeSuite\r\n--- PASS: TestDockerCLINetmodeSuite (0.00s)\r\n=== RUN   TestDockerCLINetworkSuite\r\n--- PASS: TestDockerCLINetworkSuite (0.00s)\r\n=== RUN   TestDockerCLIPluginLogDriverSuite\r\n--- PASS: TestDockerCLIPluginLogDriverSuite (0.00s)\r\n=== RUN   TestDockerCLIPluginsSuite\r\n--- PASS: TestDockerCLIPluginsSuite (0.00s)\r\n=== RUN   TestDockerCLIPortSuite\r\n--- PASS: TestDockerCLIPortSuite (0.00s)\r\n=== RUN   TestDockerCLIProxySuite\r\n--- PASS: TestDockerCLIProxySuite (0.00s)\r\n=== RUN   TestDockerCLIPruneSuite\r\n--- PASS: TestDockerCLIPruneSuite (0.00s)\r\n=== RUN   TestDockerCLIPsSuite\r\n--- PASS: TestDockerCLIPsSuite (0.00s)\r\n=== RUN   TestDockerCLIPullSuite\r\n--- PASS: TestDockerCLIPullSuite (0.00s)\r\n=== RUN   TestDockerCLIPushSuite\r\n--- PASS: TestDockerCLIPushSuite (0.00s)\r\n=== RUN   TestDockerCLIRestartSuite\r\n--- PASS: TestDockerCLIRestartSuite (0.00s)\r\n=== RUN   TestDockerCLIRmiSuite\r\n--- PASS: TestDockerCLIRmiSuite (0.00s)\r\n=== RUN   TestDockerCLIRunSuite\r\n--- PASS: TestDockerCLIRunSuite (0.00s)\r\n=== RUN   TestDockerCLISaveLoadSuite\r\n--- PASS: TestDockerCLISaveLoadSuite (0.00s)\r\n=== RUN   TestDockerCLISearchSuite\r\n--- PASS: TestDockerCLISearchSuite (0.00s)\r\n=== RUN   TestDockerCLISNISuite\r\n--- PASS: TestDockerCLISNISuite (0.00s)\r\n=== RUN   TestDockerCLIStartSuite\r\n--- PASS: TestDockerCLIStartSuite (0.00s)\r\n=== RUN   TestDockerCLIStatsSuite\r\n--- PASS: TestDockerCLIStatsSuite (0.00s)\r\n=== RUN   TestDockerCLITopSuite\r\n--- PASS: TestDockerCLITopSuite (0.00s)\r\n=== RUN   TestDockerCLIUpdateSuite\r\n--- PASS: TestDockerCLIUpdateSuite (0.00s)\r\n=== RUN   TestDockerCLIVolumeSuite\r\n--- PASS: TestDockerCLIVolumeSuite (0.00s)\r\n=== RUN   TestDockerRegistrySuite\r\n=== RUN   TestDockerRegistrySuite/TestPushBusyboxImage\r\n    check_test.go:394: [ddcb5c090f43d] daemon is not started\r\n--- PASS: TestDockerRegistrySuite (0.22s)\r\n    --- PASS: TestDockerRegistrySuite/TestPushBusyboxImage (0.22s)\r\n=== RUN   TestDockerSchema1RegistrySuite\r\n--- PASS: TestDockerSchema1RegistrySuite (0.00s)\r\n=== RUN   TestDockerRegistryAuthHtpasswdSuite\r\n--- PASS: TestDockerRegistryAuthHtpasswdSuite (0.00s)\r\n=== RUN   TestDockerRegistryAuthTokenSuite\r\n--- PASS: TestDockerRegistryAuthTokenSuite (0.00s)\r\n=== RUN   TestDockerDaemonSuite\r\n--- PASS: TestDockerDaemonSuite (0.00s)\r\n=== RUN   TestDockerSwarmSuite\r\n--- PASS: TestDockerSwarmSuite (0.00s)\r\n=== RUN   TestDockerPluginSuite\r\n--- PASS: TestDockerPluginSuite (0.00s)\r\n=== RUN   TestDockerExternalVolumeSuite\r\n--- PASS: TestDockerExternalVolumeSuite (0.00s)\r\n=== RUN   TestDockerNetworkSuite\r\n--- PASS: TestDockerNetworkSuite (0.00s)\r\n=== RUN   TestDockerHubPullSuite\r\n--- PASS: TestDockerHubPullSuite (0.00s)\r\nPASS\r\n\r\nDONE 50 tests in 0.331s\r\n---> Making bundle: .integration-daemon-stop (in bundles/test-integration)\r\nRemoving test suite binaries\r\nexiting test-integration\r\n++ exit 0\r\n\r\n```\r\n</details>\r\n\r\n\r\n\r\n\r\n\r\n<details>\r\n\r\n<summary>TEST_FILTER='TestPushBusyboxImage'</summary>\r\n\r\n```bash\r\n$ make TEST_FILTER='TestPushBusyboxImage' test-integration\r\n(...)\r\n---> Making bundle: test-integration (in bundles/test-integration)\r\nSkipping integration tests since the supplied filter \"TestPushBusyboxImage\" omits all integration tests\r\nSCRIPTDIR=/go/src/github.com/docker/docker/hack\r\nHOSTNAME=3f4905a3db54\r\nVALIDATE_ORIGIN_BRANCH=\r\nDEST=bundles/test-integration\r\nPWD=/go/src/github.com/docker/docker\r\nCONTAINERD_ADDRESS=/run/docker/containerd/containerd.sock\r\nDOCKER_GITCOMMIT=ca9db07ddb\r\ncontainer=docker\r\nHOME=/root\r\nCONTAINERD_NAMESPACE=moby\r\nGOLANG_VERSION=1.20.7\r\nVALIDATE_REPO=\r\nVALIDATE_BRANCH=\r\nTERM=xterm\r\nDOCKER_PKG=github.com/docker/docker\r\nTEST_CLIENT_BINARY=/usr/local/cli-integration/docker\r\nSHLVL=1\r\nDOCKER_GRAPHDRIVER=overlay2\r\nGO111MODULE=off\r\nPATH=/usr/local/cli:/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nMAKEDIR=/go/src/github.com/docker/docker/hack/make\r\nTEST_FILTER=TestPushBusyboxImage\r\nGOPATH=/go\r\nPKG_CONFIG=pkg-config\r\n_=/usr/bin/env\r\nBuilding test suite binary ./integration-cli/test.main\r\n---> Making bundle: .integration-daemon-start (in bundles/test-integration)\r\nUsing test binary /usr/local/cli-integration/docker\r\nINFO: Waiting for daemon to start...\r\nStarting dockerd\r\n.\r\n---> Making bundle: .build-empty-images (in bundles/test-integration)\r\nLoaded image: emptyfs:latest\r\nLoaded image ID: sha256:0df1207206e5288f4a989a2f13d1f5b3c4e70467702c1d5d21dfc9f002b7bd43\r\nRunning integration-test (iteration 1)\r\nRunning /go/src/github.com/docker/docker/integration-cli (arm64.integration-cli) flags=-test.v -test.timeout=360m    -test.run /TestPushBusyboxImage\r\nLoaded image: busybox:latest\r\nLoaded image: busybox:glibc\r\nLoaded image: debian:bullseye-slim\r\nLoaded image: hello-world:latest\r\nLoaded image: arm32v7/hello-world:latest\r\nINFO: Testing against a local daemon\r\nINFO: Testing with docker cli version:\r\nClient:\r\n Version:      unknown-version\r\n API version:  1.30\r\n Go version:   go1.20.7\r\n Git commit:   unknown-commit\r\n Built:        unknown-buildtime\r\n OS/Arch:      linux/arm64\r\n\r\nServer:\r\n Version:      dev\r\n API version:  1.44 (minimum version 1.12)\r\n Go version:   go1.20.7\r\n Git commit:   ca9db07ddb\r\n Built:        Tue Aug  8 11:34:52 2023\r\n OS/Arch:      linux/arm64\r\n Experimental: false\r\n\r\n=== RUN   TestDockerAPISuite\r\n--- PASS: TestDockerAPISuite (0.01s)\r\n=== RUN   TestDockerBenchmarkSuite\r\n--- PASS: TestDockerBenchmarkSuite (0.00s)\r\n=== RUN   TestDockerCLIAttachSuite\r\n--- PASS: TestDockerCLIAttachSuite (0.00s)\r\n=== RUN   TestDockerCLIBuildSuite\r\n--- PASS: TestDockerCLIBuildSuite (0.00s)\r\n=== RUN   TestDockerCLICommitSuite\r\n--- PASS: TestDockerCLICommitSuite (0.00s)\r\n=== RUN   TestDockerCLICpSuite\r\n--- PASS: TestDockerCLICpSuite (0.00s)\r\n=== RUN   TestDockerCLICreateSuite\r\n--- PASS: TestDockerCLICreateSuite (0.00s)\r\n=== RUN   TestDockerCLIEventSuite\r\n--- PASS: TestDockerCLIEventSuite (0.00s)\r\n=== RUN   TestDockerCLIExecSuite\r\n--- PASS: TestDockerCLIExecSuite (0.00s)\r\n=== RUN   TestDockerCLIHealthSuite\r\n--- PASS: TestDockerCLIHealthSuite (0.00s)\r\n=== RUN   TestDockerCLIHistorySuite\r\n--- PASS: TestDockerCLIHistorySuite (0.00s)\r\n=== RUN   TestDockerCLIImagesSuite\r\n--- PASS: TestDockerCLIImagesSuite (0.00s)\r\n=== RUN   TestDockerCLIImportSuite\r\n--- PASS: TestDockerCLIImportSuite (0.00s)\r\n=== RUN   TestDockerCLIInfoSuite\r\n--- PASS: TestDockerCLIInfoSuite (0.00s)\r\n=== RUN   TestDockerCLIInspectSuite\r\n--- PASS: TestDockerCLIInspectSuite (0.00s)\r\n=== RUN   TestDockerCLILinksSuite\r\n--- PASS: TestDockerCLILinksSuite (0.00s)\r\n=== RUN   TestDockerCLILoginSuite\r\n--- PASS: TestDockerCLILoginSuite (0.00s)\r\n=== RUN   TestDockerCLILogsSuite\r\n--- PASS: TestDockerCLILogsSuite (0.00s)\r\n=== RUN   TestDockerCLINetmodeSuite\r\n--- PASS: TestDockerCLINetmodeSuite (0.00s)\r\n=== RUN   TestDockerCLINetworkSuite\r\n--- PASS: TestDockerCLINetworkSuite (0.00s)\r\n=== RUN   TestDockerCLIPluginLogDriverSuite\r\n--- PASS: TestDockerCLIPluginLogDriverSuite (0.00s)\r\n=== RUN   TestDockerCLIPluginsSuite\r\n--- PASS: TestDockerCLIPluginsSuite (0.00s)\r\n=== RUN   TestDockerCLIPortSuite\r\n--- PASS: TestDockerCLIPortSuite (0.00s)\r\n=== RUN   TestDockerCLIProxySuite\r\n--- PASS: TestDockerCLIProxySuite (0.00s)\r\n=== RUN   TestDockerCLIPruneSuite\r\n--- PASS: TestDockerCLIPruneSuite (0.00s)\r\n=== RUN   TestDockerCLIPsSuite\r\n--- PASS: TestDockerCLIPsSuite (0.00s)\r\n=== RUN   TestDockerCLIPullSuite\r\n--- PASS: TestDockerCLIPullSuite (0.00s)\r\n=== RUN   TestDockerCLIPushSuite\r\n--- PASS: TestDockerCLIPushSuite (0.00s)\r\n=== RUN   TestDockerCLIRestartSuite\r\n--- PASS: TestDockerCLIRestartSuite (0.00s)\r\n=== RUN   TestDockerCLIRmiSuite\r\n--- PASS: TestDockerCLIRmiSuite (0.00s)\r\n=== RUN   TestDockerCLIRunSuite\r\n--- PASS: TestDockerCLIRunSuite (0.00s)\r\n=== RUN   TestDockerCLISaveLoadSuite\r\n--- PASS: TestDockerCLISaveLoadSuite (0.00s)\r\n=== RUN   TestDockerCLISearchSuite\r\n--- PASS: TestDockerCLISearchSuite (0.00s)\r\n=== RUN   TestDockerCLISNISuite\r\n--- PASS: TestDockerCLISNISuite (0.00s)\r\n=== RUN   TestDockerCLIStartSuite\r\n--- PASS: TestDockerCLIStartSuite (0.00s)\r\n=== RUN   TestDockerCLIStatsSuite\r\n--- PASS: TestDockerCLIStatsSuite (0.00s)\r\n=== RUN   TestDockerCLITopSuite\r\n--- PASS: TestDockerCLITopSuite (0.00s)\r\n=== RUN   TestDockerCLIUpdateSuite\r\n--- PASS: TestDockerCLIUpdateSuite (0.00s)\r\n=== RUN   TestDockerCLIVolumeSuite\r\n--- PASS: TestDockerCLIVolumeSuite (0.00s)\r\n=== RUN   TestDockerRegistrySuite\r\n=== RUN   TestDockerRegistrySuite/TestPushBusyboxImage\r\n    check_test.go:394: [d50c46941f372] daemon is not started\r\n--- PASS: TestDockerRegistrySuite (0.24s)\r\n    --- PASS: TestDockerRegistrySuite/TestPushBusyboxImage (0.24s)\r\n=== RUN   TestDockerSchema1RegistrySuite\r\n--- PASS: TestDockerSchema1RegistrySuite (0.00s)\r\n=== RUN   TestDockerRegistryAuthHtpasswdSuite\r\n--- PASS: TestDockerRegistryAuthHtpasswdSuite (0.00s)\r\n=== RUN   TestDockerRegistryAuthTokenSuite\r\n--- PASS: TestDockerRegistryAuthTokenSuite (0.00s)\r\n=== RUN   TestDockerDaemonSuite\r\n--- PASS: TestDockerDaemonSuite (0.00s)\r\n=== RUN   TestDockerSwarmSuite\r\n--- PASS: TestDockerSwarmSuite (0.00s)\r\n=== RUN   TestDockerPluginSuite\r\n--- PASS: TestDockerPluginSuite (0.00s)\r\n=== RUN   TestDockerExternalVolumeSuite\r\n--- PASS: TestDockerExternalVolumeSuite (0.00s)\r\n=== RUN   TestDockerNetworkSuite\r\n--- PASS: TestDockerNetworkSuite (0.00s)\r\n=== RUN   TestDockerHubPullSuite\r\n--- PASS: TestDockerHubPullSuite (0.00s)\r\nPASS\r\n\r\nDONE 50 tests in 1.823s\r\n---> Making bundle: .integration-daemon-stop (in bundles/test-integration)\r\nRemoving test suite binaries\r\nexiting test-integration\r\n++ exit 0\r\n\r\n```\r\n</details>\r\n\r\n<details>\r\n<summary>TEST_FILTER='TestDiff'</summary>\r\n\r\n```\r\n$ make TEST_FILTER='TestDiff' test-integration\r\n(...)\r\n---> Making bundle: test-integration (in bundles/test-integration)\r\nSkipping integration-cli tests since the supplied filter \"TestDiff\" omits all integration-cli tests\r\nSCRIPTDIR=/go/src/github.com/docker/docker/hack\r\nHOSTNAME=be4281caa771\r\nVALIDATE_ORIGIN_BRANCH=\r\nDEST=bundles/test-integration\r\nPWD=/go/src/github.com/docker/docker\r\nCONTAINERD_ADDRESS=/run/docker/containerd/containerd.sock\r\nDOCKER_GITCOMMIT=ca9db07ddb\r\ncontainer=docker\r\nHOME=/root\r\nCONTAINERD_NAMESPACE=moby\r\nGOLANG_VERSION=1.20.7\r\nVALIDATE_REPO=\r\nVALIDATE_BRANCH=\r\nTERM=xterm\r\nDOCKER_PKG=github.com/docker/docker\r\nTEST_CLIENT_BINARY=/usr/local/cli-integration/docker\r\nSHLVL=1\r\nDOCKER_GRAPHDRIVER=overlay2\r\nGO111MODULE=off\r\nPATH=/usr/local/cli:/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nMAKEDIR=/go/src/github.com/docker/docker/hack/make\r\nTEST_FILTER=TestDiff\r\nGOPATH=/go\r\nPKG_CONFIG=pkg-config\r\n_=/usr/bin/env\r\nBuilding test suite binary ./integration/container/test.main\r\n---> Making bundle: .integration-daemon-start (in bundles/test-integration)\r\nUsing test binary /usr/local/cli-integration/docker\r\nINFO: Waiting for daemon to start...\r\nStarting dockerd\r\n.\r\n---> Making bundle: .build-empty-images (in bundles/test-integration)\r\nLoaded image: emptyfs:latest\r\nLoaded image ID: sha256:0df1207206e5288f4a989a2f13d1f5b3c4e70467702c1d5d21dfc9f002b7bd43\r\nRunning integration-test (iteration 1)\r\nRunning /go/src/github.com/docker/docker/integration/container (arm64.integration.container) flags=-test.v -test.timeout=5m    -test.run TestDiff\r\nLoaded image: busybox:latest\r\nLoaded image: busybox:glibc\r\nLoaded image: debian:bullseye-slim\r\nLoaded image: hello-world:latest\r\nLoaded image: arm32v7/hello-world:latest\r\nINFO: Testing against a local daemon\r\n=== RUN   TestDiff\r\n--- PASS: TestDiff (0.34s)\r\nPASS\r\n\r\nDONE 1 tests in 1.825s\r\n---> Making bundle: .integration-daemon-stop (in bundles/test-integration)\r\nRemoving test suite binaries\r\nexiting test-integration\r\n++ exit 0\r\n\r\n```\r\n\r\n</details>\r\n\r\n\r\n**- Description for the changelog**\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![image](https://github.com/moby/moby/assets/5046555/57a17938-1e16-4f9e-aab3-51f0eee17e52)\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 16,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-08T11:58:55Z",
        "closed_at": "2023-08-09T11:43:44Z",
        "merged_at": "2023-08-09T11:43:44Z",
        "body": "- related to: https://github.com/moby/moby/pull/46060\r\n\r\nIf TEST_INTEGRATION_FAIL_FAST is not set, run the integration-cli tests even if integration tests failed.\r\n\r\n**- What I did**\r\nDon't fail-fast after `integration` tests failed but before `integration-cli` tests are started.\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 26,
        "deletions": 14,
        "changed_files": 4,
        "created_at": "2023-08-08T10:54:30Z",
        "closed_at": "2023-08-08T16:38:08Z",
        "merged_at": "2023-08-08T16:38:08Z",
        "body": "Some tests were testing non-existing plugins, but therefore triggered the retry-loop, which times out after 15-30 seconds. Add some options to allow overriding this timeout during tests.\r\n\r\nBefore:\r\n\r\n    go test -v -run '^(TestGet|TestNewClientWithTimeout)$'\r\n    === RUN   TestGet\r\n    === RUN   TestGet/success\r\n    === RUN   TestGet/not_implemented\r\n    === RUN   TestGet/not_exists\r\n    WARN[0000] Unable to locate plugin: vegetable, retrying in 1s\r\n    WARN[0001] Unable to locate plugin: vegetable, retrying in 2s\r\n    WARN[0003] Unable to locate plugin: vegetable, retrying in 4s\r\n    WARN[0007] Unable to locate plugin: vegetable, retrying in 8s\r\n    --- PASS: TestGet (15.02s)\r\n        --- PASS: TestGet/success (0.00s)\r\n        --- PASS: TestGet/not_implemented (0.00s)\r\n        --- PASS: TestGet/not_exists (15.02s)\r\n    === RUN   TestNewClientWithTimeout\r\n        client_test.go:166: started remote plugin server listening on: http://127.0.0.1:36275\r\n    WARN[0015] Unable to connect to plugin: 127.0.0.1:36275/Test.Echo: Post \"http://127.0.0.1:36275/Test.Echo\": context deadline exceeded (Client.Timeout exceeded while awaiting headers), retrying in 1s\r\n    WARN[0017] Unable to connect to plugin: 127.0.0.1:36275/Test.Echo: Post \"http://127.0.0.1:36275/Test.Echo\": context deadline exceeded (Client.Timeout exceeded while awaiting headers), retrying in 2s\r\n    WARN[0019] Unable to connect to plugin: 127.0.0.1:36275/Test.Echo: Post \"http://127.0.0.1:36275/Test.Echo\": net/http: request canceled (Client.Timeout exceeded while awaiting headers), retrying in 4s\r\n    WARN[0024] Unable to connect to plugin: 127.0.0.1:36275/Test.Echo: Post \"http://127.0.0.1:36275/Test.Echo\": net/http: request canceled (Client.Timeout exceeded while awaiting headers), retrying in 8s\r\n    --- PASS: TestNewClientWithTimeout (17.64s)\r\n    PASS\r\n    ok  \tgithub.com/docker/docker/pkg/plugins\t32.664s\r\n\r\nAfter:\r\n\r\n    go test -v -run '^(TestGet|TestNewClientWithTimeout)$'\r\n    === RUN   TestGet\r\n    === RUN   TestGet/success\r\n    === RUN   TestGet/not_implemented\r\n    === RUN   TestGet/not_exists\r\n    WARN[0000] Unable to locate plugin: this-plugin-does-not-exist, retrying in 1s\r\n    --- PASS: TestGet (1.00s)\r\n        --- PASS: TestGet/success (0.00s)\r\n        --- PASS: TestGet/not_implemented (0.00s)\r\n        --- PASS: TestGet/not_exists (1.00s)\r\n    === RUN   TestNewClientWithTimeout\r\n        client_test.go:167: started remote plugin server listening on: http://127.0.0.1:45973\r\n    --- PASS: TestNewClientWithTimeout (0.04s)\r\n    PASS\r\n    ok  \tgithub.com/docker/docker/pkg/plugins\t1.050s\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 19,
        "changed_files": 2,
        "created_at": "2023-08-08T08:08:43Z",
        "closed_at": "2023-08-08T11:42:17Z",
        "merged_at": "2023-08-08T11:42:17Z",
        "body": "**- What I did**\r\n\r\nPartially revert commit 94b880f.\r\n\r\nThe `CheckDuplicate` field has been introduced in commit 2ab94e1. At that time, this check was done in the network router. It was then moved to the daemon package in commit 3ca2982. However, commit 94b880f duplicated the logic into the network router for no apparent reason. Finally, commit ab18718 made sure a 409 would be returned instead of a 500.\r\n\r\nAs this logic is first done by the daemon, the error -> warning conversion can't happen because `CheckDuplicate` has to be true for the daemon package to return an error. If it's false, the daemon proceed with the network creation, set the Warning field of its return value and return no error.\r\n\r\nThus, the `CheckDuplicate` logic in the api is removed and `libnetwork.NetworkNameError` now implements the ErrConflict interface.\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 28,
        "deletions": 11,
        "changed_files": 2,
        "created_at": "2023-08-04T09:41:05Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\nAdded a `testutil.TempDir` function that ensures the correct permissions for the fake-root user in rootless mode.\r\n\r\n**- How I did it**\r\nMoved the existing code to the `testutil` package.\r\n\r\n**- How to verify it**\r\nNo functional changes.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 14,
        "deletions": 3,
        "changed_files": 1,
        "created_at": "2023-08-04T09:25:54Z",
        "closed_at": "2023-08-05T17:46:00Z",
        "merged_at": "2023-08-05T17:46:00Z",
        "body": "- related to: https://github.com/moby/moby/pull/45946\r\n\r\n\r\nThese tests were made parallel to speed up the execution, but this turned out to be flaky, because they mutate some shared state.\r\n\r\nThe tests use shared `storage` variable without any synchronization. However, adding synchronization is not enough in all cases, some tests register the same plugin, so they can't be run in parallel to each other.\r\n\r\nThis commit adds the synchronization around `storage` variable modification and removes parallel from the tests where it's not enough.\r\n\r\nBefore:\r\n```\r\n$ go test -race -v . -count 1\r\n...\r\n--- FAIL: TestGet (15.02s)\r\n    --- FAIL: TestGet/not_implemented (0.00s)\r\n        testing.go:1446: race detected during execution of test\r\n    testing.go:1446: race detected during execution of test\r\nFAIL\r\nFAIL    github.com/docker/docker/pkg/plugins    17.655s\r\nFAIL\r\n```\r\n\r\nAfter:\r\n```\r\n$ go test -race -v . -count 1\r\nok      github.com/docker/docker/pkg/plugins    32.702s\r\n```\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-04T02:55:02Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\nfix typo\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 3,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-03T23:13:52Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n`bin-image` has failed on dco step when `v24.0.5` tag has been pushed: https://github.com/moby/moby/actions/runs/5647118881/job/15296540926#step:5:13\r\n\r\n```\r\nfatal: couldn't find remote ref refs/heads/refs/tags/v24.0.5\r\nError: Process completed with exit code 128.\r\n```\r\n\r\nFixes tag refs handling in dco workflow.\r\n\r\n**- How I did it**\r\n\r\nAdd extra cond to handle tag push events. Base ref is returned from the event payload (e.g., https://github.com/docker/metadata-action/blob/35e9aff4f5d665b5aa8a8f2adffaf8a1b5f49cc0/__tests__/fixtures/event_tag_v1.1.1.json#L3)\r\n\r\n**- How to verify it**\r\n\r\nOn new release :crossed_fingers:\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 20,
        "deletions": 43,
        "changed_files": 15,
        "created_at": "2023-08-03T21:55:03Z",
        "closed_at": "2023-08-25T12:33:41Z",
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\nEnabled Go Modules support. The reason why this was not possible before (\"Moby uses CalVer instead of SemVer\") is no longer valid since v23.0.0\r\n\r\n**- How I did it**\r\n\r\nRenamed `vendor.mod` to `go.mod` and `vendor.sum` to `go.sum`.\r\n\r\n**- How to verify it**\r\n\r\nEverything should continue to work and build as before. IDEs and other tooling now properly understand Moby dependencies.\r\n\r\nThis change also allows to enable Dependabot for Moby repository.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 5
    },
    {
        "merged": false,
        "additions": 8,
        "deletions": 4,
        "changed_files": 1,
        "created_at": "2023-08-03T12:26:07Z",
        "closed_at": "2023-08-30T07:23:57Z",
        "merged_at": null,
        "body": "Previously, the unmount was performed only when loading the `opts.json` file succeded. This protected from calling the unmount on Windows, but also from unmounting `_data` directories NOT mounted by the daemon. This is because local volume driver only performs the mount if it's needed by the additional volume mount opts.\r\n\r\nThe behavior was changed when the mount was turned into a no-op on Windows and the unmount was moved and became unconditional. This missed the fact that the mount could NOT have been performed by the daemon, if the volume didn't have any volume options.\r\n\r\nThis partially the old behavior and unmounts the data directory only if conditions for mounting it are true.\r\n(reverts: 7e907e29a32e1a3b7d5a1569e74e361d19876b0c)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 2
    },
    {
        "merged": false,
        "additions": 45,
        "deletions": 44,
        "changed_files": 3,
        "created_at": "2023-08-03T00:06:33Z",
        "closed_at": null,
        "merged_at": null,
        "body": "<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 558,
        "deletions": 527,
        "changed_files": 19,
        "created_at": "2023-08-02T22:08:18Z",
        "closed_at": "2023-08-23T21:28:41Z",
        "merged_at": "2023-08-23T21:28:41Z",
        "body": "### libnetwork/osl: add godoc to networkNamespace\r\n\r\nCopying the descriptions from the Sandbox, Info, NeighborOptionSetter,\r\nand IfaceOptionSetter interfaces that it implements.\r\n\r\n### libnetwork: implement Controller.setupOSLSandbox\r\n\r\nosl.NewSandbox() always returns a nil interface on Windows (and other non-Linux\r\nplatforms). This means that any code that these fields are always nil, and\r\nany code using these fields must be considered Linux-only;\r\n\r\n- libnetwork/Controller.defOsSbox\r\n- libnetwork/Sandbox.osSbox\r\n\r\nIdeally, these fields would live in Linux-only files, but they're referenced\r\nin various platform-neutral parts of the code, so let's start with moving\r\nthe initialization code to Linux-only files.\r\n\r\n### libnetwork: move more osl.Sandbox related code to Linux-only files\r\n\r\nosl.NewSandbox() always returns a nil interface on Windows (and other non-Linux\r\nplatforms). This means that any code that these fields are always nil, and\r\nany code using these fields must be considered Linux-only.\r\n\r\n### libnetwork/osl: remove Sandbox.NeighborOptions() etc.\r\n\r\nNeighborOptions() returned an NeighborOptionSetter interface, which\r\ncontained \"methods\" that returned functional options. Such a construct\r\ncould have made sense if the functional options returned would (e.g.)\r\nbe pre-propagated with information from the Sandbox (network namespace),\r\nbut none of that was the case.\r\n\r\nThere was only one implementation of NeighborOptionSetter (networkNamespace),\r\nwhich happened to be the same as the only implementation of Sandbox, so\r\nremove the interface as well, to help networkNamespace with its multi-personality\r\ndisorder.\r\n\r\nThis patch:\r\n\r\n- removes Sandbox.LinkName() and makes it a regular function (WithLinkName)\r\n- removes Sandbox.Family() and makes it a regular function (WithFamily)\r\n- removes Sandbox.NeighborOptions().\r\n- removes the NeighborOptionSetter interface\r\n\r\n### libnetwork/osl: remove Sandbox.InterfaceOptions() etc.\r\n\r\nInterfaceOptions() returned an IfaceOptionSetter interface, which contained\r\n\"methods\" that returned functional options. Such a construct could have made\r\nsense if the functional options returned would (e.g.) be pre-propagated with\r\ninformation from the Sandbox (network namespace), but none of that was the case.\r\n\r\nThere was only one implementation of IfaceOptionSetter (networkNamespace),\r\nwhich happened to be the same as the only implementation of Sandbox, so remove\r\nthe interface as well, to help networkNamespace with its multi-personality\r\ndisorder.\r\n\r\nThis patch:\r\n\r\n- removes Sandbox.Bridge() and makes it a regular function (WithIsBridge)\r\n- removes Sandbox.Master() and makes it a regular function (WithMaster)\r\n- removes Sandbox.MacAddress() and makes it a regular function (WithMACAddress)\r\n- removes Sandbox.Address() and makes it a regular function (WithIPv4Address)\r\n- removes Sandbox.AddressIPv6() and makes it a regular function (WithIPv6Address)\r\n- removes Sandbox.LinkLocalAddresses() and makes it a regular function (WithLinkLocalAddresses)\r\n- removes Sandbox.Routes() and makes it a regular function (WithRoutes)\r\n- removes Sandbox.InterfaceOptions().\r\n- removes the IfaceOptionSetter interface.\r\n\r\nNote that the IfaceOption signature was changes as well to allow returning\r\nan error. This is not currently used, but will be used for some options\r\nin the near future, so adding that in preparation.\r\n\r\n### libnetwork/osl: remove Interface Interface\r\n\r\nThere's only one implementation; let's use that.\r\nAlso fixing a linting issue;\r\n\r\n    libnetwork/osl/interface_linux.go:91:2: S1001: should use copy(to, from) instead of a loop (gosimple)\r\n    for i, iface := range n.iFaces {\r\n        ^\r\n\r\n### libnetwork/osl: remove Interface.Master() as it's unused\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 118,
        "deletions": 124,
        "changed_files": 31,
        "created_at": "2023-08-02T15:04:48Z",
        "closed_at": "2023-08-18T15:21:03Z",
        "merged_at": "2023-08-18T15:21:03Z",
        "body": "**- What I did**\r\n\r\nBoth libnetwork's BadRequestError and NoServiceError interfaces used a different method name than their equivalent in `errdefs`. As the package httpstatus wasn't aware of these interfaces, any libnetwork's errors implementing those interfaces were returning a 500 and a \"FIXME\" mesage would be logged. This is now fixed by replacing libnetwork's interfaces with newer interfaces compatible with errdefs' ones.\r\n\r\n**- How to verify it**\r\n\r\nCI is green\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://www.thesprucepets.com/thmb/wbacRYRNfOaMJ0aeDXtsQUxI0Rk=/5200x0/filters:no_upscale():strip_icc()/mandarinfish-swimming-in-coral-reef-166264759-5ac6c034303713003775cb26.jpg)\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 3,
        "deletions": 3,
        "changed_files": 2,
        "created_at": "2023-08-02T09:54:13Z",
        "closed_at": "2023-08-03T10:54:39Z",
        "merged_at": "2023-08-03T10:54:39Z",
        "body": "**- What I did**\r\n\r\nRelated to:\r\n\r\n- https://github.com/moby/moby/pull/45906#discussion_r1280796908\r\n\r\nThis function is called by `daemon.containerCreate()` which is already wrapping errors coming from `verifyNetworkingConfig()` with `errdefs.InvalidParameter()`. So `verifyNetworkingConfig()` should only return standard errors.\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://www.animalspot.net/wp-content/uploads/2014/08/Mandarinfish-Baby.jpg)\r\n",
        "comments": 6
    },
    {
        "merged": true,
        "additions": 1,
        "deletions": 1,
        "changed_files": 1,
        "created_at": "2023-08-02T07:14:11Z",
        "closed_at": "2023-08-02T14:34:53Z",
        "merged_at": "2023-08-02T14:34:53Z",
        "body": "- fixes https://github.com/moby/moby/pull/45925#discussion_r1281257898\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 4,
        "changed_files": 4,
        "created_at": "2023-08-01T22:15:11Z",
        "closed_at": "2023-08-02T05:50:17Z",
        "merged_at": "2023-08-02T05:50:17Z",
        "body": "Includes a fix for CVE-2023-29409\r\n\r\ngo1.19.12 (released 2023-08-01) includes a security fix to the crypto/tls package, as well as bug fixes to the assembler and the compiler. See the Go 1.19.12 milestone on our issue tracker for details.\r\n\r\n- https://github.com/golang/go/issues?q=milestone%3AGo1.19.12+label%3ACherryPickApproved\r\n- full diff: https://github.com/golang/go/compare/go1.19.11...go1.19.12\r\n\r\nFrom the mailing list announcement:\r\n\r\n[security] Go 1.20.7 and Go 1.19.12 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.20.7 and 1.19.12, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- crypto/tls: restrict RSA keys in certificates to <= 8192 bits\r\n\r\n  Extremely large RSA keys in certificate chains can cause a client/server\r\n  to expend significant CPU time verifying signatures. Limit this by\r\n  restricting the size of RSA keys transmitted during handshakes to <=\r\n  8192 bits.\r\n\r\n  Based on a survey of publicly trusted RSA keys, there are currently only\r\n  three certificates in circulation with keys larger than this, and all\r\n  three appear to be test certificates that are not actively deployed. It\r\n  is possible there are larger keys in use in private PKIs, but we target\r\n  the web PKI, so causing breakage here in the interests of increasing the\r\n  default safety of users of crypto/tls seems reasonable.\r\n\r\n  Thanks to Mateusz Poliwczak for reporting this issue.\r\n\r\nView the release notes for more information:\r\nhttps://go.dev/doc/devel/release#go1.20.7\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 5,
        "deletions": 5,
        "changed_files": 5,
        "created_at": "2023-08-01T22:14:41Z",
        "closed_at": "2023-08-02T05:50:02Z",
        "merged_at": "2023-08-02T05:50:02Z",
        "body": "- backport of https://github.com/moby/moby/pull/46139\r\n\r\nIncludes a fix for CVE-2023-29409\r\n\r\ngo1.20.7 (released 2023-08-01) includes a security fix to the crypto/tls package, as well as bug fixes to the assembler and the compiler. See the Go 1.20.7 milestone on our issue tracker for details:\r\n\r\n- https://github.com/golang/go/issues?q=milestone%3AGo1.20.7+label%3ACherryPickApproved\r\n- full diff: https://github.com/golang/go/compare/go1.20.6...go1.20.7\r\n\r\nFrom the mailing list announcement:\r\n\r\n[security] Go 1.20.7 and Go 1.19.12 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.20.7 and 1.19.12, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- crypto/tls: restrict RSA keys in certificates to <= 8192 bits\r\n\r\n  Extremely large RSA keys in certificate chains can cause a client/server\r\n  to expend significant CPU time verifying signatures. Limit this by\r\n  restricting the size of RSA keys transmitted during handshakes to <=\r\n  8192 bits.\r\n\r\n  Based on a survey of publicly trusted RSA keys, there are currently only\r\n  three certificates in circulation with keys larger than this, and all\r\n  three appear to be test certificates that are not actively deployed. It\r\n  is possible there are larger keys in use in private PKIs, but we target\r\n  the web PKI, so causing breakage here in the interests of increasing the\r\n  default safety of users of crypto/tls seems reasonable.\r\n\r\n  Thanks to Mateusz Poliwczak for reporting this issue.\r\n\r\nView the release notes for more information:\r\nhttps://go.dev/doc/devel/release#go1.20.7\r\n\r\n\r\n(cherry picked from commit d5cb7cdeae32f071dfa243c2a34925a23dd50679)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 6,
        "deletions": 6,
        "changed_files": 6,
        "created_at": "2023-08-01T22:14:07Z",
        "closed_at": "2023-08-02T05:49:46Z",
        "merged_at": "2023-08-02T05:49:46Z",
        "body": "- backport of https://github.com/moby/moby/pull/46139\r\n\r\nIncludes a fix for CVE-2023-29409\r\n\r\ngo1.20.7 (released 2023-08-01) includes a security fix to the crypto/tls package, as well as bug fixes to the assembler and the compiler. See the Go 1.20.7 milestone on our issue tracker for details:\r\n\r\n- https://github.com/golang/go/issues?q=milestone%3AGo1.20.7+label%3ACherryPickApproved\r\n- full diff: https://github.com/golang/go/compare/go1.20.6...go1.20.7\r\n\r\nFrom the mailing list announcement:\r\n\r\n[security] Go 1.20.7 and Go 1.19.12 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.20.7 and 1.19.12, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- crypto/tls: restrict RSA keys in certificates to <= 8192 bits\r\n\r\n  Extremely large RSA keys in certificate chains can cause a client/server\r\n  to expend significant CPU time verifying signatures. Limit this by\r\n  restricting the size of RSA keys transmitted during handshakes to <=\r\n  8192 bits.\r\n\r\n  Based on a survey of publicly trusted RSA keys, there are currently only\r\n  three certificates in circulation with keys larger than this, and all\r\n  three appear to be test certificates that are not actively deployed. It\r\n  is possible there are larger keys in use in private PKIs, but we target\r\n  the web PKI, so causing breakage here in the interests of increasing the\r\n  default safety of users of crypto/tls seems reasonable.\r\n\r\n  Thanks to Mateusz Poliwczak for reporting this issue.\r\n\r\nView the release notes for more information:\r\nhttps://go.dev/doc/devel/release#go1.20.7\r\n\r\n\r\n(cherry picked from commit d5cb7cdeae32f071dfa243c2a34925a23dd50679)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 7,
        "deletions": 7,
        "changed_files": 7,
        "created_at": "2023-08-01T22:13:26Z",
        "closed_at": "2023-08-02T05:49:29Z",
        "merged_at": "2023-08-02T05:49:29Z",
        "body": "Includes a fix for CVE-2023-29409\r\n\r\ngo1.20.7 (released 2023-08-01) includes a security fix to the crypto/tls package, as well as bug fixes to the assembler and the compiler. See the Go 1.20.7 milestone on our issue tracker for details:\r\n\r\n- https://github.com/golang/go/issues?q=milestone%3AGo1.20.7+label%3ACherryPickApproved\r\n- full diff: https://github.com/golang/go/compare/go1.20.6...go1.20.7\r\n\r\nFrom the mailing list announcement:\r\n\r\n[security] Go 1.20.7 and Go 1.19.12 are released\r\n\r\nHello gophers,\r\n\r\nWe have just released Go versions 1.20.7 and 1.19.12, minor point releases.\r\n\r\nThese minor releases include 1 security fixes following the security policy:\r\n\r\n- crypto/tls: restrict RSA keys in certificates to <= 8192 bits\r\n\r\n  Extremely large RSA keys in certificate chains can cause a client/server\r\n  to expend significant CPU time verifying signatures. Limit this by\r\n  restricting the size of RSA keys transmitted during handshakes to <=\r\n  8192 bits.\r\n\r\n  Based on a survey of publicly trusted RSA keys, there are currently only\r\n  three certificates in circulation with keys larger than this, and all\r\n  three appear to be test certificates that are not actively deployed. It\r\n  is possible there are larger keys in use in private PKIs, but we target\r\n  the web PKI, so causing breakage here in the interests of increasing the\r\n  default safety of users of crypto/tls seems reasonable.\r\n\r\n  Thanks to Mateusz Poliwczak for reporting this issue.\r\n\r\nView the release notes for more information:\r\nhttps://go.dev/doc/devel/release#go1.20.7\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 80,
        "deletions": 21,
        "changed_files": 2,
        "created_at": "2023-08-01T19:10:45Z",
        "closed_at": "2023-08-02T11:45:28Z",
        "merged_at": "2023-08-02T11:45:28Z",
        "body": "**- What I did**\r\n\r\nExtract the `RunAttach` helper from #45850 and fix @corhere's comment about the leaking goroutine and the data race.\r\n\r\nFollowing PRs need this helper:\r\n\r\n- #45850 \r\n- #45905 \r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n![](https://cdn-s-www.lalsace.fr/images/5A7AAB5A-AEC5-4016-857C-8E23CE32B3F2/NW_raw/cette-photo-prise-sur-les-iles-falkland-a-ete-titree-parle-a-mon-aile-photo-jennifer-hadley-comedy-wildlife-photography-awards-2022-1666183647.jpg)",
        "comments": 2
    },
    {
        "merged": true,
        "additions": 4,
        "deletions": 8,
        "changed_files": 1,
        "created_at": "2023-08-01T19:07:25Z",
        "closed_at": "2023-08-21T17:51:23Z",
        "merged_at": "2023-08-21T17:51:23Z",
        "body": "- [x] relates to / depends on https://github.com/docker/docs/pull/17858\r\n- relates to https://github.com/moby/moby/pull/39736\r\n- relates to https://github.com/moby/moby/issues/39701\r\n- relates to https://github.com/distribution/distribution/issues/2976\r\n- relates to https://github.com/moby/moby/issues/44521\r\n- relates to https://github.com/moby/moby/pull/42300\r\n- relates to https://github.com/docker/roadmap/issues/173\r\n\r\n\r\n### distribution: update warning for deprecated image formats\r\n\r\n- Use the same warning for both \"v1 in manifest-index\" and bare \"v1\" images.\r\n- Update URL to use a \"/go/\" redirect, which allows the docs team to more\r\n  easily redirect the URL to relevant docs (if things move).\r\n\r\n\r\n### distribution: show image schema deprecation on all registries\r\n\r\nWhen we added this deprecation warning, some registries had not yet\r\nmoved away from the deprecated specification, so we made the warning\r\nconditional for pulling from Docker Hub.\r\n\r\nThat condition was added in 647dfe99a50badd27f0508c67eddc4b4923fcef7,\r\nwhich is over 4 Years ago, which should be time enough for images\r\nand registries to have moved to current specifications.\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 204,
        "deletions": 91,
        "changed_files": 2,
        "created_at": "2023-08-01T11:27:12Z",
        "closed_at": "2023-08-04T16:06:05Z",
        "merged_at": "2023-08-04T16:06:05Z",
        "body": "backports:\r\n\r\n- https://github.com/moby/moby/pull/42138\r\n- https://github.com/moby/moby/pull/46122\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 204,
        "deletions": 91,
        "changed_files": 2,
        "created_at": "2023-08-01T11:27:07Z",
        "closed_at": "2023-08-04T16:06:26Z",
        "merged_at": "2023-08-04T16:06:26Z",
        "body": "backports:\r\n\r\n- https://github.com/moby/moby/pull/42138\r\n- https://github.com/moby/moby/pull/46122\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 41,
        "deletions": 52,
        "changed_files": 4,
        "created_at": "2023-08-01T10:18:49Z",
        "closed_at": "2023-08-03T16:38:23Z",
        "merged_at": "2023-08-03T16:38:22Z",
        "body": "I had these lying around, but didn't push them yet.\r\n\r\nI modified the last commit from what I originally had (originally I inlined the code), after noticing that https://github.com/moby/moby/pull/45652 also refactored the same code, but we decided to make a `cli.tlsConfig()` method, so I already introduced that method, for it to be updated with the OTEL changes in https://github.com/moby/moby/pull/45652\r\n\r\n\r\n### client/buildkit: ClientOpts: update docs to use doc-links, and inline\r\n\r\ninline the closures, and update the GoDoc to use doc-links to the related\r\nbuildkit function.\r\n\r\n### client: Dialer: inline fallbackDial\r\n\r\nfallbackDial was only used in a single place, and it was defined far away\r\nfrom where it's used, so let's inline it, so that it's clear at a glance\r\nwhat we're doing.\r\n\r\n### client: move resolveTLSConfig to a Client.tlsConfig()\r\n\r\nThis makes it slightly clearer what it does, as \"resolve\" may give the\r\nimpression it's doing more than just returning the TLS config configured\r\nfor the client.\r\n\r\n \r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 1
    },
    {
        "merged": false,
        "additions": 55,
        "deletions": 76,
        "changed_files": 1,
        "created_at": "2023-08-01T05:29:24Z",
        "closed_at": "2023-09-08T16:30:08Z",
        "merged_at": null,
        "body": "Addresses: #46082 \r\n\r\n**- What I did**\r\nRefactored the code in `daemon/list.go` to avoid `containerReducer` type and `reduceContainer` since they are being used at only one place.\r\n\r\n**- How I did it**\r\nInstead of calling `reduceContainer` function inside `Containers`, replaced the body of `reduceContainer` into the `Containers` and removed the `reduceContainer` entirely. We don't need `containerReducer` type anymore in this case. So, removed that as well. Renamed the `reducePsContainer` to `formatContainerForPs` as it tries to format the container snapshot into something that fits in ps command output.\r\n\r\n**- How to verify it**\r\nThere should be no difference in the `docker ps` command outputs since this is just a code refactor.\r\n\r\n**- Description for the changelog**\r\nRefactor daemon/list to abandon using reduceContainer and replace its code in Containers itself.\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n![85120553](https://github.com/moby/moby/assets/64607742/082a579a-b1ae-4967-954d-31e2ff5a801f)\r\n\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 10,
        "deletions": 96,
        "changed_files": 3,
        "created_at": "2023-07-31T17:24:19Z",
        "closed_at": "2023-07-31T22:15:21Z",
        "merged_at": "2023-07-31T22:15:21Z",
        "body": "**- What I did**\r\n\r\n#### libnet/d/bridge: Remove unused error types\r\n\r\nThese error types are removed:\r\n\r\n- ErrInvalidContainerConfig\r\n- ErrInvalidPort\r\n- ErrInvalidAddressBinding\r\n- InvalidSandboxIDError\r\n- IPv4AddrRangeError\r\n\r\n#### libnet/d/bridge: Change interface implemented by error types\r\n\r\n- InvalidIPTablesCfgError: implement InternalError instead of\r\n  BadRequestError. This error is returned when an invalid iptables\r\n  action is passed as argument (ie. none of -A, -I, or -D).\r\n- ErrInvalidDriverConfig: don't implement BadRequestError. This is\r\n  returned when libnetwork controller initialization pass bad driver\r\n  config -- there's no call from an HTTP route.\r\n\r\n#### libnet/d/bridge: Inline IPTableCfgError\r\n\r\nThis error is only used in defensive checks whereas the precondition is\r\nalready checked by caller. If we reach it, we messed something else. So\r\nit's definitely not a BadRequest but an InternalError. Since there's no\r\ntype assertion, it adds no value.\r\n\r\n#### libnet/d/bridge: Inline InvalidIPTablesCfgError\r\n\r\nThis error is an InternalError and is never type asserted, so no need to\r\nkeep it around.\r\n\r\n#### libnet/d/bridge: Remove pointless BadRequestError impl\r\n\r\nIPv4AddrNoMatchError and IPv6AddrNoMatchError are currently implementing\r\nBadRequestError. They are returned in two cases, and none are due to a\r\nbad user request:\r\n\r\n- When calling daemon's CreateNetwork route, if the bridge's IPv4\r\n  address or none of the bridge's IPv6 addresses match what's requested.\r\n  If that happens, there's a big issue somewhere in libnetwork or the\r\n  kernel.\r\n- When restoring a network, for the same reason. In that case, the\r\n  on-disk state drifted from the interface state.\r\n\r\n#### libnet/d/bridge: Inline InvalidLinkIPAddrError\r\n",
        "comments": 0
    },
    {
        "merged": true,
        "additions": 2,
        "deletions": 2,
        "changed_files": 1,
        "created_at": "2023-07-31T16:49:36Z",
        "closed_at": "2023-08-03T18:25:49Z",
        "merged_at": "2023-08-03T18:25:49Z",
        "body": "\"HEAD\" will still be used as a version if no DOCKER_COMMIT is provided (for example when not running via `make`), but it won't prevent it being set to the GITHUB_SHA variable when it's present.\r\n\r\nThis will fix `Git commit` reported by `docker version` for the binaries generated by `moby-bin`.\r\n\r\nhttps://github.com/moby/moby/blob/7baab8bd6c0674475f108f4cd1158d9ea30a62cb/docker-bake.hcl#L84\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 4421,
        "deletions": 2732,
        "changed_files": 229,
        "created_at": "2023-07-31T11:43:56Z",
        "closed_at": "2023-09-14T19:04:12Z",
        "merged_at": null,
        "body": "- This is a quick rebase of https://github.com/moby/moby/pull/45652\r\n- [x] on top of https://github.com/moby/moby/pull/46122 (merged)\r\n- [x] on top of https://github.com/moby/moby/pull/46133\r\n- [x] on top of https://github.com/moby/moby/pull/46171\r\n\r\nTo see how \"bad\" it is. I kept the `TestDaemonProxy: check proxy settings early` commit separate, but moved it after the \"Wire up tests to support otel tracing\" commit, as it should be squashed into that one.\r\n\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    },
    {
        "merged": false,
        "additions": 236,
        "deletions": 217,
        "changed_files": 24,
        "created_at": "2023-07-30T20:55:14Z",
        "closed_at": null,
        "merged_at": null,
        "body": "This plumbs through a context within `plugin/` and `libcontainerd/`.\r\nIn some cases this touched some higher-level things.\r\n\r\nNote: I did not change `pkg/plugins` or `pkg/plugingetter` because this is a *much* larger change (deceptively so) which won't even compile until some swarmkit changes are made (fun times here: https://github.com/cpuguy83/docker/commit/9c25233a2f24c6b0b84790af628044fe6edd1aa8).\r\n\r\nBasically taking a bottom-up approach here so the underlying subsystems are ready to take a context when ready.",
        "comments": 8
    },
    {
        "merged": true,
        "additions": 391,
        "deletions": 373,
        "changed_files": 51,
        "created_at": "2023-07-30T15:49:11Z",
        "closed_at": "2023-08-01T12:38:39Z",
        "merged_at": "2023-08-01T12:38:39Z",
        "body": "- [x] depends on https://github.com/moby/moby/pull/46117\r\n- [x] depends on https://github.com/moby/moby/pull/46118\r\n- relates to https://github.com/containerd/containerd/pull/8894\r\n\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 4
    },
    {
        "merged": true,
        "additions": 173,
        "deletions": 92,
        "changed_files": 2,
        "created_at": "2023-07-30T11:07:10Z",
        "closed_at": "2023-08-01T08:22:02Z",
        "merged_at": "2023-08-01T08:22:02Z",
        "body": "Trying to extract the test fixes from https://github.com/moby/moby/pull/45652, without the OTEL changes, so that we have the ability to backport those to other branches\r\n\r\n- relates to https://github.com/moby/moby/pull/45652\r\n- relates to https://github.com/moby/moby/pull/42835#discussion_r712994123\r\n- relates to https://github.com/moby/moby/pull/42835#discussion_r716617751\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 3
    },
    {
        "merged": true,
        "additions": 100,
        "deletions": 75,
        "changed_files": 12,
        "created_at": "2023-07-29T18:59:04Z",
        "closed_at": "2023-08-01T14:27:23Z",
        "merged_at": "2023-08-01T14:27:23Z",
        "body": "- backport of https://github.com/moby/moby/pull/46117\r\n\r\n----\r\n\r\n- go.mod: update dependencies and go version by\r\n- Use Go1.20\r\n- Fix couple of typos\r\n- Added `WithStdout` and `WithStderr` helpers\r\n- Moved `cmdOperators` handling from `RunCmd` to `StartCmd`\r\n- Deprecate `assert.ErrorType`\r\n- Remove outdated Dockerfile\r\n- add godoc links\r\n\r\nfull diff: https://github.com/gotestyourself/gotest.tools/compare/v3.4.0...v3.5.0\r\n\r\n\r\n(cherry picked from commit ce053a14aa3fd28ae7225d67220b177ade75bc0c)\r\n\r\n<!--\r\nPlease make sure you've read and understood our contributing guidelines;\r\nhttps://github.com/moby/moby/blob/master/CONTRIBUTING.md\r\n\r\n** Make sure all your commits include a signature generated with `git commit -s` **\r\n\r\nFor additional information on our contributing process, read our contributing\r\nguide https://docs.docker.com/opensource/code/\r\n\r\nIf this is a bug fix, make sure your description includes \"fixes #xxxx\", or\r\n\"closes #xxxx\"\r\n\r\nPlease provide the following information:\r\n-->\r\n\r\n**- What I did**\r\n\r\n**- How I did it**\r\n\r\n**- How to verify it**\r\n\r\n**- Description for the changelog**\r\n<!--\r\nWrite a short (one line) summary that describes the changes in this\r\npull request for inclusion in the changelog:\r\n-->\r\n\r\n\r\n**- A picture of a cute animal (not mandatory but encouraged)**\r\n\r\n",
        "comments": 0
    }
]